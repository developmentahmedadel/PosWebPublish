import{a as ue,b as fe}from"./chunk-6T4APQIW.js";import{a as Te}from"./chunk-TB4TCGTI.js";import{a as Se}from"./chunk-EHX2YHES.js";import{c as de,j as me}from"./chunk-7N7H2ETQ.js";import"./chunk-QI74C7BQ.js";import"./chunk-PWIKXZ6E.js";import"./chunk-S52O5BXQ.js";import{a as ce,b as _e}from"./chunk-KOJPIKRQ.js";import"./chunk-WL6N6SLT.js";import{a as pe}from"./chunk-JZVD3M6G.js";import"./chunk-34JSETBR.js";import"./chunk-QFTVA365.js";import"./chunk-LNYZIAUP.js";import"./chunk-HYE6JRVA.js";import{a as re,b as ne,c as ie,d as oe}from"./chunk-DVVEKPVL.js";import{b as le}from"./chunk-GTD5WNPP.js";import{b as z,c as Y,f as K,h as X,k as Z,m as ee,u as te}from"./chunk-M24M3PNC.js";import{c as ae,d as se}from"./chunk-4L6P5Z5M.js";import{A as q,c as L,d as H,e as $,j as J}from"./chunk-JM67XKKX.js";import{$b as M,Bb as p,Cb as s,Db as N,Hb as A,Lb as b,Mb as a,Qb as V,Sb as E,Tb as F,Ub as U,Vb as h,Wb as u,Xb as C,Yb as I,Zb as y,_b as w,ac as D,cb as l,cc as G,db as P,fc as Q,mc as S,na as j,nc as g,oc as W,pc as B,ub as x,wb as T,xa as c,ya as _}from"./chunk-VIO7ZK3G.js";import{a as R,b as k}from"./chunk-3EYC4JTX.js";var ge=["content"],he=["GLComponent"],Ie=(o,m)=>({"btn-success":o,"btn-primary":m});function xe(o,m){if(o&1&&(p(0,"span",32),u(1),S(2,"date"),s()),o&2){let n=a(2);l(),I(" ",W(2,1,n.Transfer.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Ce(o,m){if(o&1){let n=A();p(0,"p-calendar",33),D("ngModelChange",function(e){c(n);let r=a(2);return M(r.Transfer.DocDate,e)||(r.Transfer.DocDate=e),_(e)}),s()}if(o&2){let n=a(2);T("showOtherMonths",!0)("showTime",!0)("showIcon",!0)("showOnFocus",!1),w("ngModel",n.Transfer.DocDate)}}function be(o,m){if(o&1&&(p(0,"small",34),u(1),s()),o&2){let n=a(2);l(),y("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function ve(o,m){if(o&1&&u(0),o&2){let n=m.item;I(" ",n.Name," ")}}function we(o,m){if(o&1&&(p(0,"small",34),u(1),s()),o&2){let n=a(2);l(),y("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Me(o,m){if(o&1&&u(0),o&2){let n=m.item;I(" ",n.Name," ")}}function De(o,m){if(o&1&&(p(0,"small",34),u(1),s()),o&2){let n=a().$implicit,t=a(2);l(),y("Loaded ",n.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ae(o,m){if(o&1&&u(0),o&2){let n=m.item;y(" ",n.Name," - ",n.Code," ")}}function Pe(o,m){if(o&1){let n=A();p(0,"button",45),b("click",function(){c(n);let e=a().index,r=a(2),i=h(4);return _(r.GetItemBalance(e,i))}),N(1,"i",46),s()}if(o&2){let n=a(3);T("disabled",n._AppModeService.DisabledButton)}}function ye(o,m){if(o&1&&(p(0,"small",34),u(1),s()),o&2){let n=a().$implicit,t=a(2);l(),y("Loaded ",n.ProductUnits.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ne(o,m){if(o&1&&u(0),o&2){let n=m.item;I(" ",n.Name," ")}}function Ve(o,m){if(o&1){let n=A();p(0,"tr")(1,"td",35)(2,"div",36)(3,"button",37),b("click",function(){let e=c(n).index,r=a(2);return _(r.AppendRow(e))}),u(4,"+"),s(),p(5,"button",38),b("click",function(){let e=c(n).index,r=a(2);return _(r.RemoveRow(e))}),u(6,"-"),s()()(),p(7,"td",39)(8,"ng-select",40,5),S(10,"translate"),b("clear",function(){let e=c(n).$implicit;return _(e.Items=[])})("focus",function(){let e=c(n).index,r=h(9),i=a(2);return i.ChangeSearchApiDetails("Items",r,e),_(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=c(n).index,r=h(9),i=a(2);return i.ChangeSearchApiDetails("Items",r,e),_(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=c(n).index,r=h(9),i=a(2);return _(i.ChangeSearchApiDetails("Items",r,e))})("close",function(){c(n);let e=a(2);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(n);let e=a(2);return _(e._AppModeService.ResetCurrentPage())})("change",function(){let e=c(n),r=e.$implicit,i=e.index,d=a(2);return _(d.SelectItem(r.ProductId,i))}),D("ngModelChange",function(e){let r=c(n).$implicit;return M(r.ProductId,e)||(r.ProductId=e),_(e)}),x(11,De,2,2,"ng-template",21)(12,Ae,1,2,"ng-template",22),s(),x(13,Pe,2,1,"button",41),s(),p(14,"td",42)(15,"ng-select",43,6),S(17,"translate"),b("clear",function(){let e=c(n).$implicit;return _(e.ProductUnits=[])})("focus",function(){let e=c(n).index,r=h(16),i=a(2);return i.ChangeSearchApiDetails("ItemUnits",r,e),_(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=c(n).index,r=h(16),i=a(2);return i.ChangeSearchApiDetails("ItemUnits",r,e),_(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=c(n).index,r=h(16),i=a(2);return _(i.ChangeSearchApiDetails("ItemUnits",r,e))})("close",function(){c(n);let e=a(2);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(n);let e=a(2);return _(e._AppModeService.ResetCurrentPage())})("change",function(){let e=c(n),r=e.$implicit,i=e.index,d=a(2);return _(d.SelectUnit(r.ProductUnitId,i))}),D("ngModelChange",function(e){let r=c(n).$implicit;return M(r.ProductUnitId,e)||(r.ProductUnitId=e),_(e)}),x(18,ye,2,2,"ng-template",21)(19,Ne,1,1,"ng-template",22),s()(),p(20,"td")(21,"input",44),D("ngModelChange",function(e){let r=c(n).$implicit;return M(r.Quantity,e)||(r.Quantity=e),_(e)}),s()()()}if(o&2){let n=m.$implicit,t=a(2);l(5),T("disabled",t.Transfer.TransferDetails.length==1),l(3),V("placeholder","  ",g(10,16,"SaleInvoice.ChooseProduct"),""),T("items",n.Items)("dropdownPosition","top")("searchable",!0)("virtualScroll",!0),w("ngModel",n.ProductId),l(5),T("ngIf",n.ProductId>0&&t.Transfer.FromStoreId>0&&t.Transfer.ToStoreId>0),l(2),V("placeholder","  ",g(17,18,"Item.ItemUnit"),""),T("items",n.ProductUnits)("dropdownPosition","top")("disabled",n.ProductId==0||n.ProductId==null),w("ngModel",n.ProductUnitId),l(6),w("ngModel",n.Quantity)}}function Ee(o,m){o&1&&(p(0,"span"),u(1),S(2,"translate"),s()),o&2&&(l(),I(" ",g(2,1,"Model.Save"),""))}function Fe(o,m){o&1&&(p(0,"span"),u(1),S(2,"translate"),s()),o&2&&(l(),I(" ",g(2,1,"Model.Update"),""))}function Ue(o,m){if(o&1){let n=A();p(0,"button",47),b("click",function(){c(n);let e=a(2);return _(e.OpenGl())}),u(1),S(2,"translate"),s()}o&2&&(l(),I(" ",g(2,1,"Model.Gl")," "))}function Be(o,m){if(o&1){let n=A();N(0,"app-modal-header",9),p(1,"div",10)(2,"div",11)(3,"div",12)(4,"label",13),u(5),S(6,"translate"),s(),N(7,"input",14),s(),p(8,"div",12)(9,"label",15),u(10),S(11,"translate"),s(),p(12,"input",16),D("ngModelChange",function(e){c(n);let r=a();return M(r.Transfer.Notes,e)||(r.Transfer.Notes=e),_(e)}),s()(),p(13,"div",12),x(14,xe,3,4,"span",17)(15,Ce,1,5,"p-calendar",18),s(),p(16,"div",12)(17,"p",19),u(18),S(19,"translate"),s(),p(20,"ng-select",20,3),b("clear",function(){c(n);let e=a();return _(e.Storages=[])})("focus",function(){c(n);let e=h(21),r=a();return r.ChangeSearchApi("FromStore",e),_(r._AppModeService.ResetCurrentPage())})("keyup",function(){c(n);let e=h(21),r=a();return r.ChangeSearchApi("FromStore",e),_(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(n);let e=h(21),r=a();return _(r.ChangeSearchApi("FromStore",e))})("close",function(){c(n);let e=a();return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(n);let e=a();return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(n);let e=a();return _(e.SelectValue(e.Transfer.FromStoreId,"FromStore"))}),D("ngModelChange",function(e){c(n);let r=a();return M(r.Transfer.FromStoreId,e)||(r.Transfer.FromStoreId=e),_(e)}),x(22,be,2,2,"ng-template",21)(23,ve,1,1,"ng-template",22),s()(),p(24,"div",12)(25,"p",19),u(26),S(27,"translate"),s(),p(28,"ng-select",20,4),b("clear",function(){c(n);let e=a();return _(e.Storages=[])})("focus",function(){c(n);let e=h(29),r=a();return r.ChangeSearchApi("ToStore",e),_(r._AppModeService.ResetCurrentPage())})("keyup",function(){c(n);let e=h(29),r=a();return r.ChangeSearchApi("ToStore",e),_(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(n);let e=h(29),r=a();return _(r.ChangeSearchApi("ToStore",e))})("close",function(){c(n);let e=a();return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(n);let e=a();return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(n);let e=a();return _(e.SelectValue(e.Transfer.ToStoreId,"ToStore"))}),D("ngModelChange",function(e){c(n);let r=a();return M(r.Transfer.ToStoreId,e)||(r.Transfer.ToStoreId=e),_(e)}),x(30,we,2,2,"ng-template",21)(31,Me,1,1,"ng-template",22),s()()(),p(32,"table",23)(33,"thead")(34,"tr")(35,"th",24),u(36,"#"),s(),p(37,"th",25),u(38),S(39,"translate"),s(),p(40,"th",25),u(41),S(42,"translate"),s(),p(43,"th",25),u(44),S(45,"translate"),s()()(),p(46,"tbody"),x(47,Ve,22,20,"tr",26),s()()(),p(48,"div",27)(49,"button",28),b("click",function(){c(n);let e=a();return _(e.Save())}),x(50,Ee,3,3,"span",29)(51,Fe,3,3,"span",29),s(),x(52,Ue,3,3,"button",30),p(53,"button",31),b("click",function(){let e=c(n).$implicit,r=a();return e.close("Close click"),_(r.ResetPage())}),u(54),S(55,"translate"),s()()}if(o&2){let n=a();T("PageTitle","TransferStorage.TransferStorage"),l(5),C(g(6,29,"Table.DocNo")),l(2),T("value",n.Transfer.DocNo)("disabled",!0),l(3),C(g(11,31,"Table.Notes")),l(2),w("ngModel",n.Transfer.Notes),l(2),T("ngIf",n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!1),l(),T("ngIf",n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!0),l(3),C(g(19,33,"TransferStorage.FromStoreId")),l(2),T("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),w("ngModel",n.Transfer.FromStoreId),l(6),C(g(27,35,"TransferStorage.ToStoreId")),l(2),T("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),w("ngModel",n.Transfer.ToStoreId),l(10),C(g(39,37,"TransferStorage.Name")),l(3),C(g(42,39,"SaleInvoice.Units")),l(3),C(g(45,41,"TransferStorage.Quantity")),l(3),T("ngForOf",n.Transfer.TransferDetails),l(2),T("ngClass",Q(45,Ie,n.Transfer.Id==0,n.Transfer.Id!=0)),l(),T("ngIf",n.Transfer.Id==0),l(),T("ngIf",n.Transfer.Id!=0),l(),T("ngIf",n.Transfer.Id>0),l(2),C(g(55,43,"Model.Close"))}}function Oe(o,m){if(o&1&&(p(0,"tr")(1,"td"),u(2),s(),p(3,"td"),u(4),s()()),o&2){let n=m.$implicit;l(2),I(" ",n.Name," "),l(2),I(" ",n.Qty," ")}}function Re(o,m){if(o&1&&(p(0,"tr")(1,"td"),u(2),s(),p(3,"td"),u(4),s()()),o&2){let n=m.$implicit;l(2),I(" ",n.Name," "),l(2),I(" ",n.Qty," ")}}function ke(o,m){if(o&1&&(p(0,"div",48)(1,"p",49),u(2),S(3,"translate"),s(),p(4,"table",50)(5,"thead")(6,"tr")(7,"th"),u(8),S(9,"translate"),s(),p(10,"th"),u(11),S(12,"translate"),s()()(),p(13,"tbody"),x(14,Oe,5,2,"tr",26),s()(),p(15,"p",49),u(16),S(17,"translate"),s(),p(18,"table",50)(19,"thead")(20,"tr")(21,"th"),u(22),S(23,"translate"),s(),p(24,"th"),u(25),S(26,"translate"),s()()(),p(27,"tbody"),x(28,Re,5,2,"tr",26),s()()()),o&2){let n=a();l(2),I(" ",g(3,8,"TransferStorage.BalanceFrom")," "),l(6),C(g(9,10,"SaleInvoice.Name")),l(3),C(g(12,12,"Table.Balance")),l(3),T("ngForOf",n.ItemBalanceFrom),l(2),I(" ",g(17,14,"TransferStorage.BalanceTo")," "),l(6),C(g(23,16,"SaleInvoice.Name")),l(3),C(g(26,18,"Table.Balance")),l(3),T("ngForOf",n.ItemBalanceTo)}}var st=(()=>{let m=class m{constructor(t,e,r,i,d){this._ActivatedRoute=t,this._AppModeService=e,this._SharedObjectModelService=r,this._DefaultSettingsService=i,this._Apiservice=d,this.TablePaging={InputType:"Table",Type:"TablePaging",ReportName:"Transfer",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"Transfer",Join:!0,JoinTables:["Storages SF","Storages ST"],JoinConditions:["T.FromStoreId = SF.Id","T.ToStoreId = ST.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","SF.Name AS FromStoreName","ST.Name AS ToStoreName"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"},{SortName:"FromStoreName",CellName:"TransferStorage.FromStoreId",ExistSearchField:"SF.Name"},{SortName:"ToStoreName",CellName:"TransferStorage.ToStoreId",ExistSearchField:"ST.Name"}]},this.SubscriptionArr=[],this.Transfer={Id:0,Name:"",Notes:"",Code:"",FromStoreId:null,FromStoreName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,DocNo:0,DocDate:"",TransferDetails:[{Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""}]},this.Storages=[],this.ItemBalanceFrom=[],this.ItemBalanceTo=[]}ngOnInit(){let t=Number(this._ActivatedRoute.snapshot.queryParams.Id);t>0&&this.GetByIdRoute(t),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(t){let e=this._Apiservice.getById("TransferStorageEP/GetById",t,!0).subscribe({next:r=>{r.IsSuccess==!0&&r.Obj!=null?(this._SharedObjectModelService.PageModel=r.Obj.model,this._SharedObjectModelService.Gl=r.Obj.Gl,this.Drow(this._SharedObjectModelService.PageModel),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(r.Message)}});this.SubscriptionArr.push(e)}OpenModal(){this._AppModeService.DisabledButton=!0,this.ResetPage(),this.GetPageInfo()}GetPageInfo(){let t=this._Apiservice.get("TransferStorageEP/GetPageInfo",!1).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.Transfer.DocNo=e.Obj,this._AppModeService.DisabledButton=!1):this._AppModeService._Toastr.error(e.Message)},error:e=>{this._AppModeService.DisabledButton=!1}});this.SubscriptionArr.push(t)}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){this.Transfer={Id:t.Id,Name:t.Name,Notes:t.Notes,Code:t.Code,FromStoreId:t.FromStoreId,FromStoreName:t.FromStoreName,ToStoreId:t.ToStoreId,ToStoreName:t.ToStoreName,TotalQty:t.TotalQty,DocNo:t.DocNo,DocDate:new Date(`${t.DocDate}`),TransferDetails:t.TransferDetails},this.Storages=[],this.Storages.push({Id:t.FromStoreId,Name:t.FromStoreName}),this.Storages.push({Id:t.ToStoreId,Name:t.ToStoreName});for(let e=0;e<this.Transfer.TransferDetails.length;e++){let r=this.Transfer.TransferDetails[e];r.Items=[{Id:r.ProductId,Name:r.ProductName,NameAndCode:r.ProductName}],r.ProductUnits=[{Id:r.ProductUnitId,Name:r.ProductUnitName}]}}ChangeSearchApi(t,e){let r=`${e.searchTerm}`.trim();(r==""||r=="null")&&(e.searchTerm="",r=""),this._AppModeService.CurrentPage+=1;let i={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:r,SearchField:"Name"};(t=="FromStore"||t=="ToStore")&&(i.TableName="Storages",i.BranchFilter=!0);let d=this._Apiservice.post("Global/GetAll",i,!1).subscribe({next:f=>{f.IsSuccess==!0&&f.Obj!=null?this.HandleResponse(f.Obj,t):this._AppModeService._Toastr.error(f.Message)}});this.SubscriptionArr.push(d)}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,(e=="FromStore"||e=="ToStore")&&(this.Storages=this._SharedObjectModelService.RemoveDuplicates(this.Storages.concat(t.DataReturn),"Id"))}ChangeSearchApiDetails(t,e,r){let i=`${e.searchTerm}`.trim();(i==""||i=="null")&&(e.searchTerm="",i=""),this._AppModeService.CurrentPage+=1;let d={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:i,SearchField:"Name"};if(t=="Items"&&(d.Columns=["Id","Name","Code"],d.Conditions="ProductType != 2"),t=="ItemUnits"){let v=this.Transfer.TransferDetails[r].ProductId==null?0:this.Transfer.TransferDetails[r].ProductId;d.Conditions=`ItemId = ${v}`,d.Join=!0,d.JoinTables=["Units U"],d.JoinConditions=["T.UnitId = U.Id"],d.Columns=["T.Id","U.Name","T.Code"],d.SearchField="U.Name"}let f=this._Apiservice.post("Global/GetAll",d,!1).subscribe({next:v=>{v.IsSuccess==!0&&v.Obj!=null?this.HandleResponseDetails(v.Obj,t,r):this._AppModeService._Toastr.error(v.Message)}});this.SubscriptionArr.push(f)}HandleResponseDetails(t,e,r){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Items"&&(this.Transfer.TransferDetails[r].Items=this._SharedObjectModelService.RemoveDuplicates(this.Transfer.TransferDetails[r].Items.concat(t.DataReturn),"Id"),this.Transfer.TransferDetails[r].Items=this.Transfer.TransferDetails[r].Items.map(i=>k(R({},i),{NameAndCode:i.Code!=null?`${i.Name} - ${i.Code}`:`${i.Name}`}))),e=="ItemUnits"&&(this.Transfer.TransferDetails[r].ProductUnits=t.DataReturn)}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let r=[];(e=="FromStore"||e=="ToStore")&&(r=this.Storages);let i=r.find(d=>d.Id==t);if(i==null){this._AppModeService.DontPlay();return}else this.Transfer[`${e}Id`]=t,this.Transfer[`${e}Name`]=i.Name}else this.Transfer[`${e}Id`]=null,this.Transfer[`${e}Name`]=""}SelectItem(t,e){if(t!=null&&t>0){let r=this.Transfer.TransferDetails[e].Items.find(i=>i.Id==t);if(r!=null)this.Transfer.TransferDetails[e].ProductId=r.Id,this.Transfer.TransferDetails[e].ProductName=r.Name,this.Transfer.TransferDetails[e].ProductUnitId=null,this.Transfer.TransferDetails[e].ProductUnits=[],this.AfterSelectem(r.Id,e);else{this._Apiservice.DontPlay();return}}else this.Transfer.TransferDetails[e].ProductUnitId=null,this.Transfer.TransferDetails[e].ProductUnits=[]}AfterSelectem(t,e){if(t>0){let r={TableName:"ItemUnits",Columns:["Id","Name"],CurrentPage:1,PageSize:1,SearchText:"",SearchField:"Name"};r.Conditions=`ItemId = ${t}`,r.Join=!0,r.JoinTables=["Units U"],r.JoinConditions=["T.UnitId = U.Id"],r.Columns=["T.Id","U.Name","T.Code"],r.SearchField="U.Name";let i=this._Apiservice.post("Global/GetAll",r,!1).subscribe({next:d=>{if(d.IsSuccess==!0&&d.Obj!=null){let f=d.Obj.DataReturn[0];f!=null&&(this.Transfer.TransferDetails[e].ProductUnits=d.Obj.DataReturn,this.Transfer.TransferDetails[e].ProductUnitId=f.Id,this.Transfer.TransferDetails[e].Quantity=1)}else this._AppModeService._Toastr.error(d.Message)}});this.SubscriptionArr.push(i)}}SelectUnit(t,e){if(t!=null&&t>0){let r=this.Transfer.TransferDetails[e].ProductUnits.find(i=>i.Id==t);if(r!=null)this.Transfer.TransferDetails[e].ProductUnitId=r.Id,this.Transfer.TransferDetails[e].ProductUnitName=r.Name;else{this._Apiservice.DontPlay();return}}}TotalRow(t){let e=Number(this.Transfer.TransferDetails[t].Price),r=Number(this.Transfer.TransferDetails[t].Quantity);return Number(e*r)}TotalTransfer(){let t=0;for(let e=0;e<this.Transfer.TransferDetails.length;e++)this.Transfer.TransferDetails[e].ProductId>0&&this.Transfer.TransferDetails[e].ProductUnitId>0&&(t+=Number(this.Transfer.TransferDetails[e].Price)*Number(this.Transfer.TransferDetails[e].Quantity));return Number(t)}AppendRow(t){let e={Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""};return this.Transfer.TransferDetails.push(e),!0}RemoveRow(t){return this.Transfer.TransferDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Transfer.Error.ErrorFirstRow")),!1):(this.Transfer.TransferDetails.splice(t,1),this.TotalTransfer(),!0)}GetItemBalance(t,e){let r=this.Transfer.TransferDetails[t];if(this.Transfer.ToStoreId==0||this.Transfer.ToStoreId==null||this.Transfer.FromStoreId==0||this.Transfer.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Storage"));return}if(r.ProductId==0||r.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}let i={ProductId:r.ProductId,FromStoreId:this.Transfer.FromStoreId,ToStoreId:this.Transfer.ToStoreId};this._AppModeService.DisabledButton=!0;let d=this._Apiservice.post("ItemEP/ProductBalance",i,!0).subscribe({next:f=>{f.IsSuccess==!0&&f.Obj!=null?(this._AppModeService.DisabledButton=!1,this._AppModeService._NgbModal.open(e,{size:"xl",centered:!0}),this.ItemBalanceFrom=f.Obj.FromStorageBalance,this.ItemBalanceTo=f.Obj.ToStorageBalance):(this._AppModeService.DisabledButton=!1,this._AppModeService._Toastr.error(f.Message))},error:f=>{this._AppModeService.DisabledButton=!1}});this.SubscriptionArr.push(d)}Save(){if(this.Transfer.DocDate==""||this.Transfer.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate"));return}if(this.Transfer.FromStoreId==0||this.Transfer.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterFromStore"));return}if(this.Transfer.ToStoreId==0||this.Transfer.ToStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterToStore"));return}if(this.Transfer.ToStoreId==this.Transfer.FromStoreId){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.ErrorExistStore"));return}for(let e=0;e<this.Transfer.TransferDetails.length;e++){let r=e,i=Number(this.Transfer.TransferDetails[e].ProductId),d=Number(this.Transfer.TransferDetails[e].Quantity),f=Number(this.Transfer.TransferDetails[e].ProductUnitId),v=Number(this.Transfer.TransferDetails[e].Price);if(i==null||i==null||i<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}if(f==null||f==null||f<=0||isNaN(f)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyTransfer.Error.EnterUnit"));return}if(this.Transfer.TransferDetails.filter(O=>O.ProductId==i&&O.ProductUnitId==f).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(r+1));return}if(d==null||d==null||isNaN(d)||d<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterQuantity"));return}this.Transfer.TransferDetails[e].ProductUnitId=f,this.Transfer.TransferDetails[e].ProductId=i,this.Transfer.TransferDetails[e].Price=v}let t={DocDate:this._Apiservice.ConvertISODate(this.Transfer.DocDate),DocNo:this.Transfer.DocNo,TransferDetails:this.Transfer.TransferDetails,FromStoreId:this.Transfer.FromStoreId,FromStoreName:this.Transfer.FromStoreName,ToStoreId:this.Transfer.ToStoreId,ToStoreName:this.Transfer.ToStoreName,TotalQty:this.Transfer.TotalQty,Id:this.Transfer.Id,Name:this.Transfer.Name,Code:this.Transfer.Code,Notes:this.Transfer.Notes};if(t.Id==0){let e=this._Apiservice.post("TransferStorageEP/Add",t,!0).subscribe({next:r=>{r.IsSuccess==!0&&r.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(r.Obj)):this._AppModeService._Toastr.error(r.Message)}});this.SubscriptionArr.push(e)}if(t.Id>0){let e=this._Apiservice.put("TransferStorageEP/Update",t,!0).subscribe({next:r=>{if(r.IsSuccess==!0&&r.Obj!=null){this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.UpdateSuccess"));let i=r.Obj,d=this._SharedObjectModelService.Paging.DataReturn.find(f=>f.Id==i.Id);d!=null&&Object.assign(d,i),this.ResetPage(),this.GetPageInfo()}else this._AppModeService._Toastr.error(r.Message)}});this.SubscriptionArr.push(e)}}OpenGl(){this.GLComponent.Open()}StartConnection(){this.Hub_Connection=new fe().withUrl(`${z.signalrUrl}/Transfer`,{skipNegotiation:!0,transport:ue.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(t=>{console.log("Error Hub Connection",t)})}ServerListener(){this.Hub_Connection?.on("AddTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&(this.Transfer.DocNo=t.DocNo)}),this.Hub_Connection?.on("UpdateTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Transfer.Id&&(alert(this._AppModeService._Translate.instant("Show.UpdateModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.UpdateModelAnother"),t.User),this._AppModeService._NgbModal.dismissAll())}),this.Hub_Connection?.on("DeleteTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Transfer.Id&&(alert(this._AppModeService._Translate.instant("Show.DeleteModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.DeleteModelAnother"),t.User),this._SharedObjectModelService.Paging.DataReturn=this._SharedObjectModelService.Paging.DataReturn.filter(r=>r.Id!=t.Id),this._AppModeService._NgbModal.dismissAll())})}ResetPage(){this.Transfer={Id:0,Name:"",Notes:"",Code:"",FromStoreId:null,FromStoreName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,DocNo:0,DocDate:"",TransferDetails:[{Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""}]},this._DefaultSettingsService.ResetDate(this.Transfer)}ngOnDestroy(){this._AppModeService._NgbModal.dismissAll();for(let t=0;t<this.SubscriptionArr.length;t++)this.SubscriptionArr[t].unsubscribe()}};m.\u0275fac=function(e){return new(e||m)(P(q),P(le),P(pe),P(Se),P(Y))},m.\u0275cmp=j({type:m,selectors:[["app-transfer-storage"]],viewQuery:function(e,r){if(e&1&&(E(ge,5),E(he,5)),e&2){let i;F(i=U())&&(r.ContentModel=i.first),F(i=U())&&(r.GLComponent=i.first)}},standalone:!0,features:[G],decls:7,vars:8,consts:[["content",""],["ItemBalance",""],["GLComponent",""],["SelectFromStore",""],["SelectToStore",""],["SelectItem22",""],["SelectUnits",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","PrintUrl","DeleteUrl","OutModal"],[1,"col-8"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-end","col-12"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","px-1"],["for","DocNo"],["type","number",1,"form-control","text-center",3,"value","disabled"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block text-center ",4,"ngIf"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12","class"," shadow-none text-center w-100",3,"showOtherMonths","showTime","showIcon","showOnFocus","ngModel","ngModelChange",4,"ngIf"],[1,"m-0"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[1,"table","table-hover","table-striped","table-light","mt-4","mb-0"],[1,"col-1"],[1,"col-2"],[4,"ngFor","ngForOf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn","py-3","px-5",3,"click","ngClass"],[4,"ngIf"],["class","btn btn-info mx-3 py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-secondary","py-3","px-5",3,"click"],[1,"d-block","text-center"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","showOtherMonths","showTime","showIcon","showOnFocus","ngModel"],[1,"form-text","text-muted"],[1,"Flex1"],[1,"d-flex","justify-content-center","align-items-center"],[1,"col-5","mx-auto","btn","btn-success",3,"click"],[1,"col-5","mx-auto","btn","btn-danger",3,"click","disabled"],[1,"ngSelect","d-flex"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-11",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["class","col-1 d-block text-center btn btn-info py-0 px-2 mx-2",3,"disabled","click",4,"ngIf"],[1,"ngSelect"],["bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","disabled","ngModel"],["name","Quantity","type","number",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-1","d-block","text-center","btn","btn-info","py-0","px-2","mx-2",3,"click","disabled"],[1,"fa-solid","fa-eye","d-block","mx-auto"],[1,"btn","btn-info","mx-3","py-3","px-5",3,"click"],[1,"modal-body"],[1,"my-2","text-center"],[1,"table","table-striped","table-hover"]],template:function(e,r){if(e&1){let i=A();p(0,"app-dynamic-component",7),b("OpenModalEvent",function(){return c(i),_(r.OpenModal())})("ShowToEditeEvent",function(){return c(i),_(r.ShowToEdite())}),s(),x(1,Be,56,48,"ng-template",null,0,B)(3,ke,29,20,"ng-template",8,1,B),N(5,"app-glsheard",null,2)}if(e&2){let i=h(2);T("PageTitle","TransferStorage.TransferStorage")("TablePaging",r.TablePaging)("FullScreen",!1)("GlResponse",!0)("GetById","TransferStorageEP/GetById")("PrintUrl","TransferStorage")("DeleteUrl","TransferStorageEP/Delete")("OutModal",i)}},dependencies:[_e,ce,J,te,K,ee,X,Z,H,$,L,se,ae,oe,ie,re,ne,me,Te,de],styles:["svg[_ngcontent-%COMP%]{cursor:pointer}"]});let o=m;return o})();export{st as TransferStorageComponent};
