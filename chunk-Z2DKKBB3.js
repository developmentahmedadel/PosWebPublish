import{a as ve}from"./chunk-AFVHDR2Z.js";import{b as de,h as ge}from"./chunk-RMPXGUPG.js";import"./chunk-6G7QKXJW.js";import"./chunk-PE2JD36L.js";import{a as ue}from"./chunk-NNHHLG53.js";import{g as le,h as ce,o as se,s as me,x as _e}from"./chunk-RAAURFHQ.js";import{b as pe}from"./chunk-UVSBIWKY.js";import"./chunk-5EQTOVFJ.js";import{a as Se}from"./chunk-OZ63RRZR.js";import{g as ae}from"./chunk-3T7HRBK4.js";import"./chunk-G323P4PR.js";import"./chunk-NZD6IPKE.js";import"./chunk-EKOK3I7J.js";import{a as te,b as ne,c as ie,d as oe}from"./chunk-SU7IEUNK.js";import"./chunk-MYPGER6Q.js";import{k as re}from"./chunk-CETGYK4I.js";import{c as ee}from"./chunk-F7IHWOEY.js";import{c as H,d as K}from"./chunk-GJAIQ3XH.js";import{c as V,d as z,g as J,i as Q,l as q,n as X,t as Y,v as Z}from"./chunk-UA6GT64L.js";import{e as U,j as $}from"./chunk-GOUT62LL.js";import{$b as M,Cb as a,Db as r,Eb as b,Ib as C,Mb as I,Nb as c,Wb as f,X as w,Xb as p,Yb as v,Zb as h,_b as E,ac as N,bc as D,cc as G,db as l,dc as j,eb as P,ec as F,ia as R,na as k,nc as S,oc as g,pc as W,qc as L,vb as y,xa as s,xb as u,ya as m}from"./chunk-RH76WUG2.js";import{a as B,b as O}from"./chunk-3EYC4JTX.js";var he=()=>["Name","TotalQty","Wa","TotaPrice"];function xe(o,_){if(o&1&&(a(0,"small",39),p(1),r()),o&2){let t=c(2);l(),E("Loaded ",t.Storages.length," of ",t._SharedObjectModelService.TotalItems,"")}}function ye(o,_){if(o&1&&p(0),o&2){let t=_.item;h(" ",t.Name," ")}}function fe(o,_){if(o&1&&(a(0,"small",39),p(1),r()),o&2){let t=c(2);l(),E("Loaded ",t.Groups.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ce(o,_){if(o&1&&p(0),o&2){let t=_.item;h(" ",t.Name," ")}}function Te(o,_){if(o&1&&(a(0,"small",39),p(1),r()),o&2){let t=c(2);l(),E("Loaded ",t.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function be(o,_){if(o&1&&p(0),o&2){let t=_.item;h(" ",t.NameAndCode," ")}}function we(o,_){if(o&1){let t=C();a(0,"div",40)(1,"p-button",41),I("onClick",function(){s(t);let e=c(2);return m(e.ExpandAll())}),r(),a(2,"p-button",42),I("onClick",function(){s(t);let e=c(2);return m(e.CollapseAll())}),r()()}}function Me(o,_){o&1&&(a(0,"tr")(1,"th"),p(2),S(3,"translate"),r(),a(4,"th"),p(5),S(6,"translate"),r(),a(7,"th"),p(8),S(9,"translate"),r(),a(10,"th"),p(11),S(12,"translate"),r(),a(13,"th"),p(14),S(15,"translate"),r(),a(16,"th"),p(17),S(18,"translate"),r(),a(19,"th"),p(20),S(21,"translate"),r(),a(22,"th"),p(23,"-"),r()()),o&2&&(l(2),v(g(3,7,"Table.Units")),l(3),v(g(6,9,"Table.Name")),l(3),v(g(9,11,"Table.BalanceDaftare")),l(3),v(g(12,13,"Table.BalanceNow")),l(3),v(g(15,15,"Table.WA")),l(3),v(g(18,17,"Table.Amount")),l(3),v(g(21,19,"Table.Status")))}function Ne(o,_){if(o&1&&b(0,"p-button",52),o&2){let t=c(),n=t.$implicit,e=t.expanded,i=c(2);u("pRowToggler",n)("text",!0)("rounded",!0)("plain",!0)("icon",e?"pi pi-chevron-down":i._Apiservice.Language=="ar"?"pi pi-chevron-left":"pi pi-chevron-right")}}function De(o,_){o&1&&(a(0,"span",53),p(1," \u0645\u062A\u0633\u0627\u0648\u064A "),r())}function Pe(o,_){o&1&&(a(0,"span",54),p(1," \u0639\u062C\u0632 "),r())}function Ee(o,_){o&1&&(a(0,"span",55),p(1," \u0641\u0627\u0626\u0636 "),r())}function Ve(o,_){if(o&1){let t=C();a(0,"span",56)(1,"button",57),I("click",function(){s(t);let e=c().$implicit,i=c(2);return e.InventoryType=1,m(i.Calc())}),p(2," \u0637\u0628\u064A\u0639\u064A "),r(),a(3,"button",58),I("click",function(){s(t);let e=c().$implicit,i=c(2);return e.InventoryType=2,m(i.Calc())}),p(4," \u063A\u064A\u0631 \u0637\u0628\u064A\u0639\u064A "),r()()}if(o&2){let t=c().$implicit;l(),u("disabled",t.InventoryType==1),l(2),u("disabled",t.InventoryType==2)}}function Ae(o,_){if(o&1){let t=C();a(0,"button",59),I("click",function(){s(t);let e=c().$implicit,i=c(2);return m(i.RemoveProcut(e))}),b(1,"i",60),r()}}function Be(o,_){if(o&1){let t=C();a(0,"tr")(1,"td"),y(2,Ne,1,5,"p-button",43),r(),a(3,"td")(4,"span",44),p(5),r()(),a(6,"td")(7,"span",44),p(8),r()(),a(9,"td")(10,"input",45),I("keyup",function(){s(t);let e=c(2);return m(e.Calc())})("change",function(){s(t);let e=c(2);return m(e.Calc())})("change",function(){let e=s(t).$implicit,i=c(2);return m(i.ConvertNumber(e.BalanceNow)==e.BalanceDocument?e.InventoryType=0:e.InventoryType=e.InventoryType)}),D("ngModelChange",function(e){let i=s(t).$implicit;return N(i.BalanceNow,e)||(i.BalanceNow=e),m(e)}),r()(),a(11,"td")(12,"span",44),p(13),r()(),a(14,"td")(15,"span",44),p(16),r()(),a(17,"td",46),y(18,De,2,0,"span",47)(19,Pe,2,0,"span",48)(20,Ee,2,0,"span",49)(21,Ve,5,2,"span",50),r(),a(22,"td"),y(23,Ae,2,0,"button",51),r()()}if(o&2){let t=_.$implicit,n=c(2);l(2),u("ngIf",n.Inventory.Id==0),l(3),h(" ",t.ProductName,""),l(3),h(" ",t.BalanceDocument.toFixed(2)," "),l(2),u("disabled",n.Inventory.Id>0),M("ngModel",t.BalanceNow),l(3),h(" ",t.WADocument.toFixed(2)," "),l(3),h(" ",t.TotaPriceDocument.toFixed(2)," "),l(2),u("ngIf",n.ConvertNumber(t.BalanceNow)==t.BalanceDocument),l(),u("ngIf",n.ConvertNumber(t.BalanceNow)<t.BalanceDocument),l(),u("ngIf",n.ConvertNumber(t.BalanceNow)>t.BalanceDocument),l(),u("ngIf",n.ConvertNumber(t.BalanceNow)<t.BalanceDocument),l(2),u("ngIf",n.Inventory.Id==0)}}function Oe(o,_){o&1&&(a(0,"tr")(1,"th"),p(2),S(3,"translate"),r(),a(4,"th"),p(5),S(6,"translate"),r()()),o&2&&(l(2),h("",g(3,2,"Table.Name")," "),l(3),v(g(6,4,"Table.Quantity")))}function Re(o,_){if(o&1&&(a(0,"tr")(1,"td")(2,"span",44),p(3),r()(),a(4,"td")(5,"span",44),p(6),r()()()),o&2){let t=_.$implicit;l(3),h(" ",t.UnitName," "),l(3),h(" ",t.Qty," ")}}function ke(o,_){if(o&1&&(a(0,"tr")(1,"td",61)(2,"p-table",62),y(3,Oe,7,6,"ng-template",31)(4,Re,7,2,"ng-template",32),r()()()),o&2){let t=_.$implicit;l(2),u("value",t.ItemUnits)}}function Ge(o,_){if(o&1){let t=C();a(0,"p-paginator",63),I("onPageChange",function(e){s(t);let i=c(2);return m(i.onPageChange(e))}),r()}if(o&2){let t=c(2);u("first",t._SharedObjectModelService.Paging.CurrentPage)("rows",t._SharedObjectModelService.Paging.PageSize)("totalRecords",t._SharedObjectModelService.Paging.TotalItems)("rowsPerPageOptions",t._AppModeService.RowCount)}}function je(o,_){if(o&1){let t=C();a(0,"p-paginator",64),I("onPageChange",function(e){s(t);let i=c(2);return m(i.onPageChange(e))}),r()}if(o&2){let t=c(2);u("first",t._SharedObjectModelService.Paging.CurrentPage)("rows",t._SharedObjectModelService.Paging.PageSize)("totalRecords",t._SharedObjectModelService.Paging.TotalItems)}}function Fe(o,_){if(o&1){let t=C();a(0,"button",24),I("click",function(){s(t);let e=c(2);return m(e.Save())}),a(1,"span"),p(2),S(3,"translate"),r(),b(4,"i",65),r()}o&2&&(l(2),h(" ",g(3,1,"Model.Save"),""))}function We(o,_){if(o&1){let t=C();b(0,"app-modal-header",7),a(1,"div",8)(2,"div",9)(3,"div",10)(4,"label",11),p(5),S(6,"translate"),r(),b(7,"input",12),r(),a(8,"div",13)(9,"label",14),p(10),S(11,"translate"),r(),a(12,"input",15),D("ngModelChange",function(e){s(t);let i=c();return N(i.Inventory.Notes,e)||(i.Inventory.Notes=e),m(e)}),r()(),a(13,"div",13)(14,"span",16),p(15),S(16,"date"),r()(),a(17,"div",13)(18,"p",17),p(19),S(20,"translate"),r(),a(21,"ng-select",18,2),I("clear",function(){s(t);let e=c();return m(e.Storages=[])})("focus",function(){s(t);let e=f(22),i=c();return i.ChangeSearchApi("Storages",e),m(i._AppModeService.ResetCurrentPage())})("keyup",function(){s(t);let e=f(22),i=c();return i.ChangeSearchApi("Storages",e),m(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(t);let e=f(22),i=c();return m(i.ChangeSearchApi("Storages",e))})("close",function(){s(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){s(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){s(t);let e=c();return e.SelectValue(e.SearchModel.StoreId,"Store"),m(e.ResetPage())}),D("ngModelChange",function(e){s(t);let i=c();return N(i.SearchModel.StoreId,e)||(i.SearchModel.StoreId=e),m(e)}),y(23,xe,2,2,"ng-template",19)(24,ye,1,1,"ng-template",20),r()(),a(25,"div",13)(26,"p"),p(27),S(28,"translate"),r(),a(29,"ng-select",18,3),I("clear",function(){s(t);let e=c();return m(e.Groups=[])})("focus",function(){s(t);let e=f(30),i=c();return i.ChangeSearchApi("ItemGroups",e),m(i._AppModeService.ResetCurrentPage())})("keyup",function(){s(t);let e=f(30),i=c();return i.ChangeSearchApi("ItemGroups",e),m(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(t);let e=f(30),i=c();return m(i.ChangeSearchApi("ItemGroups",e))})("close",function(){s(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){s(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){s(t);let e=c();return e.SelectValue(e.SearchModel.GroupId,"Group"),e.SearchModel.ProductId=null,m(e.ResetPage())}),D("ngModelChange",function(e){s(t);let i=c();return N(i.SearchModel.GroupId,e)||(i.SearchModel.GroupId=e),m(e)}),y(31,fe,2,2,"ng-template",19)(32,Ce,1,1,"ng-template",20),r()(),a(33,"div",13)(34,"label",21),p(35),S(36,"translate"),r(),a(37,"ng-select",22,4),I("clear",function(){s(t);let e=c();return m(e.Items=[])})("focus",function(){s(t);let e=f(38),i=c();return i.ChangeSearchApi("Items",e),m(i._AppModeService.ResetCurrentPage())})("keyup",function(){s(t);let e=f(38),i=c();return i.ChangeSearchApi("Items",e),m(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(t);let e=f(38),i=c();return m(i.ChangeSearchApi("Items",e))})("close",function(){s(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){s(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){s(t);let e=c();return e.SelectValue(e.SearchModel.ProductId,"Product"),e.SearchModel.GroupId=null,m(e.ResetPage())}),D("ngModelChange",function(e){s(t);let i=c();return N(i.SearchModel.ProductId,e)||(i.SearchModel.ProductId=e),m(e)}),y(39,Te,2,2,"ng-template",19)(40,be,1,1,"ng-template",20),r()(),a(41,"div",23)(42,"button",24),I("click",function(){s(t);let e=c();return m(e.Search())}),p(43),S(44,"translate"),b(45,"i",25),r()()(),a(46,"div",26)(47,"table",27)(48,"thead")(49,"tr")(50,"th"),p(51),S(52,"translate"),r(),a(53,"th"),p(54),S(55,"translate"),r(),a(56,"th"),p(57),S(58,"translate"),r()()(),a(59,"tbody")(60,"tr")(61,"td"),p(62),r(),a(63,"td"),p(64),r(),a(65,"td"),p(66),r()()()()(),a(67,"div",28)(68,"p-table",29,5),y(70,we,3,0,"ng-template",30)(71,Me,24,21,"ng-template",31)(72,Be,24,12,"ng-template",32)(73,ke,5,1,"ng-template",33),r(),y(74,Ge,1,4,"p-paginator",34)(75,je,1,3,"p-paginator",35),r()(),a(76,"div",36),y(77,Fe,5,3,"button",37),a(78,"button",38),I("click",function(){let e=s(t).$implicit,i=c();return e.close("Close click"),m(i.ResetPage())}),p(79),S(80,"translate"),r()()}if(o&2){let t=c();u("PageTitle",t.TablePaging.PageTitle),l(5),v(g(6,41,"Table.DocNo")),l(2),u("disabled",!0)("value",t.SearchModel.DocNo),l(3),v(g(11,43,"Table.Notes")),l(2),M("ngModel",t.Inventory.Notes),l(3),h(" ",W(16,45,t.Inventory.DocDate,"d-M-yyyy h:mm:ss a")," "),l(4),v(g(20,48,"SaleInvoice.Storage")),l(2),u("items",t.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),M("ngModel",t.SearchModel.StoreId),l(6),v(g(28,50,"Item.ItemGroup")),l(2),u("items",t.Groups)("autofocus",!1)("virtualScroll",!0)("searchable",!0),M("ngModel",t.SearchModel.GroupId),l(6),h(" ",g(36,52,"BalanceStorage.ItemId"),""),l(2),u("items",t.Items)("autofocus",!1)("virtualScroll",!0)("searchable",!0),M("ngModel",t.SearchModel.ProductId),l(6),h("",g(44,54,"Model.Search")," "),l(8),v(g(52,56,"InventorySettlement.TotalNormal")),l(3),v(g(55,58,"InventorySettlement.TotalUnNormal")),l(3),v(g(58,60,"InventorySettlement.TotalOver")),l(5),v(t.Inventory.TotalNormal.toFixed(2)),l(2),v(t.Inventory.TotalUnNormal.toFixed(2)),l(2),v(t.Inventory.TotalOver.toFixed(2)),l(2),u("expandedRowKeys",t.expandedRows)("value",t.Inventory.InventorySettlementDetails)("paginator",!1)("rows",10)("globalFilterFields",F(64,he)),l(6),u("ngIf",t._SharedObjectModelService.Paging.TotalItems>=10),l(),u("ngIf",t._SharedObjectModelService.Paging.TotalItems<10),l(2),u("ngIf",t.Inventory.Id==0),l(2),v(g(80,62,"Model.Close"))}}var ut=(()=>{let _=class _{constructor(n,e,i,d){this._SharedObjectModelService=n,this._AppModeService=e,this._DefaultSettingsService=i,this._Apiservice=d,this._ServiceLifeTime=R(V),this.TablePaging={PageTitle:"InventorySettlement.InventorySettlement",GetById:"StorageSettlementEP/GetById",BranchFilter:!0,Url:"Global/GetAll",TableName:"InventorySettlement",Join:!0,JoinTables:["Storages SF"],JoinConditions:["T.StoreId = SF.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","SF.Name AS StoreName"],TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes",ExistSearchField:"T.Notes"},{SortName:"StoreName",CellName:"SaleInvoice.Storage",ExistSearchField:"SF.Name"}]},this.Inventory={InventorySettlementDetails:[],Id:0,Name:"",Code:"",DocDate:"",DocNo:0,StoreId:0,StoreName:"",TotalNormal:0,TotalUnNormal:0,TotalOver:0},this.Items=[],this.Groups=[],this.Storages=[],this.SearchModel={GroupId:null,StoreId:null,ProductId:null},this.expandedRows={}}ngOnInit(){}OpenModal(){this.GetPageInfo(),this.SearchModel={GroupId:null,StoreId:null,ProductId:null},this.ResetPage()}GetPageInfo(){this._Apiservice.get("StorageSettlementEP/GetPageInfo",!1).pipe(w(this._ServiceLifeTime.Destroyed$)).subscribe({next:n=>{this.SearchModel.DocNo=n.Obj}})}ShowToEdite(n){this.Drow(n.PageModel)}Drow(n){this.Inventory={InventorySettlementDetails:[],Id:n.Id,Name:"",Code:"",DocDate:new Date(`${n.DocDate}`),DocNo:n.DocNo,StoreId:n.StoreId,StoreName:n.StoreName,TotalNormal:n.TotalNormal,TotalUnNormal:n.TotalUnNormal,TotalOver:n.TotalOver},this.Storages=[{Id:n.StoreId,Name:n.StoreName}],this.SearchModel.StoreId=n.StoreId,this.SearchModel.DocNo=n.DocNo,this.Inventory.InventorySettlementDetails=[];for(let e=0;e<n.InventorySettlementDetails.length;e++){let i=n.InventorySettlementDetails[e];this.Inventory.InventorySettlementDetails.push(i)}}ChangeSearchApi(n,e){let i=`${e.searchTerm}`.trim();(i==""||i=="null")&&(e.searchTerm="",i=""),this._AppModeService.CurrentPage+=1;let d={TableName:n,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:i,SearchField:"Name"};n=="Storages"&&(d.BranchFilter=!0),n=="Items"&&(d.Columns=["Id","Name","Code"],d.Conditions="ProductType != 2"),this._Apiservice.post("Global/GetAll",d,!1).pipe(w(this._ServiceLifeTime.Destroyed$)).subscribe({next:x=>{this.HandleResponse(x.Obj,n)}})}HandleResponse(n,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=n.TotalItems,e=="Storages"&&(this.Storages=this._SharedObjectModelService.RemoveDuplicates(this.Storages.concat(n.DataReturn),"Id")),e=="ItemGroups"&&(this.Groups=this._SharedObjectModelService.RemoveDuplicates(this.Groups.concat(n.DataReturn),"Id")),e=="Items"&&(this.Items=this._SharedObjectModelService.RemoveDuplicates(this.Items.concat(n.DataReturn),"Id"),this.Items=this.Items.map(i=>O(B({},i),{NameAndCode:`${i.Name} - ${i.Code}`})))}SelectValue(n,e){if(n!=null&&(n>0||n!="")){let i=[];e=="Store"&&(i=this.Storages),e=="Group"&&(i=this.Groups),e=="Product"&&(i=this.Items);let d=i.find(x=>x.Id==n);if(d==null){this._AppModeService.DontPlay();return}else this.SearchModel[`${e}Id`]=n,this.SearchModel[`${e}Name`]=d.Name}else this.SearchModel[`${e}Id`]=null,this.SearchModel[`${e}Name`]=""}Search(){if(this.SearchModel.StoreId==0||this.SearchModel.StoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyOffer.Error.EnterStore"));return}let n={ProductId:this.SearchModel.ProductId,StoreId:this.SearchModel.StoreId,GroupId:this.SearchModel.GroupId,CurrentPage:1,PageSize:this._SharedObjectModelService.Paging.PageSize};this._Apiservice.post("StorageSettlementEP/GetItems",n,!0).pipe(w(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.Inventory.InventorySettlementDetails=this._SharedObjectModelService.RemoveDuplicates(this.Inventory.InventorySettlementDetails.concat(e.Obj.List),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=e.Obj.TotalItems,this.Inventory.TotalNormal=0,this.Inventory.TotalUnNormal=0,this.Inventory.TotalOver=0):this.Inventory.InventorySettlementDetails=[]}})}onPageChange(n){n.page++,n.first,n.rows,this._SharedObjectModelService.Paging.CurrentPage=n.first,this._SharedObjectModelService.Paging.PageSize=n.rows;let e={ProductId:this.SearchModel.ProductId,StoreId:this.SearchModel.StoreId,GroupId:this.SearchModel.GroupId,PageSize:this._SharedObjectModelService.Paging.PageSize,CurrentPage:n.page};this._Apiservice.post("StorageSettlementEP/GetItems",e,!0).pipe(w(this._ServiceLifeTime.Destroyed$)).subscribe({next:i=>{this.Inventory.InventorySettlementDetails=this._SharedObjectModelService.RemoveDuplicates(this.Inventory.InventorySettlementDetails.concat(i.Obj.List),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=i.Obj.TotalItems}})}RemoveProcut(n){this.Inventory.InventorySettlementDetails=this.Inventory.InventorySettlementDetails.filter(e=>e.ProductId!=n.ProductId),this.Calc()}ExpandAll(){this.expandedRows=this.Inventory.InventorySettlementDetails.reduce((n,e)=>(n[e.Id]=!0)&&n,{})}CollapseAll(){this.expandedRows={}}ConvertNumber(n){return Number(n)}Calc(){this.Inventory.TotalNormal=0,this.Inventory.TotalUnNormal=0,this.Inventory.TotalOver=0;for(let n=0;n<this.Inventory.InventorySettlementDetails.length;n++){let e=Number(this.Inventory.InventorySettlementDetails[n].BalanceDocument),i=Number(this.Inventory.InventorySettlementDetails[n].BalanceNow),d=Number(this.Inventory.InventorySettlementDetails[n].WADocument);i>e&&(this.Inventory.InventorySettlementDetails[n].InventoryType=3);let x=Number(this.Inventory.InventorySettlementDetails[n].InventoryType);x==1&&(this.Inventory.TotalNormal+=(e-i)*d),x==2&&(this.Inventory.TotalUnNormal+=(e-i)*d),x==3&&i-e>0&&(this.Inventory.TotalOver+=(i-e)*d)}}Save(){if(this.Inventory.StoreId=this.SearchModel.StoreId,this.Inventory.DocNo=this.SearchModel.DocNo,this.Inventory.DocDate==""||this.Inventory.DocDate==null)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate")),!1;if(this.Inventory.StoreId==0||this.Inventory.StoreId==null)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyOffer.Error.EnterStore")),!1;for(let i=0;i<this.Inventory.InventorySettlementDetails.length;i++){let d=this.Inventory.InventorySettlementDetails[i].ProductName,x=this.Inventory.InventorySettlementDetails[i].BalanceDocument,T=Number(`${this.Inventory.InventorySettlementDetails[i].BalanceNow}`.trim()),Ie=Number(this.Inventory.InventorySettlementDetails[i].InventoryType),A=this.Inventory.InventorySettlementDetails[i].WADocument;if(x>0&&T<0)return alert("BalanceDocument > 0 && (BalanceNow <= 0)"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+d),!1;if(Number(T)>0&&A<=0)return alert("Number(BalanceNow) > 0 && WADocument <= 0"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.WANow")+" "+d),!1;if((Number(T)<0||T<0)&&A>0)return alert("(Number(BalanceNow) < 0 || (BalanceNow <= 0))  && WADocument > 0"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+d),!1;if(Number(T)<0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+d),!1;if(Ie==0&&Number(x)-Number(T)>0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.InventoryType")+" "+d),!1}let e={InventorySettlementDetails:this.Inventory.InventorySettlementDetails.filter(i=>i.BalanceDocument>0&&i.BalanceNow!="null"||Number(i.BalanceNow)>0),Id:0,Name:"",Code:"",DocDate:this._Apiservice.ConvertISODate(this.Inventory.DocDate),DocNo:this.Inventory.DocNo,StoreId:this.Inventory.StoreId,StoreName:this.Inventory.StoreName,TotalNormal:this.Inventory.TotalNormal,TotalUnNormal:this.Inventory.TotalUnNormal,TotalOver:this.Inventory.TotalOver};return e.Id==0&&this._Apiservice.post("StorageSettlementEP/Add",e,!0).pipe(w(this._ServiceLifeTime.Destroyed$)).subscribe({next:i=>{this._AppModeService._Toastr.success(i.Message),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(i.Obj)}}),!0}ResetPage(){this.Inventory={InventorySettlementDetails:[],Id:0,Name:"",Code:"",DocDate:"",DocNo:0,StoreId:0,StoreName:"",TotalNormal:0,TotalUnNormal:0,TotalOver:0},this._DefaultSettingsService.ResetDate(this.Inventory)}trackByMethod(n,e){return e.Id}ngOnDestroy(){}};_.\u0275fac=function(e){return new(e||_)(P(Se),P(ee),P(ve),P(z))},_.\u0275cmp=k({type:_,selectors:[["app-inventory-settlement"]],standalone:!0,features:[G([V]),j],decls:4,vars:5,consts:[["dynamiccomponent",""],["content",""],["SelectStorages",""],["SelectItemGroup",""],["SelectFromStore",""],["dt1",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GetById","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-center"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","col-xl-1","p-2"],["for","DocNo"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","col-xl-2","p-2"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"d-block","text-center"],["for","Store"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["for","Item"],["placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","col-xl-1","p-2","align-self-end","text-center","mx-auto"],[1,"btn-Add","btn",3,"click"],[1,"mx-1","pi","pi-search"],[1,"DivPaging","col-12","table-responsive"],[1,"table","table-striped","table-hover","w-100","m-0"],[1,"DivPaging","col-12","p-0","table-responsive"],["dataKey","Id",3,"expandedRowKeys","value","paginator","rows","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["appendTo","table",3,"first","rows","totalRecords","rowsPerPageOptions","onPageChange",4,"ngIf"],["appendTo","table",3,"first","rows","totalRecords","onPageChange",4,"ngIf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],["class","btn-Add btn",3,"click",4,"ngIf"],["type","button",1,"btn","btn-light","btn-Close","border","border-1","border-dark",3,"click"],[1,"form-text","text-muted"],[1,"flex","flex-wrap","justify-content-end","gap-2","CollapseGroup"],["icon","pi pi-plus","text","",3,"onClick"],["icon","pi pi-minus","text","",3,"onClick"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon",4,"ngIf"],[1,"text-dark"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"keyup","change","ngModelChange","disabled","ngModel"],[1,"p-0","text-center"],["class","py-3 m-0 text-dark text-center",4,"ngIf"],["class"," py-3 m-0 text-danger text-center",4,"ngIf"],["class"," py-3 m-0 text-success text-center",4,"ngIf"],["class","mx-2",4,"ngIf"],["class","btn btn-Delete",3,"click",4,"ngIf"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon"],[1,"py-3","m-0","text-dark","text-center"],[1,"py-3","m-0","text-danger","text-center"],[1,"py-3","m-0","text-success","text-center"],[1,"mx-2"],[1,"btn","btn-Refresh","p-2",3,"click","disabled"],[1,"btn","btn-Delete","btn-Page","p-2",3,"click","disabled"],[1,"btn","btn-Delete",3,"click"],[1,"mx-1","pi","pi-trash","fw-bold"],["colspan","8",1,"p-0"],["dataKey","Id",3,"value"],["appendTo","table",3,"onPageChange","first","rows","totalRecords","rowsPerPageOptions"],["appendTo","table",3,"onPageChange","first","rows","totalRecords"],[1,"mx-1","pi","pi-save"]],template:function(e,i){if(e&1){let d=C();a(0,"app-dynamic-component",6,0),I("OpenModalEvent",function(){return s(d),m(i.OpenModal())})("ShowToEditeEvent",function(T){return s(d),m(i.ShowToEdite(T))}),r(),y(2,We,81,65,"ng-template",null,1,L)}if(e&2){let d=f(3);u("PageTitle",i.TablePaging.PageTitle)("TablePaging",i.TablePaging)("FullScreen",!0)("GetById",i.TablePaging.GetById)("OutModal",d)}},dependencies:[pe,ae,re,$,ce,le,J,X,Q,Y,q,U,_e,se,me,Z,K,H,oe,ie,te,ne,ge,de,ue]});let o=_;return o})();export{ut as InventorySettlementComponent};
