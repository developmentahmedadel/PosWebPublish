import{a as se}from"./chunk-6FCX7RNP.js";import{b as oe,c as pe,h as ue}from"./chunk-RMPXGUPG.js";import"./chunk-6G7QKXJW.js";import"./chunk-PE2JD36L.js";import{a as le}from"./chunk-NNHHLG53.js";import"./chunk-RAAURFHQ.js";import"./chunk-UVSBIWKY.js";import"./chunk-5EQTOVFJ.js";import{a as de}from"./chunk-OZ63RRZR.js";import"./chunk-3T7HRBK4.js";import"./chunk-G323P4PR.js";import"./chunk-NZD6IPKE.js";import"./chunk-EKOK3I7J.js";import{a as re,b as ne,c as ae,d as ce}from"./chunk-SU7IEUNK.js";import"./chunk-MYPGER6Q.js";import"./chunk-CETGYK4I.js";import{c as ie}from"./chunk-F7IHWOEY.js";import{c as q,d as z}from"./chunk-GJAIQ3XH.js";import{c as B,d as J,g as K,i as X,l as Y,n as ee,v as te}from"./chunk-UA6GT64L.js";import{A as H,d as Z,e as $}from"./chunk-GOUT62LL.js";import{$b as v,Cb as n,Db as c,Eb as E,Fb as G,Gb as W,Ib as A,Mb as P,Nb as d,Tb as N,Ub as V,Vb as U,Wb as T,X as y,Xb as o,Yb as h,Zb as g,_b as O,ac as C,bc as R,cc as j,db as a,dc as L,eb as M,ia as F,na as Q,nc as _,oc as f,qc as k,vb as x,xa as u,xb as S,ya as s}from"./chunk-RH76WUG2.js";import{a as D,b as w}from"./chunk-3EYC4JTX.js";var _e=["dynamiccomponent"],fe=["content"];function he(l,m){if(l&1&&(n(0,"small",29),o(1),c()),l&2){let r=d(2);a(),O("Loaded ",r.ManufactureOrder.Recipes.length," of ",r._SharedObjectModelService.TotalItems,"")}}function ge(l,m){if(l&1&&o(0),l&2){let r=m.item;O(" ",r.ProductName," - ",r.ProductCode," ")}}function Se(l,m){if(l&1&&(n(0,"small",29),o(1),c()),l&2){let r=d(2);a(),O("Loaded ",r.ManufactureOrder.ProductUnits.length," of ",r._SharedObjectModelService.TotalItems,"")}}function xe(l,m){if(l&1&&o(0),l&2){let r=m.item;g(" ",r.NameAndUnitFactor," ")}}function Te(l,m){if(l&1&&(n(0,"small",29),o(1),c()),l&2){let r=d(2);a(),O("Loaded ",r.ManufactureOrder.CostCenters.length," of ",r._SharedObjectModelService.TotalItems,"")}}function Ie(l,m){if(l&1&&o(0),l&2){let r=m.item;g(" ",r.Name," ")}}function Pe(l,m){if(l&1&&(n(0,"small",29),o(1),c()),l&2){let r=d(2);a(),O("Loaded ",r.ManufactureOrder.Storages.length," of ",r._SharedObjectModelService.TotalItems,"")}}function ye(l,m){if(l&1&&o(0),l&2){let r=m.item;g(" ",r.Name," ")}}function ve(l,m){if(l&1&&(n(0,"tr")(1,"td"),o(2),c(),n(3,"td"),o(4),c(),n(5,"td"),o(6),c(),n(7,"td"),o(8),c(),n(9,"td"),o(10),c(),n(11,"td"),o(12),c()()),l&2){let r=m.$implicit,i=d(4);a(2),h(r.StoreName),a(2),h(r.ProductName),a(2),h(r.ProductUnitName),a(2),h(r.Quantity),a(2),h(i._AppModeService.GetTwoNumberAfterZero(r.WA)),a(2),h(i._AppModeService.GetTwoNumberAfterZero(r.TotalPrice))}}function Ce(l,m){if(l&1&&(n(0,"div",32)(1,"p",33),o(2),_(3,"translate"),n(4,"span"),o(5,"["),c(),o(6),n(7,"span"),o(8,"]"),c()(),n(9,"table",34)(10,"thead")(11,"tr")(12,"th",35),o(13),_(14,"translate"),c(),n(15,"th",35),o(16),_(17,"translate"),c(),n(18,"th",35),o(19),_(20,"translate"),c(),n(21,"th",35),o(22),_(23,"translate"),c(),n(24,"th",35),o(25),_(26,"translate"),c(),n(27,"th",35),o(28),_(29,"translate"),c()()(),n(30,"tbody"),x(31,ve,13,6,"tr",36),c()()()),l&2){let r=d(3);a(2),g(" ",f(3,9,"ProductRecipe.TotalDirectProduct")," "),a(4),g(" ",r._AppModeService.GetTwoNumberAfterZero(r.Recipe.TotalDirectProduct)," "),a(7),h(f(14,11,"SaleInvoice.Storage")),a(3),h(f(17,13,"SaleInvoice.Name")),a(3),h(f(20,15,"SaleInvoice.Unit")),a(3),h(f(23,17,"Table.Quantity")),a(3),h(f(26,19,"ProductRecipe.WA")),a(3),h(f(29,21,"Table.Total")),a(3),S("ngForOf",r.RecipeTypeDirectProduct)}}function Re(l,m){if(l&1&&(n(0,"tr")(1,"td"),o(2),c(),n(3,"td"),o(4),c(),n(5,"td"),o(6),c()()),l&2){let r=m.$implicit;a(2),g(" ",r.AccTreeName,""),a(2),g(" ",r.Amount,""),a(2),g(" ",r.Notes,"")}}function Me(l,m){if(l&1&&(n(0,"div",32)(1,"p",33),o(2),_(3,"translate"),n(4,"span"),o(5,"["),c(),o(6),n(7,"span"),o(8,"]"),c()(),n(9,"table",34)(10,"thead")(11,"tr")(12,"th",37),o(13),_(14,"translate"),c(),n(15,"th",37),o(16),_(17,"translate"),c(),n(18,"th",37),o(19),_(20,"translate"),c()()(),n(21,"tbody"),x(22,Re,7,3,"tr",36),c()()()),l&2){let r=d(3);a(2),g(" ",f(3,6,"ProductRecipe.TotalDirectSalary")," "),a(4),g(" ",r._AppModeService.GetTwoNumberAfterZero(r.Recipe.TotalDirectSalary)," "),a(7),h(f(14,8,"SaleInvoice.Name")),a(3),h(f(17,10,"MoneyIn.Price")),a(3),h(f(20,12,"MoneyIn.Notes")),a(3),S("ngForOf",r.RecipeTypeDirectSalary)}}function Oe(l,m){if(l&1&&(n(0,"tr")(1,"td"),o(2),c(),n(3,"td"),o(4),c(),n(5,"td"),o(6),c(),n(7,"td"),o(8),c(),n(9,"td"),o(10),c(),n(11,"td"),o(12),c()()),l&2){let r=m.$implicit,i=d(4);a(2),h(r.StoreName),a(2),h(r.ProductName),a(2),h(r.ProductUnitName),a(2),h(r.Quantity),a(2),h(i._AppModeService.GetTwoNumberAfterZero(r.WA)),a(2),h(i._AppModeService.GetTwoNumberAfterZero(r.TotalPrice))}}function be(l,m){if(l&1&&(n(0,"div",32)(1,"p",33),o(2),_(3,"translate"),n(4,"span"),o(5,"["),c(),o(6),n(7,"span"),o(8,"]"),c()(),n(9,"table",34)(10,"thead")(11,"tr")(12,"th",35),o(13),_(14,"translate"),c(),n(15,"th",35),o(16),_(17,"translate"),c(),n(18,"th",35),o(19),_(20,"translate"),c(),n(21,"th",35),o(22),_(23,"translate"),c(),n(24,"th",35),o(25),_(26,"translate"),c(),n(27,"th",35),o(28),_(29,"translate"),c()()(),n(30,"tbody"),x(31,Oe,13,6,"tr",36),c()()()),l&2){let r=d(3);a(2),g(" ",f(3,9,"ProductRecipe.TotalInDirectProduct")," "),a(4),g(" ",r._AppModeService.GetTwoNumberAfterZero(r.Recipe.TotalInDirectProduct)," "),a(7),h(f(14,11,"SaleInvoice.Storage")),a(3),h(f(17,13,"SaleInvoice.Name")),a(3),h(f(20,15,"SaleInvoice.Unit")),a(3),h(f(23,17,"Table.Quantity")),a(3),h(f(26,19,"ProductRecipe.WA")),a(3),h(f(29,21,"Table.Total")),a(3),S("ngForOf",r.RecipeTypeInDirectProduct)}}function De(l,m){if(l&1&&(n(0,"tr")(1,"td"),o(2),c(),n(3,"td"),o(4),c(),n(5,"td"),o(6),c()()),l&2){let r=m.$implicit;a(2),g(" ",r.AccTreeName,""),a(2),g(" ",r.Amount,""),a(2),g(" ",r.Notes,"")}}function we(l,m){if(l&1&&(n(0,"div",32)(1,"p",33),o(2),_(3,"translate"),n(4,"span"),o(5,"["),c(),o(6),n(7,"span"),o(8,"]"),c()(),n(9,"table",34)(10,"thead")(11,"tr")(12,"th",37),o(13),_(14,"translate"),c(),n(15,"th",37),o(16),_(17,"translate"),c(),n(18,"th",37),o(19),_(20,"translate"),c()()(),n(21,"tbody"),x(22,De,7,3,"tr",36),c()()()),l&2){let r=d(3);a(2),g(" ",f(3,6,"ProductRecipe.TotalInDirectSalary")," "),a(4),g(" ",r._AppModeService.GetTwoNumberAfterZero(r.Recipe.TotalInDirectSalary)," "),a(7),h(f(14,8,"SaleInvoice.Name")),a(3),h(f(17,10,"MoneyIn.Price")),a(3),h(f(20,12,"MoneyIn.Notes")),a(3),S("ngForOf",r.RecipeTypeInDirectSalary)}}function Ee(l,m){if(l&1&&(n(0,"tr")(1,"td"),o(2),c(),n(3,"td"),o(4),c(),n(5,"td"),o(6),c()()),l&2){let r=m.$implicit;a(2),g(" ",r.AccTreeName,""),a(2),g(" ",r.Amount,""),a(2),g(" ",r.Notes,"")}}function Ae(l,m){if(l&1&&(n(0,"div",32)(1,"p",33),o(2),_(3,"translate"),n(4,"span"),o(5,"["),c(),o(6),n(7,"span"),o(8,"]"),c()(),n(9,"table",34)(10,"thead")(11,"tr")(12,"th",37),o(13),_(14,"translate"),c(),n(15,"th",37),o(16),_(17,"translate"),c(),n(18,"th",37),o(19),_(20,"translate"),c()()(),n(21,"tbody"),x(22,Ee,7,3,"tr",36),c()()()),l&2){let r=d(3);a(2),g(" ",f(3,6,"ProductRecipe.TotalInDirectOther")," "),a(4),g(" ",r._AppModeService.GetTwoNumberAfterZero(r.Recipe.TotalInDirectOther)," "),a(7),h(f(14,8,"SaleInvoice.Name")),a(3),h(f(17,10,"MoneyIn.Price")),a(3),h(f(20,12,"MoneyIn.Notes")),a(3),S("ngForOf",r.RecipeTypeInDirectOther)}}function Ne(l,m){if(l&1&&(G(0),n(1,"h4",30),o(2," \u062A\u0643\u0627\u0644\u064A\u0641 \u0635\u0646\u0627\u0639\u064A\u0629 \u0645\u0628\u0627\u0634\u0631\u0629 "),c(),x(3,Ce,32,23,"div",31)(4,Me,23,14,"div",31),n(5,"h4",30),o(6," \u062A\u0643\u0627\u0644\u064A\u0641 \u0635\u0646\u0627\u0639\u064A\u0629 \u063A\u064A\u0631 \u0645\u0628\u0627\u0634\u0631\u0629 "),c(),x(7,be,32,23,"div",31)(8,we,23,14,"div",31)(9,Ae,23,14,"div",31),W()),l&2){let r=d(2);a(3),S("ngIf",r.RecipeTypeDirectProduct.length>0),a(),S("ngIf",r.RecipeTypeDirectSalary.length>0),a(3),S("ngIf",r.RecipeTypeInDirectProduct.length>0),a(),S("ngIf",r.RecipeTypeInDirectSalary.length>0),a(),S("ngIf",r.RecipeTypeInDirectOther.length>0)}}function Ve(l,m){if(l&1){let r=A();E(0,"app-modal-header",7),n(1,"div",8)(2,"div",9)(3,"label",10),o(4),_(5,"translate"),c(),E(6,"input",11),c(),n(7,"div",9)(8,"label",12),o(9),_(10,"translate"),c(),n(11,"input",13),R("ngModelChange",function(e){u(r);let t=d();return C(t.ManufactureOrder.Notes,e)||(t.ManufactureOrder.Notes=e),s(e)}),c()(),n(12,"div",9)(13,"label",14),o(14),_(15,"translate"),c(),n(16,"ng-select",15,2),P("clear",function(){u(r);let e=d();return s(e.ManufactureOrder.Recipes=[])})("focus",function(){u(r);let e=T(17),t=d();return t.ChangeSearchApi("ProductRecipe",e),s(t._AppModeService.ResetCurrentPage())})("keyup",function(){u(r);let e=T(17),t=d();return t.ChangeSearchApi("ProductRecipe",e),s(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){u(r);let e=T(17),t=d();return s(t.ChangeSearchApi("ProductRecipe",e))})("close",function(){u(r);let e=d();return e._AppModeService.ResetCurrentPage(),s(e.ManufactureOrder.Recipes=[])})("open",function(){u(r);let e=d();return s(e._AppModeService.ResetCurrentPage())})("change",function(){u(r);let e=T(17),t=d();return t.SelectValue(t.ManufactureOrder.ProductRecipeId,"ProductRecipe"),e.blur(),s(t.ManufactureOrder.Recipes=[])}),R("ngModelChange",function(e){u(r);let t=d();return C(t.ManufactureOrder.ProductRecipeId,e)||(t.ManufactureOrder.ProductRecipeId=e),s(e)}),x(18,he,2,2,"ng-template",16)(19,ge,1,2,"ng-template",17),c()(),n(20,"div",9)(21,"label",14),o(22),_(23,"translate"),c(),n(24,"ng-select",18,3),P("clear",function(){u(r);let e=d();return s(e.ManufactureOrder.ProductUnits=[])})("focus",function(){u(r);let e=T(25),t=d();return t.ChangeSearchApi("ItemUnits",e),s(t._AppModeService.ResetCurrentPage())})("keyup",function(){u(r);let e=T(25),t=d();return t.ChangeSearchApi("ItemUnits",e),s(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){u(r);let e=T(25),t=d();return s(t.ChangeSearchApi("ItemUnits",e))})("close",function(){u(r);let e=d();return e._AppModeService.ResetCurrentPage(),s(e.ManufactureOrder.ProductUnits=[])})("open",function(){u(r);let e=d();return s(e._AppModeService.ResetCurrentPage())})("change",function(){u(r);let e=T(25),t=d();return t.SelectValue(t.ManufactureOrder.ProductUnitId,"ProductUnit"),e.blur(),s(t.ManufactureOrder.ProductUnits=[])}),R("ngModelChange",function(e){u(r);let t=d();return C(t.ManufactureOrder.ProductUnitId,e)||(t.ManufactureOrder.ProductUnitId=e),s(e)}),x(26,Se,2,2,"ng-template",16)(27,xe,1,1,"ng-template",17),c()(),n(28,"div",9)(29,"label",19),o(30),_(31,"translate"),c(),n(32,"input",20),P("change",function(){u(r);let e=d();return s(e.CalcRecipe())})("keyup",function(){u(r);let e=d();return s(e.CalcRecipe())}),R("ngModelChange",function(e){u(r);let t=d();return C(t.ManufactureOrder.Quantity,e)||(t.ManufactureOrder.Quantity=e),s(e)}),c()(),n(33,"div",9)(34,"label",21),o(35),_(36,"translate"),c(),E(37,"input",22),c(),n(38,"div",9)(39,"label",14),o(40),_(41,"translate"),c(),n(42,"ng-select",23,2),P("clear",function(){u(r);let e=d();return s(e.ManufactureOrder.CostCenters=[])}),R("ngModelChange",function(e){u(r);let t=d();return C(t.ManufactureOrder.CostCenterId,e)||(t.ManufactureOrder.CostCenterId=e),s(e)}),x(44,Te,2,2,"ng-template",16)(45,Ie,1,1,"ng-template",17),c()(),n(46,"div",9)(47,"label",14),o(48),_(49,"translate"),c(),n(50,"ng-select",24,4),P("clear",function(){u(r);let e=d();return s(e.ManufactureOrder.Storages=[])})("focus",function(){u(r);let e=T(51),t=d();return t.ChangeSearchApi("Storages",e),s(t._AppModeService.ResetCurrentPage())})("keyup",function(){u(r);let e=T(51),t=d();return t.ChangeSearchApi("Storages",e),s(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){u(r);let e=T(51),t=d();return s(t.ChangeSearchApi("Storages",e))})("close",function(){u(r);let e=d();return e._AppModeService.ResetCurrentPage(),s(e.ManufactureOrder.Storages=[])})("open",function(){u(r);let e=d();return s(e._AppModeService.ResetCurrentPage())})("change",function(){u(r);let e=T(51),t=d();return t.SelectValue(t.ManufactureOrder.StoreId,"Store"),e.blur(),s(t.ManufactureOrder.Storages=[])}),R("ngModelChange",function(e){u(r);let t=d();return C(t.ManufactureOrder.StoreId,e)||(t.ManufactureOrder.StoreId=e),s(e)}),x(52,Pe,2,2,"ng-template",16)(53,ye,1,1,"ng-template",17),c()()(),n(54,"div",25)(55,"div",26),x(56,Ne,10,5,"ng-container",27),c()(),n(57,"app-modal-footer",28),P("SaveEvent",function(){u(r);let e=d();return s(e.Save())})("UpdateEvent",function(){u(r);let e=d();return s(e.Save())})("CloseEvent",function(){let e=u(r).$implicit,t=d();return e.close("Close click"),s(t.ResetPage())}),c()}if(l&2){let r=d();S("PageTitle",r.TablePaging.PageTitle),a(4),g(" ",f(5,41,"Table.DocNo")," "),a(2),S("disabled",!0)("value",r.ManufactureOrder.DocNo),a(3),g(" ",f(10,43,"Table.Notes")," "),a(2),v("ngModel",r.ManufactureOrder.Notes),a(3),g(" ",f(15,45,"TransferStorage.Name")," "),a(2),S("dropdownPosition","bottom")("disabled",r.ManufactureOrder.Id>0)("items",r.ManufactureOrder.Recipes)("virtualScroll",!0)("searchable",!0),v("ngModel",r.ManufactureOrder.ProductRecipeId),a(6),g(" ",f(23,47,"Item.ItemUnit")," "),a(2),S("disabled",r.ManufactureOrder.ProductId==null)("dropdownPosition","bottom")("items",r.ManufactureOrder.ProductUnits)("virtualScroll",!0)("searchable",!0),v("ngModel",r.ManufactureOrder.ProductUnitId),a(6),g(" ",f(31,49,"Table.Quantity")," "),a(2),v("ngModel",r.ManufactureOrder.Quantity),a(3),g(" ",f(36,51,"ProductRecipe.TotalPrice")," "),a(2),S("value",r._AppModeService.GetTwoNumberAfterZero(r.Recipe.TotalPrice))("disabled",!0),a(3),g(" ",f(41,53,"MoneyIn.CostCenter")," "),a(2),S("dropdownPosition","bottom")("items",r.ManufactureOrder.CostCenters)("disabled",!0)("virtualScroll",!0)("searchable",!0),v("ngModel",r.ManufactureOrder.CostCenterId),a(6),g(" ",f(49,55,"ManufactureOrder.DoneStorage")," "),a(2),S("dropdownPosition","bottom")("items",r.ManufactureOrder.Storages)("virtualScroll",!0)("searchable",!0),v("ngModel",r.ManufactureOrder.StoreId),a(6),S("ngIf",r.Recipe.Id>0),a(),S("Id",r.ManufactureOrder.Id)("HideUpdate",!1)}}var nt=(()=>{let m=class m{constructor(i,e,t,p,I){this._ActivatedRoute=i,this._SharedScreenService=e,this._SharedObjectModelService=t,this._AppModeService=p,this._Apiservice=I,this._ServiceLifeTime=F(B),this.TablePaging={PageTitle:"ManufactureOrder.ManufactureOrder",DeleteUrl:"ManufactureOrderEP/Delete",GetById:"ManufactureOrderEP/GetById",BranchFilter:!0,Url:"Global/GetAll",TableName:"ManufactureOrder",Columns:["Id","DocNo"],TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"}]},this.ProductRecipes=[],this.Recipe={Id:0,ProductRecipeDetails:[]},this.RecipeTypeDirectProduct=[],this.RecipeTypeDirectSalary=[],this.RecipeTypeInDirectProduct=[],this.RecipeTypeInDirectSalary=[],this.RecipeTypeInDirectOther=[],this.RecipeType={DirectProduct:1,DirectSalary:2,InDirectProduct:3,InDirectSalary:4,InDirectOther:5},this.ManufactureOrder={Id:0,DocNo:0,Quantity:"",Notes:"",ProductRecipeId:null,ProductRecipeName:"",ManufactureOrderDetails:[],Recipes:[],ProductUnits:[],Storages:[]}}ngOnInit(){let i=Number(this._ActivatedRoute.snapshot.queryParams.Id);i>0&&this.GetByIdRoute(i)}GetByIdRoute(i){this._Apiservice.getById("ManufactureOrderEP/GetById",i,!0).pipe(y(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this.Drow(e.Obj.model),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})}})}ShowToEdite(i){this.Drow(i.PageModel)}Drow(i){this.ManufactureOrder={Id:i.Id,DocNo:i.DocNo,DocDate:i.DocDate,ProductId:i.ProductId,ProductUnitId:i.ProductUnitId,StoreId:i.StoreId,Quantity:i.Quantity==0?"":i.Quantity,ProductRecipeUnitFactor:i.ProductRecipeUnitFactor,ProductUnitFactor:i.ProductUnitFactor,ProductRecipeId:i.ProductRecipeId,ProductRecipeName:i.ProductRecipeName,CostCenterId:i.CostCenterId,CostCenterName:i.CostCenterName,Notes:i.Notes,TotalPrice:i.TotalPrice,TotalDirectProduct:i.TotalDirectProduct,TotalDirectSalary:i.TotalDirectSalary,TotalInDirectProduct:i.TotalInDirectProduct,TotalInDirectSalary:i.TotalInDirectSalary,TotalInDirectOther:i.TotalInDirectOther,ManufactureOrderDetails:i.ManufactureOrderDetails,CostCenters:[{Id:i.CostCenterId,Name:i.CostCenterName}],Recipes:[{Id:i.ProductRecipeId,Name:i.ProductRecipeName,NameAndCode:i.ProductRecipeName}],ProductUnits:[{Id:i.ProductUnitId,Name:i.ProductUnitName,NameAndUnitFactor:i.ProductUnitName}],Storages:[{Id:i.StoreId,Name:i.StoreName}]},this.Recipe={Id:i.ProductRecipeId,ProductRecipeDetails:[],TotalPrice:i.TotalPrice,TotalDirectProduct:i.TotalDirectProduct,TotalDirectSalary:i.TotalDirectSalary,TotalInDirectProduct:i.TotalInDirectProduct,TotalInDirectSalary:i.TotalInDirectSalary,TotalInDirectOther:i.TotalInDirectOther};for(let e=0;e<i.ManufactureOrderDetails.length;e++){let t=i.ManufactureOrderDetails[e];t.SaveWA=t.WA,t.SaveAmount=t.Amount,t.RecipeType=t.ManufactureOrderType,this.Recipe.ProductRecipeDetails.push(t)}this.RecipeTypeDirectProduct=i.ManufactureOrderDetails.filter(e=>e.ManufactureOrderType==this.RecipeType.DirectProduct),this.RecipeTypeDirectSalary=i.ManufactureOrderDetails.filter(e=>e.ManufactureOrderType==this.RecipeType.DirectSalary),this.RecipeTypeInDirectProduct=i.ManufactureOrderDetails.filter(e=>e.ManufactureOrderType==this.RecipeType.InDirectProduct),this.RecipeTypeInDirectSalary=i.ManufactureOrderDetails.filter(e=>e.ManufactureOrderType==this.RecipeType.InDirectSalary),this.RecipeTypeInDirectOther=i.ManufactureOrderDetails.filter(e=>e.ManufactureOrderType==this.RecipeType.InDirectOther),this.CalcRecipe()}OpenModal(){this.ResetPage(),this.GetPageInfo()}GetPageInfo(){this._Apiservice.get("ManufactureOrderEP/GetPageInfo",!1).pipe(y(this._ServiceLifeTime.Destroyed$)).subscribe({next:i=>{this.ManufactureOrder.DocNo=i.Obj}})}GetRecipe(){this.ManufactureOrder.ProductRecipeId>0&&this._Apiservice.getById("ProductRecipeEP/GetById",this.ManufactureOrder.ProductRecipeId,!1).pipe(y(this._ServiceLifeTime.Destroyed$)).subscribe({next:i=>{this.HandleRecipe(i.Obj.model)}})}ChangeSearchApi(i,e){let t="";t=`${e.searchTerm}`.trim(),(t==""||t=="null")&&(e.searchTerm="",t=""),this._AppModeService.CurrentPage+=1;let p={TableName:i,Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:t,SearchField:"Name"};if(i=="ProductRecipe"&&(p.TableName="ProductRecipe",p.BranchFilter=!0,p.Join=!0,p.JoinTables=["Items Product"],p.JoinConditions=["T.ProductId = Product.Id"],p.Columns=["T.Id","T.ProductId","Product.Name As ProductName","Product.Code As ProductCode"],p.SearchField="Product.Name"),i=="ItemUnits"){let I=this.ManufactureOrder.ProductId==null?0:this.ManufactureOrder.ProductId;p.Conditions=`ItemId = ${I}`,p.Join=!0,p.JoinTables=["Units U"],p.NoPaging=!0,p.JoinConditions=["T.UnitId = U.Id"],p.Columns=["T.Id","U.Name","T.UnitFactor"],p.SearchField="U.Name"}i=="Storages"&&(p.BranchFilter=!0,p.Columns=["Id","Name"]),this._Apiservice.post("Global/GetAll",p,!1).pipe(y(this._ServiceLifeTime.Destroyed$)).subscribe({next:I=>{this.HandleResponse(I.Obj,i)}})}HandleResponse(i,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=i.TotalItems,e=="ProductRecipe"&&(this.ManufactureOrder.Recipes=this._SharedObjectModelService.RemoveDuplicates(this.ManufactureOrder.Recipes.concat(i.DataReturn),"Id").map(t=>w(D({},t),{NameAndCode:`${t.ProductName} - ${t.ProductCode}`}))),e=="Storages"&&(this.ManufactureOrder.Storages=this._SharedObjectModelService.RemoveDuplicates(this.ManufactureOrder.Storages.concat(i.DataReturn),"Id")),e=="ItemUnits"&&(this.ManufactureOrder.ProductUnits=i.DataReturn.map(t=>w(D({},t),{UnitFactor:t.UnitFactor,NameAndUnitFactor:`${t.Name} - ${t.UnitFactor}`})))}SelectValue(i,e){if(i!=null&&(i>0||i!="")){let t=[];e=="ProductRecipe"&&(t=this.ManufactureOrder.Recipes),e=="ProductUnit"&&(t=this.ManufactureOrder.ProductUnits),e=="Store"&&(t=this.ManufactureOrder.Storages);let p=t.find(I=>I.Id==i);if(p==null){this._AppModeService.DontPlay();return}else this.ManufactureOrder[`${e}Id`]=i,this.ManufactureOrder[`${e}Name`]=p.Name,e=="ProductUnit"&&(this.ManufactureOrder.ProductUnitFactor=p.UnitFactor,this.CalcRecipe()),e=="ProductRecipe"&&(this.ManufactureOrder.ProductId=p.ProductId)}else this.ManufactureOrder[`${e}Id`]=null,this.ManufactureOrder[`${e}Name`]="",e=="ProductUnit"&&(this.ManufactureOrder.ProductUnitFactor=0,this.CalcRecipe());e=="ProductRecipe"&&(this.ResetDetails(),this.GetRecipe())}HandleRecipe(i){this.Recipe=i,this.ManufactureOrder.ProductRecipeId=this.Recipe.Id,this.ManufactureOrder.CostCenters=[],this.ManufactureOrder.CostCenters=[{Id:this.Recipe.CostCenterId,Name:this.Recipe.CostCenterName}],this.ManufactureOrder.CostCenterId=this.Recipe.CostCenterId,this.ManufactureOrder.ProductRecipeUnitFactor=this.Recipe.ProductUnitFactor;for(let e=0;e<this.Recipe.ProductRecipeDetails.length;e++){let t=this.Recipe.ProductRecipeDetails[e];t.RecipeQuantity=t.Quantity,t.SaveWA=t.WA,t.SaveAmount=t.Amount}this.CalcRecipe()}CalcRecipe(){this.Recipe.TotalPrice=0,this.Recipe.TotalDirectProduct=0,this.Recipe.TotalDirectSalary=0,this.Recipe.TotalInDirectProduct=0,this.Recipe.TotalInDirectSalary=0,this.Recipe.TotalInDirectOther=0;let i=0;i=Number(this.ManufactureOrder.Quantity)>0?Number(this.ManufactureOrder.Quantity)*(this.ManufactureOrder.ProductUnitFactor/this.ManufactureOrder.ProductRecipeUnitFactor):this.ManufactureOrder.ProductUnitFactor/this.ManufactureOrder.ProductRecipeUnitFactor;for(let e=0;e<this.Recipe.ProductRecipeDetails.length;e++){let t=this.Recipe.ProductRecipeDetails[e];(t.RecipeType==this.RecipeType.DirectProduct||t.RecipeType==this.RecipeType.InDirectProduct||t.RecipeType==this.RecipeType.DirectSalary||t.RecipeType==this.RecipeType.InDirectSalary||t.RecipeType==this.RecipeType.InDirectOther)&&(t.Quantity=t.RecipeQuantity*Number(i),t.WA=t.SaveWA,t.Amount=t.SaveAmount),(t.RecipeType==this.RecipeType.DirectProduct||t.RecipeType==this.RecipeType.InDirectProduct)&&(t.TotalPrice=t.SaveWA*t.RecipeQuantity*Number(i),t.TotalPrice=this._AppModeService.GetTwoNumberAfterZero(Number(t.TotalPrice))),(t.RecipeType==this.RecipeType.DirectSalary||t.RecipeType==this.RecipeType.InDirectSalary||t.RecipeType==this.RecipeType.InDirectOther)&&(t.TotalPrice=Number(t.Amount)*Number(i)),this.Recipe.TotalPrice+=Number(t.TotalPrice),t.RecipeType==this.RecipeType.DirectProduct&&(this.Recipe.TotalDirectProduct+=t.TotalPrice),t.RecipeType==this.RecipeType.DirectSalary&&(this.Recipe.TotalDirectSalary+=t.TotalPrice),t.RecipeType==this.RecipeType.InDirectProduct&&(this.Recipe.TotalInDirectProduct+=t.TotalPrice),t.RecipeType==this.RecipeType.InDirectSalary&&(this.Recipe.TotalInDirectSalary+=t.TotalPrice),t.RecipeType==this.RecipeType.InDirectOther&&(this.Recipe.TotalInDirectOther+=t.TotalPrice)}this.RecipeTypeDirectProduct=this.Recipe.ProductRecipeDetails.filter(e=>e.RecipeType==this.RecipeType.DirectProduct),this.RecipeTypeDirectSalary=this.Recipe.ProductRecipeDetails.filter(e=>e.RecipeType==this.RecipeType.DirectSalary),this.RecipeTypeInDirectProduct=this.Recipe.ProductRecipeDetails.filter(e=>e.RecipeType==this.RecipeType.InDirectProduct),this.RecipeTypeInDirectSalary=this.Recipe.ProductRecipeDetails.filter(e=>e.RecipeType==this.RecipeType.InDirectSalary),this.RecipeTypeInDirectOther=this.Recipe.ProductRecipeDetails.filter(e=>e.RecipeType==this.RecipeType.InDirectOther)}Save(){if(this.ManufactureOrder.ProductRecipeId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ManufactureOrder.Error.ProductRecipeId"));return}if(this.ManufactureOrder.StoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ManufactureOrder.Error.DoneStorage"));return}let i={},e=Object.keys(this.ManufactureOrder),t=Object.values(this.ManufactureOrder);for(let p=0;p<e.length;p++)i[`${e[p]}`]=t[p];i.Quantity=Number(this.ManufactureOrder.Quantity),i.ManufactureOrderDetails=this.Recipe.ProductRecipeDetails.map(p=>w(D({},p),{ManufactureOrderType:Number(p.RecipeType)})),i.Id==0&&this._Apiservice.post("ManufactureOrderEP/Add",i,!0).pipe(y(this._ServiceLifeTime.Destroyed$)).subscribe({next:p=>{this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this.DynamicComponent.Paging.DataReturn.push(p.Obj)}}),i.Id>0&&this._Apiservice.put("ManufactureOrderEP/Update",i,!0).pipe(y(this._ServiceLifeTime.Destroyed$)).subscribe({next:p=>{this._AppModeService._Toastr.success(p.Message),this.ResetPage(),this.GetPageInfo();let I=p.Obj,b=this.DynamicComponent.Paging.DataReturn.find(me=>me.Id==I.Id);b!=null&&Object.assign(b,I)}})}ResetPage(){this.Recipe={Id:0,ProductRecipeDetails:[]},this.ManufactureOrder={Id:0,DocNo:0,Quantity:"",Notes:"",ProductRecipeId:null,ProductRecipeName:"",CostCenterId:null,CostCenterName:"",ManufactureOrderDetails:[],Recipes:[],ProductUnits:[],Storages:[]}}ResetDetails(){this.Recipe.Id=0,this.Recipe.TotalPrice="",this.Recipe.ProductRecipeDetails=[],this.ManufactureOrder.CostCenterId=null,this.ManufactureOrder.ProductRecipeUnitFactor=0,this.ManufactureOrder.Quantity="",this.ManufactureOrder.ProductUnitFactor=0,this.ManufactureOrder.ProductUnits=[],this.ManufactureOrder.ProductUnitId=null}ngOnDestroy(){}};m.\u0275fac=function(e){return new(e||m)(M(H),M(se),M(de),M(ie),M(J))},m.\u0275cmp=Q({type:m,selectors:[["app-manufacture-order"]],viewQuery:function(e,t){if(e&1&&(N(_e,5),N(fe,5)),e&2){let p;V(p=U())&&(t.DynamicComponent=p.first),V(p=U())&&(t.ContentModel=p.first)}},standalone:!0,features:[j([B]),L],decls:4,vars:6,consts:[["dynamiccomponent",""],["content",""],["Select",""],["SelectProductUnit",""],["Select22222",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","OutModal","DeleteUrl","GetById"],[1,"modalConent"],[3,"PageTitle"],[1,"col-12","d-flex","flex-wrap","justify-content-","align-items-end","p-1","bg-white"],[1,"col-12","col-md-2","p-1"],["for","DocNo",1,""],["id","DocNo","name","DocNo","type","number",1,"form-control","text-center",3,"disabled","value"],["for","Notes",1,""],["id","Notes","name","Notes","type","number",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,""],["id","ngSelectComponent","placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","disabled","items","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["id","ngSelectComponent","placeholder","Search","bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","disabled","dropdownPosition","items","virtualScroll","searchable","ngModel"],["for","Quantity",1,"d-block"],["id","Quantity","name","Quantity","appNumericInput","","type","number",1,"form-control","text-center",3,"change","keyup","ngModelChange","ngModel"],["for","TotalPrice",1,""],["id","TotalPrice","name","TotalPrice","type","number","appNumericInput","",1,"form-control","text-center",3,"value","disabled"],["id","ngSelectComponent","placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","ngModelChange","dropdownPosition","items","disabled","virtualScroll","searchable","ngModel"],["id","ngSelectComponent","placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","virtualScroll","searchable","ngModel"],[1,"modal-body","p-0","m-0","Invoicemodalbody","bg-white","ProductTable"],[1,"col-12"],[4,"ngIf"],[3,"SaveEvent","UpdateEvent","CloseEvent","Id","HideUpdate"],[1,"form-text","text-muted"],[1,"m-0","p-2","col-12"],["class","DivPaging col-12 table-responsive-vertical shadow-z-1","id","ProductTable",4,"ngIf"],["id","ProductTable",1,"DivPaging","col-12","table-responsive-vertical","shadow-z-1"],[1,"my-1","text-center"],[1,"table","table-hover","table-striped","table-light","mt-1","mb-0"],[1,"col-2"],[4,"ngFor","ngForOf"],[1,"col-4"]],template:function(e,t){if(e&1){let p=A();n(0,"app-dynamic-component",5,0),P("OpenModalEvent",function(){return u(p),s(t.OpenModal())})("ShowToEditeEvent",function(b){return u(p),s(t.ShowToEdite(b))}),c(),x(2,Ve,58,57,"ng-template",6,1,k)}if(e&2){let p=T(3);S("PageTitle",t.TablePaging.PageTitle)("TablePaging",t.TablePaging)("FullScreen",!0)("OutModal",p)("DeleteUrl",t.TablePaging.DeleteUrl)("GetById",t.TablePaging.GetById)}},dependencies:[ue,oe,z,q,te,K,ee,X,Y,ce,ae,re,ne,$,Z,pe,le]});let l=m;return l})();export{nt as ManufactureOrderComponent};
