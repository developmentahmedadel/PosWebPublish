import{a as pe}from"./chunk-PAI6ZM6M.js";import{b as ae,j as le}from"./chunk-A6MDEMU4.js";import"./chunk-3ZAIJ4IV.js";import"./chunk-Y5QDR55A.js";import"./chunk-VSYXDL23.js";import"./chunk-BHSN7HFD.js";import"./chunk-6BJKXUWP.js";import"./chunk-3Y7UQ2M3.js";import{a as _e}from"./chunk-BHTRH7BV.js";import"./chunk-VUX2NRX2.js";import"./chunk-RXBBGPQB.js";import"./chunk-GEJP5WQO.js";import"./chunk-GNF256I6.js";import{a as ie,b as re,c as oe,d as ce}from"./chunk-MZIKAFPE.js";import"./chunk-EGE4BGUH.js";import"./chunk-RVJIMCIT.js";import{c as ne}from"./chunk-ITQ57RKD.js";import{c as z,d as q}from"./chunk-KALZ37GW.js";import{c as H,f as K,h as X,k as Y,m as Z,s as ee,u as te}from"./chunk-N4FWSTCP.js";import{c as Q,d as G,e as J}from"./chunk-VTADEU6K.js";import{$b as T,Cb as l,Db as p,Eb as v,Fb as N,Gb as k,Ib as b,Mb as h,Nb as r,Rb as I,Wb as g,X as E,Xb as d,Yb as V,Zb as D,_b as A,ac as w,bc as y,db as s,dc as $,eb as B,gc as L,na as F,nc as S,oc as P,qc as j,vb as f,xa as c,xb as C,ya as _}from"./chunk-J5UB44FZ.js";import{a as M,b as U}from"./chunk-3EYC4JTX.js";var se=(a,u)=>({"btn-success":a,"btn-primary":u});function de(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2);s(),A("Loaded ",i.Recipe.Items.length," of ",i._SharedObjectModelService.TotalItems,"")}}function ue(a,u){if(a&1&&d(0),a&2){let i=u.item;A(" ",i.Name," - ",i.Code," ")}}function me(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2);s(),A("Loaded ",i.Recipe.ProductUnits.length," of ",i._SharedObjectModelService.TotalItems,"")}}function ge(a,u){if(a&1&&d(0),a&2){let i=u.item;A(" ",i.Name," - ",i.Code," ")}}function xe(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2);s(),A("Loaded ",i.Recipe.CostCenters.length," of ",i._SharedObjectModelService.TotalItems,"")}}function Ce(a,u){if(a&1&&d(0),a&2){let i=u.item;A(" ",i.Name," - ",i.Code," ")}}function Se(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2).$implicit,n=r(2);s(),A("Loaded ",i.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Pe(a,u){if(a&1&&d(0),a&2){let i=u.item;D(" ",i.Name," ")}}function he(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2).$implicit,n=r(2);s(),A("Loaded ",i.Items.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Re(a,u){if(a&1&&d(0),a&2){let i=u.item;A(" ",i.Name," - ",i.Code," ")}}function fe(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2).$implicit,n=r(2);s(),A("Loaded ",i.ProductUnits.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Ie(a,u){if(a&1&&d(0),a&2){let i=u.item;D(" ",i.NameAndUnitFactor," ")}}function Te(a,u){if(a&1){let i=b();l(0,"tr")(1,"td",38)(2,"div",39)(3,"button",40),h("click",function(){c(i);let e=r(3);return _(e.AppendRow(e.EnumRecipe.DirectProduct))}),v(4,"i",41),p(),l(5,"button",42),h("click",function(){c(i);let e=r().index,t=r(2);return _(t.RemoveRow(t.EnumRecipe.DirectProduct,e))}),v(6,"i",43),p()()(),l(7,"td")(8,"ng-select",44,3),S(10,"translate"),h("clear",function(){c(i);let e=r().$implicit;return _(e.Storages=[])})("focus",function(){c(i);let e=g(9),t=r().index,o=r(2);return o.ChangeSearchApiDetails("Storages",e,t,o.EnumRecipe.DirectProduct),_(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(9),t=r().index,o=r(2);return o.ChangeSearchApiDetails("Storages",e,t,o.EnumRecipe.DirectProduct),_(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(9),t=r().index,o=r(2);return _(o.ChangeSearchApiDetails("Storages",e,t,o.EnumRecipe.DirectProduct))})("close",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=r(),t=e.$implicit,o=e.index,m=r(2);return _(m.SelectValueDetails(t.StorageId,"Storage",o))}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.StorageId,e)||(t.StorageId=e),_(e)}),f(11,Se,2,2,"ng-template",15)(12,Pe,1,1,"ng-template",16),p()(),l(13,"td")(14,"ng-select",45,4),S(16,"translate"),h("clear",function(){c(i);let e=r().$implicit;return _(e.Items=[])})("focus",function(){c(i);let e=g(15),t=r().index,o=r(2);return o.ChangeSearchApiDetails("DirectProduct",e,t,1),_(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(15),t=r().index,o=r(2);return o.ChangeSearchApiDetails("DirectProduct",e,t,1),_(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(15),t=r().index,o=r(2);return _(o.ChangeSearchApiDetails("DirectProduct",e,t,1))})("close",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(15),t=r(),o=t.$implicit,m=t.index;return r(2).SelectItem(o.ProductId,m),_(e.blur())}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.ProductId,e)||(t.ProductId=e),_(e)}),f(17,he,2,2,"ng-template",15)(18,Re,1,2,"ng-template",16),p()(),l(19,"td")(20,"ng-select",46,5),S(22,"translate"),h("clear",function(){c(i);let e=r().$implicit;return _(e.ProductUnits=[])})("focus",function(){c(i);let e=g(21),t=r().index,o=r(2);return o.ChangeSearchApiDetails("ItemUnits",e,t,1),_(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(21),t=r().index,o=r(2);return o.ChangeSearchApiDetails("ItemUnits",e,t,1),_(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(21),t=r().index,o=r(2);return _(o.ChangeSearchApiDetails("ItemUnits",e,t,1))})("close",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(21),t=r(),o=t.$implicit,m=t.index;return r(2).SelectUnit(o.ProductUnitId,m),_(e.blur())}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.ProductUnitId,e)||(t.ProductUnitId=e),_(e)}),f(23,fe,2,2,"ng-template",15)(24,Ie,1,1,"ng-template",16),p()(),l(25,"td")(26,"input",47),h("change",function(){c(i);let e=r(3);return _(e.CalcRecipe())})("keyup",function(){c(i);let e=r(3);return _(e.CalcRecipe())}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.Quantity,e)||(t.Quantity=e),_(e)}),p()(),l(27,"td"),d(28),p(),l(29,"td"),d(30),p()()}if(a&2){let i=r(),n=i.$implicit,e=i.index;s(8),I("placeholder","  ",P(10,30,"SaleInvoice.ChooseStore"),""),C("items",n.Storages)("dropdownPosition","bottom")("searchable",!0)("virtualScroll",!0),T("ngModel",n.StorageId),s(6),I("placeholder","  ",P(16,32,"SaleInvoice.ChooseProduct"),""),C("dropdownPosition","bottom")("items",n.Items)("virtualScroll",!0)("searchable",!0),T("ngModel",n.ProductId),s(6),I("placeholder","  ",P(22,34,"Item.ItemUnit"),""),C("dropdownPosition","bottom")("items",n.ProductUnits)("disabled",n.ProductId==0||n.ProductId==null)("virtualScroll",!0)("searchable",!0),T("ngModel",n.ProductUnitId),s(6),I("id","Quantity",e,""),I("name","Quantity",e,""),C("disabled",n.ProductId==null||n.ProductUnitId==null),T("ngModel",n.Quantity),s(2),D(" ",n.Price," "),s(2),D(" ",n.TotalPrice," ")}}function we(a,u){if(a&1&&(N(0),f(1,Te,31,36,"tr",34),k()),a&2){let i=u.$implicit,n=r(2);s(),C("ngIf",i.EnumRecipe==n.EnumRecipe.DirectProduct)}}function ye(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2).$implicit,n=r(2);s(),A("Loaded ",i.AccTrees.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Ve(a,u){if(a&1&&d(0),a&2){let i=u.item;D(" ",i.Name," ")}}function Ae(a,u){if(a&1){let i=b();l(0,"tr")(1,"td",38)(2,"div",39)(3,"button",40),h("click",function(){c(i);let e=r(3);return _(e.AppendRow(e.EnumRecipe.DirectSalary))}),v(4,"i",41),p(),l(5,"button",42),h("click",function(){c(i);let e=r().index,t=r(2);return _(t.RemoveRow(t.EnumRecipe.DirectSalary,e))}),v(6,"i",43),p()()(),l(7,"td")(8,"ng-select",48,6),h("clear",function(){c(i);let e=r().$implicit;return _(e.AccTrees=[])})("focus",function(){c(i);let e=g(9),t=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,t,o.EnumRecipe.DirectSalary),_(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(9),t=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,t,o.EnumRecipe.DirectSalary),_(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(9),t=r().index,o=r(2);return _(o.ChangeSearchApiDetails("AccTreeExpenses",e,t,o.EnumRecipe.DirectSalary))})("close",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=r(),t=e.$implicit,o=e.index,m=r(2);return _(m.SelectValueDetails(t.AccTreeId,"AccTree",o))}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.AccTreeId,e)||(t.AccTreeId=e),_(e)}),f(10,ye,2,2,"ng-template",15)(11,Ve,1,1,"ng-template",16),p()(),l(12,"td")(13,"input",49),h("change",function(){c(i);let e=r(3);return _(e.CalcRecipe())})("keyup",function(){c(i);let e=r(3);return _(e.CalcRecipe())}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.Price,e)||(t.Price=e),_(e)}),p()(),l(14,"td")(15,"input",50),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.Notes,e)||(t.Notes=e),_(e)}),p()()()}if(a&2){let i=r(),n=i.$implicit,e=i.index;s(8),C("items",n.AccTrees)("autofocus",!1)("dropdownPosition","bottom")("virtualScroll",!0)("searchable",!0),T("ngModel",n.AccTreeId),s(5),I("id","Price",e,""),I("name","Price",e,""),T("ngModel",n.Price),s(2),I("id","Notes",e,""),I("name","Notes",e,""),T("ngModel",n.Notes)}}function De(a,u){if(a&1&&(N(0),f(1,Ae,16,16,"tr",34),k()),a&2){let i=u.$implicit,n=r(2);s(),C("ngIf",i.EnumRecipe==n.EnumRecipe.DirectSalary)}}function ve(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2).$implicit,n=r(2);s(),A("Loaded ",i.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Ee(a,u){if(a&1&&d(0),a&2){let i=u.item;D(" ",i.Name," ")}}function be(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2).$implicit,n=r(2);s(),A("Loaded ",i.Items.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Me(a,u){if(a&1&&d(0),a&2){let i=u.item;A(" ",i.Name," - ",i.Code," ")}}function Ue(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2).$implicit,n=r(2);s(),A("Loaded ",i.ProductUnits.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Ne(a,u){if(a&1&&d(0),a&2){let i=u.item;D(" ",i.NameAndUnitFactor," ")}}function ke(a,u){if(a&1){let i=b();l(0,"tr")(1,"td",38)(2,"div",39)(3,"button",40),h("click",function(){c(i);let e=r(3);return _(e.AppendRow(e.EnumRecipe.InDirectProduct))}),v(4,"i",41),p(),l(5,"button",42),h("click",function(){c(i);let e=r().index,t=r(2);return _(t.RemoveRow(t.EnumRecipe.InDirectProduct,e))}),v(6,"i",43),p()()(),l(7,"td")(8,"ng-select",44,3),S(10,"translate"),h("clear",function(){c(i);let e=r().$implicit;return _(e.Storages=[])})("focus",function(){c(i);let e=g(9),t=r().index,o=r(2);return o.ChangeSearchApiDetails("Storages",e,t,o.EnumRecipe.InDirectProduct),_(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(9),t=r().index,o=r(2);return o.ChangeSearchApiDetails("Storages",e,t,o.EnumRecipe.InDirectProduct),_(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(9),t=r().index,o=r(2);return _(o.ChangeSearchApiDetails("Storages",e,t,o.EnumRecipe.InDirectProduct))})("close",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=r(),t=e.$implicit,o=e.index,m=r(2);return _(m.SelectValueDetails(t.StorageId,"Storage",o))}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.StorageId,e)||(t.StorageId=e),_(e)}),f(11,ve,2,2,"ng-template",15)(12,Ee,1,1,"ng-template",16),p()(),l(13,"td")(14,"ng-select",45,4),S(16,"translate"),h("clear",function(){c(i);let e=r().$implicit;return _(e.Items=[])})("focus",function(){c(i);let e=g(15),t=r().index,o=r(2);return o.ChangeSearchApiDetails("InDirectProduct",e,t,o.EnumRecipe.InDirectProduct),_(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(15),t=r().index,o=r(2);return o.ChangeSearchApiDetails("InDirectProduct",e,t,o.EnumRecipe.InDirectProduct),_(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(15),t=r().index,o=r(2);return _(o.ChangeSearchApiDetails("InDirectProduct",e,t,o.EnumRecipe.InDirectProduct))})("close",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(15),t=r(),o=t.$implicit,m=t.index;return r(2).SelectItem(o.ProductId,m),_(e.blur())}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.ProductId,e)||(t.ProductId=e),_(e)}),f(17,be,2,2,"ng-template",15)(18,Me,1,2,"ng-template",16),p()(),l(19,"td")(20,"ng-select",46,5),S(22,"translate"),h("clear",function(){c(i);let e=r().$implicit;return _(e.ProductUnits=[])})("focus",function(){c(i);let e=g(21),t=r().index,o=r(2);return o.ChangeSearchApiDetails("ItemUnits",e,t,1),_(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(21),t=r().index,o=r(2);return o.ChangeSearchApiDetails("ItemUnits",e,t,1),_(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(21),t=r().index,o=r(2);return _(o.ChangeSearchApiDetails("ItemUnits",e,t,1))})("close",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(21),t=r(),o=t.$implicit,m=t.index;return r(2).SelectUnit(o.ProductUnitId,m),_(e.blur())}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.ProductUnitId,e)||(t.ProductUnitId=e),_(e)}),f(23,Ue,2,2,"ng-template",15)(24,Ne,1,1,"ng-template",16),p()(),l(25,"td")(26,"input",47),h("change",function(){c(i);let e=r(3);return _(e.CalcRecipe())})("keyup",function(){c(i);let e=r(3);return _(e.CalcRecipe())}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.Quantity,e)||(t.Quantity=e),_(e)}),p()(),l(27,"td"),d(28),p(),l(29,"td"),d(30),p()()}if(a&2){let i=r(),n=i.$implicit,e=i.index;s(8),I("placeholder","  ",P(10,30,"SaleInvoice.ChooseStore"),""),C("items",n.Storages)("dropdownPosition","bottom")("searchable",!0)("virtualScroll",!0),T("ngModel",n.StorageId),s(6),I("placeholder","  ",P(16,32,"SaleInvoice.ChooseProduct"),""),C("dropdownPosition","bottom")("items",n.Items)("virtualScroll",!0)("searchable",!0),T("ngModel",n.ProductId),s(6),I("placeholder","  ",P(22,34,"Item.ItemUnit"),""),C("dropdownPosition","bottom")("items",n.ProductUnits)("disabled",n.ProductId==0||n.ProductId==null)("virtualScroll",!0)("searchable",!0),T("ngModel",n.ProductUnitId),s(6),I("id","Quantity",e,""),I("name","Quantity",e,""),C("disabled",n.ProductId==null||n.ProductUnitId==null),T("ngModel",n.Quantity),s(2),D(" ",n.Price," "),s(2),D(" ",n.TotalPrice," ")}}function We(a,u){if(a&1&&(N(0),f(1,ke,31,36,"tr",34),k()),a&2){let i=u.$implicit,n=r(2);s(),C("ngIf",i.EnumRecipe==n.EnumRecipe.InDirectProduct)}}function Be(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2).$implicit,n=r(2);s(),A("Loaded ",i.AccTrees.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Oe(a,u){if(a&1&&d(0),a&2){let i=u.item;D(" ",i.Name," ")}}function Fe(a,u){if(a&1){let i=b();l(0,"tr")(1,"td",38)(2,"div",39)(3,"button",40),h("click",function(){c(i);let e=r(3);return _(e.AppendRow(e.EnumRecipe.InDirectSalary))}),v(4,"i",41),p(),l(5,"button",42),h("click",function(){c(i);let e=r().index,t=r(2);return _(t.RemoveRow(t.EnumRecipe.InDirectSalary,e))}),v(6,"i",43),p()()(),l(7,"td")(8,"ng-select",48,6),h("clear",function(){c(i);let e=r().$implicit;return _(e.AccTrees=[])})("focus",function(){c(i);let e=g(9),t=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,t,o.EnumRecipe.InDirectSalary),_(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(9),t=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,t,o.EnumRecipe.InDirectSalary),_(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(9),t=r().index,o=r(2);return _(o.ChangeSearchApiDetails("AccTreeExpenses",e,t,o.EnumRecipe.InDirectSalary))})("close",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=r(),t=e.$implicit,o=e.index,m=r(2);return _(m.SelectValueDetails(t.AccTreeId,"AccTree",o))}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.AccTreeId,e)||(t.AccTreeId=e),_(e)}),f(10,Be,2,2,"ng-template",15)(11,Oe,1,1,"ng-template",16),p()(),l(12,"td")(13,"input",49),h("change",function(){c(i);let e=r(3);return _(e.CalcRecipe())})("keyup",function(){c(i);let e=r(3);return _(e.CalcRecipe())}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.Price,e)||(t.Price=e),_(e)}),p()(),l(14,"td")(15,"input",50),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.Notes,e)||(t.Notes=e),_(e)}),p()()()}if(a&2){let i=r(),n=i.$implicit,e=i.index;s(8),C("items",n.AccTrees)("autofocus",!1)("dropdownPosition","bottom")("virtualScroll",!0)("searchable",!0),T("ngModel",n.AccTreeId),s(5),I("id","Price",e,""),I("name","Price",e,""),T("ngModel",n.Price),s(2),I("id","Notes",e,""),I("name","Notes",e,""),T("ngModel",n.Notes)}}function $e(a,u){if(a&1&&(N(0),f(1,Fe,16,16,"tr",34),k()),a&2){let i=u.$implicit,n=r(2);s(),C("ngIf",i.EnumRecipe==n.EnumRecipe.InDirectSalary)}}function Le(a,u){if(a&1&&(l(0,"small",37),d(1),p()),a&2){let i=r(2).$implicit,n=r(2);s(),A("Loaded ",i.AccTrees.length," of ",n._SharedObjectModelService.TotalItems,"")}}function je(a,u){if(a&1&&d(0),a&2){let i=u.item;D(" ",i.Name," ")}}function Qe(a,u){if(a&1){let i=b();l(0,"tr")(1,"td",38)(2,"div",39)(3,"button",40),h("click",function(){c(i);let e=r(3);return _(e.AppendRow(e.EnumRecipe.InDirectOther))}),v(4,"i",41),p(),l(5,"button",42),h("click",function(){c(i);let e=r().index,t=r(2);return _(t.RemoveRow(t.EnumRecipe.InDirectOther,e))}),v(6,"i",43),p()()(),l(7,"td")(8,"ng-select",48,6),h("clear",function(){c(i);let e=r().$implicit;return _(e.AccTrees=[])})("focus",function(){c(i);let e=g(9),t=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,t,o.EnumRecipe.InDirectOther),_(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(9),t=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,t,o.EnumRecipe.InDirectOther),_(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(9),t=r().index,o=r(2);return _(o.ChangeSearchApiDetails("AccTreeExpenses",e,t,o.EnumRecipe.InDirectOther))})("close",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=r(),t=e.$implicit,o=e.index,m=r(2);return _(m.SelectValueDetails(t.AccTreeId,"AccTree",o))}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.AccTreeId,e)||(t.AccTreeId=e),_(e)}),f(10,Le,2,2,"ng-template",15)(11,je,1,1,"ng-template",16),p()(),l(12,"td")(13,"input",49),h("change",function(){c(i);let e=r(3);return _(e.CalcRecipe())})("keyup",function(){c(i);let e=r(3);return _(e.CalcRecipe())}),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.Price,e)||(t.Price=e),_(e)}),p()(),l(14,"td")(15,"input",50),y("ngModelChange",function(e){c(i);let t=r().$implicit;return w(t.Notes,e)||(t.Notes=e),_(e)}),p()()()}if(a&2){let i=r(),n=i.$implicit,e=i.index;s(8),C("items",n.AccTrees)("autofocus",!1)("dropdownPosition","bottom")("virtualScroll",!0)("searchable",!0),T("ngModel",n.AccTreeId),s(5),I("id","Price",e,""),I("name","Price",e,""),T("ngModel",n.Price),s(2),I("id","Notes",e,""),I("name","Notes",e,""),T("ngModel",n.Notes)}}function Ge(a,u){if(a&1&&(N(0),f(1,Qe,16,16,"tr",34),k()),a&2){let i=u.$implicit,n=r(2);s(),C("ngIf",i.EnumRecipe==n.EnumRecipe.InDirectOther)}}function Je(a,u){a&1&&(l(0,"span"),d(1),S(2,"translate"),p()),a&2&&(s(),D(" ",P(2,1,"Model.Save"),""))}function He(a,u){a&1&&(l(0,"span"),d(1),S(2,"translate"),p()),a&2&&(s(),D(" ",P(2,1,"Model.Update"),""))}function ze(a,u){if(a&1){let i=b();v(0,"app-modal-header",9),l(1,"div",10)(2,"div",11)(3,"div",12)(4,"span",13),d(5,"\u0627\u0644\u0645\u0646\u062A\u062C \u0627\u0644\u0644\u064A \u0647\u0635\u0646\u0639\u0647 "),p(),l(6,"ng-select",14,1),h("clear",function(){c(i);let e=r();return _(e.Recipe.Items=[])})("focus",function(){c(i);let e=g(7),t=r();return t.ChangeSearchApi("Product",e),_(t._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(7),t=r();return t.ChangeSearchApi("Product",e),_(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(7),t=r();return _(t.ChangeSearchApi("Product",e))})("close",function(){c(i);let e=r();return e._AppModeService.ResetCurrentPage(),_(e.Recipe.Items=[])})("open",function(){c(i);let e=r();return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(7),t=r();return t.SelectValue(t.Recipe.ProductId,"Product"),e.blur(),_(t.Recipe.Items=[])}),y("ngModelChange",function(e){c(i);let t=r();return w(t.Recipe.ProductId,e)||(t.Recipe.ProductId=e),_(e)}),f(8,de,2,2,"ng-template",15)(9,ue,1,2,"ng-template",16),p()(),l(10,"div",12)(11,"span",13),d(12," \u0627\u0644\u0648\u062D\u062F\u0629 "),p(),l(13,"ng-select",17,2),h("clear",function(){c(i);let e=r();return _(e.Recipe.ProductUnits=[])})("focus",function(){c(i);let e=g(14),t=r();return t.ChangeSearchApi("ItemUnits",e),_(t._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(14),t=r();return t.ChangeSearchApi("ItemUnits",e),_(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(14),t=r();return _(t.ChangeSearchApi("ItemUnits",e))})("close",function(){c(i);let e=r();return e._AppModeService.ResetCurrentPage(),_(e.Recipe.ProductUnits=[])})("open",function(){c(i);let e=r();return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(14),t=r();return t.SelectValue(t.Recipe.ProductUnitId,"ProductUnit"),e.blur(),_(t.Recipe.ProductUnits=[])}),y("ngModelChange",function(e){c(i);let t=r();return w(t.Recipe.ProductUnitId,e)||(t.Recipe.ProductUnitId=e),_(e)}),f(15,me,2,2,"ng-template",15)(16,ge,1,2,"ng-template",16),p()(),l(17,"div",12)(18,"span",13),d(19," \u0645\u0631\u0643\u0632 \u0627\u0644\u062A\u0643\u0644\u0641\u0629 "),p(),l(20,"ng-select",18,1),h("clear",function(){c(i);let e=r();return _(e.Recipe.CostCenters=[])})("focus",function(){c(i);let e=g(7),t=r();return t.ChangeSearchApi("CostCenter",e),_(t._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(7),t=r();return t.ChangeSearchApi("CostCenter",e),_(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(7),t=r();return _(t.ChangeSearchApi("CostCenter",e))})("close",function(){c(i);let e=r();return e._AppModeService.ResetCurrentPage(),_(e.Recipe.CostCenters=[])})("open",function(){c(i);let e=r();return _(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(7),t=r();return t.SelectValue(t.Recipe.CostCenterId,"CostCenter"),e.blur(),_(t.Recipe.CostCenters=[])}),y("ngModelChange",function(e){c(i);let t=r();return w(t.Recipe.CostCenterId,e)||(t.Recipe.CostCenterId=e),_(e)}),f(22,xe,2,2,"ng-template",15)(23,Ce,1,2,"ng-template",16),p()(),l(24,"div",19)(25,"span",13),d(26," \u0627\u0644\u0643\u0645\u064A\u0629 "),p(),l(27,"input",20),y("ngModelChange",function(e){c(i);let t=r();return w(t.Recipe.RecipeQuantity,e)||(t.Recipe.RecipeQuantity=e),_(e)}),p()(),l(28,"div",19)(29,"span",21),d(30," \u0627\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0631\u064A\u0633\u0628\u064A"),p(),v(31,"input",22),p(),l(32,"div",19)(33,"span",21),d(34," \u0645\u0644\u062D\u0648\u0638\u0629 "),p(),l(35,"input",23),y("ngModelChange",function(e){c(i);let t=r();return w(t.Recipe.Notes,e)||(t.Recipe.Notes=e),_(e)}),p()()(),l(36,"div",24)(37,"h1",25),d(38," \u062A\u0643\u0627\u0644\u064A\u0641 \u0635\u0646\u0627\u0639\u064A\u0629 \u0645\u0628\u0627\u0634\u0631\u0629 "),p(),l(39,"div",26)(40,"div",27)(41,"span",21),d(42," \u062A\u0643\u0644\u0641\u0629 \u0627\u0644\u0645\u0648\u0627\u062F \u0627\u0644\u0645\u0628\u0627\u0634\u0631\u0629 "),p(),l(43,"table",28)(44,"thead")(45,"tr")(46,"th",29),d(47,"#"),p(),l(48,"th",30),d(49),S(50,"translate"),p(),l(51,"th",30),d(52),S(53,"translate"),p(),l(54,"th",30),d(55),S(56,"translate"),p(),l(57,"th",30),d(58),S(59,"translate"),p(),l(60,"th"),d(61),S(62,"translate"),p(),l(63,"th"),d(64),S(65,"translate"),p()()(),l(66,"tbody"),f(67,we,2,1,"ng-container",31),p()()()(),l(68,"div",26)(69,"span",21),d(70," \u062A\u0643\u0644\u0641\u0629 \u0627\u0644\u0627\u062C\u0648\u0631 \u0627\u0644\u0645\u0628\u0627\u0634\u0631\u0629 "),p(),l(71,"table",28)(72,"thead")(73,"tr")(74,"th",29),d(75,"#"),p(),l(76,"th",30),d(77),S(78,"translate"),p(),l(79,"th",30),d(80),S(81,"translate"),p(),l(82,"th",30),d(83),S(84,"translate"),p()()(),l(85,"tbody"),f(86,De,2,1,"ng-container",31),p()()()(),l(87,"div",24)(88,"h1",25),d(89," \u062A\u0643\u0627\u0644\u064A\u0641 \u0635\u0646\u0627\u0639\u064A\u0629 \u063A\u064A\u0631 \u0645\u0628\u0627\u0634\u0631\u0629 "),p(),l(90,"div",26)(91,"div",27)(92,"span",21),d(93," \u062A\u0643\u0644\u0641\u0629 \u0627\u0644\u0645\u0648\u0627\u062F \u063A\u064A\u0631 \u0627\u0644\u0645\u0628\u0627\u0634\u0631\u0629 "),p(),l(94,"table",28)(95,"thead")(96,"tr")(97,"th",29),d(98,"#"),p(),l(99,"th",30),d(100),S(101,"translate"),p(),l(102,"th",30),d(103),S(104,"translate"),p(),l(105,"th",30),d(106),S(107,"translate"),p(),l(108,"th",30),d(109),S(110,"translate"),p(),l(111,"th"),d(112),S(113,"translate"),p(),l(114,"th"),d(115),S(116,"translate"),p()()(),l(117,"tbody"),f(118,We,2,1,"ng-container",31),p()()()(),l(119,"div",26)(120,"span",21),d(121," \u062A\u0643\u0644\u0641\u0629 \u0627\u0644\u0627\u062C\u0648\u0631 \u063A\u064A\u0631 \u0627\u0644\u0645\u0628\u0627\u0634\u0631\u0629 "),p(),l(122,"table",28)(123,"thead")(124,"tr")(125,"th",29),d(126,"#"),p(),l(127,"th",30),d(128),S(129,"translate"),p(),l(130,"th",30),d(131),S(132,"translate"),p(),l(133,"th",30),d(134),S(135,"translate"),p()()(),l(136,"tbody"),f(137,$e,2,1,"ng-container",31),p()()(),l(138,"div",26)(139,"span",21),d(140," \u0646\u0641\u0642\u0627\u062A \u0639\u0627\u0645\u0629 - OverHead "),p(),l(141,"table",28)(142,"thead")(143,"tr")(144,"th",29),d(145,"#"),p(),l(146,"th",30),d(147),S(148,"translate"),p(),l(149,"th",30),d(150),S(151,"translate"),p(),l(152,"th",30),d(153),S(154,"translate"),p()()(),l(155,"tbody"),f(156,Ge,2,1,"ng-container",31),p()()()()(),l(157,"div",32)(158,"button",33),h("click",function(){c(i);let e=r();return _(e.Save())}),f(159,Je,3,3,"span",34)(160,He,3,3,"span",34),l(161,"span",35),d(162,"Ctrl + Space"),p()(),l(163,"button",36),h("click",function(){let e=c(i).$implicit,t=r();return e.close("Close click"),_(t.ResetPage())}),d(164),S(165,"translate"),l(166,"span",35),d(167,"Esc"),p()()()}if(a&2){let i=r();C("PageTitle","ProductRecipe.ProductRecipe"),s(6),C("dropdownPosition","bottom")("items",i.Recipe.Items)("virtualScroll",!0)("searchable",!0),T("ngModel",i.Recipe.ProductId),s(7),C("disabled",i.Recipe.ProductId==null)("dropdownPosition","bottom")("items",i.Recipe.ProductUnits)("virtualScroll",!0)("searchable",!0),T("ngModel",i.Recipe.ProductUnitId),s(7),C("dropdownPosition","bottom")("items",i.Recipe.CostCenters)("virtualScroll",!0)("searchable",!0),T("ngModel",i.Recipe.CostCenterId),s(7),T("ngModel",i.Recipe.RecipeQuantity),s(4),C("value",i.Recipe.TotalPrice)("disabled",!0),s(4),T("ngModel",i.Recipe.Notes),s(14),V(P(50,52,"SaleInvoice.Storage")),s(3),V(P(53,54,"SaleInvoice.Name")),s(3),V(P(56,56,"SaleInvoice.Unit")),s(3),V(P(59,58,"Table.Quantity")),s(3),V(P(62,60,"ProductRecipe.WA")),s(3),V(P(65,62,"Table.Total")),s(3),C("ngForOf",i.RecipeDetails),s(10),V(P(78,64,"SaleInvoice.Name")),s(3),V(P(81,66,"MoneyIn.Price")),s(3),V(P(84,68,"MoneyIn.Notes")),s(3),C("ngForOf",i.RecipeDetails),s(14),V(P(101,70,"SaleInvoice.Storage")),s(3),V(P(104,72,"SaleInvoice.Name")),s(3),V(P(107,74,"SaleInvoice.Unit")),s(3),V(P(110,76,"Table.Quantity")),s(3),V(P(113,78,"ProductRecipe.WA")),s(3),V(P(116,80,"Table.Total")),s(3),C("ngForOf",i.RecipeDetails),s(10),V(P(129,82,"SaleInvoice.Name")),s(3),V(P(132,84,"MoneyIn.Price")),s(3),V(P(135,86,"MoneyIn.Notes")),s(3),C("ngForOf",i.RecipeDetails),s(10),V(P(148,88,"SaleInvoice.Name")),s(3),V(P(151,90,"MoneyIn.Price")),s(3),V(P(154,92,"MoneyIn.Notes")),s(3),C("ngForOf",i.RecipeDetails),s(2),C("disabled",i._AppModeService.DisabledButton)("ngClass",L(96,se,i.Recipe.Id==0,i.Recipe.Id!=0)),s(),C("ngIf",i.Recipe.Id==0),s(),C("ngIf",i.Recipe.Id!=0),s(4),D(" ",P(165,94,"Model.Close")," ")}}var pt=(()=>{let u=class u{constructor(n,e,t,o){this._SharedScreenService=n,this._SharedObjectModelService=e,this._AppModeService=t,this._Apiservice=o,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{Url:"Global/GetAll",TableName:"Items",Join:!0,JoinTables:["ItemGroups ItemGroup"],JoinConditions:["T.ItemGroupId = ItemGroup.Id"],Columns:["T.Id","T.Name","T.Code","ItemGroup.Name AS ItemGroupName"]},Required:!1,TableCell:[{SortName:"Name",CellName:"Table.Name",ExistSearchField:"T.Name"},{SortName:"Code",CellName:"Table.Code",ExistSearchField:"T.Code"},{SortName:"ItemGroupName",CellName:"Item.ItemGroup",ExistSearchField:"ItemGroup.Name"}]},this.Recipe={Id:0,ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",CostCenterId:null,CostCenterName:"",TotalPrice:0,RecipeQuantity:"",Items:[],ProductUnits:[],CostCenters:[],RecipeDetails:[]},this.EnumRecipe={DirectProduct:1,DirectSalary:2,InDirectProduct:3,InDirectSalary:4,InDirectOther:5},this.RecipeDetails=[{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],EnumRecipe:this.EnumRecipe.DirectProduct,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Price:""},{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],EnumRecipe:this.EnumRecipe.DirectSalary,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Price:""},{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],EnumRecipe:this.EnumRecipe.InDirectProduct,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Price:""},{Id:0,Name:"",ProductId:null,ProductName:"",Items:[],StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],EnumRecipe:this.EnumRecipe.InDirectSalary,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Price:""},{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],EnumRecipe:this.EnumRecipe.InDirectOther,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Price:""}]}AppendRow(n){let e={Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],EnumRecipe:n,Items:[],ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Price:0};this.RecipeDetails.push(e)}RemoveRow(n,e){return this.RecipeDetails.filter(t=>t.EnumRecipe==n).length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.RecipeDetails.splice(e,1),this.CalcRecipe(),!0)}CalcRecipe(){this.Recipe.TotalPrice=0,this.RecipeDetails.forEach(n=>{n.Quantity=`${n.Quantity}`.trim()==""||n.Quantity=="0"?"":Number(n.Quantity),n.Price=`${n.Price}`.trim()==""||n.Price=="0"?"":Number(n.Price),n.TotalPrice=Number(n.Quantity)>0?Number(n.Price)*Number(n.Quantity):Number(n.Price),this.Recipe.TotalPrice+=n.TotalPrice})}ChangeSearchApi(n,e){let t="";t=`${e.searchTerm}`.trim(),(t==""||t=="null")&&(e.searchTerm="",t=""),this._AppModeService.CurrentPage+=1;let o={TableName:n,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:t,SearchField:"Name"};if(n=="Storages"&&(o.BranchFilter=!0),n=="Product"&&(o.TableName="Items",o.Columns=["Id","Name","Code"],o.SearchField="Code",o.Conditions="ProductType = 1"),n=="ItemUnits"){let m=this.Recipe.ProductId==null?0:this.Recipe.ProductId;o.Conditions=`ItemId = ${m}`,o.Join=!0,o.JoinTables=["Units U"],o.NoPaging=!0,o.JoinConditions=["T.UnitId = U.Id"],o.Columns=["T.Id","U.Name","T.UnitFactor"],o.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",o,!1).pipe(E(this._Apiservice.destroy$)).subscribe({next:m=>{m.IsSuccess==!0&&m.Obj!=null?this.HandleResponse(m.Obj,n):this._AppModeService._Toastr.error(m.Message)}})}HandleResponse(n,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=n.TotalItems,e=="Product"&&(this.Recipe.Items=this._SharedObjectModelService.RemoveDuplicates(this.Recipe.Items.concat(n.DataReturn),"Id").map(t=>U(M({},t),{NameAndCode:t.Code!=null?`${t.Name} - ${t.Code}`:`${t.Name}`}))),e=="ItemUnits"&&(this.Recipe.ProductUnits=n.DataReturn.map(t=>U(M({},t),{NameAndUnitFactor:t.UnitFactor!=null?`${t.Name} - ${t.UnitFactor}`:`${t.Name}`})))}SelectValue(n,e){if(n!=null&&(n>0||n!="")){let t=[];e=="Product"&&(t=this.Recipe.Items),e=="ProductUnit"&&(t=this.Recipe.ProductUnits);let o=t.find(m=>m.Id==n);if(o==null){this._AppModeService.DontPlay();return}else this.Recipe[`${e}Id`]=n,this.Recipe[`${e}Name`]=o.Name}else this.Recipe[`${e}Id`]=null,this.Recipe[`${e}Name`]="",e=="Product"&&(this.Recipe.ProductUnits=[],this.Recipe.ProductUnitId=null)}SelectItem(n,e){if(n!=null&&n>0){let t=this.RecipeDetails[e].Items.find(o=>o.Id==n);if(t!=null)this.RecipeDetails[e].ProductId=t.Id,this.RecipeDetails[e].ProductName=t.Name,this.RecipeDetails[e].ProductUnitId=null,this.RecipeDetails[e].ProductUnits=[],this.AfterSelectem(t.Id,e);else{this._Apiservice.DontPlay();return}}else this.RecipeDetails[e].ProductUnitId=null,this.RecipeDetails[e].ProductUnits=[]}AfterSelectem(n,e){if(n>0){let t={TableName:"ItemUnits",Columns:["Id","Name"],NoPaging:!0,SearchText:"",SearchField:"Name"};t.Conditions=`ItemId = ${n}`,t.Join=!0,t.JoinTables=["Units U"],t.JoinConditions=["T.UnitId = U.Id"],t.Columns=["T.Id","U.Name","T.UnitFactor","T.DefaultUnit"],t.SearchField="U.Name",this._Apiservice.post("Global/GetAll",t,!1).pipe(E(this._Apiservice.destroy$)).subscribe({next:o=>{if(o.IsSuccess==!0&&o.Obj!=null){o.Obj.DataReturn=o.Obj.DataReturn.map(R=>U(M({},R),{NameAndUnitFactor:R.UnitFactor!=null?`${R.Name} - ${R.UnitFactor}`:`${R.Name}`}));let m=o.Obj.DataReturn,x=m.find(R=>R.DefaultUnit==!0);if(x&&this.RecipeDetails.find(W=>W.ProductId==n&&W.ProductUnitId==x.Id)==null){this.RecipeDetails[e].ProductUnits=[{Id:x.Id,NameAndUnitFactor:x.Name+" - "+x.UnitFactor}],this.RecipeDetails[e].ProductUnitId=x.Id,this.RecipeDetails[e].Quantity=1,this.SelectUnit(x.Id,e);return}for(let R=0;R<m.length;R++){let W=this.RecipeDetails.find(O=>O.ProductId==n&&O.ProductUnitId==m[R].Id);if(W==null){this.RecipeDetails[e].ProductUnits=[{Id:m[R].Id,NameAndUnitFactor:m[R].Name+" - "+m[R].UnitFactor}],this.RecipeDetails[e].ProductUnitId=m[R].Id,this.RecipeDetails[e].Quantity=1,this.SelectUnit(m[R].Id,e);break}W!=null&&R==m.length-1&&this.RecipeDetails.splice(e,1)}this.CalcRecipe()}else this._AppModeService._Toastr.error(o.Message)}})}}SelectUnit(n,e){if(n!=null&&n>0){let t=this.RecipeDetails[e].ProductUnits.find(o=>o.Id==n);if(t!=null)this.RecipeDetails[e].ProductUnitId=t.Id,this.RecipeDetails[e].ProductUnitName=t.Name,this.UnitWa(t.Id,e);else{this._Apiservice.DontPlay();return}}}UnitWa(n,e){let t=this.RecipeDetails[e].ProductId;n>0&&t>0&&this._Apiservice.get(`ItemEP/ItemWaUnit?ProductId=${t}&ProductUnitId=${n}`,!1).pipe(E(this._Apiservice.destroy$)).subscribe({next:o=>{o.IsSuccess==!0&&o.Obj!=null?(this.RecipeDetails[e].Price=o.Obj,this.CalcRecipe()):this._AppModeService._Toastr.error(o.Message)}})}ChangeSearchApiDetails(n,e,t,o){let m=`${e.searchTerm}`.trim();(m==""||m=="null")&&(e.searchTerm="",m=""),this._AppModeService.CurrentPage+=1;let x={TableName:n,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:m,SearchField:"Name"};if(n=="AccTreeExpenses"&&(x.TableName="AccTree",x.BranchFilter=!0,x.Conditions="AccClass >= 3 And Level = 5"),(n=="DirectProduct"||n=="InDirectProduct")&&(x.TableName="Items",x.Columns=["Id","Name","Code"],n=="DirectProduct"&&(x.Conditions="ProductType = 1"),n=="InDirectProduct"&&(x.Conditions="ProductType = 3")),n=="ItemUnits"){let R=this.RecipeDetails[t].ProductId==null?0:this.RecipeDetails[t].ProductId;x.Conditions=`ItemId = ${R}`,x.Join=!0,x.JoinTables=["Units U"],x.NoPaging=!0,x.JoinConditions=["T.UnitId = U.Id"],x.Columns=["T.Id","U.Name","T.UnitFactor"],x.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",x,!1).pipe(E(this._Apiservice.destroy$)).subscribe({next:R=>{R.IsSuccess==!0&&R.Obj!=null?this.HandleResponseDetails(R.Obj,n,t):this._AppModeService._Toastr.error(R.Message)}})}HandleResponseDetails(n,e,t){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=n.TotalItems,e=="Storages"&&(this.RecipeDetails[t].Storages=this._SharedObjectModelService.RemoveDuplicates(this.RecipeDetails[t].Storages.concat(n.DataReturn),"Id")),(e=="DirectProduct"||e=="InDirectProduct")&&(this.RecipeDetails[t].Items=this._SharedObjectModelService.RemoveDuplicates(this.RecipeDetails[t].Items.concat(n.DataReturn),"Id"),this.RecipeDetails[t].Items=this.RecipeDetails[t].Items.map(o=>U(M({},o),{NameAndCode:o.Code!=null?`${o.Name} - ${o.Code}`:`${o.Name}`}))),e=="ItemUnits"&&(this.RecipeDetails[t].ProductUnits=n.DataReturn.map(o=>U(M({},o),{NameAndUnitFactor:o.UnitFactor!=null?`${o.Name} - ${o.UnitFactor}`:`${o.Name}`}))),e=="AccTreeExpenses"&&(this.RecipeDetails[t].AccTrees=this._SharedObjectModelService.RemoveDuplicates(this.RecipeDetails[t].AccTrees.concat(n.DataReturn),"Id"))}SelectValueDetails(n,e,t){if(n!=null&&n>0){let o=[];e=="AccTree"&&(o=this.RecipeDetails[t].AccTrees),e=="Storage"&&(o=this.RecipeDetails[t].Storages);let m=o.find(x=>x.Id==n);if(m!=null)this.RecipeDetails[t][`${e}Id`]=m.Id,this.RecipeDetails[t][`${e}Name`]=m.Name;else{this._Apiservice.DontPlay();return}}else this.RecipeDetails[t][`${e}Id`]=null,this.RecipeDetails[t][`${e}Name`]=[]}Save(){if(this.Recipe.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterProduct"));return}let n=this.RecipeDetails.filter(t=>t.Price>0);if(n.length==0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.EmptyCost"));return}for(let t=0;t<n.length;t++){let o=n[t];if(Number(o.Price)>0&&o.AccTreeId==null&&(o.EnumRecipe==this.EnumRecipe.DirectSalary||o.EnumRecipe==this.EnumRecipe.InDirectSalary||o.EnumRecipe==this.EnumRecipe.InDirectOther)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.EmptyCostName"));return}if(Number(o.Price)>0&&(o.EnumRecipe==this.EnumRecipe.DirectProduct||o.EnumRecipe==this.EnumRecipe.InDirectProduct)){if(o.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.ChooseItem"));return}if(o.StorageId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.StoreId"));return}}}console.log(n);let e={Id:this.Recipe.Id,ProductId:this.Recipe.ProductId,ProductName:this.Recipe.ProductName,TotalPrice:this.Recipe.TotalPrice,RecipeQuantity:Number(this.Recipe.RecipeQuantity),RecipeDetails:n};console.log(e),e.Id==0&&this._Apiservice.post("ProductRecipeEP/Add",e,!0).pipe(E(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this._SharedObjectModelService.Paging.DataReturn.push(t.Obj)):this._AppModeService._Toastr.error(t.Message)}}),e.Id>0&&this._Apiservice.put("ProductRecipeEP/Update",e,!0).pipe(E(this._Apiservice.destroy$)).subscribe({next:t=>{if(t.IsSuccess==!0&&t.Obj!=null){this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.UpdateSuccess"));let o=t.Obj,m=this._SharedObjectModelService.Paging.DataReturn.find(x=>x.Id==o.Id);m!=null&&Object.assign(m,o),this.ResetPage()}else this._AppModeService._Toastr.error(t.Message)}})}ResetPage(){}};u.\u0275fac=function(e){return new(e||u)(B(pe),B(_e),B(ne),B(H))},u.\u0275cmp=F({type:u,selectors:[["app-recipe-product"]],standalone:!0,features:[$],decls:3,vars:6,consts:[["content",""],["Select",""],["SelectProductUnit",""],["SelectStorages",""],["SelectItem22",""],["SelectUnits",""],["SelectAccTreeDetails",""],[3,"PageTitle","TablePaging","FullScreen","OutModal","DeleteUrl","GetById"],[1,"modalConent"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0","d-flex","flex-wrap","justify-content-center","align-items-start"],[1,"col-12","d-flex","flex-wrap","justify-content-center","align-items-center"],[1,"col-12","col-md-2"],[1,"fs-3","mx-3"],["id","ngSelectComponent","placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["id","ngSelectComponent","placeholder","Search","bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","disabled","dropdownPosition","items","virtualScroll","searchable","ngModel"],["id","ngSelectComponent","placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","virtualScroll","searchable","ngModel"],[1,"col-12","col-md-2","text-center"],["id","RecipeQuantity","name","RecipeQuantity","type","number","appNumericInput","",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"fs-3"],["id","TotalPrice","name","TotalPrice","type","number","appNumericInput","",1,"form-control","text-center",3,"value","disabled"],["id","Notes","name","Notes","type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-12","col-md-6","d-flex","flex-wrap","justify-content-center","align-items-start"],[1,"fs-1","col-12"],[1,"col-12"],["id","ProductTable",1,"col-12"],[1,"table","table-striped","table-hover"],[1,"col-1"],[1,"col-3"],[4,"ngFor","ngForOf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn","py-3","px-5",3,"click","disabled","ngClass"],[4,"ngIf"],[1,"fs-5","mx-1"],["type","button",1,"btn","btn-light","border","border-1","border-dark","px-5","py-3",3,"click"],[1,"form-text","text-muted"],[1,""],[1,"d-flex","justify-content-center","align-items-center","col-12"],[1,"px-3","mx-xl-1","text-center","mx-auto","btn","btn-success",3,"click"],[1,"mx-1","fs-5","fw-bold","pi","pi-plus"],[1,"px-3","mx-xl-1","text-center","mx-auto","btn","btn-danger",3,"click"],[1,"mx-1","pi","pi-trash","fw-bold","fs-5"],["bindLabel","Name","bindValue","Id",1,"p-0","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","placeholder","virtualScroll","searchable","ngModel"],["bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","placeholder","disabled","virtualScroll","searchable","ngModel"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"change","keyup","ngModelChange","id","name","disabled","ngModel"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"change","keyup","ngModelChange","id","name","ngModel"],["type","text",1,"form-control","text-center",3,"ngModelChange","id","name","ngModel"]],template:function(e,t){if(e&1&&(v(0,"app-dynamic-component",7),f(1,ze,168,99,"ng-template",8,0,j)),e&2){let o=g(2);C("PageTitle","ProductRecipe.ProductRecipe")("TablePaging",t.TablePaging)("FullScreen",!0)("OutModal",o)("DeleteUrl","ProductRecipeEP/Delete")("GetById","ProductRecipeEP/GetById")}},dependencies:[te,K,Z,X,ee,Y,J,ce,oe,ie,re,G,Q,q,z,le,ae]});let a=u;return a})();export{pt as RecipeProductComponent};
