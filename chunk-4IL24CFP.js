import{a as me,b as ue,c as De}from"./chunk-BZPR73YG.js";import{a as be}from"./chunk-D7RC4W4V.js";import{a as ge}from"./chunk-R22ILC4E.js";import{b as pe,j as _e}from"./chunk-JSAFLJSP.js";import"./chunk-EDAXKXER.js";import{a as ce}from"./chunk-VSYXDL23.js";import"./chunk-ZFVZF6NJ.js";import"./chunk-CCUNZCGD.js";import{a as de}from"./chunk-6KCN6SOZ.js";import{a as re,b as le}from"./chunk-OFCF557E.js";import"./chunk-PHRVA4P6.js";import"./chunk-5KZZH3PQ.js";import"./chunk-ENJ54XRO.js";import{a as ne,b as ae,c as oe,d as se}from"./chunk-ZWNSIIKM.js";import"./chunk-KZSRC3MR.js";import"./chunk-TQD4QWDO.js";import{c as z,d as Y,g as ie}from"./chunk-JS2GAZTB.js";import{H as Q,I as q,_ as J,aa as K,b as W,c as $,d as H,da as X,fa as Z,i as U,la as ee,na as te}from"./chunk-WSHLQXZC.js";import{$b as x,Cb as r,Db as l,Eb as M,Ib as I,Mb as S,Nb as c,Qb as w,Rb as A,Tb as V,Ub as O,Vb as k,Wb as N,X as B,Xb as b,Yb as E,Zb as h,_b as R,ac as v,bc as y,db as s,dc as j,eb as T,gc as G,na as P,nc as D,oc as g,pc as F,qc as L,vb as C,xa as _,xb as u,ya as m}from"./chunk-J5UB44FZ.js";import"./chunk-3EYC4JTX.js";var Ce=["GLComponent"],fe=(o,d)=>({"btn-success":o,"btn-primary":d});function Be(o,d){if(o&1&&(r(0,"span",25),b(1),D(2,"date"),l()),o&2){let n=c(2);s(),h(" ",F(2,1,n.BadDebts.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Se(o,d){if(o&1){let n=I();r(0,"div",26,2)(2,"p-calendar",27),y("ngModelChange",function(e){_(n);let i=c(2);return v(i.BadDebts.DocDate,e)||(i.BadDebts.DocDate=e),m(e)}),l()()}if(o&2){let n=c(2);s(2),x("ngModel",n.BadDebts.DocDate),u("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function Ie(o,d){if(o&1&&(r(0,"small",36),b(1),l()),o&2){let n=c().$implicit,t=c(2);s(),R("Loaded ",n.Clients.length," of ",t._SharedObjectModelService.TotalItems,"")}}function xe(o,d){if(o&1&&b(0),o&2){let n=d.item;h(" ",n.Name," ")}}function ve(o,d){if(o&1&&(r(0,"span",37),b(1),l()),o&2){let n=c().$implicit;s(),h(" ",n.AmountDebts," ")}}function ye(o,d){if(o&1){let n=I();r(0,"tr")(1,"td",28),D(2,"translate"),r(3,"ng-select",29,3),S("clear",function(){let e=_(n).$implicit;return m(e.Clients=[])})("focus",function(){let e=_(n).index,i=N(4),a=c(2);return a.ChangeSearchApiDetails("Clients",i,e),m(a._AppModeService.ResetCurrentPage())})("keyup",function(){let e=_(n).index,i=N(4),a=c(2);return a.ChangeSearchApiDetails("Clients",i,e),m(a._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=_(n).index,i=N(4),a=c(2);return m(a.ChangeSearchApiDetails("Clients",i,e))})("close",function(){_(n);let e=c(2);return m(e._AppModeService.ResetCurrentPage())})("open",function(){_(n);let e=c(2);return m(e._AppModeService.ResetCurrentPage())})("change",function(){let e=_(n),i=e.$implicit,a=e.index,p=c(2);return m(p.SelectValueDetails(i.ClientId,"Client",a))}),y("ngModelChange",function(e){let i=_(n).$implicit;return v(i.ClientId,e)||(i.ClientId=e),m(e)}),C(5,Ie,2,2,"ng-template",30)(6,xe,1,1,"ng-template",31),l()(),r(7,"td",32),D(8,"translate"),C(9,ve,2,1,"span",33),l(),r(10,"td",32),D(11,"translate"),r(12,"input",34),S("keyup",function(){let e=_(n),i=e.$implicit,a=e.index,p=c(2);return p.TotalBadDebts(),m(p.ChangeAmount(i.ClientId,a))}),y("ngModelChange",function(e){let i=_(n).$implicit;return v(i.Amount,e)||(i.Amount=e),m(e)}),l()(),r(13,"td",32),D(14,"translate"),r(15,"input",35),y("ngModelChange",function(e){let i=_(n).$implicit;return v(i.Notes,e)||(i.Notes=e),m(e)}),l()()()}if(o&2){let n=d.$implicit,t=d.index,e=c(2);s(),w("title",g(2,23,"TransferStorage.Name")),s(2),u("items",n.Clients)("autofocus",!1)("dropdownPosition",e._AppModeService.DropdownPosition(t))("virtualScroll",!0)("searchable",!0),x("ngModel",n.ClientId),s(4),w("title",g(8,25,"MoneyIn.Debt")),s(2),u("ngIf",n.ClientId>0),s(),w("title",g(11,27,"MoneyIn.Price")),s(2),A("name","Amount",t,""),A("id","Amount",t,""),u("disabled",n.ClientId==0||n.ClientId==null),x("ngModel",n.Amount),s(),w("title",g(14,29,"MoneyIn.Notes")),s(2),A("name","Notes",t,""),A("id","Notes",t,""),u("disabled",n.ClientId==0||n.ClientId==null),x("ngModel",n.Notes)}}function Te(o,d){o&1&&(r(0,"span"),b(1),D(2,"translate"),l()),o&2&&(s(),h(" ",g(2,1,"Model.Save"),""))}function Me(o,d){o&1&&(r(0,"span"),b(1),D(2,"translate"),l()),o&2&&(s(),h(" ",g(2,1,"Model.Update"),""))}function we(o,d){if(o&1){let n=I();r(0,"button",38),S("click",function(){_(n);let e=c(2);return m(e.OpenGl())}),b(1),D(2,"translate"),l()}o&2&&(s(),h(" ",g(2,1,"Model.Gl")," "))}function Ae(o,d){if(o&1){let n=I();M(0,"app-modal-header",5),r(1,"div",6)(2,"div",7)(3,"div",8),M(4,"input",9),l(),r(5,"div",8)(6,"label",10),b(7),D(8,"translate"),l(),r(9,"input",11),y("ngModelChange",function(e){_(n);let i=c();return v(i.BadDebts.Notes,e)||(i.BadDebts.Notes=e),m(e)}),l()(),r(10,"div",8),C(11,Be,3,4,"span",12)(12,Se,3,5,"div",13),l()(),r(13,"div",14)(14,"table",15)(15,"thead")(16,"th",16),b(17),D(18,"translate"),l(),r(19,"th",16),b(20),D(21,"translate"),l(),r(22,"th",16),b(23),D(24,"translate"),l(),r(25,"th",17),b(26),D(27,"translate"),l()(),r(28,"tbody"),C(29,ye,16,31,"tr",18),l()()()(),r(30,"div",19)(31,"button",20),S("click",function(){_(n);let e=c();return m(e.Save())}),C(32,Te,3,3,"span",21)(33,Me,3,3,"span",21),M(34,"i",22),l(),C(35,we,3,3,"button",23),r(36,"button",24),S("click",function(){let e=_(n).$implicit,i=c();return e.close("Close click"),m(i.ResetPage())}),b(37),D(38,"translate"),l()()}if(o&2){let n=c();u("PageTitle","BadDebts.BadDebts"),s(4),u("disabled",!0)("value",n.BadDebts.DocNo),s(3),E(g(8,18,"Table.Notes")),s(2),x("ngModel",n.BadDebts.Notes),s(2),u("ngIf",(n._DefaultSettingsService.DefaultSettings==null?null:n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),s(),u("ngIf",(n._DefaultSettingsService.DefaultSettings==null?null:n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),s(5),h(" ",g(18,20,"SaleInvoice.Client")," "),s(3),h(" ",g(21,22,"MoneyIn.Debt")," "),s(3),h(" ",g(24,24,"MoneyIn.Price")," "),s(3),h(" ",g(27,26,"MoneyIn.Notes")," "),s(3),u("ngForOf",n.BadDebts.BadDebtsDetails)("ngForTrackBy",n.trackByMethod),s(2),u("ngClass",G(30,fe,n.BadDebts.Id==0,n.BadDebts.Id!=0)),s(),u("ngIf",n.BadDebts.Id==0),s(),u("ngIf",n.BadDebts.Id!=0),s(2),u("ngIf",n.BadDebts.Id>0),s(2),E(g(38,28,"Model.Close"))}}var Ze=(()=>{let d=class d{constructor(t,e,i,a){this._SharedObjectModelService=t,this._AppModeService=e,this._DefaultSettingsService=i,this._Apiservice=a,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"BadDebts",Columns:["Id","DocNo","DocDate","Notes"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"}]},this.BadDebts={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",BadDebtsDetails:[{Amount:"",ClientId:null,ClientName:"",Id:0,Code:"",Name:"",Clients:[],AmountDebts:0}]}}ngOnInit(){this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}OpenModal(){this.ResetPage(),this.GetPageInfo()}OpenGl(){this.GLComponent.Open()}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){this.BadDebts={DocDate:new Date(t.DocDate),DocNo:t.DocNo,Id:t.Id,Name:t.Name,Code:t.Code,BadDebtsDetails:t.BadDebtsDetails};for(let e=0;e<this.BadDebts.BadDebtsDetails.length;e++){this.BadDebts.BadDebtsDetails[e].Clients=[],this.BadDebts.BadDebtsDetails[e].Clients=[{Id:this.BadDebts.BadDebtsDetails[e].ClientId,Name:this.BadDebts.BadDebtsDetails[e].ClientName}];let i=this.BadDebts.BadDebtsDetails[e].ClientId;this._Apiservice.getById("ClientEP/TotalBadDepts",i,!1).pipe(B(this._Apiservice.destroy$)).subscribe({next:a=>{a.IsSuccess==!0&&a.Obj!=null?this.BadDebts.BadDebtsDetails[e].AmountDebts=a.Obj:this._AppModeService._Toastr.error(a.Message)}})}}StartConnection(){this.Hub_Connection=new De().withUrl(`${Q.signalrUrl}/BadDebts`,{skipNegotiation:!0,transport:ue.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(me.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(t=>{console.log(t)})}GetPageInfo(){this._Apiservice.get("BadDebtsEP/GetPageInfo",!1).pipe(B(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?this.BadDebts.DocNo=t.Obj:this._AppModeService._Toastr.error(t.Message)}})}ChangeSearchApiDetails(t,e,i){let a=`${e.searchTerm}`.trim();(a==""||a=="null")&&(e.searchTerm="",a=""),this._AppModeService.CurrentPage+=1;let p={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:a,SearchField:"Name"};this._Apiservice.post("Global/GetAll",p,!1).pipe(B(this._Apiservice.destroy$)).subscribe({next:f=>{f.IsSuccess==!0&&f.Obj!=null?this.HandleResponseDetails(f.Obj,t,i):this._AppModeService._Toastr.error(f.Message)}})}HandleResponseDetails(t,e,i){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Clients"&&(this.BadDebts.BadDebtsDetails[i].Clients=this._SharedObjectModelService.RemoveDuplicates(this.BadDebts.BadDebtsDetails[i].Clients.concat(t.DataReturn),"Id"))}SelectValueDetails(t,e,i){if(t!=null&&t>0){let a=[];e=="Client"&&(a=this.BadDebts.BadDebtsDetails[i].Clients);let p=a.find(f=>f.Id==t);if(p!=null)this.BadDebts.BadDebtsDetails[i][`${e}Id`]=p.Id,this.BadDebts.BadDebtsDetails[i][`${e}Name`]=p.Name,this.TotalBadDepts(p.Id,i);else{this._Apiservice.DontPlay();return}}else this.BadDebts.BadDebtsDetails[i][`${e}Id`]=null,this.BadDebts.BadDebtsDetails[i][`${e}Name`]=[]}TotalBadDepts(t,e){this._Apiservice.getById("ClientEP/TotalBadDepts",t,!1).pipe(B(this._Apiservice.destroy$)).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?this.BadDebts.BadDebtsDetails[e].AmountDebts=i.Obj:this._AppModeService._Toastr.error(i.Message)},error:i=>{this._AppModeService._Toastr.error(i)}})}AppendRow(){return this.Row={ClientId:null,Amount:"",AmountDebts:0,ClientName:"",Clients:[],Code:"",Id:0,Name:""},this.BadDebts.BadDebtsDetails.push(this.Row),this.TotalBadDebts(),!0}RemoveRow(t){return this.BadDebts.BadDebtsDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.BadDebts.BadDebtsDetails.splice(t,1),this.TotalBadDebts(),!0)}TotalBadDebts(){let t=0;for(let e=0;e<this.BadDebts.BadDebtsDetails.length;e++)t+=Number(this.BadDebts.BadDebtsDetails[e].Amount);return Number(t.toFixed(2))}ChangeAmount(t,e){}Save(){if(this.BadDebts.DocDate==""||this.BadDebts.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}for(let e=0;e<this.BadDebts.BadDebtsDetails.length;e++){let i=e,a=Number(this.BadDebts.BadDebtsDetails[e].ClientId),p=Number(this.BadDebts.BadDebtsDetails[e].Amount),f=Number(this.BadDebts.BadDebtsDetails[e].AmountDebts);if(a>0){if(p<=0||isNaN(p)||p==null||p==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("MoneyIn.Error.EnterAmount"));return}if(this.BadDebts.BadDebtsDetails.filter(he=>he.ClientId==a).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(i+1));return}}}let t={DocNo:this.BadDebts.DocNo,DocDate:this._Apiservice.ConvertISODate(this.BadDebts.DocDate),BadDebtsDetails:this.BadDebts.BadDebtsDetails,Id:this.BadDebts.Id,Name:"",Code:""};t.Id==0&&this._Apiservice.post("BadDebtsEP/Add",t,!0).pipe(B(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}}),t.Id>0&&this._Apiservice.put("BadDebtsEP/Update",t,!0).pipe(B(this._Apiservice.destroy$)).subscribe({next:e=>{if(e.IsSuccess==!0&&e.Obj!=null){this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo();let i=e.Obj,a=this._SharedObjectModelService.Paging.DataReturn.find(p=>p.Id==i.Id);a!=null&&Object.assign(a,i)}else this._AppModeService._Toastr.error(e.Message)}})}ResetPage(){this.BadDebts={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",BadDebtsDetails:[{Amount:"",ClientId:null,ClientName:"",Id:0,Code:"",Name:"",Clients:[],AmountDebts:0}]},this._DefaultSettingsService.ResetDate(this.BadDebts)}ServerListener(){this.Hub_Connection?.on("AddBadDebts",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&(this.BadDebts.DocNo=t.DocNo)})}trackByMethod(t,e){return e.Id}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};d.\u0275fac=function(e){return new(e||d)(T(de),T(ie),T(ge),T(q))},d.\u0275cmp=P({type:d,selectors:[["app-bad-debts"]],viewQuery:function(e,i){if(e&1&&V(Ce,5),e&2){let a;O(a=k())&&(i.GLComponent=a.first)}},standalone:!0,features:[j],decls:5,vars:7,consts:[["content",""],["GLComponent",""],["ddddd",""],["SelectClientssDetails",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"col-12","d-flex","flex","flex-wrap","align-items-end"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","p-1"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block text-center",4,"ngIf"],["class","formdate",4,"ngIf"],[1,"table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-3","mb-0"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn","py-3","px-5",3,"click","ngClass"],[4,"ngIf"],[1,"mx-1","pi","pi-save"],["class","btn btn-info mx-3 py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-light","border","border-1","border-dark","px-5","py-3",3,"click"],[1,"d-block","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"ngSelect",3,"title"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[3,"title"],["class","text-dark d-block text-center col-11 col-md-12",4,"ngIf"],["min","0","step","1","type","number","appNumericInput","",1,"form-control","shadow-none","text-center",3,"keyup","ngModelChange","disabled","ngModel","name","id"],["type","text",1,"form-control","shadow-none","text-center",3,"ngModelChange","disabled","ngModel","name","id"],[1,"form-text","text-muted"],[1,"text-dark","d-block","text-center","col-11","col-md-12"],[1,"btn","btn-info","mx-3","py-3","px-5",3,"click"]],template:function(e,i){if(e&1){let a=I();r(0,"app-dynamic-component",4),S("OpenModalEvent",function(){return _(a),m(i.OpenModal())})("ShowToEditeEvent",function(){return _(a),m(i.ShowToEdite())}),l(),C(1,Ae,39,33,"ng-template",null,0,L),M(3,"app-glsheard",null,1)}if(e&2){let a=N(2);u("PageTitle","BadDebts.BadDebts")("TablePaging",i.TablePaging)("FullScreen",!0)("GlResponse",!0)("GetById","BadDebtsEP/GetById")("DeleteUrl","BadDebtsEP/Delete")("OutModal",a)}},dependencies:[le,re,U,H,$,W,te,J,Z,K,ee,X,Y,z,se,oe,ne,ae,_e,be,pe,ce]});let o=d;return o})();export{Ze as BadDebtsComponent};
