import{a as Se,b as ge,c as he}from"./chunk-BZPR73YG.js";import{a as ue}from"./chunk-RI6KAADW.js";import{a as Te}from"./chunk-3UDBFBON.js";import{b as pe,c as de,h as fe}from"./chunk-ZV4STMPN.js";import"./chunk-3ZAIJ4IV.js";import"./chunk-W3OSOPGE.js";import{a as _e}from"./chunk-VSYXDL23.js";import"./chunk-BHSN7HFD.js";import{a as le,b as ce}from"./chunk-6BJKXUWP.js";import"./chunk-3Y7UQ2M3.js";import{a as me}from"./chunk-LUZO7NCR.js";import"./chunk-VUX2NRX2.js";import"./chunk-RXBBGPQB.js";import"./chunk-GEJP5WQO.js";import"./chunk-GNF256I6.js";import{a as ie,b as oe,c as ae,d as se}from"./chunk-MZIKAFPE.js";import"./chunk-EGE4BGUH.js";import"./chunk-RVJIMCIT.js";import{c as ne}from"./chunk-NUFVOF6D.js";import{c as Y,d as K}from"./chunk-KALZ37GW.js";import{b as q,c as z,f as X,h as Z,k as ee,m as te,u as re}from"./chunk-N4FWSTCP.js";import{A as J,d as L,e as W,j as H}from"./chunk-VTADEU6K.js";import{$b as b,Cb as c,Db as _,Eb as y,Ib as A,Mb as C,Nb as a,Qb as E,Rb as O,Tb as F,Ub as B,Vb as R,Wb as I,X as v,Xb as f,Yb as h,Zb as N,_b as M,ac as w,bc as D,db as p,dc as Q,eb as P,na as j,nc as T,oc as S,pc as $,qc as k,vb as x,xa as s,xb as g,ya as l}from"./chunk-J5UB44FZ.js";import{a as V,b as U}from"./chunk-3EYC4JTX.js";var xe=["content"],Ce=["GLComponent"],ve=["dynamiccomponent"];function be(o,m){if(o&1&&(c(0,"span",31),f(1),T(2,"date"),_()),o&2){let n=a(2);p(),N(" ",$(2,1,n.Transfer.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function we(o,m){if(o&1){let n=A();c(0,"p-calendar",32),D("ngModelChange",function(e){s(n);let r=a(2);return w(r.Transfer.DocDate,e)||(r.Transfer.DocDate=e),l(e)}),_()}if(o&2){let n=a(2);b("ngModel",n.Transfer.DocDate),g("showOtherMonths",!0)("showTime",!0)("showIcon",!0)("showOnFocus",!0)}}function De(o,m){if(o&1&&(c(0,"small",33),f(1),_()),o&2){let n=a(2);p(),M("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function ye(o,m){if(o&1&&f(0),o&2){let n=m.item;N(" ",n.Name," ")}}function Ne(o,m){if(o&1&&(c(0,"small",33),f(1),_()),o&2){let n=a(2);p(),M("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Pe(o,m){if(o&1&&f(0),o&2){let n=m.item;N(" ",n.Name," ")}}function Ae(o,m){if(o&1&&(c(0,"small",33),f(1),_()),o&2){let n=a().$implicit,t=a(2);p(),M("Loaded ",n.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Me(o,m){if(o&1&&f(0),o&2){let n=m.item;M(" ",n.Name," - ",n.Code," ")}}function Ee(o,m){if(o&1){let n=A();c(0,"button",49),C("click",function(){s(n);let e=a().index,r=a(2),i=I(5);return l(r.GetItemBalance(e,i))}),y(1,"i",50),_()}if(o&2){let n=a(3);g("disabled",n._AppModeService.DisabledButton)}}function Ve(o,m){if(o&1&&(c(0,"small",33),f(1),_()),o&2){let n=a().$implicit,t=a(2);p(),M("Loaded ",n.ProductUnits.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ue(o,m){if(o&1&&f(0),o&2){let n=m.item;N(" ",n.Name," ")}}function Fe(o,m){if(o&1){let n=A();c(0,"tr")(1,"td",34)(2,"div",35)(3,"span",36),f(4),_(),c(5,"button",37),C("click",function(){s(n);let e=a(2);return l(e.AppendRow())}),y(6,"i",38),_(),c(7,"button",39),C("click",function(){let e=s(n).index,r=a(2);return l(r.RemoveRow(e))}),y(8,"i",40),_()()(),c(9,"td",41),T(10,"translate"),c(11,"ng-select",42,6),T(13,"translate"),C("clear",function(){let e=s(n).$implicit;return l(e.Items=[])})("focus",function(){let e=s(n).index,r=I(12),i=a(2);return i.ChangeSearchApiDetails("Items",r,e),l(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(n).index,r=I(12),i=a(2);return i.ChangeSearchApiDetails("Items",r,e),l(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(n).index,r=I(12),i=a(2);return l(i.ChangeSearchApiDetails("Items",r,e))})("close",function(){s(n);let e=a(2);return l(e._AppModeService.ResetCurrentPage())})("open",function(){s(n);let e=a(2);return l(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(n),r=e.$implicit,i=e.index,d=a(2);return l(d.SelectItem(r.ProductId,i))}),D("ngModelChange",function(e){let r=s(n).$implicit;return w(r.ProductId,e)||(r.ProductId=e),l(e)}),x(14,Ae,2,2,"ng-template",24)(15,Me,1,2,"ng-template",25),_(),x(16,Ee,2,1,"button",43),_(),c(17,"td",44),T(18,"translate"),c(19,"ng-select",45,7),T(21,"translate"),C("clear",function(){let e=s(n).$implicit;return l(e.ProductUnits=[])})("focus",function(){let e=s(n).index,r=I(20),i=a(2);return i.ChangeSearchApiDetails("ItemUnits",r,e),l(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(n).index,r=I(20),i=a(2);return i.ChangeSearchApiDetails("ItemUnits",r,e),l(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(n).index,r=I(20),i=a(2);return l(i.ChangeSearchApiDetails("ItemUnits",r,e))})("close",function(){s(n);let e=a(2);return l(e._AppModeService.ResetCurrentPage())})("open",function(){s(n);let e=a(2);return l(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(n),r=e.$implicit,i=e.index,d=a(2);return l(d.SelectUnit(r.ProductUnitId,i))}),D("ngModelChange",function(e){let r=s(n).$implicit;return w(r.ProductUnitId,e)||(r.ProductUnitId=e),l(e)}),x(22,Ve,2,2,"ng-template",24)(23,Ue,1,1,"ng-template",25),_()(),c(24,"td",46),T(25,"translate"),c(26,"div",47)(27,"input",48),D("ngModelChange",function(e){let r=s(n).$implicit;return w(r.Quantity,e)||(r.Quantity=e),l(e)}),_()()()()}if(o&2){let n=m.$implicit,t=m.index,e=a(2);p(),E("title",t+1),p(3),h(t+1),p(3),g("disabled",e.Transfer.TransferDetails.length==1),p(2),E("title",S(10,21,"TransferStorage.Name")),p(2),O("placeholder","  ",S(13,23,"SaleInvoice.ChooseProduct"),""),g("items",n.Items)("dropdownPosition","bottom")("searchable",!0)("virtualScroll",!0),b("ngModel",n.ProductId),p(5),g("ngIf",n.ProductId>0&&e.Transfer.FromStoreId>0&&e.Transfer.ToStoreId>0),p(),E("title",S(18,25,"SaleInvoice.Units")),p(2),O("placeholder","  ",S(21,27,"Item.ItemUnit"),""),g("items",n.ProductUnits)("dropdownPosition","bottom")("disabled",n.ProductId==0||n.ProductId==null),b("ngModel",n.ProductUnitId),p(5),E("title",S(25,29,"SaleInvoice.Quantity")),p(3),b("ngModel",n.Quantity)}}function Be(o,m){if(o&1){let n=A();y(0,"app-modal-header",10),c(1,"div",11)(2,"div",12)(3,"div",13)(4,"label",14),f(5),T(6,"translate"),_(),y(7,"input",15),_(),c(8,"div",16)(9,"label",17),f(10),T(11,"translate"),_(),c(12,"input",18),D("ngModelChange",function(e){s(n);let r=a();return w(r.Transfer.Notes,e)||(r.Transfer.Notes=e),l(e)}),_()(),c(13,"div",16),x(14,be,3,4,"span",19)(15,we,1,5,"p-calendar",20),_(),c(16,"div",21)(17,"p",22),f(18),T(19,"translate"),_(),c(20,"ng-select",23,4),C("clear",function(){s(n);let e=a();return l(e.Storages=[])})("focus",function(){s(n);let e=I(21),r=a();return r.ChangeSearchApi("FromStore",e),l(r._AppModeService.ResetCurrentPage())})("keyup",function(){s(n);let e=I(21),r=a();return r.ChangeSearchApi("FromStore",e),l(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(n);let e=I(21),r=a();return l(r.ChangeSearchApi("FromStore",e))})("close",function(){s(n);let e=a();return l(e._AppModeService.ResetCurrentPage())})("open",function(){s(n);let e=a();return l(e._AppModeService.ResetCurrentPage())})("change",function(){s(n);let e=a();return l(e.SelectValue(e.Transfer.FromStoreId,"FromStore"))}),D("ngModelChange",function(e){s(n);let r=a();return w(r.Transfer.FromStoreId,e)||(r.Transfer.FromStoreId=e),l(e)}),x(22,De,2,2,"ng-template",24)(23,ye,1,1,"ng-template",25),_()(),c(24,"div",21)(25,"p",22),f(26),T(27,"translate"),_(),c(28,"ng-select",23,5),C("clear",function(){s(n);let e=a();return l(e.Storages=[])})("focus",function(){s(n);let e=I(29),r=a();return r.ChangeSearchApi("ToStore",e),l(r._AppModeService.ResetCurrentPage())})("keyup",function(){s(n);let e=I(29),r=a();return r.ChangeSearchApi("ToStore",e),l(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(n);let e=I(29),r=a();return l(r.ChangeSearchApi("ToStore",e))})("close",function(){s(n);let e=a();return l(e._AppModeService.ResetCurrentPage())})("open",function(){s(n);let e=a();return l(e._AppModeService.ResetCurrentPage())})("change",function(){s(n);let e=a();return l(e.SelectValue(e.Transfer.ToStoreId,"ToStore"))}),D("ngModelChange",function(e){s(n);let r=a();return w(r.Transfer.ToStoreId,e)||(r.Transfer.ToStoreId=e),l(e)}),x(30,Ne,2,2,"ng-template",24)(31,Pe,1,1,"ng-template",25),_()()(),c(32,"div",26)(33,"table",27)(34,"thead")(35,"tr")(36,"th"),f(37,"#"),_(),c(38,"th",28),f(39),T(40,"translate"),_(),c(41,"th",28),f(42),T(43,"translate"),_(),c(44,"th",28),f(45),T(46,"translate"),_()()(),c(47,"tbody"),x(48,Fe,28,31,"tr",29),_()()()(),c(49,"app-modal-footer",30),C("SaveEvent",function(){s(n);let e=a();return l(e.Save())})("UpdateEvent",function(){s(n);let e=a();return l(e.Save())})("OpenGlEvent",function(){s(n);let e=a();return l(e.OpenGl())})("CloseEvent",function(){let e=s(n).$implicit,r=a();return e.close("Close click"),l(r.ResetPage())}),_()}if(o&2){let n=a();g("PageTitle","TransferStorage.TransferStorage"),p(5),h(S(6,26,"Table.DocNo")),p(2),g("value",n.Transfer.DocNo)("disabled",!0),p(3),h(S(11,28,"Table.Notes")),p(2),b("ngModel",n.Transfer.Notes),p(2),g("ngIf",n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!1),p(),g("ngIf",n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!0),p(3),h(S(19,30,"TransferStorage.FromStoreId")),p(2),g("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",n.Transfer.FromStoreId),p(6),h(S(27,32,"TransferStorage.ToStoreId")),p(2),g("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",n.Transfer.ToStoreId),p(11),h(S(40,34,"TransferStorage.Name")),p(3),h(S(43,36,"SaleInvoice.Units")),p(3),h(S(46,38,"TransferStorage.Quantity")),p(3),g("ngForOf",n.Transfer.TransferDetails),p(),g("Id",n.Transfer.Id)("Gl",!0)}}function Re(o,m){if(o&1&&(c(0,"tr")(1,"td")(2,"span",54),f(3),_()(),c(4,"td")(5,"span",54),f(6),_()()()),o&2){let n=m.$implicit;p(3),h(n.Name),p(3),h(n.Qty)}}function Oe(o,m){if(o&1&&(c(0,"tr")(1,"td")(2,"span",54),f(3),_()(),c(4,"td")(5,"span",54),f(6),_()()()),o&2){let n=m.$implicit;p(3),h(n.Name),p(3),h(n.Qty)}}function ke(o,m){if(o&1&&(c(0,"div",51)(1,"p",52),f(2),T(3,"translate"),_(),c(4,"table",53)(5,"thead")(6,"tr")(7,"th"),f(8),T(9,"translate"),_(),c(10,"th"),f(11),T(12,"translate"),_()()(),c(13,"tbody"),x(14,Re,7,2,"tr",29),_()(),c(15,"p",52),f(16),T(17,"translate"),_(),c(18,"table",53)(19,"thead")(20,"tr")(21,"th"),f(22),T(23,"translate"),_(),c(24,"th"),f(25),T(26,"translate"),_()()(),c(27,"tbody"),x(28,Oe,7,2,"tr",29),_()()()),o&2){let n=a();p(2),N(" ",S(3,8,"TransferStorage.BalanceFrom")," "),p(6),h(S(9,10,"SaleInvoice.Name")),p(3),h(S(12,12,"Table.Balance")),p(3),g("ngForOf",n.ItemBalanceFrom),p(2),N(" ",S(17,14,"TransferStorage.BalanceTo")," "),p(6),h(S(23,16,"SaleInvoice.Name")),p(3),h(S(26,18,"Table.Balance")),p(3),g("ngForOf",n.ItemBalanceTo)}}var pt=(()=>{let m=class m{constructor(t,e,r,i,d){this._ActivatedRoute=t,this._AppModeService=e,this._SharedObjectModelService=r,this._DefaultSettingsService=i,this._Apiservice=d,this.TablePaging={InputType:"Table",Type:"TablePaging",ReportName:"Transfer",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"Transfer",Join:!0,JoinTables:["Storages SF","Storages ST"],JoinConditions:["T.FromStoreId = SF.Id","T.ToStoreId = ST.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","SF.Name AS FromStoreName","ST.Name AS ToStoreName"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes",ExistSearchField:"T.Notes"},{SortName:"FromStoreName",CellName:"TransferStorage.FromStoreId",ExistSearchField:"SF.Name"},{SortName:"ToStoreName",CellName:"TransferStorage.ToStoreId",ExistSearchField:"ST.Name"}]},this.Transfer={Id:0,Name:"",Notes:"",Code:"",FromStoreId:null,FromStoreName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,DocNo:0,DocDate:"",TransferDetails:[{Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""}]},this.Storages=[],this.ItemBalanceFrom=[],this.ItemBalanceTo=[]}ngOnInit(){let t=Number(this._ActivatedRoute.snapshot.queryParams.Id);t>0&&this.GetByIdRoute(t),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(t){this._Apiservice.getById("TransferStorageEP/GetById",t,!0).pipe(v(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.GLComponent.Gl=e.Obj.Gl,this.Drow(e.Obj.model),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(e.Message)}})}OpenModal(){this._AppModeService.DisabledButton=!0,this.ResetPage(),this.GetPageInfo()}GetPageInfo(){this._Apiservice.get("TransferStorageEP/GetPageInfo",!1).pipe(v(this._Apiservice.destroy$)).subscribe({next:t=>{this._AppModeService.DisabledButton=!1,t.IsSuccess==!0&&t.Obj!=null?this.Transfer.DocNo=t.Obj:this._AppModeService._Toastr.error(t.Message)},error:t=>{this._AppModeService.DisabledButton=!1}})}ShowToEdite(t){this.GLComponent.Gl=t.Gl,this.Drow(t.PageModel)}Drow(t){this.Transfer={Id:t.Id,Name:t.Name,Notes:t.Notes,Code:t.Code,FromStoreId:t.FromStoreId,FromStoreName:t.FromStoreName,ToStoreId:t.ToStoreId,ToStoreName:t.ToStoreName,TotalQty:t.TotalQty,DocNo:t.DocNo,DocDate:new Date(`${t.DocDate}`),TransferDetails:t.TransferDetails},this.Storages=[],this.Storages.push({Id:t.FromStoreId,Name:t.FromStoreName}),this.Storages.push({Id:t.ToStoreId,Name:t.ToStoreName});for(let e=0;e<this.Transfer.TransferDetails.length;e++){let r=this.Transfer.TransferDetails[e];r.Items=[{Id:r.ProductId,Name:r.ProductName,NameAndCode:r.ProductName}],r.ProductUnits=[{Id:r.ProductUnitId,Name:r.ProductUnitName,NameAndUnitFactor:r.ProductUnitName}]}}ChangeSearchApi(t,e){let r=`${e.searchTerm}`.trim();(r==""||r=="null")&&(e.searchTerm="",r=""),this._AppModeService.CurrentPage+=1;let i={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:r,SearchField:"Name"};(t=="FromStore"||t=="ToStore")&&(i.TableName="Storages",i.BranchFilter=!0),this._Apiservice.post("Global/GetAll",i,!1).pipe(v(this._Apiservice.destroy$)).subscribe({next:d=>{d.IsSuccess==!0&&d.Obj!=null?this.HandleResponse(d.Obj,t):this._AppModeService._Toastr.error(d.Message)}})}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,(e=="FromStore"||e=="ToStore")&&(this.Storages=this._SharedObjectModelService.RemoveDuplicates(this.Storages.concat(t.DataReturn),"Id"))}ChangeSearchApiDetails(t,e,r){let i=`${e.searchTerm}`.trim();(i==""||i=="null")&&(e.searchTerm="",i=""),this._AppModeService.CurrentPage+=1;let d={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:i,SearchField:"Name"};if(t=="Items"&&(d.Columns=["Id","Name","Code"],d.Conditions="ProductType != 2"),t=="ItemUnits"){let u=this.Transfer.TransferDetails[r].ProductId==null?0:this.Transfer.TransferDetails[r].ProductId;d.Conditions=`ItemId = ${u}`,d.Join=!0,d.JoinTables=["Units U"],d.NoPaging=!0,d.JoinConditions=["T.UnitId = U.Id"],d.Columns=["T.Id","U.Name","T.UnitFactor"],d.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",d,!1).pipe(v(this._Apiservice.destroy$)).subscribe({next:u=>{u.IsSuccess==!0&&u.Obj!=null?this.HandleResponseDetails(u.Obj,t,r):this._AppModeService._Toastr.error(u.Message)}})}HandleResponseDetails(t,e,r){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Items"&&(this.Transfer.TransferDetails[r].Items=this._SharedObjectModelService.RemoveDuplicates(this.Transfer.TransferDetails[r].Items.concat(t.DataReturn),"Id"),this.Transfer.TransferDetails[r].Items=this.Transfer.TransferDetails[r].Items.map(i=>U(V({},i),{NameAndCode:i.Code!=null?`${i.Name} - ${i.Code}`:`${i.Name}`}))),e=="ItemUnits"&&(this.Transfer.TransferDetails[r].ProductUnits=t.DataReturn.map(i=>U(V({},i),{NameAndUnitFactor:i.UnitFactor!=null?`${i.Name} - ${i.UnitFactor}`:`${i.Name}`})))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let r=[];(e=="FromStore"||e=="ToStore")&&(r=this.Storages);let i=r.find(d=>d.Id==t);if(i==null){this._AppModeService.DontPlay();return}else this.Transfer[`${e}Id`]=t,this.Transfer[`${e}Name`]=i.Name}else this.Transfer[`${e}Id`]=null,this.Transfer[`${e}Name`]=""}SelectItem(t,e){if(t!=null&&t>0){let r=this.Transfer.TransferDetails[e].Items.find(i=>i.Id==t);if(r!=null)this.Transfer.TransferDetails[e].ProductId=r.Id,this.Transfer.TransferDetails[e].ProductName=r.Name,this.Transfer.TransferDetails[e].ProductUnitId=null,this.Transfer.TransferDetails[e].ProductUnits=[],this.AfterSelectem(r.Id,e);else{this._Apiservice.DontPlay();return}}else this.Transfer.TransferDetails[e].ProductUnitId=null,this.Transfer.TransferDetails[e].ProductUnits=[]}AfterSelectem(t,e){if(t>0){let r={TableName:"ItemUnits",Columns:["Id","Name"],CurrentPage:1,PageSize:1,SearchText:"",SearchField:"Name"};r.Conditions=`ItemId = ${t}`,r.Join=!0,r.JoinTables=["Units U"],r.JoinConditions=["T.UnitId = U.Id"],r.Columns=["T.Id","U.Name","T.UnitFactor"],r.SearchField="U.Name",this._Apiservice.post("Global/GetAll",r,!1).pipe(v(this._Apiservice.destroy$)).subscribe({next:i=>{if(i.IsSuccess==!0&&i.Obj!=null){i.Obj.DataReturn=i.Obj.DataReturn.map(u=>U(V({},u),{NameAndUnitFactor:u.UnitFactor!=null?`${u.Name} - ${u.UnitFactor}`:`${u.Name}`}));let d=i.Obj.DataReturn[0];d!=null&&(this.Transfer.TransferDetails[e].ProductUnits=i.Obj.DataReturn,this.Transfer.TransferDetails[e].ProductUnitId=d.Id,this.Transfer.TransferDetails[e].Quantity=1)}else this._AppModeService._Toastr.error(i.Message)}})}}SelectUnit(t,e){if(t!=null&&t>0){let r=this.Transfer.TransferDetails[e].ProductUnits.find(i=>i.Id==t);if(r!=null)this.Transfer.TransferDetails[e].ProductUnitId=r.Id,this.Transfer.TransferDetails[e].ProductUnitName=r.Name;else{this._Apiservice.DontPlay();return}}}TotalRow(t){let e=Number(this.Transfer.TransferDetails[t].Price),r=Number(this.Transfer.TransferDetails[t].Quantity);return Number(e*r)}TotalTransfer(){let t=0;for(let e=0;e<this.Transfer.TransferDetails.length;e++)this.Transfer.TransferDetails[e].ProductId>0&&this.Transfer.TransferDetails[e].ProductUnitId>0&&(t+=Number(this.Transfer.TransferDetails[e].Price)*Number(this.Transfer.TransferDetails[e].Quantity));return Number(t)}AppendRow(){let t={Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""};return this.Transfer.TransferDetails.push(t),this._AppModeService.AppendTd(),!0}RemoveRow(t){return this.Transfer.TransferDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Transfer.Error.ErrorFirstRow")),!1):(this.Transfer.TransferDetails.splice(t,1),this.TotalTransfer(),!0)}GetItemBalance(t,e){let r=this.Transfer.TransferDetails[t];if(this.Transfer.ToStoreId==0||this.Transfer.ToStoreId==null||this.Transfer.FromStoreId==0||this.Transfer.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Storage"));return}if(r.ProductId==0||r.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}let i={ProductId:r.ProductId,FromStoreId:this.Transfer.FromStoreId,ToStoreId:this.Transfer.ToStoreId};this._AppModeService.DisabledButton=!0,this._Apiservice.post("ItemEP/ProductBalance",i,!0).pipe(v(this._Apiservice.destroy$)).subscribe({next:d=>{d.IsSuccess==!0&&d.Obj!=null?(this._AppModeService.DisabledButton=!1,this._AppModeService._NgbModal.open(e,{size:"xl",centered:!0}),this.ItemBalanceFrom=d.Obj.FromStorageBalance,this.ItemBalanceTo=d.Obj.ToStorageBalance):(this._AppModeService.DisabledButton=!1,this._AppModeService._Toastr.error(d.Message))},error:d=>{this._AppModeService.DisabledButton=!1}})}Save(){if(this.Transfer.DocDate==""||this.Transfer.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate"));return}if(this.Transfer.FromStoreId==0||this.Transfer.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterFromStore"));return}if(this.Transfer.ToStoreId==0||this.Transfer.ToStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterToStore"));return}if(this.Transfer.ToStoreId==this.Transfer.FromStoreId){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.ErrorExistStore"));return}for(let e=0;e<this.Transfer.TransferDetails.length;e++){let r=e,i=Number(this.Transfer.TransferDetails[e].ProductId),d=Number(this.Transfer.TransferDetails[e].Quantity),u=Number(this.Transfer.TransferDetails[e].ProductUnitId),Ie=Number(this.Transfer.TransferDetails[e].Price);if(i==null||i==null||i<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}if(u==null||u==null||u<=0||isNaN(u)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyTransfer.Error.EnterUnit"));return}if(this.Transfer.TransferDetails.filter(G=>G.ProductId==i&&G.ProductUnitId==u).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(r+1));return}if(d==null||d==null||isNaN(d)||d<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterQuantity"));return}this.Transfer.TransferDetails[e].ProductUnitId=u,this.Transfer.TransferDetails[e].ProductId=i,this.Transfer.TransferDetails[e].Price=Ie}let t={DocDate:this._Apiservice.ConvertISODate(this.Transfer.DocDate),DocNo:this.Transfer.DocNo,TransferDetails:this.Transfer.TransferDetails,FromStoreId:this.Transfer.FromStoreId,FromStoreName:this.Transfer.FromStoreName,ToStoreId:this.Transfer.ToStoreId,ToStoreName:this.Transfer.ToStoreName,TotalQty:this.Transfer.TotalQty,Id:this.Transfer.Id,Name:this.Transfer.Name,Code:this.Transfer.Code,Notes:this.Transfer.Notes};t.Id==0&&this._Apiservice.post("TransferStorageEP/Add",t,!0).pipe(v(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this.DynamicComponent.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}}),t.Id>0&&this._Apiservice.put("TransferStorageEP/Update",t,!0).pipe(v(this._Apiservice.destroy$)).subscribe({next:e=>{if(e.IsSuccess==!0&&e.Obj!=null){this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.UpdateSuccess"));let r=e.Obj,i=this.DynamicComponent.Paging.DataReturn.find(d=>d.Id==r.Id);i!=null&&Object.assign(i,r),this.ResetPage(),this.GetPageInfo()}else this._AppModeService._Toastr.error(e.Message)}})}OpenGl(){this.GLComponent.Open()}StartConnection(){this.Hub_Connection=new he().withUrl(`${q.signalrUrl}/Transfer`,{skipNegotiation:!0,transport:ge.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(Se.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(t=>{console.log(t)})}ServerListener(){this.Hub_Connection?.on("AddTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&(this.Transfer.DocNo=t.DocNo)}),this.Hub_Connection?.on("UpdateTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Transfer.Id&&(alert(this._AppModeService._Translate.instant("Show.UpdateModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.UpdateModelAnother"),t.User),this._AppModeService._NgbModal.dismissAll())}),this.Hub_Connection?.on("DeleteTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Transfer.Id&&(alert(this._AppModeService._Translate.instant("Show.DeleteModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.DeleteModelAnother"),t.User),this.DynamicComponent.Paging.DataReturn=this.DynamicComponent.Paging.DataReturn.filter(r=>r.Id!=t.Id),this._AppModeService._NgbModal.dismissAll())})}ResetPage(){this.Transfer={Id:0,Name:"",Notes:"",Code:"",FromStoreId:null,FromStoreName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,DocNo:0,DocDate:"",TransferDetails:[{Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""}]},this._DefaultSettingsService.ResetDate(this.Transfer)}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};m.\u0275fac=function(e){return new(e||m)(P(J),P(ne),P(me),P(Te),P(z))},m.\u0275cmp=j({type:m,selectors:[["app-transfer-storage"]],viewQuery:function(e,r){if(e&1&&(F(xe,5),F(Ce,5),F(ve,5)),e&2){let i;B(i=R())&&(r.ContentModel=i.first),B(i=R())&&(r.GLComponent=i.first),B(i=R())&&(r.DynamicComponent=i.first)}},standalone:!0,features:[Q],decls:8,vars:8,consts:[["dynamiccomponent",""],["content",""],["ItemBalance",""],["GLComponent",""],["SelectFromStore",""],["SelectToStore",""],["SelectItem22",""],["SelectUnits",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","PrintUrl","DeleteUrl","OutModal"],[1,"col-8"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-end","col-12","px-2"],[1,"col-12","col-sm-6","col-md-6","col-lg-3","col-xl-1","p-1"],["for","DocNo"],["type","number","appNumericInput","",1,"form-control","text-center",3,"value","disabled"],[1,"col-12","col-sm-6","col-md-6","col-lg-4","col-xl-3","p-1"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block text-center ",4,"ngIf"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12","class"," shadow-none text-center w-100",3,"ngModel","showOtherMonths","showTime","showIcon","showOnFocus","ngModelChange",4,"ngIf"],[1,"col-12","col-sm-6","col-md-6","col-lg-4","col-xl-2","p-1"],[1,"m-0"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["id","ProductTable",1,"DivPaging","table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-1","mb-0"],[1,"col-3"],[4,"ngFor","ngForOf"],[3,"SaveEvent","UpdateEvent","OpenGlEvent","CloseEvent","Id","Gl"],[1,"d-block","text-center"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showOtherMonths","showTime","showIcon","showOnFocus"],[1,"form-text","text-muted"],[1,"p-0",3,"title"],[1,"d-flex","justify-content-center","align-items-center","col-11","col-md-12"],[1,"d-none","d-lg-inline"],[1,"btn-Add","btn",3,"click"],[1,"mx-1","fw-bold","pi","pi-plus"],[1,"btn-Delete","btn-Page","btn",3,"click","disabled"],[1,"mx-1","pi","pi-trash","fw-bold"],[1,"ngSelect","d-flex","mx-auto","flex-wrap","justify-content-center",3,"title"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-10","col-lg-9","col-xl-10",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["class","btn btn-Refresh d-block d-md-inline-block",3,"disabled","click",4,"ngIf"],[1,"ngSelect",3,"title"],["bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","disabled","ngModel"],[3,"title"],[1,"p-0","col-10","col-lg-12"],["name","Quantity","type","number","appNumericInput","",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"btn","btn-Refresh","d-block","d-md-inline-block",3,"click","disabled"],[1,"pi","pi-eye","d-block","mx-auto"],[1,"modal-body"],[1,"my-2","text-center"],[1,"table","table-striped","table-hover"],[1,"text-dark"]],template:function(e,r){if(e&1){let i=A();c(0,"app-dynamic-component",8,0),C("OpenModalEvent",function(){return s(i),l(r.OpenModal())})("ShowToEditeEvent",function(u){return s(i),l(r.ShowToEdite(u))}),_(),x(2,Be,50,40,"ng-template",null,1,k)(4,ke,29,20,"ng-template",9,2,k),y(6,"app-glsheard",null,3)}if(e&2){let i=I(3);g("PageTitle","TransferStorage.TransferStorage")("TablePaging",r.TablePaging)("FullScreen",!1)("GlResponse",!0)("GetById","TransferStorageEP/GetById")("PrintUrl","TransferStorage")("DeleteUrl","TransferStorageEP/Delete")("OutModal",i)}},dependencies:[ce,le,H,re,X,te,Z,ee,L,W,K,Y,se,ae,ie,oe,fe,ue,pe,_e,de],styles:["svg[_ngcontent-%COMP%]{cursor:pointer}"]});let o=m;return o})();export{pt as TransferStorageComponent};
