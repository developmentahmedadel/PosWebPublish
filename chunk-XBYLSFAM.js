import{a as Se,b as Te}from"./chunk-6T4APQIW.js";import{a as ge}from"./chunk-SB45HR2Z.js";import{a as he}from"./chunk-PBWISRCH.js";import{c as _e,j as ue}from"./chunk-D4UU44IK.js";import"./chunk-4LHCKT7C.js";import{a as fe}from"./chunk-VSYXDL23.js";import"./chunk-3ZAIJ4IV.js";import"./chunk-PPWB5S3T.js";import{a as de,b as pe}from"./chunk-FF7KVUSC.js";import"./chunk-VNF6RC2R.js";import{a as me}from"./chunk-H6HTMPGV.js";import"./chunk-GKF6IR3T.js";import"./chunk-76NAH4W4.js";import"./chunk-O7NQZYPY.js";import"./chunk-EWI5J5KH.js";import{a as ne,b as ie,c as oe,d as ae}from"./chunk-X4LTGZKH.js";import{c as se,d as le,g as ce}from"./chunk-OFZNSK7N.js";import{H as Y,I as K,L as X,N as Z,Q as ee,S as te,_ as re,b as W,c as z,d as H,i as J,z as q}from"./chunk-CXJLKQ4R.js";import{$b as D,Cb as i,Db as o,Eb as P,Ib as w,Mb as C,Nb as c,Qb as E,Rb as U,Tb as k,Ub as B,Vb as O,Wb as x,X as b,Xb as a,Yb as h,Zb as v,_b as A,ac as y,bc as M,db as d,dc as Q,eb as N,gc as $,na as G,nc as u,oc as S,pc as L,qc as R,vb as I,xa as p,xb as T,ya as m}from"./chunk-J5UB44FZ.js";import{a as V,b as F}from"./chunk-3EYC4JTX.js";var Ie=["content"],Ce=["GLComponent"],ve=(l,f)=>({"btn-success":l,"btn-primary":f});function be(l,f){if(l&1&&(i(0,"span",51),a(1),u(2,"date"),o()),l&2){let n=c(2);d(),v(" ",L(2,1,n.Transfer.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function De(l,f){if(l&1){let n=w();i(0,"p-calendar",52),M("ngModelChange",function(e){p(n);let r=c(2);return y(r.Transfer.DocDate,e)||(r.Transfer.DocDate=e),m(e)}),o()}if(l&2){let n=c(2);T("showOtherMonths",!0)("showTime",!0)("showIcon",!0)("showOnFocus",!1),D("ngModel",n.Transfer.DocDate)}}function ye(l,f){if(l&1&&(i(0,"small",53),a(1),o()),l&2){let n=c(2);d(),A("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Me(l,f){if(l&1&&a(0),l&2){let n=f.item;v(" ",n.Name," ")}}function we(l,f){if(l&1&&(i(0,"small",53),a(1),o()),l&2){let n=c(2);d(),A("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Ne(l,f){if(l&1&&a(0),l&2){let n=f.item;v(" ",n.Name," ")}}function Pe(l,f){if(l&1&&(i(0,"small",53),a(1),o()),l&2){let n=c().$implicit,t=c(2);d(),A("Loaded ",n.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ae(l,f){if(l&1&&a(0),l&2){let n=f.item;A(" ",n.Name," - ",n.Code," ")}}function Ee(l,f){if(l&1){let n=w();i(0,"button",65),C("click",function(){p(n);let e=c().index,r=c(2),s=x(4);return m(r.GetItemBalance(e,s))}),P(1,"i",66),o()}if(l&2){let n=c(3);T("disabled",n._AppModeService.DisabledButton)}}function Ve(l,f){if(l&1&&(i(0,"small",53),a(1),o()),l&2){let n=c().$implicit,t=c(2);d(),A("Loaded ",n.ProductUnits.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Fe(l,f){if(l&1&&a(0),l&2){let n=f.item;v(" ",n.Name," ")}}function Ue(l,f){if(l&1){let n=w();i(0,"tr")(1,"td",54)(2,"div",55)(3,"button",56),C("click",function(){p(n);let e=c(2);return m(e.AppendRow())}),a(4,"+"),o(),i(5,"button",57),C("click",function(){let e=p(n).index,r=c(2);return m(r.RemoveRow(e))}),a(6,"-"),o()()(),i(7,"td",58),u(8,"translate"),i(9,"ng-select",59,5),u(11,"translate"),C("clear",function(){let e=p(n).$implicit;return m(e.Items=[])})("focus",function(){let e=p(n).index,r=x(10),s=c(2);return s.ChangeSearchApiDetails("Items",r,e),m(s._AppModeService.ResetCurrentPage())})("keyup",function(){let e=p(n).index,r=x(10),s=c(2);return s.ChangeSearchApiDetails("Items",r,e),m(s._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=p(n).index,r=x(10),s=c(2);return m(s.ChangeSearchApiDetails("Items",r,e))})("close",function(){p(n);let e=c(2);return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c(2);return m(e._AppModeService.ResetCurrentPage())})("change",function(){let e=p(n),r=e.$implicit,s=e.index,_=c(2);return m(_.SelectItem(r.ProductId,s))}),M("ngModelChange",function(e){let r=p(n).$implicit;return y(r.ProductId,e)||(r.ProductId=e),m(e)}),I(12,Pe,2,2,"ng-template",21)(13,Ae,1,2,"ng-template",22),o(),I(14,Ee,2,1,"button",60),o(),i(15,"td",61),u(16,"translate"),i(17,"ng-select",62,6),u(19,"translate"),C("clear",function(){let e=p(n).$implicit;return m(e.ProductUnits=[])})("focus",function(){let e=p(n).index,r=x(18),s=c(2);return s.ChangeSearchApiDetails("ItemUnits",r,e),m(s._AppModeService.ResetCurrentPage())})("keyup",function(){let e=p(n).index,r=x(18),s=c(2);return s.ChangeSearchApiDetails("ItemUnits",r,e),m(s._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=p(n).index,r=x(18),s=c(2);return m(s.ChangeSearchApiDetails("ItemUnits",r,e))})("close",function(){p(n);let e=c(2);return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c(2);return m(e._AppModeService.ResetCurrentPage())})("change",function(){let e=p(n),r=e.$implicit,s=e.index,_=c(2);return m(_.SelectUnit(r.ProductUnitId,s))}),M("ngModelChange",function(e){let r=p(n).$implicit;return y(r.ProductUnitId,e)||(r.ProductUnitId=e),m(e)}),I(20,Ve,2,2,"ng-template",21)(21,Fe,1,1,"ng-template",22),o()(),i(22,"td",63),u(23,"translate"),i(24,"input",64),M("ngModelChange",function(e){let r=p(n).$implicit;return y(r.Quantity,e)||(r.Quantity=e),m(e)}),o()()()}if(l&2){let n=f.$implicit,t=f.index,e=c(2);d(),E("title",t+1),d(4),T("disabled",e.Transfer.TransferDetails.length==1),d(2),E("title",S(8,20,"TransferStorage.Name")),d(2),U("placeholder","  ",S(11,22,"SaleInvoice.ChooseProduct"),""),T("items",n.Items)("dropdownPosition","top")("searchable",!0)("virtualScroll",!0),D("ngModel",n.ProductId),d(5),T("ngIf",n.ProductId>0&&e.Transfer.FromStoreId>0&&e.Transfer.ToStoreId>0),d(),E("title",S(16,24,"SaleInvoice.Units")),d(2),U("placeholder","  ",S(19,26,"Item.ItemUnit"),""),T("items",n.ProductUnits)("dropdownPosition","top")("disabled",n.ProductId==0||n.ProductId==null),D("ngModel",n.ProductUnitId),d(5),E("title",S(23,28,"SaleInvoice.Quantity")),d(2),D("ngModel",n.Quantity)}}function ke(l,f){l&1&&(i(0,"span"),a(1),u(2,"translate"),o()),l&2&&(d(),v(" ",S(2,1,"Model.Save"),""))}function Be(l,f){l&1&&(i(0,"span"),a(1),u(2,"translate"),o()),l&2&&(d(),v(" ",S(2,1,"Model.Update"),""))}function Oe(l,f){if(l&1){let n=w();i(0,"button",67),C("click",function(){p(n);let e=c(2);return m(e.OpenGl())}),a(1),u(2,"translate"),o()}l&2&&(d(),v(" ",S(2,1,"Model.Gl")," "))}function Re(l,f){if(l&1){let n=w();P(0,"app-modal-header",9),i(1,"div",10)(2,"div",11)(3,"div",12)(4,"label",13),a(5),u(6,"translate"),o(),P(7,"input",14),o(),i(8,"div",12)(9,"label",15),a(10),u(11,"translate"),o(),i(12,"input",16),M("ngModelChange",function(e){p(n);let r=c();return y(r.Transfer.Notes,e)||(r.Transfer.Notes=e),m(e)}),o()(),i(13,"div",12),I(14,be,3,4,"span",17)(15,De,1,5,"p-calendar",18),o(),i(16,"div",12)(17,"p",19),a(18),u(19,"translate"),o(),i(20,"ng-select",20,3),C("clear",function(){p(n);let e=c();return m(e.Storages=[])})("focus",function(){p(n);let e=x(21),r=c();return r.ChangeSearchApi("FromStore",e),m(r._AppModeService.ResetCurrentPage())})("keyup",function(){p(n);let e=x(21),r=c();return r.ChangeSearchApi("FromStore",e),m(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(n);let e=x(21),r=c();return m(r.ChangeSearchApi("FromStore",e))})("close",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(n);let e=c();return m(e.SelectValue(e.Transfer.FromStoreId,"FromStore"))}),M("ngModelChange",function(e){p(n);let r=c();return y(r.Transfer.FromStoreId,e)||(r.Transfer.FromStoreId=e),m(e)}),I(22,ye,2,2,"ng-template",21)(23,Me,1,1,"ng-template",22),o()(),i(24,"div",12)(25,"p",19),a(26),u(27,"translate"),o(),i(28,"ng-select",20,4),C("clear",function(){p(n);let e=c();return m(e.Storages=[])})("focus",function(){p(n);let e=x(29),r=c();return r.ChangeSearchApi("ToStore",e),m(r._AppModeService.ResetCurrentPage())})("keyup",function(){p(n);let e=x(29),r=c();return r.ChangeSearchApi("ToStore",e),m(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(n);let e=x(29),r=c();return m(r.ChangeSearchApi("ToStore",e))})("close",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(n);let e=c();return m(e.SelectValue(e.Transfer.ToStoreId,"ToStore"))}),M("ngModelChange",function(e){p(n);let r=c();return y(r.Transfer.ToStoreId,e)||(r.Transfer.ToStoreId=e),m(e)}),I(30,we,2,2,"ng-template",21)(31,Ne,1,1,"ng-template",22),o()()(),i(32,"div",23)(33,"div",24)(34,"table",25)(35,"thead")(36,"tr")(37,"th"),a(38,"ID"),o(),i(39,"th"),a(40,"Name"),o(),i(41,"th"),a(42,"Link"),o(),i(43,"th"),a(44,"Status"),o()()(),i(45,"tbody")(46,"tr")(47,"td",26),a(48,"1"),o(),i(49,"td",27),a(50,"Material Design Color Palette"),o(),i(51,"td",28)(52,"a",29),a(53,"GitHub"),o()(),i(54,"td",30),a(55,"Completed"),o()(),i(56,"tr")(57,"td",26),a(58,"2"),o(),i(59,"td",27),a(60,"Material Design Iconic Font"),o(),i(61,"td",28)(62,"a",31),a(63,"Codepen"),o(),i(64,"a",32),a(65,"GitHub"),o()(),i(66,"td",30),a(67,"Completed"),o()(),i(68,"tr")(69,"td",26),a(70,"3"),o(),i(71,"td",27),a(72,"Material Design Hierarchical Display"),o(),i(73,"td",28)(74,"a",33),a(75,"Codepen"),o(),i(76,"a",34),a(77,"GitHub"),o()(),i(78,"td",30),a(79,"Completed"),o()(),i(80,"tr")(81,"td",26),a(82,"4"),o(),i(83,"td",27),a(84,"Material Design Sidebar"),o(),i(85,"td",28)(86,"a",35),a(87,"Codepen"),o()(),i(88,"td",30),a(89,"Completed"),o()(),i(90,"tr")(91,"td",26),a(92,"5"),o(),i(93,"td",27),a(94,"Material Design Tiles"),o(),i(95,"td",28)(96,"a",36),a(97,"Codepen"),o()(),i(98,"td",30),a(99,"Completed"),o()(),i(100,"tr")(101,"td",26),a(102,"6"),o(),i(103,"td",27),a(104,"Material Design Typography"),o(),i(105,"td",28)(106,"a",37),a(107,"Codepen"),o(),i(108,"a",38),a(109,"GitHub"),o()(),i(110,"td",30),a(111,"Completed"),o()(),i(112,"tr")(113,"td",26),a(114,"7"),o(),i(115,"td",27),a(116,"Material Design Buttons"),o(),i(117,"td",28)(118,"a",39),a(119,"Codepen"),o()(),i(120,"td",30),a(121,"In progress"),o()(),i(122,"tr")(123,"td",26),a(124,"8"),o(),i(125,"td",27),a(126,"Material Design Form Elements"),o(),i(127,"td",28)(128,"a",40),a(129,"Codepen"),o()(),i(130,"td",30),a(131,"In progress"),o()(),i(132,"tr")(133,"td",26),a(134,"9"),o(),i(135,"td",27),a(136,"Material Design Email Template"),o(),i(137,"td",28)(138,"a",41),a(139,"Codepen"),o()(),i(140,"td",30),a(141,"Completed"),o()(),i(142,"tr")(143,"td",26),a(144,"10"),o(),i(145,"td",27),a(146,"Material Design Animation Timing (old one)"),o(),i(147,"td",28)(148,"a",42),a(149,"Codepen"),o()(),i(150,"td",30),a(151,"Completed"),o()()()()()(),i(152,"div",24)(153,"table",43)(154,"thead")(155,"tr")(156,"th"),a(157,"#"),o(),i(158,"th"),a(159),u(160,"translate"),o(),i(161,"th"),a(162),u(163,"translate"),o(),i(164,"th"),a(165),u(166,"translate"),o()()(),i(167,"tbody"),I(168,Ue,25,30,"tr",44),o()()()(),i(169,"div",45)(170,"button",46),C("click",function(){p(n);let e=c();return m(e.Save())}),I(171,ke,3,3,"span",47)(172,Be,3,3,"span",47),P(173,"i",48),o(),I(174,Oe,3,3,"button",49),i(175,"button",50),C("click",function(){let e=p(n).$implicit,r=c();return e.close("Close click"),m(r.ResetPage())}),a(176),u(177,"translate"),o()()}if(l&2){let n=c();T("PageTitle","TransferStorage.TransferStorage"),d(5),h(S(6,29,"Table.DocNo")),d(2),T("value",n.Transfer.DocNo)("disabled",!0),d(3),h(S(11,31,"Table.Notes")),d(2),D("ngModel",n.Transfer.Notes),d(2),T("ngIf",n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!1),d(),T("ngIf",n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!0),d(3),h(S(19,33,"TransferStorage.FromStoreId")),d(2),T("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),D("ngModel",n.Transfer.FromStoreId),d(6),h(S(27,35,"TransferStorage.ToStoreId")),d(2),T("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),D("ngModel",n.Transfer.ToStoreId),d(131),h(S(160,37,"TransferStorage.Name")),d(3),h(S(163,39,"SaleInvoice.Units")),d(3),h(S(166,41,"TransferStorage.Quantity")),d(3),T("ngForOf",n.Transfer.TransferDetails),d(2),T("ngClass",$(45,ve,n.Transfer.Id==0,n.Transfer.Id!=0)),d(),T("ngIf",n.Transfer.Id==0),d(),T("ngIf",n.Transfer.Id!=0),d(2),T("ngIf",n.Transfer.Id>0),d(2),h(S(177,43,"Model.Close"))}}function je(l,f){if(l&1&&(i(0,"tr")(1,"td")(2,"span",71),a(3),o()(),i(4,"td")(5,"span",71),a(6),o()()()),l&2){let n=f.$implicit;d(3),h(n.Name),d(3),h(n.Qty)}}function Ge(l,f){if(l&1&&(i(0,"tr")(1,"td")(2,"span",71),a(3),o()(),i(4,"td")(5,"span",71),a(6),o()()()),l&2){let n=f.$implicit;d(3),h(n.Name),d(3),h(n.Qty)}}function Qe(l,f){if(l&1&&(i(0,"div",68)(1,"p",69),a(2),u(3,"translate"),o(),i(4,"table",70)(5,"thead")(6,"tr")(7,"th"),a(8),u(9,"translate"),o(),i(10,"th"),a(11),u(12,"translate"),o()()(),i(13,"tbody"),I(14,je,7,2,"tr",44),o()(),i(15,"p",69),a(16),u(17,"translate"),o(),i(18,"table",70)(19,"thead")(20,"tr")(21,"th"),a(22),u(23,"translate"),o(),i(24,"th"),a(25),u(26,"translate"),o()()(),i(27,"tbody"),I(28,Ge,7,2,"tr",44),o()()()),l&2){let n=c();d(2),v(" ",S(3,8,"TransferStorage.BalanceFrom")," "),d(6),h(S(9,10,"SaleInvoice.Name")),d(3),h(S(12,12,"Table.Balance")),d(3),T("ngForOf",n.ItemBalanceFrom),d(2),v(" ",S(17,14,"TransferStorage.BalanceTo")," "),d(6),h(S(23,16,"SaleInvoice.Name")),d(3),h(S(26,18,"Table.Balance")),d(3),T("ngForOf",n.ItemBalanceTo)}}var mt=(()=>{let f=class f{constructor(t,e,r,s,_){this._ActivatedRoute=t,this._AppModeService=e,this._SharedObjectModelService=r,this._DefaultSettingsService=s,this._Apiservice=_,this.TablePaging={InputType:"Table",Type:"TablePaging",ReportName:"Transfer",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"Transfer",Join:!0,JoinTables:["Storages SF","Storages ST"],JoinConditions:["T.FromStoreId = SF.Id","T.ToStoreId = ST.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","SF.Name AS FromStoreName","ST.Name AS ToStoreName"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"},{SortName:"FromStoreName",CellName:"TransferStorage.FromStoreId",ExistSearchField:"SF.Name"},{SortName:"ToStoreName",CellName:"TransferStorage.ToStoreId",ExistSearchField:"ST.Name"}]},this.Transfer={Id:0,Name:"",Notes:"",Code:"",FromStoreId:null,FromStoreName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,DocNo:0,DocDate:"",TransferDetails:[{Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""}]},this.Storages=[],this.ItemBalanceFrom=[],this.ItemBalanceTo=[]}ngOnInit(){let t=Number(this._ActivatedRoute.snapshot.queryParams.Id);t>0&&this.GetByIdRoute(t),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(t){this._Apiservice.getById("TransferStorageEP/GetById",t,!0).pipe(b(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._SharedObjectModelService.PageModel=e.Obj.model,this._SharedObjectModelService.Gl=e.Obj.Gl,this.Drow(this._SharedObjectModelService.PageModel),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(e.Message)}})}OpenModal(){this._AppModeService.DisabledButton=!0,this.ResetPage(),this.GetPageInfo()}GetPageInfo(){this._Apiservice.get("TransferStorageEP/GetPageInfo",!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this.Transfer.DocNo=t.Obj,this._AppModeService.DisabledButton=!1):this._AppModeService._Toastr.error(t.Message)},error:t=>{this._AppModeService.DisabledButton=!1}})}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){this.Transfer={Id:t.Id,Name:t.Name,Notes:t.Notes,Code:t.Code,FromStoreId:t.FromStoreId,FromStoreName:t.FromStoreName,ToStoreId:t.ToStoreId,ToStoreName:t.ToStoreName,TotalQty:t.TotalQty,DocNo:t.DocNo,DocDate:new Date(`${t.DocDate}`),TransferDetails:t.TransferDetails},this.Storages=[],this.Storages.push({Id:t.FromStoreId,Name:t.FromStoreName}),this.Storages.push({Id:t.ToStoreId,Name:t.ToStoreName});for(let e=0;e<this.Transfer.TransferDetails.length;e++){let r=this.Transfer.TransferDetails[e];r.Items=[{Id:r.ProductId,Name:r.ProductName,NameAndCode:r.ProductName}],r.ProductUnits=[{Id:r.ProductUnitId,Name:r.ProductUnitName,NameAndUnitFactor:r.ProductUnitName}]}}ChangeSearchApi(t,e){let r=`${e.searchTerm}`.trim();(r==""||r=="null")&&(e.searchTerm="",r=""),this._AppModeService.CurrentPage+=1;let s={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:r,SearchField:"Name"};(t=="FromStore"||t=="ToStore")&&(s.TableName="Storages",s.BranchFilter=!0),this._Apiservice.post("Global/GetAll",s,!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:_=>{_.IsSuccess==!0&&_.Obj!=null?this.HandleResponse(_.Obj,t):this._AppModeService._Toastr.error(_.Message)}})}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,(e=="FromStore"||e=="ToStore")&&(this.Storages=this._SharedObjectModelService.RemoveDuplicates(this.Storages.concat(t.DataReturn),"Id"))}ChangeSearchApiDetails(t,e,r){let s=`${e.searchTerm}`.trim();(s==""||s=="null")&&(e.searchTerm="",s=""),this._AppModeService.CurrentPage+=1;let _={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:s,SearchField:"Name"};if(t=="Items"&&(_.Columns=["Id","Name","Code"],_.Conditions="ProductType != 2"),t=="ItemUnits"){let g=this.Transfer.TransferDetails[r].ProductId==null?0:this.Transfer.TransferDetails[r].ProductId;_.Conditions=`ItemId = ${g}`,_.Join=!0,_.JoinTables=["Units U"],_.NoPaging=!0,_.JoinConditions=["T.UnitId = U.Id"],_.Columns=["T.Id","U.Name","T.UnitFactor"],_.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",_,!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:g=>{g.IsSuccess==!0&&g.Obj!=null?this.HandleResponseDetails(g.Obj,t,r):this._AppModeService._Toastr.error(g.Message)}})}HandleResponseDetails(t,e,r){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Items"&&(this.Transfer.TransferDetails[r].Items=this._SharedObjectModelService.RemoveDuplicates(this.Transfer.TransferDetails[r].Items.concat(t.DataReturn),"Id"),this.Transfer.TransferDetails[r].Items=this.Transfer.TransferDetails[r].Items.map(s=>F(V({},s),{NameAndCode:s.Code!=null?`${s.Name} - ${s.Code}`:`${s.Name}`}))),e=="ItemUnits"&&(this.Transfer.TransferDetails[r].ProductUnits=t.DataReturn.map(s=>F(V({},s),{NameAndUnitFactor:s.UnitFactor!=null?`${s.Name} - ${s.UnitFactor}`:`${s.Name}`})))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let r=[];(e=="FromStore"||e=="ToStore")&&(r=this.Storages);let s=r.find(_=>_.Id==t);if(s==null){this._AppModeService.DontPlay();return}else this.Transfer[`${e}Id`]=t,this.Transfer[`${e}Name`]=s.Name}else this.Transfer[`${e}Id`]=null,this.Transfer[`${e}Name`]=""}SelectItem(t,e){if(t!=null&&t>0){let r=this.Transfer.TransferDetails[e].Items.find(s=>s.Id==t);if(r!=null)this.Transfer.TransferDetails[e].ProductId=r.Id,this.Transfer.TransferDetails[e].ProductName=r.Name,this.Transfer.TransferDetails[e].ProductUnitId=null,this.Transfer.TransferDetails[e].ProductUnits=[],this.AfterSelectem(r.Id,e);else{this._Apiservice.DontPlay();return}}else this.Transfer.TransferDetails[e].ProductUnitId=null,this.Transfer.TransferDetails[e].ProductUnits=[]}AfterSelectem(t,e){if(t>0){let r={TableName:"ItemUnits",Columns:["Id","Name"],CurrentPage:1,PageSize:1,SearchText:"",SearchField:"Name"};r.Conditions=`ItemId = ${t}`,r.Join=!0,r.JoinTables=["Units U"],r.JoinConditions=["T.UnitId = U.Id"],r.Columns=["T.Id","U.Name","T.UnitFactor"],r.SearchField="U.Name",this._Apiservice.post("Global/GetAll",r,!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:s=>{if(s.IsSuccess==!0&&s.Obj!=null){s.Obj.DataReturn=s.Obj.DataReturn.map(g=>F(V({},g),{NameAndUnitFactor:g.UnitFactor!=null?`${g.Name} - ${g.UnitFactor}`:`${g.Name}`}));let _=s.Obj.DataReturn[0];_!=null&&(this.Transfer.TransferDetails[e].ProductUnits=s.Obj.DataReturn,this.Transfer.TransferDetails[e].ProductUnitId=_.Id,this.Transfer.TransferDetails[e].Quantity=1)}else this._AppModeService._Toastr.error(s.Message)}})}}SelectUnit(t,e){if(t!=null&&t>0){let r=this.Transfer.TransferDetails[e].ProductUnits.find(s=>s.Id==t);if(r!=null)this.Transfer.TransferDetails[e].ProductUnitId=r.Id,this.Transfer.TransferDetails[e].ProductUnitName=r.Name;else{this._Apiservice.DontPlay();return}}}TotalRow(t){let e=Number(this.Transfer.TransferDetails[t].Price),r=Number(this.Transfer.TransferDetails[t].Quantity);return Number(e*r)}TotalTransfer(){let t=0;for(let e=0;e<this.Transfer.TransferDetails.length;e++)this.Transfer.TransferDetails[e].ProductId>0&&this.Transfer.TransferDetails[e].ProductUnitId>0&&(t+=Number(this.Transfer.TransferDetails[e].Price)*Number(this.Transfer.TransferDetails[e].Quantity));return Number(t)}AppendRow(){let t={Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""};return this.Transfer.TransferDetails.push(t),!0}RemoveRow(t){return this.Transfer.TransferDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Transfer.Error.ErrorFirstRow")),!1):(this.Transfer.TransferDetails.splice(t,1),this.TotalTransfer(),!0)}GetItemBalance(t,e){let r=this.Transfer.TransferDetails[t];if(this.Transfer.ToStoreId==0||this.Transfer.ToStoreId==null||this.Transfer.FromStoreId==0||this.Transfer.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Storage"));return}if(r.ProductId==0||r.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}let s={ProductId:r.ProductId,FromStoreId:this.Transfer.FromStoreId,ToStoreId:this.Transfer.ToStoreId};this._AppModeService.DisabledButton=!0,this._Apiservice.post("ItemEP/ProductBalance",s,!0).pipe(b(this._Apiservice.destroy$)).subscribe({next:_=>{_.IsSuccess==!0&&_.Obj!=null?(this._AppModeService.DisabledButton=!1,this._AppModeService._NgbModal.open(e,{size:"xl",centered:!0}),this.ItemBalanceFrom=_.Obj.FromStorageBalance,this.ItemBalanceTo=_.Obj.ToStorageBalance):(this._AppModeService.DisabledButton=!1,this._AppModeService._Toastr.error(_.Message))},error:_=>{this._AppModeService.DisabledButton=!1}})}Save(){if(this.Transfer.DocDate==""||this.Transfer.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate"));return}if(this.Transfer.FromStoreId==0||this.Transfer.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterFromStore"));return}if(this.Transfer.ToStoreId==0||this.Transfer.ToStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterToStore"));return}if(this.Transfer.ToStoreId==this.Transfer.FromStoreId){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.ErrorExistStore"));return}for(let e=0;e<this.Transfer.TransferDetails.length;e++){let r=e,s=Number(this.Transfer.TransferDetails[e].ProductId),_=Number(this.Transfer.TransferDetails[e].Quantity),g=Number(this.Transfer.TransferDetails[e].ProductUnitId),xe=Number(this.Transfer.TransferDetails[e].Price);if(s==null||s==null||s<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}if(g==null||g==null||g<=0||isNaN(g)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyTransfer.Error.EnterUnit"));return}if(this.Transfer.TransferDetails.filter(j=>j.ProductId==s&&j.ProductUnitId==g).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(r+1));return}if(_==null||_==null||isNaN(_)||_<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterQuantity"));return}this.Transfer.TransferDetails[e].ProductUnitId=g,this.Transfer.TransferDetails[e].ProductId=s,this.Transfer.TransferDetails[e].Price=xe}let t={DocDate:this._Apiservice.ConvertISODate(this.Transfer.DocDate),DocNo:this.Transfer.DocNo,TransferDetails:this.Transfer.TransferDetails,FromStoreId:this.Transfer.FromStoreId,FromStoreName:this.Transfer.FromStoreName,ToStoreId:this.Transfer.ToStoreId,ToStoreName:this.Transfer.ToStoreName,TotalQty:this.Transfer.TotalQty,Id:this.Transfer.Id,Name:this.Transfer.Name,Code:this.Transfer.Code,Notes:this.Transfer.Notes};t.Id==0&&this._Apiservice.post("TransferStorageEP/Add",t,!0).pipe(b(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}}),t.Id>0&&this._Apiservice.put("TransferStorageEP/Update",t,!0).pipe(b(this._Apiservice.destroy$)).subscribe({next:e=>{if(e.IsSuccess==!0&&e.Obj!=null){this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.UpdateSuccess"));let r=e.Obj,s=this._SharedObjectModelService.Paging.DataReturn.find(_=>_.Id==r.Id);s!=null&&Object.assign(s,r),this.ResetPage(),this.GetPageInfo()}else this._AppModeService._Toastr.error(e.Message)}})}OpenGl(){this.GLComponent.Open()}StartConnection(){this.Hub_Connection=new Te().withUrl(`${Y.signalrUrl}/Transfer`,{skipNegotiation:!0,transport:Se.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(t=>{console.log("Error Hub Connection",t)})}ServerListener(){this.Hub_Connection?.on("AddTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&(this.Transfer.DocNo=t.DocNo)}),this.Hub_Connection?.on("UpdateTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Transfer.Id&&(alert(this._AppModeService._Translate.instant("Show.UpdateModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.UpdateModelAnother"),t.User),this._AppModeService._NgbModal.dismissAll())}),this.Hub_Connection?.on("DeleteTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Transfer.Id&&(alert(this._AppModeService._Translate.instant("Show.DeleteModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.DeleteModelAnother"),t.User),this._SharedObjectModelService.Paging.DataReturn=this._SharedObjectModelService.Paging.DataReturn.filter(r=>r.Id!=t.Id),this._AppModeService._NgbModal.dismissAll())})}ResetPage(){this.Transfer={Id:0,Name:"",Notes:"",Code:"",FromStoreId:null,FromStoreName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,DocNo:0,DocDate:"",TransferDetails:[{Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""}]},this._DefaultSettingsService.ResetDate(this.Transfer)}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};f.\u0275fac=function(e){return new(e||f)(N(q),N(ce),N(me),N(he),N(K))},f.\u0275cmp=G({type:f,selectors:[["app-transfer-storage"]],viewQuery:function(e,r){if(e&1&&(k(Ie,5),k(Ce,5)),e&2){let s;B(s=O())&&(r.ContentModel=s.first),B(s=O())&&(r.GLComponent=s.first)}},standalone:!0,features:[Q],decls:7,vars:8,consts:[["content",""],["ItemBalance",""],["GLComponent",""],["SelectFromStore",""],["SelectToStore",""],["SelectItem22",""],["SelectUnits",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","PrintUrl","DeleteUrl","OutModal"],[1,"col-8"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-end","col-12"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","p-1"],["for","DocNo"],["type","number","appNumericInput","",1,"form-control","text-center",3,"value","disabled"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block text-center ",4,"ngIf"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12","class"," shadow-none text-center w-100",3,"showOtherMonths","showTime","showIcon","showOnFocus","ngModel","ngModelChange",4,"ngIf"],[1,"m-0"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["id","demo",1,"d-none"],[1,"table-responsive-vertical","shadow-z-1"],["id","table",1,"table","table-hover","table-mc-light-blue"],["data-title","ID"],["data-title","Name"],["data-title","Link"],["href","https://github.com/zavoloklom/material-design-color-palette","target","_blank"],["data-title","Status"],["href","https://codepen.io/zavoloklom/pen/uqCsB","target","_blank"],["href","https://github.com/zavoloklom/material-design-iconic-font","target","_blank"],["href","https://codepen.io/zavoloklom/pen/eNaEBM","target","_blank"],["href","https://github.com/zavoloklom/material-design-hierarchical-display","target","_blank"],["href","https://codepen.io/zavoloklom/pen/dIgco","target","_blank"],["href","https://codepen.io/zavoloklom/pen/wtApI","target","_blank"],["href","https://codepen.io/zavoloklom/pen/IkaFL","target","_blank"],["href","https://github.com/zavoloklom/material-design-typography","target","_blank"],["href","https://codepen.io/zavoloklom/pen/Gubja","target","_blank"],["href","https://codepen.io/zavoloklom/pen/yaozl","target","_blank"],["href","https://codepen.io/zavoloklom/pen/qEVqzx","target","_blank"],["href","https://codepen.io/zavoloklom/pen/Jbrho","target","_blank"],[1,"table","table-hover","table-striped","table-light","mt-4","mb-0"],[4,"ngFor","ngForOf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn","py-3","px-5",3,"click","ngClass"],[4,"ngIf"],[1,"mx-1","pi","pi-save"],["class","btn btn-info mx-3 py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-secondary","py-3","px-5",3,"click"],[1,"d-block","text-center"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","showOtherMonths","showTime","showIcon","showOnFocus","ngModel"],[1,"form-text","text-muted"],[1,"Flex1",3,"title"],[1,"d-flex","justify-content-center","align-items-center","col-11","col-md-12"],[1,"col-2","col-md-5","py-3","py-md-1","text-center","mx-auto","btn","btn-success",3,"click"],[1,"col-2","col-md-5","py-3","py-md-1","text-center","mx-auto","btn","btn-danger",3,"click","disabled"],[1,"ngSelect","d-flex",3,"title"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-12","col-md-11",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["class","col-1 d-block text-center btn btn-info py-0 px-2 mx-2",3,"disabled","click",4,"ngIf"],[1,"ngSelect",3,"title"],["bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","disabled","ngModel"],[3,"title"],["name","Quantity","type","number","appNumericInput","",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-1","d-block","text-center","btn","btn-info","py-0","px-2","mx-2",3,"click","disabled"],[1,"pi","pi-eye","d-block","mx-auto"],[1,"btn","btn-info","mx-3","py-3","px-5",3,"click"],[1,"modal-body"],[1,"my-2","text-center"],[1,"table","table-striped","table-hover"],[1,"text-dark"]],template:function(e,r){if(e&1){let s=w();i(0,"app-dynamic-component",7),C("OpenModalEvent",function(){return p(s),m(r.OpenModal())})("ShowToEditeEvent",function(){return p(s),m(r.ShowToEdite())}),o(),I(1,Re,178,48,"ng-template",null,0,R)(3,Qe,29,20,"ng-template",8,1,R),P(5,"app-glsheard",null,2)}if(e&2){let s=x(2);T("PageTitle","TransferStorage.TransferStorage")("TablePaging",r.TablePaging)("FullScreen",!1)("GlResponse",!0)("GetById","TransferStorageEP/GetById")("PrintUrl","TransferStorage")("DeleteUrl","TransferStorageEP/Delete")("OutModal",s)}},dependencies:[pe,de,J,re,X,te,Z,ee,z,H,W,le,se,ae,oe,ne,ie,ue,ge,_e,fe],styles:["svg[_ngcontent-%COMP%]{cursor:pointer}"]});let l=f;return l})();export{mt as TransferStorageComponent};
