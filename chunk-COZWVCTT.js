import{a as ue,b as de}from"./chunk-6T4APQIW.js";import{a as _e}from"./chunk-TB4TCGTI.js";import{a as me}from"./chunk-EHX2YHES.js";import{c as ce,j as pe}from"./chunk-7N7H2ETQ.js";import"./chunk-QI74C7BQ.js";import"./chunk-PWIKXZ6E.js";import"./chunk-S52O5BXQ.js";import{a as ae,b as le}from"./chunk-KOJPIKRQ.js";import"./chunk-WL6N6SLT.js";import{a as re}from"./chunk-JZVD3M6G.js";import"./chunk-34JSETBR.js";import"./chunk-QFTVA365.js";import"./chunk-LNYZIAUP.js";import"./chunk-HYE6JRVA.js";import{a as Z,b as ee,c as te,d as ie}from"./chunk-DVVEKPVL.js";import{b as se}from"./chunk-GTD5WNPP.js";import{b as $,c as Q,f as q,h as z,k as Y,m as J,s as K,u as X}from"./chunk-M24M3PNC.js";import{c as ne,d as oe}from"./chunk-4L6P5Z5M.js";import{c as W,d as L,e as H,j as U}from"./chunk-JM67XKKX.js";import{$b as T,Bb as l,Cb as r,Db as N,Hb as b,Lb as S,Mb as p,Qb as A,Sb as P,Tb as O,Ub as k,Vb as I,Wb as h,Xb as E,Yb as D,Zb as R,_b as v,ac as w,cb as a,cc as B,db as M,fc as j,mc as C,na as V,nc as g,oc as G,pc as F,ub as f,wb as m,xa as d,ya as _}from"./chunk-VIO7ZK3G.js";import"./chunk-3EYC4JTX.js";var De=["GLComponent"],Ce=(s,u)=>({"btn-success":s,"btn-primary":u});function ge(s,u){if(s&1&&(l(0,"span",24),h(1),C(2,"date"),r()),s&2){let n=p(2);a(),D(" ",G(2,1,n.CashDiscount.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Se(s,u){if(s&1){let n=b();l(0,"div",25,2)(2,"p-calendar",26),w("ngModelChange",function(e){d(n);let i=p(2);return T(i.CashDiscount.DocDate,e)||(i.CashDiscount.DocDate=e),_(e)}),r()()}if(s&2){let n=I(1),t=p(2);a(2),m("showClear",t.CashDiscount.DocDate!=null&&t.CashDiscount.DocDate!="")("appendTo",n)("showOtherMonths",!0),v("ngModel",t.CashDiscount.DocDate),m("showTime",!0)}}function fe(s,u){if(s&1&&(l(0,"small",38),h(1),r()),s&2){let n=p().$implicit,t=p(2);a(),R("Loaded ",n.Clients.length," of ",t._SharedObjectModelService.TotalItems,"")}}function xe(s,u){if(s&1&&h(0),s&2){let n=u.item;D(" ",n.Name," ")}}function be(s,u){if(s&1&&(l(0,"span",39),h(1),r()),s&2){let n=p().$implicit;a(),D(" ",n.AmountDebts," ")}}function Ie(s,u){if(s&1){let n=b();l(0,"tr")(1,"td")(2,"div",27)(3,"span",28),h(4),r(),l(5,"button",29),S("click",function(){let e=d(n).index,i=p(2);return _(i.AppendRow(e))}),h(6,"+"),r(),l(7,"button",30),S("click",function(){let e=d(n).index,i=p(2);return _(i.RemoveRow(e))}),h(8,"-"),r()()(),l(9,"td",31)(10,"ng-select",32,3),S("clear",function(){let e=d(n).$implicit;return _(e.Clients=[])})("focus",function(){let e=d(n).index,i=I(11),o=p(2);return o.ChangeSearchApiDetails("Clients",i,e),_(o._AppModeService.ResetCurrentPage())})("keyup",function(){let e=d(n).index,i=I(11),o=p(2);return o.ChangeSearchApiDetails("Clients",i,e),_(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=d(n).index,i=I(11),o=p(2);return _(o.ChangeSearchApiDetails("Clients",i,e))})("close",function(){d(n);let e=p(2);return _(e._AppModeService.ResetCurrentPage())})("open",function(){d(n);let e=p(2);return _(e._AppModeService.ResetCurrentPage())})("change",function(){let e=d(n),i=e.$implicit,o=e.index,c=p(2);return _(c.SelectValueDetails(i.ClientId,"Client",o))}),w("ngModelChange",function(e){let i=d(n).$implicit;return T(i.ClientId,e)||(i.ClientId=e),_(e)}),f(12,fe,2,2,"ng-template",33)(13,xe,1,1,"ng-template",34),r()(),l(14,"td"),f(15,be,2,1,"span",35),r(),l(16,"td")(17,"input",36),S("keyup",function(){let e=d(n),i=e.$implicit,o=e.index,c=p(2);return c.TotalCashDiscount(),_(c.ChangeAmount(i.ClientId,o))}),w("ngModelChange",function(e){let i=d(n).$implicit;return T(i.Amount,e)||(i.Amount=e),_(e)}),r()(),l(18,"td")(19,"input",37),w("ngModelChange",function(e){let i=d(n).$implicit;return T(i.Notes,e)||(i.Notes=e),_(e)}),r()()()}if(s&2){let n=u.$implicit,t=u.index,e=p(2);a(4),E(t+1),a(3),m("disabled",e.CashDiscount.SalesDisountDetails.length==1),a(3),m("items",n.Clients)("autofocus",!1)("dropdownPosition",e._AppModeService.DropdownPosition(t))("virtualScroll",!0)("searchable",!0),v("ngModel",n.ClientId),a(5),m("ngIf",n.ClientId>0),a(2),A("name","Amount",t,""),A("id","Amount",t,""),m("disabled",n.ClientId==0||n.ClientId==null),v("ngModel",n.Amount),a(2),A("name","Notes",t,""),A("id","Notes",t,""),m("disabled",n.ClientId==0||n.ClientId==null),v("ngModel",n.Notes)}}function ve(s,u){s&1&&(l(0,"span"),h(1),C(2,"translate"),r()),s&2&&(a(),D(" ",g(2,1,"Model.Save"),""))}function Te(s,u){s&1&&(l(0,"span"),h(1),C(2,"translate"),r()),s&2&&(a(),D(" ",g(2,1,"Model.Update"),""))}function we(s,u){if(s&1){let n=b();l(0,"button",40),S("click",function(){d(n);let e=p(2);return _(e.OpenGl())}),h(1),C(2,"translate"),r()}s&2&&(a(),D(" ",g(2,1,"Model.Gl")," "))}function ye(s,u){if(s&1){let n=b();N(0,"app-modal-header",5),l(1,"div",6)(2,"div",7)(3,"div",8),N(4,"input",9),r(),l(5,"div",8)(6,"label",10),h(7),C(8,"translate"),r(),l(9,"input",11),w("ngModelChange",function(e){d(n);let i=p();return T(i.CashDiscount.Notes,e)||(i.CashDiscount.Notes=e),_(e)}),r()(),l(10,"div",8),f(11,ge,3,4,"span",12)(12,Se,3,5,"div",13),r()(),l(13,"table",14)(14,"thead")(15,"th",15),h(16,"#"),r(),l(17,"th",16),h(18),C(19,"translate"),r(),l(20,"th",16),h(21),C(22,"translate"),r(),l(23,"th",16),h(24),C(25,"translate"),r(),l(26,"th",17),h(27),C(28,"translate"),r()(),l(29,"tbody"),f(30,Ie,20,21,"tr",18),r()()(),l(31,"div",19)(32,"button",20),S("click",function(){d(n);let e=p();return _(e.Save())}),f(33,ve,3,3,"span",21)(34,Te,3,3,"span",21),r(),f(35,we,3,3,"button",22),l(36,"button",23),S("click",function(){let e=d(n).$implicit,i=p();return e.close("Close click"),_(i.ResetPage())}),h(37),C(38,"translate"),r()()}if(s&2){let n=p();m("PageTitle","CashDisount.CashDisount"),a(4),m("disabled",!0)("value",n.CashDiscount.DocNo),a(3),E(g(8,18,"Table.Notes")),a(2),v("ngModel",n.CashDiscount.Notes),a(2),m("ngIf",(n._DefaultSettingsService.DefaultSettings==null?null:n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),a(),m("ngIf",(n._DefaultSettingsService.DefaultSettings==null?null:n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),a(6),D(" ",g(19,20,"SaleInvoice.Client")," "),a(3),D(" ",g(22,22,"MoneyIn.Debt")," "),a(3),D(" ",g(25,24,"MoneyIn.Price")," "),a(3),D(" ",g(28,26,"MoneyIn.Notes")," "),a(3),m("ngForOf",n.CashDiscount.SalesDisountDetails)("ngForTrackBy",n.trackByMethod),a(2),m("ngClass",j(30,Ce,n.CashDiscount.Id==0,n.CashDiscount.Id!=0)),a(),m("ngIf",n.CashDiscount.Id==0),a(),m("ngIf",n.CashDiscount.Id!=0),a(),m("ngIf",n.CashDiscount.Id>0),a(2),E(g(38,28,"Model.Close"))}}var qe=(()=>{let u=class u{constructor(t,e,i,o){this._SharedObjectModelService=t,this._AppModeService=e,this._DefaultSettingsService=i,this._Apiservice=o,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"SalesDisount",Columns:["Id","DocNo","DocDate","Notes"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"}]},this.SubscriptionArr=[],this.CashDiscount={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SalesDisountDetails:[{Amount:"",ClientId:null,ClientName:"",Id:0,Code:"",Name:"",Clients:[],AmountDebts:0}]}}ngOnInit(){this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}OpenModal(){this.ResetPage(),this.GetPageInfo()}OpenGl(){this.GLComponent.Open()}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){this.CashDiscount={DocDate:new Date(t.DocDate),DocNo:t.DocNo,Id:t.Id,Name:t.Name,Code:t.Code,SalesDisountDetails:t.SalesDisountDetails};for(let e=0;e<this.CashDiscount.SalesDisountDetails.length;e++){this.CashDiscount.SalesDisountDetails[e].Clients=[],this.CashDiscount.SalesDisountDetails[e].Clients=[{Id:this.CashDiscount.SalesDisountDetails[e].ClientId,Name:this.CashDiscount.SalesDisountDetails[e].ClientName}];let i=this.CashDiscount.SalesDisountDetails[e].ClientId,o=this._Apiservice.post("ClientEP/TotalBadDepts",i,!1).subscribe({next:c=>{c.IsSuccess==!0&&c.Obj!=null?this.CashDiscount.SalesDisountDetails[e].AmountDebts=c.Obj:this._AppModeService._Toastr.error(c.Message)}});this.SubscriptionArr.push(o)}}StartConnection(){this.Hub_Connection=new de().withUrl(`${$.signalrUrl}/SalesDisount`,{skipNegotiation:!0,transport:ue.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(t=>{console.log("Error Hub Connection",t)})}GetPageInfo(){let t=this._Apiservice.get("SalesDisountEP/GetPageInfo",!1).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?this.CashDiscount.DocNo=e.Obj:this._AppModeService._Toastr.error(e.Message)}});this.SubscriptionArr.push(t)}ChangeSearchApiDetails(t,e,i){let o=`${e.searchTerm}`.trim();(o==""||o=="null")&&(e.searchTerm="",o=""),this._AppModeService.CurrentPage+=1;let c={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:o,SearchField:"Name"},x=this._Apiservice.post("Global/GetAll",c,!1).subscribe({next:y=>{y.IsSuccess==!0&&y.Obj!=null?this.HandleResponseDetails(y.Obj,t,i):this._AppModeService._Toastr.error(y.Message)}});this.SubscriptionArr.push(x)}HandleResponseDetails(t,e,i){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Clients"&&(this.CashDiscount.SalesDisountDetails[i].Clients=this._SharedObjectModelService.RemoveDuplicates(this.CashDiscount.SalesDisountDetails[i].Clients.concat(t.DataReturn),"Id"))}SelectValueDetails(t,e,i){if(t!=null&&t>0){let o=[];e=="Client"&&(o=this.CashDiscount.SalesDisountDetails[i].Clients);let c=o.find(x=>x.Id==t);if(c!=null)this.CashDiscount.SalesDisountDetails[i][`${e}Id`]=c.Id,this.CashDiscount.SalesDisountDetails[i][`${e}Name`]=c.Name,this.TotalDept(c.Id,i);else{this._Apiservice.DontPlay();return}}else this.CashDiscount.SalesDisountDetails[i][`${e}Id`]=null,this.CashDiscount.SalesDisountDetails[i][`${e}Name`]=[]}TotalDept(t,e){let i=this._Apiservice.post("ClientEP/TotalBadDepts",t,!1).subscribe({next:o=>{o.IsSuccess==!0&&o.Obj!=null?this.CashDiscount.SalesDisountDetails[e].AmountDebts=o.Obj:this._AppModeService._Toastr.error(o.Message)}});this.SubscriptionArr.push(i)}AppendRow(t){return this.Row={ClientId:null,Amount:"",AmountDebts:0,ClientName:"",Clients:[],Code:"",Id:0,Name:""},this.CashDiscount.SalesDisountDetails.push(this.Row),this.TotalCashDiscount(),!0}RemoveRow(t){return this.CashDiscount.SalesDisountDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.CashDiscount.SalesDisountDetails.splice(t,1),this.TotalCashDiscount(),!0)}TotalCashDiscount(){let t=0;for(let e=0;e<this.CashDiscount.SalesDisountDetails.length;e++)t+=Number(this.CashDiscount.SalesDisountDetails[e].Amount);return Number(t.toFixed(2))}ChangeAmount(t,e){}Save(){if(this.CashDiscount.DocDate==""||this.CashDiscount.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}for(let e=0;e<this.CashDiscount.SalesDisountDetails.length;e++){let i=e,o=Number(this.CashDiscount.SalesDisountDetails[e].ClientId),c=Number(this.CashDiscount.SalesDisountDetails[e].Amount),x=Number(this.CashDiscount.SalesDisountDetails[e].AmountDebts);if(o>0){if(c<=0||isNaN(c)||c==null||c==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("MoneyIn.Error.EnterAmount"));return}if(this.CashDiscount.SalesDisountDetails.filter(he=>he.ClientId==o).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(i+1));return}}}let t={DocNo:this.CashDiscount.DocNo,DocDate:this._Apiservice.ConvertISODate(this.CashDiscount.DocDate),SalesDisountDetails:this.CashDiscount.SalesDisountDetails,Id:this.CashDiscount.Id,Name:"",Code:""};if(t.Id==0){let e=this._Apiservice.post("SalesDisountEP/Add",t,!0).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?(this._AppModeService._Toastr.success(i.Message),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(i.Obj)):this._AppModeService._Toastr.error(i.Message)}});this.SubscriptionArr.push(e)}if(t.Id>0){let e=this._Apiservice.put("SalesDisountEP/Update",t,!0).subscribe({next:i=>{if(i.IsSuccess==!0&&i.Obj!=null){this._AppModeService._Toastr.success(i.Message),this.ResetPage(),this.GetPageInfo();let o=i.Obj,c=this._SharedObjectModelService.Paging.DataReturn.find(x=>x.Id==o.Id);c!=null&&Object.assign(c,o)}else this._AppModeService._Toastr.error(i.Message)}});this.SubscriptionArr.push(e)}}ResetPage(){this.CashDiscount={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SalesDisountDetails:[{Amount:"",ClientId:null,ClientName:"",Id:0,Code:"",Name:"",Clients:[],AmountDebts:0}]},this._DefaultSettingsService.ResetDate(this.CashDiscount)}ServerListener(){this.Hub_Connection?.on("AddSalesDisount",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&(this.CashDiscount.DocNo=t.DocNo)})}trackByMethod(t,e){return e.Id}ngOnDestroy(){for(let t=0;t<this.SubscriptionArr.length;t++)this.SubscriptionArr[t].unsubscribe()}};u.\u0275fac=function(e){return new(e||u)(M(re),M(se),M(me),M(Q))},u.\u0275cmp=V({type:u,selectors:[["app-cash-discount"]],viewQuery:function(e,i){if(e&1&&P(De,5),e&2){let o;O(o=k())&&(i.GLComponent=o.first)}},standalone:!0,features:[B],decls:5,vars:7,consts:[["content",""],["GLComponent",""],["ddddd",""],["SelectClientssDetails",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"col-12","d-flex","flex","flex-wrap","align-items-end"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","px-1"],["type","number","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block",4,"ngIf"],["class","formdate",4,"ngIf"],[1,"table","table-hover","table-striped","table-light","mt-3","mb-0"],[1,"col-1"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn","py-3","px-5",3,"click","ngClass"],[4,"ngIf"],["class","btn btn-info mx-3 py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-secondary","py-3","px-5",3,"click"],[1,"d-block"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","showClear","appendTo","showOtherMonths","ngModel","showTime"],[1,"d-flex","justify-content-center","align-items-center"],[1,"mx-1","text-dark"],[1,"col-5","mx-2","btn","btn-success",3,"click"],[1,"col-5","mx-auto","btn","btn-danger",3,"click","disabled"],[1,"ngSelect"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["class","text-dark",4,"ngIf"],["min","0","step","1","type","number",1,"form-control","shadow-none","text-center",3,"keyup","ngModelChange","disabled","ngModel","name","id"],["type","text",1,"form-control","shadow-none","text-center",3,"ngModelChange","disabled","ngModel","name","id"],[1,"form-text","text-muted"],[1,"text-dark"],[1,"btn","btn-info","mx-3","py-3","px-5",3,"click"]],template:function(e,i){if(e&1){let o=b();l(0,"app-dynamic-component",4),S("OpenModalEvent",function(){return d(o),_(i.OpenModal())})("ShowToEditeEvent",function(){return d(o),_(i.ShowToEdite())}),r(),f(1,ye,39,33,"ng-template",null,0,F),N(3,"app-glsheard",null,1)}if(e&2){let o=I(2);m("PageTitle","CashDisount.CashDisount")("TablePaging",i.TablePaging)("FullScreen",!0)("GlResponse",!0)("GetById","SalesDisountEP/GetById")("DeleteUrl","SalesDisountEP/Delete")("OutModal",o)}},dependencies:[le,ae,U,H,L,W,X,q,J,z,K,Y,oe,ne,ie,te,Z,ee,pe,_e,ce]});let s=u;return s})();export{qe as CashDiscountComponent};
