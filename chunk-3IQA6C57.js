import{a as ge}from"./chunk-ABGH7SJD.js";import{a as Be}from"./chunk-AFVHDR2Z.js";import{b as de,c as Te,h as ue}from"./chunk-RMPXGUPG.js";import"./chunk-6G7QKXJW.js";import"./chunk-PE2JD36L.js";import{a as he}from"./chunk-NNHHLG53.js";import"./chunk-RAAURFHQ.js";import{a as pe,b as me}from"./chunk-UVSBIWKY.js";import"./chunk-5EQTOVFJ.js";import{a as fe}from"./chunk-OZ63RRZR.js";import"./chunk-3T7HRBK4.js";import"./chunk-G323P4PR.js";import"./chunk-NZD6IPKE.js";import"./chunk-EKOK3I7J.js";import{a as se,b as ce,c as le,d as _e}from"./chunk-SU7IEUNK.js";import"./chunk-MYPGER6Q.js";import"./chunk-CETGYK4I.js";import{c as oe}from"./chunk-F7IHWOEY.js";import{c as Z,d as ee}from"./chunk-GJAIQ3XH.js";import{c as G,d as X,g as te,i as ne,l as re,n as ae,v as ie}from"./chunk-UA6GT64L.js";import{A as Y,G as K,d as H,e as z,j as q}from"./chunk-GOUT62LL.js";import{$b as v,Cb as l,Db as p,Eb as N,Ib as F,Mb as I,Nb as i,Qb as V,Rb as E,Tb as U,Ub as R,Vb as O,Wb as f,X as b,Xb as d,Yb as S,Zb as C,_b as P,ac as w,bc as D,cc as W,db as _,dc as $,eb as y,ia as j,na as Q,nc as u,oc as g,pc as J,qc as k,vb as x,xa as s,xb as T,ya as c}from"./chunk-RH76WUG2.js";import{a as M,b as A}from"./chunk-3EYC4JTX.js";var Se=["content"],xe=["GLComponent"];function Ie(o,m){if(o&1&&(l(0,"span",33),d(1),u(2,"date"),p()),o&2){let r=i(2);_(),C(" ",J(2,1,r.TransferBanches.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Ce(o,m){if(o&1){let r=F();l(0,"div",34)(1,"p-calendar",35),D("ngModelChange",function(e){s(r);let t=i(2);return w(t.TransferBanches.DocDate,e)||(t.TransferBanches.DocDate=e),c(e)}),p()()}if(o&2){let r=i(2);_(),v("ngModel",r.TransferBanches.DocDate),T("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function ve(o,m){if(o&1&&(l(0,"small",36),d(1),p()),o&2){let r=i(2);_(),P("Loaded ",r.Branches.length," of ",r._SharedObjectModelService.TotalItems,"")}}function we(o,m){if(o&1&&d(0),o&2){let r=m.item;C(" ",r.Name," ")}}function De(o,m){if(o&1&&(l(0,"small",36),d(1),p()),o&2){let r=i(2);_(),P("Loaded ",r.FromStorages.length," of ",r._SharedObjectModelService.TotalItems,"")}}function be(o,m){if(o&1&&d(0),o&2){let r=m.item;C(" ",r.Name,`
`)}}function Ne(o,m){if(o&1&&(l(0,"small",36),d(1),p()),o&2){let r=i(2);_(),P("Loaded ",r.Branches.length," of ",r._SharedObjectModelService.TotalItems,"")}}function Pe(o,m){if(o&1&&d(0),o&2){let r=m.item;C(" ",r.Name,`
`)}}function ye(o,m){if(o&1&&(l(0,"small",36),d(1),p()),o&2){let r=i(2);_(),P("Loaded ",r.ToStorages.length," of ",r._SharedObjectModelService.TotalItems,"")}}function Fe(o,m){if(o&1&&d(0),o&2){let r=m.item;C(" ",r.Name,`
`)}}function Ve(o,m){if(o&1&&(l(0,"small",36),d(1),p()),o&2){let r=i().$implicit,n=i(2);_(),P("Loaded ",r.Items.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Me(o,m){if(o&1&&d(0),o&2){let r=m.item;P(" ",r.Name," - ",r.Code," ")}}function Ae(o,m){if(o&1){let r=F();l(0,"button",51),I("click",function(){s(r);let e=i().index,t=i(2),a=f(5);return c(t.GetItemBalance(e,a))}),N(1,"i",52),p()}if(o&2){let r=i(3);T("disabled",r._Apiservice.DisabledButton)}}function Ee(o,m){if(o&1&&(l(0,"small",36),d(1),p()),o&2){let r=i().$implicit,n=i(2);_(),P("Loaded ",r.ProductUnits.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Ue(o,m){if(o&1&&d(0),o&2){let r=m.item;C(" ",r.Name," ")}}function Re(o,m){if(o&1){let r=F();l(0,"tr")(1,"td",37)(2,"div",38)(3,"span",39),d(4),p(),l(5,"button",40),I("click",function(){s(r);let e=i(2);return c(e.AppendRow())}),N(6,"i",41),p(),l(7,"button",42),I("click",function(){let e=s(r).index,t=i(2);return c(t.RemoveRow(e))}),N(8,"i",43),p()()(),l(9,"td",44),u(10,"translate"),l(11,"ng-select",45,8),u(13,"translate"),I("clear",function(){let e=s(r).$implicit;return c(e.Items=[])})("focus",function(){let e=s(r).index,t=f(12),a=i(2);return a.ChangeSearchApiDetails("Items",t,e),c(a._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(r).index,t=f(12),a=i(2);return a.ChangeSearchApiDetails("Items",t,e),c(a._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(r).index,t=f(12),a=i(2);return c(a.ChangeSearchApiDetails("Items",t,e))})("close",function(){s(r);let e=i(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=i(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(r),t=e.$implicit,a=e.index,h=i(2);return c(h.SelectItem(t.ProductId,a))}),D("ngModelChange",function(e){let t=s(r).$implicit;return w(t.ProductId,e)||(t.ProductId=e),c(e)}),x(14,Ve,2,2,"ng-template",22)(15,Me,1,2,"ng-template",23),p(),x(16,Ae,2,1,"button",46),p(),l(17,"td",47),u(18,"translate"),l(19,"ng-select",48,9),u(21,"translate"),I("clear",function(){let e=s(r).$implicit;return c(e.ProductUnits=[])})("focus",function(){let e=s(r).index,t=f(20),a=i(2);return a.ChangeSearchApiDetails("ItemUnits",t,e),c(a._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(r).index,t=f(20),a=i(2);return a.ChangeSearchApiDetails("ItemUnits",t,e),c(a._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(r).index,t=f(20),a=i(2);return c(a.ChangeSearchApiDetails("ItemUnits",t,e))})("close",function(){s(r);let e=i(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=i(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(r),t=e.$implicit,a=e.index,h=i(2);return c(h.SelectUnit(t.ProductUnitId,a))}),D("ngModelChange",function(e){let t=s(r).$implicit;return w(t.ProductUnitId,e)||(t.ProductUnitId=e),c(e)}),x(22,Ee,2,2,"ng-template",22)(23,Ue,1,1,"ng-template",23),p()(),l(24,"td",49),u(25,"translate"),l(26,"input",50),I("change",function(){let e=s(r).index,t=i(2);return c(t.TotalRow(e))})("keyup",function(){let e=s(r).index,t=i(2);return c(t.TotalRow(e))}),D("ngModelChange",function(e){let t=s(r).$implicit;return w(t.Quantity,e)||(t.Quantity=e),c(e)}),p()()()}if(o&2){let r=m.$implicit,n=m.index,e=i(2);_(),V("title",n+1),_(3),S(n+1),_(3),T("disabled",e.TransferBanches.TransferBranchesDetails.length==1),_(2),V("title",g(10,22,"TransferStorage.Name")),_(2),E("placeholder","  ",g(13,24,"SaleInvoice.ChooseProduct"),""),T("items",r.Items)("dropdownPosition","bottom")("searchable",!0)("virtualScroll",!0),v("ngModel",r.ProductId),_(5),T("ngIf",r.ProductId>0&&e.TransferBanches.FromStoreId>0&&e.TransferBanches.ToStoreId>0),_(),V("title",g(18,26,"SaleInvoice.Units")),_(2),E("placeholder","  ",g(21,28,"Item.ItemUnit"),""),T("items",r.ProductUnits)("dropdownPosition","bottom")("disabled",r.ProductId==0||r.ProductId==null),v("ngModel",r.ProductUnitId),_(5),V("title",g(25,30,"SaleInvoice.Quantity")),_(2),T("disabled",r.ProductId<=0||r.UnitId<=0),v("ngModel",r.Quantity)}}function Oe(o,m){if(o&1){let r=F();N(0,"app-modal-header",12),l(1,"div",13)(2,"div",14)(3,"div",15),N(4,"input",16),p(),l(5,"div",15),N(6,"input",16),p(),l(7,"div",15)(8,"p",17),d(9),u(10,"translate"),p(),l(11,"input",18),D("ngModelChange",function(e){s(r);let t=i();return w(t.TransferBanches.Notes,e)||(t.TransferBanches.Notes=e),c(e)}),p()(),l(12,"div",15),x(13,Ie,3,4,"span",19)(14,Ce,2,5,"div",20),p()(),l(15,"div",14)(16,"div",15)(17,"p",17),d(18),u(19,"translate"),p(),l(20,"ng-select",21,4),I("clear",function(){s(r);let e=i();return c(e.Branches=[])})("focus",function(){s(r);let e=f(21),t=i();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=f(21),t=i();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=f(21),t=i();return c(t.ChangeSearchApi("Branch",e))})("close",function(){s(r);let e=i();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=i();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=i();return c(e.SelectValue(e.TransferBanches.FromBranchId,"FromBranch"))}),D("ngModelChange",function(e){s(r);let t=i();return w(t.TransferBanches.FromBranchId,e)||(t.TransferBanches.FromBranchId=e),c(e)}),x(22,ve,2,2,"ng-template",22)(23,we,1,1,"ng-template",23),p()(),l(24,"div",15)(25,"p",24),d(26),u(27,"translate"),p(),l(28,"ng-select",25,5),I("clear",function(){s(r);let e=i();return c(e.FromStorages=[])})("focus",function(){s(r);let e=f(29),t=i();return t.ChangeSearchApi("FromStore",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=f(29),t=i();return t.ChangeSearchApi("FromStore",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=f(29),t=i();return c(t.ChangeSearchApi("FromStore",e))})("close",function(){s(r);let e=i();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=i();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=i();return c(e.SelectValue(e.TransferBanches.FromStoreId,"FromStore"))}),D("ngModelChange",function(e){s(r);let t=i();return w(t.TransferBanches.FromStoreId,e)||(t.TransferBanches.FromStoreId=e),c(e)}),x(30,De,2,2,"ng-template",22)(31,be,1,1,"ng-template",23),p()(),l(32,"div",15)(33,"p",17),d(34),u(35,"translate"),p(),l(36,"ng-select",21,6),I("clear",function(){s(r);let e=i();return c(e.Branches=[])})("focus",function(){s(r);let e=f(37),t=i();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=f(37),t=i();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=f(37),t=i();return c(t.ChangeSearchApi("Branch",e))})("close",function(){s(r);let e=i();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=i();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=i();return c(e.SelectValue(e.TransferBanches.ToBranchId,"ToBranch"))}),D("ngModelChange",function(e){s(r);let t=i();return w(t.TransferBanches.ToBranchId,e)||(t.TransferBanches.ToBranchId=e),c(e)}),x(38,Ne,2,2,"ng-template",22)(39,Pe,1,1,"ng-template",23),p()(),l(40,"div",15)(41,"p",17),d(42),u(43,"translate"),p(),l(44,"ng-select",26,7),I("clear",function(){s(r);let e=i();return c(e.ToStorages=[])})("focus",function(){s(r);let e=f(45),t=i();return t.ChangeSearchApi("ToStore",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=f(45),t=i();return t.ChangeSearchApi("ToStore",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=f(45),t=i();return c(t.ChangeSearchApi("ToStore",e))})("close",function(){s(r);let e=i();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=i();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=i();return c(e.SelectValue(e.TransferBanches.ToStoreId,"ToStore"))}),D("ngModelChange",function(e){s(r);let t=i();return w(t.TransferBanches.ToStoreId,e)||(t.TransferBanches.ToStoreId=e),c(e)}),x(46,ye,2,2,"ng-template",22)(47,Fe,1,1,"ng-template",23),p()()(),l(48,"div",27)(49,"table",28)(50,"thead")(51,"tr")(52,"th",29),d(53,"#"),p(),l(54,"th",30),d(55),u(56,"translate"),p(),l(57,"th",30),d(58),u(59,"translate"),p(),l(60,"th",30),d(61),u(62,"translate"),p()()(),l(63,"tbody"),x(64,Re,27,32,"tr",31),p()()()(),l(65,"app-modal-footer",32),I("SaveEvent",function(){s(r);let e=i();return c(e.Save())})("UpdateEvent",function(){s(r);let e=i();return c(e.Save())})("OpenGlEvent",function(){s(r);let e=i();return c(e.OpenGl())})("CloseEvent",function(){let e=s(r).$implicit,t=i();return e.close("Close click"),c(t.ResetPage())}),p()}if(o&2){let r=i();T("PageTitle",r.TablePaging.PageTitle),_(4),T("disabled",!0)("value",r.TransferBanches.DocNoFrom),_(2),T("disabled",!0)("value",r.TransferBanches.DocNoTo),_(3),S(g(10,41,"Table.Notes")),_(2),v("ngModel",r.TransferBanches.Notes),_(2),T("ngIf",(r._DefaultSettingsService.DefaultSettings==null?null:r._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),_(),T("ngIf",(r._DefaultSettingsService.DefaultSettings==null?null:r._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),_(4),S(g(19,43,"TransferBanches.BranchFrom")),_(2),T("items",r.Branches)("autofocus",!1)("virtualScroll",!0)("searchable",!0),v("ngModel",r.TransferBanches.FromBranchId),_(6),S(g(27,45,"TransferStorage.FromStoreId")),_(2),T("items",r.FromStorages)("autofocus",!1)("virtualScroll",!0)("disabled",r.TransferBanches.FromBranchId==null)("searchable",!0),v("ngModel",r.TransferBanches.FromStoreId),_(6),S(g(35,47,"TransferBanches.BranchTo")),_(2),T("items",r.Branches)("autofocus",!1)("virtualScroll",!0)("searchable",!0),v("ngModel",r.TransferBanches.ToBranchId),_(6),S(g(43,49,"TransferStorage.ToStoreId")),_(2),T("items",r.ToStorages)("autofocus",!1)("virtualScroll",!0)("searchable",!0)("disabled",r.TransferBanches.ToBranchId==null),v("ngModel",r.TransferBanches.ToStoreId),_(11),S(g(56,51,"TransferStorage.Name")),_(3),S(g(59,53,"SaleInvoice.Units")),_(3),S(g(62,55,"TransferStorage.Quantity")),_(3),T("ngForOf",r.TransferBanches.TransferBranchesDetails),_(),T("Id",r.TransferBanches.Id)("Gl",!0)}}function ke(o,m){if(o&1&&(l(0,"tr")(1,"td"),d(2),p(),l(3,"td"),d(4),p()()),o&2){let r=m.$implicit;_(2),C(" ",r.Name," "),_(2),C(" ",r.Qty," ")}}function Ge(o,m){if(o&1&&(l(0,"tr")(1,"td"),d(2),p(),l(3,"td"),d(4),p()()),o&2){let r=m.$implicit;_(2),C(" ",r.Name," "),_(2),C(" ",r.Qty," ")}}function Le(o,m){if(o&1&&(l(0,"div",53)(1,"p",54),d(2),u(3,"translate"),p(),l(4,"table",55)(5,"thead")(6,"tr")(7,"th"),d(8),u(9,"translate"),p(),l(10,"th"),d(11),u(12,"translate"),p()()(),l(13,"tbody"),x(14,ke,5,2,"tr",31),p()(),l(15,"p",54),d(16),u(17,"translate"),p(),l(18,"table",55)(19,"thead")(20,"tr")(21,"th"),d(22),u(23,"translate"),p(),l(24,"th"),d(25),u(26,"translate"),p()()(),l(27,"tbody"),x(28,Ge,5,2,"tr",31),p()()()),o&2){let r=i();_(2),C(" ",g(3,8,"TransferStorage.BalanceFrom")," "),_(6),S(g(9,10,"SaleInvoice.Name")),_(3),S(g(12,12,"Table.Balance")),_(3),T("ngForOf",r.ItemBalanceFrom),_(2),C(" ",g(17,14,"TransferStorage.BalanceTo")," "),_(6),S(g(23,16,"SaleInvoice.Name")),_(3),S(g(26,18,"Table.Balance")),_(3),T("ngForOf",r.ItemBalanceTo)}}var Tt=(()=>{let m=class m{constructor(n,e,t,a,h){this._ActivatedRoute=n,this._AppModeService=e,this._SharedObjectModelService=t,this._DefaultSettingsService=a,this._Apiservice=h,this._ServiceLifeTime=j(G),this.TablePaging={PageTitle:"TransferBanches.TransferBanches",GetById:"TransferBranchesEP/GetById",DeleteUrl:"TransferBranchesEP/Delete",PrintUrl:"TransferBranches",BranchFilter:!0,Url:"Global/GetAll",TableName:"TransferBranches",Join:!0,JoinTables:["Storages SF","Storages ST"],JoinConditions:["T.FromStoreId = SF.Id","T.ToStoreId = ST.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","T.FromBranchName","SF.Name AS FromStoreName","T.ToBranchName","ST.Name AS ToStoreName"],TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"FromBranchName",CellName:"TransferBanches.BranchFrom"},{SortName:"FromStoreName",CellName:"TransferStorage.FromStoreId",ExistSearchField:"SF.Name"},{SortName:"ToBranchName",CellName:"TransferBanches.BranchTo"},{SortName:"ToStoreName",CellName:"TransferStorage.ToStoreId",ExistSearchField:"ST.Name"},{SortName:"Notes",CellName:"Table.Notes",ExistSearchField:"T.Notes"}]},this.Branches=[],this.ToStorages=[],this.FromStorages=[],this.TransferBanches={DocNo:0,DocDate:"",DocNoTo:0,DocNoFrom:0,TransferBranchesDetails:[{ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0}],FromStoreId:null,FromStoreName:"",FromBranchId:null,FromBranchName:"",ToBranchId:null,ToBranchName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,TotalPrice:0,Id:0,Name:"",Code:""},this.ItemBalanceFrom=[],this.ItemBalanceTo=[]}ngOnInit(){let n=Number(this._ActivatedRoute.snapshot.queryParams.Id);n>0&&this.GetByIdRoute(n)}GetByIdRoute(n){this._Apiservice.getById("TransferBranchesEP/GetById",n,!0).pipe(b(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this.GLComponent.Gl=e.Obj.Gl,this.Drow(e.Obj.model),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})}})}ShowToEdite(n){this.GLComponent.Gl=n.Gl,this.Drow(n.PageModel)}Drow(n){this.TransferBanches={Id:"",DocNo:n.DocNo,DocDate:new Date(`${n.DocDate}`),DocNoTo:n.DocNoTo,DocNoFrom:n.DocNoFrom,FromStoreId:n.FromStoreId,FromBranchId:n.FromBranchId,ToBranchId:n.ToBranchId,ToStoreId:n.ToStoreId,TotalQty:n.TotalQty,TotalPrice:n.TotalPrice,TransferBranchesDetails:n.TransferBranchesDetails},this.Branches=[],this.Branches.push({Id:n.FromBranchId,Name:n.FromBranchName}),this.Branches.push({Id:n.ToBranchId,Name:n.ToBranchName}),this.FromStorages.push({Id:n.FromStoreId,Name:n.FromStoreName}),this.ToStorages.push({Id:n.ToStoreId,Name:n.ToStoreName});for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++){let t=this.TransferBanches.TransferBranchesDetails[e];t.Items=[{Id:t.ProductId,Name:t.ProductName,NameAndCode:t.ProductName}],t.ProductUnits=[{Id:t.ProductUnitId,Name:t.ProductUnitName,NameAndUnitFactor:t.ProductUnitName}]}}OpenModal(){this.ResetPage()}OpenGl(){this.GLComponent.Open()}ChangeSearchApi(n,e){let t=`${e.searchTerm}`.trim();(t==""||t=="null")&&(e.searchTerm="",t=""),this._AppModeService.CurrentPage+=1;let a={TableName:n,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:t,SearchField:"Name"};n=="FromStore"&&(a.TableName="Storages",a.Conditions=`BranchId = ${this.TransferBanches.FromBranchId}`),n=="ToStore"&&(a.TableName="Storages",a.Conditions=`BranchId = ${this.TransferBanches.ToBranchId}`),this._Apiservice.post("Global/GetAll",a,!1).pipe(b(this._ServiceLifeTime.Destroyed$)).subscribe({next:h=>{this.HandleResponse(h.Obj,n)}})}HandleResponse(n,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=n.TotalItems,e=="FromStore"&&(this.FromStorages=this._SharedObjectModelService.RemoveDuplicates(this.FromStorages.concat(n.DataReturn),"Id")),e=="ToStore"&&(this.ToStorages=this._SharedObjectModelService.RemoveDuplicates(this.ToStorages.concat(n.DataReturn),"Id")),e=="Branch"&&(this.Branches=this._SharedObjectModelService.RemoveDuplicates(this.Branches.concat(n.DataReturn),"Id"))}SelectValue(n,e){if(n!=null&&(n>0||n!="")){let t=[];e=="FromStore"&&(t=this.FromStorages),e=="ToStore"&&(t=this.ToStorages),(e=="FromBranch"||e=="ToBranch")&&(t=this.Branches);let a=t.find(h=>h.Id==n);if(a==null){this._AppModeService.DontPlay();return}else this.TransferBanches[`${e}Id`]=n,this.TransferBanches[`${e}Name`]=a.Name,(e=="FromBranch"||e=="ToBranch")&&(this.GetDocNo(),e=="ToBranch"&&(this.TransferBanches.ToStoreId=null,this.ToStorages=[]),e=="FromBranch"&&(this.TransferBanches.FromStoreId=null,this.FromStorages=[]))}else this.TransferBanches[`${e}Id`]=null,this.TransferBanches[`${e}Name`]="",e=="ToBranch"&&(this.TransferBanches.DocNoTo=0,this.ToStorages=[],this.TransferBanches.ToStoreId=null),e=="FromBranch"&&(this.TransferBanches.DocNoFrom=0,this.FromStorages=[],this.TransferBanches.FromStoreId=null)}ChangeSearchApiDetails(n,e,t){let a=`${e.searchTerm}`.trim();(a==""||a=="null")&&(e.searchTerm="",a=""),this._AppModeService.CurrentPage+=1;let h={TableName:n,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:a,SearchField:"Name"};if(n=="Items"&&(h.Columns=["Id","Name","Code"],h.Conditions="ProductType != 2"),n=="ItemUnits"){let B=this.TransferBanches.TransferBranchesDetails[t].ProductId==null?0:this.TransferBanches.TransferBranchesDetails[t].ProductId;h.Conditions=`ItemId = ${B}`,h.Join=!0,h.JoinTables=["Units U"],h.NoPaging=!0,h.JoinConditions=["T.UnitId = U.Id"],h.Columns=["T.Id","U.Name","T.UnitFactor"],h.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",h,!1).pipe(b(this._ServiceLifeTime.Destroyed$)).subscribe({next:B=>{this.HandleResponseDetails(B.Obj,n,t)}})}HandleResponseDetails(n,e,t){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=n.TotalItems,e=="Items"&&(this.TransferBanches.TransferBranchesDetails[t].Items=this._SharedObjectModelService.RemoveDuplicates(this.TransferBanches.TransferBranchesDetails[t].Items.concat(n.DataReturn),"Id"),this.TransferBanches.TransferBranchesDetails[t].Items=this.TransferBanches.TransferBranchesDetails[t].Items.map(a=>A(M({},a),{NameAndCode:a.Code!=null?`${a.Name} - ${a.Code}`:`${a.Name}`}))),e=="ItemUnits"&&(this.TransferBanches.TransferBranchesDetails[t].ProductUnits=n.DataReturn.map(a=>A(M({},a),{NameAndUnitFactor:a.UnitFactor!=null?`${a.Name} - ${a.UnitFactor}`:`${a.Name}`})))}SelectItem(n,e){if(n!=null&&n>0){let t=this.TransferBanches.TransferBranchesDetails[e].Items.find(a=>a.Id==n);if(t!=null)this.TransferBanches.TransferBranchesDetails[e].ProductId=t.Id,this.TransferBanches.TransferBranchesDetails[e].ProductName=t.Name,this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=null,this.TransferBanches.TransferBranchesDetails[e].ProductUnits=[],this.AfterSelectem(t.Id,e);else{this._Apiservice.DontPlay();return}}else this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=null,this.TransferBanches.TransferBranchesDetails[e].ProductUnits=[]}AfterSelectem(n,e){if(n>0){let t={TableName:"ItemUnits",Columns:["Id","Name"],CurrentPage:1,PageSize:1,SearchText:"",SearchField:"Name"};t.Conditions=`ItemId = ${n}`,t.Join=!0,t.JoinTables=["Units U"],t.JoinConditions=["T.UnitId = U.Id"],t.Columns=["T.Id","U.Name","T.UnitFactor"],t.SearchField="U.Name",this._Apiservice.post("Global/GetAll",t,!1).pipe(b(this._ServiceLifeTime.Destroyed$)).subscribe({next:a=>{a.Obj.DataReturn=a.Obj.DataReturn.map(B=>A(M({},B),{NameAndUnitFactor:B.UnitFactor!=null?`${B.Name} - ${B.UnitFactor}`:`${B.Name}`}));let h=a.Obj.DataReturn[0];h!=null&&(this.TransferBanches.TransferBranchesDetails[e].ProductUnits=a.Obj.DataReturn,this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=h.Id,this.TransferBanches.TransferBranchesDetails[e].Quantity=1)}})}}SelectUnit(n,e){if(n!=null&&n>0){let t=this.TransferBanches.TransferBranchesDetails[e].ProductUnits.find(a=>a.Id==n);if(t!=null)this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=t.Id,this.TransferBanches.TransferBranchesDetails[e].ProductUnitName=t.Name;else{this._Apiservice.DontPlay();return}}}GetDocNo(){let n=this.TransferBanches.FromBranchId==null?0:this.TransferBanches.FromBranchId,e=this.TransferBanches.ToBranchId==null?0:this.TransferBanches.ToBranchId;this._Apiservice.get(`TransferBranchesEP/GetPageInfo?FromBranchId=${n}&ToBranchId=${e}`).pipe(b(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{this.TransferBanches.DocNoFrom=t.Obj.FromDocNo,this.TransferBanches.DocNoTo=t.Obj.ToDocNo}})}AppendRow(){let n={ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0};return this.TransferBanches.TransferBranchesDetails.push(n),this._AppModeService.AppendTd(),!0}RemoveRow(n){return this.TransferBanches.TransferBranchesDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.TransferBanches.TransferBranchesDetails.splice(n,1),this.TotalTransfer(),!0)}GetItemBalance(n,e){let t=this.TransferBanches.TransferBranchesDetails[n];if(this.TransferBanches.ToStoreId==0||this.TransferBanches.ToStoreId==null||this.TransferBanches.FromStoreId==0||this.TransferBanches.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.EnterStore"));return}if(t.ProductId==0||t.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.SelectItem"));return}let a={ProductId:t.ProductId,FromStoreId:this.TransferBanches.FromStoreId,ToStoreId:this.TransferBanches.ToStoreId,BranchId:this.TransferBanches.FromBranchId,SecoundBranchId:this.TransferBanches.ToBranchId};this._Apiservice.post("ItemEP/ProductBalance",a,!0).pipe(b(this._ServiceLifeTime.Destroyed$)).subscribe({next:h=>{this.ItemBalanceFrom=h.Obj.BalanceFrom,this.ItemBalanceTo=h.Obj.BalanceTo,this._AppModeService._NgbModal.open(e,{size:"xl",centered:!0})}})}TotalRow(n){let e=Number(this.TransferBanches.TransferBranchesDetails[n].Price),t=Number(this.TransferBanches.TransferBranchesDetails[n].Quantity);return this.TransferBanches.TransferBranchesDetails[n].TotalPrice=Number(e*t),this.TotalTransfer(),Number(e*t)}TotalTransfer(){let n=0;for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++)n+=Number(this.TransferBanches.TransferBranchesDetails[e].Price)*Number(this.TransferBanches.TransferBranchesDetails[e].Quantity);return this.TransferBanches.TotalPrice=Number(n),Number(n)}Save(){if(this.TransferBanches.DocDate==""||this.TransferBanches.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate"));return}if(this.TransferBanches.FromBranchId==0||this.TransferBanches.FromBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.EnterFromBranchId"));return}if(this.TransferBanches.FromStoreId==0||this.TransferBanches.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.FromStoreId"));return}if(this.TransferBanches.ToBranchId==0||this.TransferBanches.ToBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.EnterToBranchId"));return}if(this.TransferBanches.ToStoreId==0||this.TransferBanches.ToStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.ToStoreId"));return}if(this.TransferBanches.FromBranchId==0||this.TransferBanches.ToBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.ToFrom"));return}if(this.TransferBanches.DocNoFrom<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.DocNoFrom"));return}if(this.TransferBanches.DocNoTo<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.DocNoTo"));return}if(this.TransferBanches.FromBranchId==this.TransferBanches.ToBranchId){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.SameBranch"));return}for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++){let t=e,a=Number(this.TransferBanches.TransferBranchesDetails[e].ProductId),h=Number(this.TransferBanches.TransferBranchesDetails[e].Quantity);this.TransferBanches.TransferBranchesDetails[e].Price=0;let B=Number(this.TransferBanches.TransferBranchesDetails[e].ProductUnitId);if(a==null||a==null||a<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}if(B==null||B==null||B<=0||isNaN(B)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterUnit"));return}if(this.TransferBanches.TransferBranchesDetails.filter(L=>L.ProductId==a&&L.ProductUnitId==B).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(t+1));return}if(h==null||h==null||isNaN(h)||h<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterQuantity"));return}}let n={DocNo:this.TransferBanches.DocNo,DocDate:this._Apiservice.ConvertISODate(this.TransferBanches.DocDate),DocNoFrom:this.TransferBanches.DocNoFrom,DocNoTo:this.TransferBanches.DocNoTo,TransferBranchesDetails:this.TransferBanches.TransferBranchesDetails,FromStoreId:this.TransferBanches.FromStoreId,FromStoreName:this.TransferBanches.FromStoreName,FromBranchId:this.TransferBanches.FromBranchId,FromBranchName:this.TransferBanches.FromBranchName,ToBranchId:this.TransferBanches.ToBranchId,ToBranchName:this.TransferBanches.ToBranchName,ToStoreId:this.TransferBanches.ToStoreId,ToStoreName:this.TransferBanches.ToStoreName,TotalQty:this.TransferBanches.TotalQty,TotalPrice:this.TransferBanches.TotalPrice,Id:0,Name:"",Code:""};this._Apiservice.post("TransferBranchesEP/Add",n,!0).pipe(b(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this._SharedObjectModelService.Paging.DataReturn.push(e.Obj)}})}ResetPage(){this.TransferBanches={DocNo:0,DocDate:"",DocNoTo:0,DocNoFrom:0,TransferBranchesDetails:[{ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0}],FromStoreId:null,FromStoreName:"",FromBranchId:null,FromBranchName:"",ToBranchId:null,ToBranchName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,TotalPrice:0,Id:0,Name:"",Code:""},this._DefaultSettingsService.ResetDate(this.TransferBanches)}ngOnDestroy(){}};m.\u0275fac=function(e){return new(e||m)(y(Y),y(oe),y(fe),y(Be),y(X))},m.\u0275cmp=Q({type:m,selectors:[["app-transfer-banches"]],viewQuery:function(e,t){if(e&1&&(U(Se,5),U(xe,5)),e&2){let a;R(a=O())&&(t.ContentModel=a.first),R(a=O())&&(t.GLComponent=a.first)}},standalone:!0,features:[W([G]),$],decls:8,vars:7,consts:[["dynamiccomponent",""],["content",""],["ItemBalance",""],["GLComponent",""],["SelectFromBranch",""],["SelectFromStore",""],["SelectToBranch",""],["SelectToStore",""],["SelectItem22",""],["SelectUnits",""],[3,"ShowToEditeEvent","OpenModalEvent","PageTitle","TablePaging","GlResponse","GetById","DeleteUrl","PrintUrl","OutModal"],[1,"col-8"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-end","col-12","p-2"],[1,"col-12","col-sm-6","col-md-6","col-lg-4","col-xl-3","p-1"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"my-1"],["type","text","name","DocDate","id","DocDate",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block col-12 text-center",4,"ngIf"],["class","formdate",4,"ngIf"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["for","FromStoreId",1,"my-1"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","disabled","searchable","ngModel"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","disabled","ngModel"],["id","ProductTable",1,"DivPaging","table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-1","mb-0"],[1,"col-1"],[1,"col-2"],[4,"ngFor","ngForOf"],[3,"SaveEvent","UpdateEvent","OpenGlEvent","CloseEvent","Id","Gl"],[1,"d-block","col-12","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"form-text","text-muted"],[1,"p-0",3,"title"],[1,"d-flex","justify-content-center","align-items-center","col-11","col-md-12"],[1,"d-none","d-lg-inline"],[1,"btn-Add","btn",3,"click"],[1,"mx-1","fw-bold","pi","pi-plus"],[1,"btn-Delete","btn-Page","btn",3,"click","disabled"],[1,"mx-1","pi","pi-trash","fw-bold"],[1,"ngSelect","d-flex","mx-auto","flex-wrap","justify-content-center",3,"title"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-10","col-lg-9","col-xl-10",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["class","btn btn-Refresh d-block d-md-inline-block",3,"disabled","click",4,"ngIf"],[1,"ngSelect",3,"title"],["bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","disabled","ngModel"],[3,"title"],["name","Quantity","type","number","appNumericInput","",1,"form-control","text-center",3,"change","keyup","ngModelChange","disabled","ngModel"],[1,"btn","btn-Refresh","d-block","d-md-inline-block",3,"click","disabled"],[1,"pi","pi-eye","d-block","mx-auto"],[1,"modal-body"],[1,"my-2","text-center"],[1,"table","table-striped","table-hover"]],template:function(e,t){if(e&1){let a=F();l(0,"app-dynamic-component",10,0),I("ShowToEditeEvent",function(B){return s(a),c(t.ShowToEdite(B))})("OpenModalEvent",function(){return s(a),c(t.OpenModal())}),p(),x(2,Oe,66,57,"ng-template",null,1,k)(4,Le,29,20,"ng-template",11,2,k),N(6,"app-glsheard",null,3)}if(e&2){let a=f(3);T("PageTitle",t.TablePaging.PageTitle)("TablePaging",t.TablePaging)("GlResponse",!0)("GetById",t.TablePaging.GetById)("DeleteUrl",t.TablePaging.DeleteUrl)("PrintUrl",t.TablePaging.PrintUrl)("OutModal",a)}},dependencies:[me,pe,q,K,_e,le,se,ce,z,H,ie,te,ae,ne,re,ee,Z,ue,ge,de,he,Te]});let o=m;return o})();export{Tt as TransferBanchesComponent};
