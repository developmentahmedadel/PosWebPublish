import{a as Se,b as he,c as ge}from"./chunk-BZPR73YG.js";import{a as de}from"./chunk-RI6KAADW.js";import{a as _e}from"./chunk-3UDBFBON.js";import{b as le,c as me,h as ue}from"./chunk-ZV4STMPN.js";import"./chunk-3ZAIJ4IV.js";import"./chunk-W3OSOPGE.js";import{a as ae}from"./chunk-VSYXDL23.js";import"./chunk-BHSN7HFD.js";import{a as oe,b as pe}from"./chunk-6BJKXUWP.js";import"./chunk-3Y7UQ2M3.js";import{a as ce}from"./chunk-LUZO7NCR.js";import"./chunk-VUX2NRX2.js";import"./chunk-RXBBGPQB.js";import"./chunk-GEJP5WQO.js";import"./chunk-GNF256I6.js";import{a as te,b as se,c as re,d as ne}from"./chunk-MZIKAFPE.js";import"./chunk-EGE4BGUH.js";import"./chunk-RVJIMCIT.js";import{c as ie}from"./chunk-NUFVOF6D.js";import{c as q,d as z}from"./chunk-KALZ37GW.js";import{b as U,c as Q,f as Y,h as J,k as K,m as X,s as Z,u as ee}from"./chunk-N4FWSTCP.js";import{A as H,d as L,e as W,j as $}from"./chunk-VTADEU6K.js";import{$b as C,Cb as p,Db as u,Eb as N,Ib as T,Mb as b,Nb as a,Qb as w,Rb as M,Tb as E,Ub as V,Vb as O,Wb as A,X as f,Xb as h,Yb as G,Zb as v,_b as B,ac as x,bc as y,db as o,dc as j,eb as D,na as R,nc as S,oc as g,pc as k,qc as F,vb as I,xa as m,xb as _,ya as c}from"./chunk-J5UB44FZ.js";import"./chunk-3EYC4JTX.js";var fe=["content"],ve=["GLComponent"],De=["dynamiccomponent"];function Ie(n,d){if(n&1&&(p(0,"span",23),h(1),S(2,"date"),u()),n&2){let s=a(2);o(),v(" ",k(2,1,s.SuppliersPermissions.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Ce(n,d){if(n&1){let s=T();p(0,"div",24,3)(2,"p-calendar",25),y("ngModelChange",function(e){m(s);let t=a(2);return x(t.SuppliersPermissions.DocDate,e)||(t.SuppliersPermissions.DocDate=e),c(e)}),u()()}if(n&2){let s=a(2);o(2),C("ngModel",s.SuppliersPermissions.DocDate),_("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function xe(n,d){if(n&1&&(p(0,"small",34),h(1),u()),n&2){let s=a().$implicit,i=a(2);o(),B("Loaded ",s.Suppliers.length," of ",i._SharedObjectModelService.TotalItems,"")}}function ye(n,d){if(n&1&&h(0),n&2){let s=d.item;v(" ",s.Name," ")}}function Te(n,d){if(n&1&&(p(0,"span",35),h(1),u()),n&2){let s=a().$implicit;o(),v(" ",s.AmountPermissions," ")}}function be(n,d){if(n&1){let s=T();p(0,"tr")(1,"td",26),S(2,"translate"),p(3,"ng-select",27,4),b("clear",function(){let e=m(s).$implicit;return c(e.Suppliers=[])})("focus",function(){let e=m(s).index,t=A(4),r=a(2);return r.ChangeSearchApiDetails("Suppliers",t,e),c(r._AppModeService.ResetCurrentPage())})("keyup",function(){let e=m(s).index,t=A(4),r=a(2);return r.ChangeSearchApiDetails("Suppliers",t,e),c(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=m(s).index,t=A(4),r=a(2);return c(r.ChangeSearchApiDetails("Suppliers",t,e))})("close",function(){m(s);let e=a(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){m(s);let e=a(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=m(s),t=e.$implicit,r=e.index,l=a(2);return c(l.SelectValueDetails(t.SupplierId,"Supplier",r))}),y("ngModelChange",function(e){let t=m(s).$implicit;return x(t.SupplierId,e)||(t.SupplierId=e),c(e)}),I(5,xe,2,2,"ng-template",28)(6,ye,1,1,"ng-template",29),u()(),p(7,"td",30),S(8,"translate"),I(9,Te,2,1,"span",31),u(),p(10,"td",30),S(11,"translate"),p(12,"input",32),b("keyup",function(){let e=m(s),t=e.$implicit,r=e.index,l=a(2);return l.TotalSuppliersPermissions(),c(l.ChangeAmount(t.SupplierId,r))}),y("ngModelChange",function(e){let t=m(s).$implicit;return x(t.Amount,e)||(t.Amount=e),c(e)}),u()(),p(13,"td",30),S(14,"translate"),p(15,"input",33),y("ngModelChange",function(e){let t=m(s).$implicit;return x(t.Notes,e)||(t.Notes=e),c(e)}),u()()()}if(n&2){let s=d.$implicit,i=d.index,e=a(2);o(),w("title",g(2,23,"TransferStorage.Name")),o(2),_("items",s.Suppliers)("autofocus",!1)("dropdownPosition",e._AppModeService.DropdownPosition(i))("virtualScroll",!0)("searchable",!0),C("ngModel",s.SupplierId),o(4),w("title",g(8,25,"MoneyIn.Debt")),o(2),_("ngIf",s.SupplierId>0),o(),w("title",g(11,27,"MoneyIn.Price")),o(2),M("name","Amount",i,""),M("id","Amount",i,""),_("disabled",s.SupplierId==0||s.SupplierId==null),C("ngModel",s.Amount),o(),w("title",g(14,29,"MoneyIn.Notes")),o(2),M("name","Notes",i,""),M("id","Notes",i,""),_("disabled",s.SupplierId==0||s.SupplierId==null),C("ngModel",s.Notes)}}function we(n,d){if(n&1){let s=T();N(0,"app-modal-header",6),p(1,"div",7)(2,"div",8)(3,"div",9),N(4,"input",10),u(),p(5,"div",11)(6,"label",12),h(7),S(8,"translate"),u(),p(9,"input",13),y("ngModelChange",function(e){m(s);let t=a();return x(t.SuppliersPermissions.Notes,e)||(t.SuppliersPermissions.Notes=e),c(e)}),u()(),p(10,"div",14),I(11,Ie,3,4,"span",15)(12,Ce,3,5,"div",16),u()(),p(13,"div",17)(14,"table",18)(15,"thead")(16,"th",19),h(17),S(18,"translate"),u(),p(19,"th",19),h(20),S(21,"translate"),u(),p(22,"th",19),h(23),S(24,"translate"),u(),p(25,"th",20),h(26),S(27,"translate"),u()(),p(28,"tbody"),I(29,be,16,31,"tr",21),u()()()(),p(30,"app-modal-footer",22),b("SaveEvent",function(){m(s);let e=a();return c(e.Save())})("UpdateEvent",function(){m(s);let e=a();return c(e.Save())})("OpenGlEvent",function(){m(s);let e=a();return c(e.OpenGl())})("CloseEvent",function(){let e=m(s).$implicit,t=a();return e.close("Close click"),c(t.ResetPage())}),u()}if(n&2){let s=a();_("PageTitle","SuppliersPermissions.SuppliersPermissions"),o(4),_("disabled",!0)("value",s.SuppliersPermissions.DocNo),o(3),G(g(8,15,"Table.Notes")),o(2),C("ngModel",s.SuppliersPermissions.Notes),o(2),_("ngIf",(s._DefaultSettingsService.DefaultSettings==null?null:s._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),o(),_("ngIf",(s._DefaultSettingsService.DefaultSettings==null?null:s._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),o(5),v(" ",g(18,17,"MoneyIn.Suppliers")," "),o(3),v(" ",g(21,19,"MoneyIn.Debt")," "),o(3),v(" ",g(24,21,"MoneyIn.Price")," "),o(3),v(" ",g(27,23,"MoneyIn.Notes")," "),o(3),_("ngForOf",s.SuppliersPermissions.SuppliersPermissionsDetails)("ngForTrackBy",s.trackByMethod),o(),_("Id",s.SuppliersPermissions.Id)("Gl",!0)}}var Ze=(()=>{let d=class d{constructor(i,e,t,r,l){this._ActivatedRoute=i,this._SharedObjectModelService=e,this._AppModeService=t,this._DefaultSettingsService=r,this._Apiservice=l,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"SuppliersPermissions",Columns:["Id","DocNo","DocDate","Notes"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"}]},this.SuppliersPermissions={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SuppliersPermissionsDetails:[{Amount:"",SupplierId:null,SupplierName:"",Id:0,Code:"",Name:"",Suppliers:[],AmountPermissions:""}]}}ngOnInit(){let i=Number(this._ActivatedRoute.snapshot.queryParams.Id);i>0&&this.GetByIdRoute(i),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(i){this._Apiservice.getById("SuppliersPermissionsEP/GetById",i,!0).pipe(f(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.GLComponent.Gl=e.Obj.Gl,this.Drow(e.Obj.model),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(e.Message)}})}OpenModal(){this.ResetPage(),this.GetPageInfo()}ShowToEdite(i){this.GLComponent.Gl=i.Gl,this.Drow(i.PageModel)}Drow(i){this.SuppliersPermissions={DocDate:new Date(i.DocDate),DocNo:i.DocNo,Id:i.Id,Name:i.Name,Code:i.Code,SuppliersPermissionsDetails:i.SuppliersPermissionsDetails};for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++){this.SuppliersPermissions.SuppliersPermissionsDetails[e].Suppliers=[],this.SuppliersPermissions.SuppliersPermissionsDetails[e].Suppliers=[{Id:this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId,Name:this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierName}];let t=this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId;this._Apiservice.getById("SupplierEP/TotalSuppliersPermissions",t,!1).pipe(f(this._Apiservice.destroy$)).subscribe({next:r=>{r.IsSuccess==!0&&r.Obj!=null?this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions=r.Obj:this._AppModeService._Toastr.error(r.Message)}})}}OpenGl(){this.GLComponent.Open()}StartConnection(){this.Hub_Connection=new ge().withUrl(`${U.signalrUrl}/SuppliersPermissions`,{skipNegotiation:!0,transport:he.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(Se.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(i=>{console.log(i)})}GetPageInfo(){this._Apiservice.get("SuppliersPermissionsEP/GetPageInfo",!1).pipe(f(this._Apiservice.destroy$)).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?this.SuppliersPermissions.DocNo=i.Obj:this._AppModeService._Toastr.error(i.Message)}})}AppendRow(i){return this.Row={SupplierId:null,Amount:"",AmountPermissions:0,SupplierName:"",Suppliers:[],Code:"",Id:0,Name:""},this.SuppliersPermissions.SuppliersPermissionsDetails.push(this.Row),this.TotalSuppliersPermissions(),!0}RemoveRow(i){return this.SuppliersPermissions.SuppliersPermissionsDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.SuppliersPermissions.SuppliersPermissionsDetails.splice(i,1),this.TotalSuppliersPermissions(),!0)}TotalSuppliersPermissions(){let i=0;for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++)i+=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].Amount);return Number(i.toFixed(2))}ChangeSearchApiDetails(i,e,t){let r=`${e.searchTerm}`.trim();(r==""||r=="null")&&(e.searchTerm="",r=""),this._AppModeService.CurrentPage+=1;let l={TableName:i,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:r,SearchField:"Name"};this._Apiservice.post("Global/GetAll",l,!1).pipe(f(this._Apiservice.destroy$)).subscribe({next:P=>{P.IsSuccess==!0&&P.Obj!=null?this.HandleResponseDetails(P.Obj,i,t):this._AppModeService._Toastr.error(P.Message)}})}HandleResponseDetails(i,e,t){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=i.TotalItems,e=="Suppliers"&&(this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers=this._SharedObjectModelService.RemoveDuplicates(this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers.concat(i.DataReturn),"Id"))}SelectValueDetails(i,e,t){if(i!=null&&i>0){let r=[];e=="Supplier"&&(r=this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers);let l=r.find(P=>P.Id==i);if(l!=null)this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Id`]=l.Id,this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Name`]=l.Name,this.TotalPermissions(l.Id,t);else{this._Apiservice.DontPlay();return}}else this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Id`]=null,this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Name`]=[]}TotalPermissions(i,e){this._Apiservice.getById("SupplierEP/TotalSuppliersPermissions",i,!1).pipe(f(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions=t.Obj:this._AppModeService._Toastr.error(t.Message)}})}ChangeAmount(i,e){}Save(){if(this.SuppliersPermissions.DocDate==""||this.SuppliersPermissions.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++){let t=e,r=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId),l=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].Amount),P=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions);if(r>0){if(l<=0||isNaN(l)||l==null||l==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("MoneyIn.Error.EnterAmount"));return}if(this.SuppliersPermissions.SuppliersPermissionsDetails.filter(Pe=>Pe.SupplierId==r).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(t+1));return}}}let i={DocNo:this.SuppliersPermissions.DocNo,DocDate:this._Apiservice.ConvertISODate(this.SuppliersPermissions.DocDate),SuppliersPermissionsDetails:this.SuppliersPermissions.SuppliersPermissionsDetails,Id:this.SuppliersPermissions.Id,Name:"",Code:""};i.Id==0&&this._Apiservice.post("SuppliersPermissionsEP/Add",i,!0).pipe(f(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this.DynamicComponent.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}}),i.Id>0&&this._Apiservice.put("SuppliersPermissionsEP/Update",i,!0).pipe(f(this._Apiservice.destroy$)).subscribe({next:e=>{if(e.IsSuccess==!0&&e.Obj!=null){this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo();let t=e.Obj,r=this.DynamicComponent.Paging.DataReturn.find(l=>l.Id==t.Id);r!=null&&Object.assign(r,t)}else this._AppModeService._Toastr.error(e.Message)}})}ResetPage(){this.SuppliersPermissions={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SuppliersPermissionsDetails:[{Amount:"",SupplierId:null,SupplierName:"",Id:0,Code:"",Name:"",Suppliers:[],AmountPermissions:0}]},this._DefaultSettingsService.ResetDate(this.SuppliersPermissions)}ServerListener(){this.Hub_Connection?.on("AddSuppliersPermissions",i=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==i.BranchId&&(this.SuppliersPermissions.DocNo=i.DocNo)})}trackByMethod(i,e){return e.Id}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};d.\u0275fac=function(e){return new(e||d)(D(H),D(ce),D(ie),D(_e),D(Q))},d.\u0275cmp=R({type:d,selectors:[["app-suppliers-permissions"]],viewQuery:function(e,t){if(e&1&&(E(fe,5),E(ve,5),E(De,5)),e&2){let r;V(r=O())&&(t.ContentModel=r.first),V(r=O())&&(t.GLComponent=r.first),V(r=O())&&(t.DynamicComponent=r.first)}},standalone:!0,features:[j],decls:6,vars:6,consts:[["dynamiccomponent",""],["content",""],["GLComponent",""],["ddddd",""],["SelectSuppliersDetails",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","GlResponse","GetById","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"col-12","d-flex","flex","flex-wrap","align-items-end","px-2"],[1,"col-12","col-sm-6","col-lg-2","col-xl-1","p-1"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"col-12","col-sm-6","col-lg-3","col-xl-2","p-1"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-12","col-sm-6","col-xl-3","p-1"],["class","d-block text-center",4,"ngIf"],["class","formdate",4,"ngIf"],[1,"DivPaging","table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-3","mb-0"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"SaveEvent","UpdateEvent","OpenGlEvent","CloseEvent","Id","Gl"],[1,"d-block","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"ngSelect",3,"title"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[3,"title"],["class","text-dark d-block text-center col-11 col-md-12",4,"ngIf"],["min","0","step","1","type","number","appNumericInput","",1,"form-control","shadow-none","text-center",3,"keyup","ngModelChange","disabled","ngModel","name","id"],["type","text",1,"form-control","shadow-none","text-center",3,"ngModelChange","disabled","ngModel","name","id"],[1,"form-text","text-muted"],[1,"text-dark","d-block","text-center","col-11","col-md-12"]],template:function(e,t){if(e&1){let r=T();p(0,"app-dynamic-component",5,0),b("OpenModalEvent",function(){return m(r),c(t.OpenModal())})("ShowToEditeEvent",function(P){return m(r),c(t.ShowToEdite(P))}),u(),I(2,we,31,25,"ng-template",null,1,F),N(4,"app-glsheard",null,2)}if(e&2){let r=A(3);_("PageTitle","SuppliersPermissions.SuppliersPermissions")("TablePaging",t.TablePaging)("GlResponse",!0)("GetById","SuppliersPermissionsEP/GetById")("DeleteUrl","SuppliersPermissionsEP/Delete")("OutModal",r)}},dependencies:[pe,oe,$,W,L,ee,Y,X,J,Z,K,z,q,ne,re,te,se,ue,de,le,ae,me]});let n=d;return n})();export{Ze as SuppliersPermissionsComponent};
