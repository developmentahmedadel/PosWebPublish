import{a as _e,b as me,c as he}from"./chunk-BZPR73YG.js";import{a as De}from"./chunk-X4NKGLB3.js";import{a as Ce}from"./chunk-3UDBFBON.js";import{b as pe,j as ue}from"./chunk-A6MDEMU4.js";import"./chunk-3ZAIJ4IV.js";import"./chunk-Y5QDR55A.js";import{a as de}from"./chunk-VSYXDL23.js";import"./chunk-BHSN7HFD.js";import{a as le,b as re}from"./chunk-6BJKXUWP.js";import"./chunk-3Y7UQ2M3.js";import{a as ce}from"./chunk-BHTRH7BV.js";import"./chunk-VUX2NRX2.js";import"./chunk-RXBBGPQB.js";import"./chunk-GEJP5WQO.js";import"./chunk-GNF256I6.js";import{a as ne,b as oe,c as se,d as ae}from"./chunk-MZIKAFPE.js";import"./chunk-EGE4BGUH.js";import"./chunk-RVJIMCIT.js";import{c as ie}from"./chunk-ITQ57RKD.js";import{c as z,d as Y}from"./chunk-KALZ37GW.js";import{b as Q,c as q,f as J,h as K,k as X,m as Z,s as ee,u as te}from"./chunk-N4FWSTCP.js";import{c as W,d as $,e as H,j as U}from"./chunk-VTADEU6K.js";import{$b as y,Cb as l,Db as r,Eb as A,Ib as v,Mb as S,Nb as c,Qb as b,Rb as N,Tb as O,Ub as k,Vb as R,Wb as E,X as I,Xb as h,Yb as V,Zb as g,_b as B,ac as T,bc as w,db as a,dc as j,eb as M,gc as G,na as P,nc as D,oc as C,pc as F,qc as L,vb as f,xa as d,xb as m,ya as u}from"./chunk-J5UB44FZ.js";import"./chunk-3EYC4JTX.js";var Se=["GLComponent"],fe=(s,p)=>({"btn-Add":s,"btn-Refresh":p});function xe(s,p){if(s&1&&(l(0,"span",28),h(1),D(2,"date"),r()),s&2){let n=c(2);a(),g(" ",F(2,1,n.CashDiscount.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Ie(s,p){if(s&1){let n=v();l(0,"div",29,2)(2,"p-calendar",30),w("ngModelChange",function(e){d(n);let i=c(2);return T(i.CashDiscount.DocDate,e)||(i.CashDiscount.DocDate=e),u(e)}),r()()}if(s&2){let n=c(2);a(2),y("ngModel",n.CashDiscount.DocDate),m("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function ve(s,p){if(s&1&&(l(0,"small",43),h(1),r()),s&2){let n=c().$implicit,t=c(2);a(),B("Loaded ",n.Clients.length," of ",t._SharedObjectModelService.TotalItems,"")}}function be(s,p){if(s&1&&h(0),s&2){let n=p.item;g(" ",n.Name," ")}}function ye(s,p){if(s&1&&(l(0,"span",44),h(1),r()),s&2){let n=c().$implicit;a(),g(" ",n.AmountDebts," ")}}function Te(s,p){if(s&1){let n=v();l(0,"tr")(1,"td",31)(2,"div",32)(3,"button",33),S("click",function(){d(n);let e=c(2);return u(e.AppendRow())}),h(4,"+"),r(),l(5,"button",34),S("click",function(){let e=d(n).index,i=c(2);return u(i.RemoveRow(e))}),h(6,"-"),r()()(),l(7,"td",35),D(8,"translate"),l(9,"ng-select",36,3),S("clear",function(){let e=d(n).$implicit;return u(e.Clients=[])})("focus",function(){let e=d(n).index,i=E(10),o=c(2);return o.ChangeSearchApiDetails("Clients",i,e),u(o._AppModeService.ResetCurrentPage())})("keyup",function(){let e=d(n).index,i=E(10),o=c(2);return o.ChangeSearchApiDetails("Clients",i,e),u(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=d(n).index,i=E(10),o=c(2);return u(o.ChangeSearchApiDetails("Clients",i,e))})("close",function(){d(n);let e=c(2);return u(e._AppModeService.ResetCurrentPage())})("open",function(){d(n);let e=c(2);return u(e._AppModeService.ResetCurrentPage())})("change",function(){let e=d(n),i=e.$implicit,o=e.index,_=c(2);return u(_.SelectValueDetails(i.ClientId,"Client",o))}),w("ngModelChange",function(e){let i=d(n).$implicit;return T(i.ClientId,e)||(i.ClientId=e),u(e)}),f(11,ve,2,2,"ng-template",37)(12,be,1,1,"ng-template",38),r()(),l(13,"td",39),D(14,"translate"),f(15,ye,2,1,"span",40),r(),l(16,"td",39),D(17,"translate"),l(18,"input",41),S("keyup",function(){let e=d(n),i=e.$implicit,o=e.index,_=c(2);return _.TotalCashDiscount(),u(_.ChangeAmount(i.ClientId,o))}),w("ngModelChange",function(e){let i=d(n).$implicit;return T(i.Amount,e)||(i.Amount=e),u(e)}),r()(),l(19,"td",39),D(20,"translate"),l(21,"input",42),w("ngModelChange",function(e){let i=d(n).$implicit;return T(i.Notes,e)||(i.Notes=e),u(e)}),r()()()}if(s&2){let n=p.$implicit,t=p.index,e=c(2);a(),b("title",t+1),a(4),m("disabled",e.CashDiscount.SalesDisountDetails.length==1),a(2),b("title",C(8,25,"TransferStorage.Name")),a(2),m("items",n.Clients)("autofocus",!1)("dropdownPosition",e._AppModeService.DropdownPosition(t))("virtualScroll",!0)("searchable",!0),y("ngModel",n.ClientId),a(4),b("title",C(14,27,"MoneyIn.Debt")),a(2),m("ngIf",n.ClientId>0),a(),b("title",C(17,29,"MoneyIn.Price")),a(2),N("name","Amount",t,""),N("id","Amount",t,""),m("disabled",n.ClientId==0||n.ClientId==null),y("ngModel",n.Amount),a(),b("title",C(20,31,"MoneyIn.Notes")),a(2),N("name","Notes",t,""),N("id","Notes",t,""),m("disabled",n.ClientId==0||n.ClientId==null),y("ngModel",n.Notes)}}function we(s,p){s&1&&(l(0,"span"),h(1),D(2,"translate"),r()),s&2&&(a(),g(" ",C(2,1,"Model.Save"),""))}function Me(s,p){s&1&&(l(0,"span"),h(1),D(2,"translate"),r()),s&2&&(a(),g(" ",C(2,1,"Model.Update"),""))}function Ae(s,p){if(s&1){let n=v();l(0,"button",45),S("click",function(){d(n);let e=c(2);return u(e.OpenGl())}),h(1),D(2,"translate"),r()}s&2&&(a(),g(" ",C(2,1,"Model.Gl")," "))}function Ne(s,p){if(s&1){let n=v();A(0,"app-modal-header",5),l(1,"div",6)(2,"div",7)(3,"div",8),A(4,"input",9),r(),l(5,"div",10)(6,"label",11),h(7),D(8,"translate"),r(),l(9,"input",12),w("ngModelChange",function(e){d(n);let i=c();return T(i.CashDiscount.Notes,e)||(i.CashDiscount.Notes=e),u(e)}),r()(),l(10,"div",13),f(11,xe,3,4,"span",14)(12,Ie,3,5,"div",15),r()(),l(13,"div",16)(14,"table",17)(15,"thead")(16,"th",18),h(17,"#"),r(),l(18,"th",19),h(19),D(20,"translate"),r(),l(21,"th",19),h(22),D(23,"translate"),r(),l(24,"th",19),h(25),D(26,"translate"),r(),l(27,"th",20),h(28),D(29,"translate"),r()(),l(30,"tbody"),f(31,Te,22,33,"tr",21),r()()()(),l(32,"div",22)(33,"button",23),S("click",function(){d(n);let e=c();return u(e.Save())}),f(34,we,3,3,"span",24)(35,Me,3,3,"span",24),A(36,"i",25),r(),f(37,Ae,3,3,"button",26),l(38,"button",27),S("click",function(){let e=d(n).$implicit,i=c();return e.close("Close click"),u(i.ResetPage())}),h(39),D(40,"translate"),r()()}if(s&2){let n=c();m("PageTitle","CashDisount.CashDisount"),a(4),m("disabled",!0)("value",n.CashDiscount.DocNo),a(3),V(C(8,18,"Table.Notes")),a(2),y("ngModel",n.CashDiscount.Notes),a(2),m("ngIf",(n._DefaultSettingsService.DefaultSettings==null?null:n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),a(),m("ngIf",(n._DefaultSettingsService.DefaultSettings==null?null:n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),a(7),g(" ",C(20,20,"SaleInvoice.Client")," "),a(3),g(" ",C(23,22,"MoneyIn.Debt")," "),a(3),g(" ",C(26,24,"MoneyIn.Price")," "),a(3),g(" ",C(29,26,"MoneyIn.Notes")," "),a(3),m("ngForOf",n.CashDiscount.SalesDisountDetails)("ngForTrackBy",n.trackByMethod),a(2),m("ngClass",G(30,fe,n.CashDiscount.Id==0,n.CashDiscount.Id!=0)),a(),m("ngIf",n.CashDiscount.Id==0),a(),m("ngIf",n.CashDiscount.Id!=0),a(2),m("ngIf",n.CashDiscount.Id>0),a(2),V(C(40,28,"Model.Close"))}}var Ze=(()=>{let p=class p{constructor(t,e,i,o){this._SharedObjectModelService=t,this._AppModeService=e,this._DefaultSettingsService=i,this._Apiservice=o,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"SalesDisount",Columns:["Id","DocNo","DocDate","Notes"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"}]},this.CashDiscount={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SalesDisountDetails:[{Amount:"",ClientId:null,ClientName:"",Id:0,Code:"",Name:"",Clients:[],AmountDebts:0}]}}ngOnInit(){this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}OpenModal(){this.ResetPage(),this.GetPageInfo()}OpenGl(){this.GLComponent.Open()}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){this.CashDiscount={DocDate:new Date(t.DocDate),DocNo:t.DocNo,Id:t.Id,Name:t.Name,Code:t.Code,SalesDisountDetails:t.SalesDisountDetails};for(let e=0;e<this.CashDiscount.SalesDisountDetails.length;e++){this.CashDiscount.SalesDisountDetails[e].Clients=[],this.CashDiscount.SalesDisountDetails[e].Clients=[{Id:this.CashDiscount.SalesDisountDetails[e].ClientId,Name:this.CashDiscount.SalesDisountDetails[e].ClientName}];let i=this.CashDiscount.SalesDisountDetails[e].ClientId;this._Apiservice.getById("ClientEP/TotalBadDepts",i,!1).pipe(I(this._Apiservice.destroy$)).subscribe({next:o=>{o.IsSuccess==!0&&o.Obj!=null?this.CashDiscount.SalesDisountDetails[e].AmountDebts=o.Obj:this._AppModeService._Toastr.error(o.Message)},error:o=>{this._AppModeService._Toastr.error(o)}})}}StartConnection(){this.Hub_Connection=new he().withUrl(`${Q.signalrUrl}/SalesDisount`,{skipNegotiation:!0,transport:me.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(_e.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(t=>{console.log(t)})}GetPageInfo(){this._Apiservice.get("SalesDisountEP/GetPageInfo",!1).pipe(I(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?this.CashDiscount.DocNo=t.Obj:this._AppModeService._Toastr.error(t.Message)}})}ChangeSearchApiDetails(t,e,i){let o=`${e.searchTerm}`.trim();(o==""||o=="null")&&(e.searchTerm="",o=""),this._AppModeService.CurrentPage+=1;let _={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:o,SearchField:"Name"};this._Apiservice.post("Global/GetAll",_,!1).pipe(I(this._Apiservice.destroy$)).subscribe({next:x=>{x.IsSuccess==!0&&x.Obj!=null?this.HandleResponseDetails(x.Obj,t,i):this._AppModeService._Toastr.error(x.Message)}})}HandleResponseDetails(t,e,i){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Clients"&&(this.CashDiscount.SalesDisountDetails[i].Clients=this._SharedObjectModelService.RemoveDuplicates(this.CashDiscount.SalesDisountDetails[i].Clients.concat(t.DataReturn),"Id"))}SelectValueDetails(t,e,i){if(t!=null&&t>0){let o=[];e=="Client"&&(o=this.CashDiscount.SalesDisountDetails[i].Clients);let _=o.find(x=>x.Id==t);if(_!=null)this.CashDiscount.SalesDisountDetails[i][`${e}Id`]=_.Id,this.CashDiscount.SalesDisountDetails[i][`${e}Name`]=_.Name,this.TotalDept(_.Id,i);else{this._Apiservice.DontPlay();return}}else this.CashDiscount.SalesDisountDetails[i][`${e}Id`]=null,this.CashDiscount.SalesDisountDetails[i][`${e}Name`]=[]}TotalDept(t,e){this._Apiservice.getById("ClientEP/TotalBadDepts",t,!1).pipe(I(this._Apiservice.destroy$)).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?this.CashDiscount.SalesDisountDetails[e].AmountDebts=i.Obj:this._AppModeService._Toastr.error(i.Message)}})}AppendRow(){return this.Row={ClientId:null,Amount:"",AmountDebts:0,ClientName:"",Clients:[],Code:"",Id:0,Name:""},this.CashDiscount.SalesDisountDetails.push(this.Row),this.TotalCashDiscount(),!0}RemoveRow(t){return this.CashDiscount.SalesDisountDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.CashDiscount.SalesDisountDetails.splice(t,1),this.TotalCashDiscount(),!0)}TotalCashDiscount(){let t=0;for(let e=0;e<this.CashDiscount.SalesDisountDetails.length;e++)t+=Number(this.CashDiscount.SalesDisountDetails[e].Amount);return Number(t.toFixed(2))}ChangeAmount(t,e){}Save(){if(this.CashDiscount.DocDate==""||this.CashDiscount.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}for(let e=0;e<this.CashDiscount.SalesDisountDetails.length;e++){let i=e,o=Number(this.CashDiscount.SalesDisountDetails[e].ClientId),_=Number(this.CashDiscount.SalesDisountDetails[e].Amount),x=Number(this.CashDiscount.SalesDisountDetails[e].AmountDebts);if(o>0){if(_<=0||isNaN(_)||_==null||_==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("MoneyIn.Error.EnterAmount"));return}if(this.CashDiscount.SalesDisountDetails.filter(ge=>ge.ClientId==o).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(i+1));return}}}let t={DocNo:this.CashDiscount.DocNo,DocDate:this._Apiservice.ConvertISODate(this.CashDiscount.DocDate),SalesDisountDetails:this.CashDiscount.SalesDisountDetails,Id:this.CashDiscount.Id,Name:"",Code:""};t.Id==0&&this._Apiservice.post("SalesDisountEP/Add",t,!0).pipe(I(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}}),t.Id>0&&this._Apiservice.put("SalesDisountEP/Update",t,!0).pipe(I(this._Apiservice.destroy$)).subscribe({next:e=>{if(e.IsSuccess==!0&&e.Obj!=null){this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo();let i=e.Obj,o=this._SharedObjectModelService.Paging.DataReturn.find(_=>_.Id==i.Id);o!=null&&Object.assign(o,i)}else this._AppModeService._Toastr.error(e.Message)}})}ResetPage(){this.CashDiscount={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SalesDisountDetails:[{Amount:"",ClientId:null,ClientName:"",Id:0,Code:"",Name:"",Clients:[],AmountDebts:0}]},this._DefaultSettingsService.ResetDate(this.CashDiscount)}ServerListener(){this.Hub_Connection?.on("AddSalesDisount",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&(this.CashDiscount.DocNo=t.DocNo)})}trackByMethod(t,e){return e.Id}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};p.\u0275fac=function(e){return new(e||p)(M(ce),M(ie),M(Ce),M(q))},p.\u0275cmp=P({type:p,selectors:[["app-cash-discount"]],viewQuery:function(e,i){if(e&1&&O(Se,5),e&2){let o;k(o=R())&&(i.GLComponent=o.first)}},standalone:!0,features:[j],decls:5,vars:6,consts:[["content",""],["GLComponent",""],["ddddd",""],["SelectClientssDetails",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","GlResponse","GetById","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"col-12","d-flex","flex","flex-wrap","align-items-end","px-2"],[1,"col-12","col-sm-6","col-lg-2","col-xl-1","p-1"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"col-12","col-sm-6","col-lg-3","col-xl-2","p-1"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-12","col-sm-6","col-xl-3","p-1"],["class","d-block text-center",4,"ngIf"],["class","formdate",4,"ngIf"],[1,"DivPaging","table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-3","mb-0"],[1,"col-1"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn",3,"click","ngClass"],[4,"ngIf"],[1,"mx-1","pi","pi-save"],["class","btn btn-Add",3,"click",4,"ngIf"],["type","button",1,"btn","btn-light","btn-Close","border","border-1","border-dark",3,"click"],[1,"d-block","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"Flex1",3,"title"],[1,"d-flex","justify-content-center","align-items-center","col-11","col-md-12"],[1,"col-2","col-md-5","py-3","py-md-1","text-center","mx-auto","btn","btn-success",3,"click"],[1,"col-2","col-md-5","py-3","py-md-1","text-center","mx-auto","btn","btn-danger",3,"click","disabled"],[1,"ngSelect",3,"title"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[3,"title"],["class","text-dark d-block text-center col-11 col-md-12",4,"ngIf"],["min","0","step","1","type","number","appNumericInput","",1,"form-control","shadow-none","text-center",3,"keyup","ngModelChange","disabled","ngModel","name","id"],["type","text",1,"form-control","shadow-none","text-center",3,"ngModelChange","disabled","ngModel","name","id"],[1,"form-text","text-muted"],[1,"text-dark","d-block","text-center","col-11","col-md-12"],[1,"btn","btn-Add",3,"click"]],template:function(e,i){if(e&1){let o=v();l(0,"app-dynamic-component",4),S("OpenModalEvent",function(){return d(o),u(i.OpenModal())})("ShowToEditeEvent",function(){return d(o),u(i.ShowToEdite())}),r(),f(1,Ne,41,33,"ng-template",null,0,L),A(3,"app-glsheard",null,1)}if(e&2){let o=E(2);m("PageTitle","CashDisount.CashDisount")("TablePaging",i.TablePaging)("GlResponse",!0)("GetById","SalesDisountEP/GetById")("DeleteUrl","SalesDisountEP/Delete")("OutModal",o)}},dependencies:[re,le,U,H,$,W,te,J,Z,K,ee,X,Y,z,ae,se,ne,oe,ue,De,pe,de]});let s=p;return s})();export{Ze as CashDiscountComponent};
