import{a as ue,b as Se}from"./chunk-6T4APQIW.js";import{a as ge}from"./chunk-EHX2YHES.js";import{c as _e,j as de}from"./chunk-HX5JBV6V.js";import"./chunk-QI74C7BQ.js";import"./chunk-PWIKXZ6E.js";import{g as oe,h as ae,j as ce,n as se,s as pe}from"./chunk-S52O5BXQ.js";import{b as le}from"./chunk-KOJPIKRQ.js";import{h as re}from"./chunk-WL6N6SLT.js";import{a as me}from"./chunk-HOAF6CDP.js";import"./chunk-34JSETBR.js";import"./chunk-QFTVA365.js";import"./chunk-LNYZIAUP.js";import{k as ie}from"./chunk-HYE6JRVA.js";import{a as q,b as X,c as Y,d as Z}from"./chunk-DVVEKPVL.js";import{b as ne}from"./chunk-JCTIHYFX.js";import{b as U,c as L,f as H,h as $,k as z,m as K,s as J,u as Q}from"./chunk-M24M3PNC.js";import{c as ee,d as te}from"./chunk-4L6P5Z5M.js";import{e as W,j as F}from"./chunk-JM67XKKX.js";import{$b as w,Bb as a,Cb as r,Db as P,Hb as T,Lb as I,Mb as c,Vb as f,Wb as s,Xb as g,Yb as h,Zb as A,_b as b,ac as M,cb as l,cc as k,db as N,dc as D,mc as u,na as R,nc as v,oc as G,pc as j,ub as C,wb as S,xa as p,ya as m,z as O}from"./chunk-VIO7ZK3G.js";import{a as V,b as B}from"./chunk-3EYC4JTX.js";var Ie=()=>({"min-width":"50rem"}),he=()=>["Name","TotalQty","Wa","TotaPrice"];function ye(o,d){if(o&1&&(a(0,"small",36),s(1),r()),o&2){let t=c(2);l(),A("Loaded ",t.Storages.length," of ",t._SharedObjectModelService.TotalItems,"")}}function xe(o,d){if(o&1&&s(0),o&2){let t=d.item;h(" ",t.Name," ")}}function fe(o,d){if(o&1&&(a(0,"small",36),s(1),r()),o&2){let t=c(2);l(),A("Loaded ",t.Groups.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ce(o,d){if(o&1&&s(0),o&2){let t=d.item;h(" ",t.Name," ")}}function Te(o,d){if(o&1&&(a(0,"small",36),s(1),r()),o&2){let t=c(2);l(),A("Loaded ",t.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function be(o,d){if(o&1&&s(0),o&2){let t=d.item;h(" ",t.NameAndCode," ")}}function we(o,d){if(o&1){let t=T();a(0,"div",37)(1,"p-button",38),I("onClick",function(){p(t);let e=c(2);return m(e.ExpandAll())}),r(),a(2,"p-button",39),I("onClick",function(){p(t);let e=c(2);return m(e.CollapseAll())}),r()()}}function Me(o,d){o&1&&(a(0,"tr")(1,"th"),s(2),u(3,"translate"),r(),a(4,"th"),s(5),u(6,"translate"),r(),a(7,"th"),s(8),u(9,"translate"),r(),a(10,"th"),s(11),u(12,"translate"),r(),a(13,"th"),s(14),u(15,"translate"),r(),a(16,"th"),s(17),u(18,"translate"),r(),a(19,"th"),s(20),u(21,"translate"),r(),a(22,"th"),s(23,"-"),r()()),o&2&&(l(2),g(v(3,7,"Table.Units")),l(3),g(v(6,9,"Table.Name")),l(3),g(v(9,11,"Table.BalanceDaftare")),l(3),g(v(12,13,"Table.BalanceNow")),l(3),g(v(15,15,"Table.WA")),l(3),g(v(18,17,"Table.Amount")),l(3),g(v(21,19,"Table.Status")))}function Ne(o,d){o&1&&(a(0,"p",49),s(1," \u0645\u062A\u0633\u0627\u0648\u064A "),r())}function Pe(o,d){o&1&&(a(0,"p",50),s(1," \u0639\u062C\u0632 "),r())}function Ae(o,d){o&1&&(a(0,"p",51),s(1," \u0641\u0627\u0626\u0636 "),r())}function De(o,d){if(o&1){let t=T();a(0,"div",52)(1,"button",53),I("click",function(){p(t);let e=c().$implicit,n=c(2);return e.InventoryType=1,m(n.Calc())}),s(2," \u0637\u0628\u064A\u0639\u064A "),r(),a(3,"button",54),I("click",function(){p(t);let e=c().$implicit,n=c(2);return e.InventoryType=2,m(n.Calc())}),s(4," \u063A\u064A\u0631 \u0637\u0628\u064A\u0639\u064A "),r()()}if(o&2){let t=c().$implicit;l(),S("disabled",t.InventoryType==1),l(2),S("disabled",t.InventoryType==2)}}function Ee(o,d){if(o&1){let t=T();a(0,"tr")(1,"td"),P(2,"p-button",40),r(),a(3,"td")(4,"span",41),s(5),r()(),a(6,"td")(7,"span",41),s(8),r()(),a(9,"td")(10,"input",42),I("keyup",function(){p(t);let e=c(2);return m(e.Calc())})("change",function(){p(t);let e=c(2);return m(e.Calc())})("change",function(){let e=p(t).$implicit,n=c(2);return m(n.ConvertNumber(e.BalanceNow)==e.BalanceDocument?e.InventoryType=0:e.InventoryType=e.InventoryType)}),M("ngModelChange",function(e){let n=p(t).$implicit;return w(n.BalanceNow,e)||(n.BalanceNow=e),m(e)}),r()(),a(11,"td")(12,"span",41),s(13),r()(),a(14,"td")(15,"span",41),s(16),r()(),a(17,"td",43),C(18,Ne,2,0,"p",44)(19,Pe,2,0,"p",45)(20,Ae,2,0,"p",46)(21,De,5,2,"div",47),r(),a(22,"td")(23,"p-button",48),I("click",function(){let e=p(t).$implicit,n=c(2);return m(n.RemoveProcut(e))}),r()()()}if(o&2){let t=d.$implicit,i=d.expanded,e=c(2);l(2),S("pRowToggler",t)("text",!0)("rounded",!0)("plain",!0)("icon",i?"pi pi-chevron-down":e._Apiservice.Language=="ar"?"pi pi-chevron-left":"pi pi-chevron-right"),l(3),h(" ",t.ProductName,""),l(3),h(" ",t.BalanceDocument," "),l(2),b("ngModel",t.BalanceNow),l(3),h(" ",t.WADocument," "),l(3),h(" ",t.TotaPriceDocument," "),l(2),S("ngIf",e.ConvertNumber(t.BalanceNow)==t.BalanceDocument),l(),S("ngIf",e.ConvertNumber(t.BalanceNow)<t.BalanceDocument),l(),S("ngIf",e.ConvertNumber(t.BalanceNow)>t.BalanceDocument),l(),S("ngIf",e.ConvertNumber(t.BalanceNow)<t.BalanceDocument),l(2),S("icon","pi pi-trash")}}function Ve(o,d){o&1&&(a(0,"tr")(1,"th"),s(2),u(3,"translate"),r(),a(4,"th"),s(5),u(6,"translate"),r()()),o&2&&(l(2),h("",v(3,2,"Table.Name")," "),l(3),g(v(6,4,"Table.Quantity")))}function Be(o,d){if(o&1&&(a(0,"tr")(1,"td")(2,"span",41),s(3),r()(),a(4,"td")(5,"span",41),s(6),r()()()),o&2){let t=d.$implicit;l(3),h(" ",t.UnitName," "),l(3),h(" ",t.Qty," ")}}function Oe(o,d){if(o&1&&(a(0,"tr")(1,"td",55)(2,"p-table",56),C(3,Ve,7,6,"ng-template",28)(4,Be,7,2,"ng-template",29),r()()()),o&2){let t=d.$implicit;l(2),S("value",t.ItemUnits)}}function Re(o,d){if(o&1){let t=T();a(0,"p-paginator",57),I("onPageChange",function(e){p(t);let n=c(2);return m(n.onPageChange(e))}),r()}if(o&2){let t=c(2);S("first",t._SharedObjectModelService.Paging.CurrentPage)("rows",t._SharedObjectModelService.Paging.PageSize)("totalRecords",t._SharedObjectModelService.Paging.TotalItems)("rowsPerPageOptions",t._AppModeService.RowCount)}}function ke(o,d){if(o&1){let t=T();a(0,"p-paginator",58),I("onPageChange",function(e){p(t);let n=c(2);return m(n.onPageChange(e))}),r()}if(o&2){let t=c(2);S("first",t._SharedObjectModelService.Paging.CurrentPage)("rows",t._SharedObjectModelService.Paging.PageSize)("totalRecords",t._SharedObjectModelService.Paging.TotalItems)}}function Ge(o,d){if(o&1){let t=T();P(0,"app-modal-header",6),a(1,"div",7)(2,"div",8)(3,"div",9)(4,"label",10),s(5),u(6,"translate"),r(),P(7,"input",11),r(),a(8,"div",9)(9,"label",12),s(10),u(11,"translate"),r(),a(12,"input",13),M("ngModelChange",function(e){p(t);let n=c();return w(n.Inventory.Notes,e)||(n.Inventory.Notes=e),m(e)}),r()(),a(13,"div",9)(14,"span",14),s(15),u(16,"date"),r()(),a(17,"div",9)(18,"p",15),s(19),u(20,"translate"),r(),a(21,"ng-select",16,1),I("clear",function(){p(t);let e=c();return m(e.Storages=[])})("focus",function(){p(t);let e=f(22),n=c();return n.ChangeSearchApi("Storages",e),m(n._AppModeService.ResetCurrentPage())})("keyup",function(){p(t);let e=f(22),n=c();return n.ChangeSearchApi("Storages",e),m(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(t);let e=f(22),n=c();return m(n.ChangeSearchApi("Storages",e))})("close",function(){p(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(t);let e=c();return e.SelectValue(e.SearchModel.StoreId,"Store"),m(e.ResetPage())}),M("ngModelChange",function(e){p(t);let n=c();return w(n.SearchModel.StoreId,e)||(n.SearchModel.StoreId=e),m(e)}),C(23,ye,2,2,"ng-template",17)(24,xe,1,1,"ng-template",18),r()(),a(25,"div",9)(26,"p",19),s(27),u(28,"translate"),r(),a(29,"ng-select",16,2),I("clear",function(){p(t);let e=c();return m(e.Groups=[])})("focus",function(){p(t);let e=f(30),n=c();return n.ChangeSearchApi("ItemGroups",e),m(n._AppModeService.ResetCurrentPage())})("keyup",function(){p(t);let e=f(30),n=c();return n.ChangeSearchApi("ItemGroups",e),m(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(t);let e=f(30),n=c();return m(n.ChangeSearchApi("ItemGroups",e))})("close",function(){p(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(t);let e=c();return e.SelectValue(e.SearchModel.GroupId,"Group"),e.SearchModel.ProductId=null,m(e.ResetPage())}),M("ngModelChange",function(e){p(t);let n=c();return w(n.SearchModel.GroupId,e)||(n.SearchModel.GroupId=e),m(e)}),C(31,fe,2,2,"ng-template",17)(32,Ce,1,1,"ng-template",18),r()(),a(33,"div",9)(34,"label",20),s(35),u(36,"translate"),r(),a(37,"ng-select",21,3),I("clear",function(){p(t);let e=c();return m(e.Items=[])})("focus",function(){p(t);let e=f(38),n=c();return n.ChangeSearchApi("Items",e),m(n._AppModeService.ResetCurrentPage())})("keyup",function(){p(t);let e=f(38),n=c();return n.ChangeSearchApi("Items",e),m(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(t);let e=f(38),n=c();return m(n.ChangeSearchApi("Items",e))})("close",function(){p(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(t);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(t);let e=c();return e.SelectValue(e.SearchModel.ProductId,"Product"),e.SearchModel.GroupId=null,m(e.ResetPage())}),M("ngModelChange",function(e){p(t);let n=c();return w(n.SearchModel.ProductId,e)||(n.SearchModel.ProductId=e),m(e)}),C(39,Te,2,2,"ng-template",17)(40,be,1,1,"ng-template",18),r()(),a(41,"div",22)(42,"button",23),I("click",function(){p(t);let e=c();return m(e.Search())}),s(43),u(44,"translate"),r()()(),a(45,"div",24)(46,"table",25)(47,"thead")(48,"tr")(49,"th"),s(50),u(51,"translate"),r(),a(52,"th"),s(53),u(54,"translate"),r(),a(55,"th"),s(56),u(57,"translate"),r()()(),a(58,"tbody")(59,"tr")(60,"td"),s(61),r(),a(62,"td"),s(63),r(),a(64,"td"),s(65),r()()()()(),a(66,"div",24)(67,"p-table",26,4),C(69,we,3,0,"ng-template",27)(70,Me,24,21,"ng-template",28)(71,Ee,24,15,"ng-template",29)(72,Oe,5,1,"ng-template",30),r(),C(73,Re,1,4,"p-paginator",31)(74,ke,1,3,"p-paginator",32),r()(),a(75,"div",33)(76,"button",34),I("click",function(){p(t);let e=c();return m(e.Save())}),a(77,"span"),s(78),u(79,"translate"),r()(),a(80,"button",35),I("click",function(){let e=p(t).$implicit,n=c();return e.close("Close click"),m(n.ResetPage())}),s(81),u(82,"translate"),r()()}if(o&2){let t=c();S("PageTitle","InventorySettlement.InventorySettlement"),l(5),g(v(6,42,"Table.DocNo")),l(2),S("disabled",!0)("value",t.SearchModel.DocNo),l(3),g(v(11,44,"Table.Notes")),l(2),b("ngModel",t.Inventory.Notes),l(3),h(" ",G(16,46,t.Inventory.DocDate,"d-M-yyyy h:mm:ss a")," "),l(4),g(v(20,49,"SaleInvoice.Storage")),l(2),S("items",t.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",t.SearchModel.StoreId),l(6),g(v(28,51,"Item.ItemGroup")),l(2),S("items",t.Groups)("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",t.SearchModel.GroupId),l(6),h(" ",v(36,53,"BalanceStorage.ItemId"),""),l(2),S("items",t.Items)("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",t.SearchModel.ProductId),l(6),g(v(44,55,"Model.Search")),l(7),g(v(51,57,"InventorySettlement.TotalNormal")),l(3),g(v(54,59,"InventorySettlement.TotalUnNormal")),l(3),g(v(57,61,"InventorySettlement.TotalOver")),l(5),g(t.Inventory.TotalNormal),l(2),g(t.Inventory.TotalUnNormal),l(2),g(t.Inventory.TotalOver),l(2),S("expandedRowKeys",t.expandedRows)("value",t.Inventory.InventorySettlementDetails)("paginator",!1)("rows",10)("tableStyle",D(67,Ie))("globalFilterFields",D(68,he)),l(6),S("ngIf",t._SharedObjectModelService.Paging.TotalItems>=10),l(),S("ngIf",t._SharedObjectModelService.Paging.TotalItems<10),l(4),h(" ",v(79,63,"Model.Save"),""),l(3),g(v(82,65,"Model.Close"))}}var st=(()=>{let d=class d{constructor(i,e,n,_){this._SharedObjectModelService=i,this._AppModeService=e,this._DefaultSettingsService=n,this._Apiservice=_,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"InventorySettlement",Join:!0,JoinTables:["Storages SF"],JoinConditions:["T.StoreId = SF.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","SF.Name AS StoreName"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"},{SortName:"StoreName",CellName:"SaleInvoice.Storage",ExistSearchField:"SF.Name"}]},this.SubscriptionArr=[],this.Inventory={InventorySettlementDetails:[],Id:0,Name:"",Code:"",DocDate:"",DocNo:0,StoreId:0,StoreName:"",TotalNormal:0,TotalUnNormal:0,TotalOver:0},this.Items=[],this.Groups=[],this.Storages=[],this.SearchModel={GroupId:null,StoreId:null,ProductId:null},this.expandedRows={}}ngOnInit(){}OpenModal(){this.GetPageInfo(),this.SearchModel={GroupId:null,StoreId:null,ProductId:null},this.ResetPage()}GetPageInfo(){let i=this._Apiservice.get("StorageSettlementEP/GetPageInfo",!1).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?this.SearchModel.DocNo=e.Obj:this._AppModeService._Toastr.error(e.Message)}});this.SubscriptionArr.push(i)}ShowToEdite(){}ChangeSearchApi(i,e){let n=`${e.searchTerm}`.trim();(n==""||n=="null")&&(e.searchTerm="",n=""),this._AppModeService.CurrentPage+=1;let _={TableName:i,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:n,SearchField:"Name"};i=="Storage"&&(_.BranchFilter=!0),i=="Items"&&(_.Columns=["Id","Name","Code"],_.Conditions="ProductType != 2");let y=this._Apiservice.post("Global/GetAll",_,!1).subscribe({next:x=>{x.IsSuccess==!0&&x.Obj!=null?this.HandleResponse(x.Obj,i):this._AppModeService._Toastr.error(x.Message)}});this.SubscriptionArr.push(y)}HandleResponse(i,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=i.TotalItems,e=="Storages"&&(this.Storages=this._SharedObjectModelService.RemoveDuplicates(this.Storages.concat(i.DataReturn),"Id")),e=="ItemGroups"&&(this.Groups=this._SharedObjectModelService.RemoveDuplicates(this.Groups.concat(i.DataReturn),"Id")),e=="Items"&&(this.Items=this._SharedObjectModelService.RemoveDuplicates(this.Items.concat(i.DataReturn),"Id"),this.Items=this.Items.map(n=>B(V({},n),{NameAndCode:`${n.Name} - ${n.Code}`})))}SelectValue(i,e){if(i!=null&&(i>0||i!="")){let n=[];e=="Store"&&(n=this.Storages),e=="Group"&&(n=this.Groups),e=="Product"&&(n=this.Items);let _=n.find(y=>y.Id==i);if(_==null){this._AppModeService.DontPlay();return}else this.SearchModel[`${e}Id`]=i,this.SearchModel[`${e}Name`]=_.Name}else this.SearchModel[`${e}Id`]=null,this.SearchModel[`${e}Name`]=""}Search(){if(this.SearchModel.StoreId==0||this.SearchModel.StoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyOffer.Error.EnterStore"));return}let i={ProductId:this.SearchModel.ProductId,StoreId:this.SearchModel.StoreId,GroupId:this.SearchModel.GroupId,CurrentPage:1,PageSize:this._SharedObjectModelService.Paging.PageSize},e=this._Apiservice.post("StorageSettlementEP/GetItems",i,!0).subscribe({next:n=>{n.IsSuccess==!0&&n.Obj!=null?(this.Inventory.InventorySettlementDetails=this._SharedObjectModelService.RemoveDuplicates(this.Inventory.InventorySettlementDetails.concat(n.Obj.List),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=n.Obj.TotalItems,this.Inventory.TotalNormal=0,this.Inventory.TotalUnNormal=0,this.Inventory.TotalOver=0):(this.Inventory.InventorySettlementDetails=[],this._AppModeService._Toastr.error(n.Message))}});this.SubscriptionArr.push(e)}onPageChange(i){i.page++,i.first,i.rows,this._SharedObjectModelService.Paging.CurrentPage=i.first,this._SharedObjectModelService.Paging.PageSize=i.rows;let e={ProductId:this.SearchModel.ProductId,StoreId:this.SearchModel.StoreId,GroupId:this.SearchModel.GroupId,PageSize:this._SharedObjectModelService.Paging.PageSize,CurrentPage:i.page},n=this._Apiservice.post("StorageSettlementEP/GetItems",e,!0).subscribe({next:_=>{_.IsSuccess==!0&&_.Obj!=null?(this.Inventory.InventorySettlementDetails=this._SharedObjectModelService.RemoveDuplicates(this.Inventory.InventorySettlementDetails.concat(_.Obj.List),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=_.Obj.TotalItems):this._AppModeService._Toastr.error(_.Message)}});this.SubscriptionArr.push(n)}RemoveProcut(i){this.Inventory.InventorySettlementDetails=this.Inventory.InventorySettlementDetails.filter(e=>e.ProductId!=i.ProductId),this.Calc()}ExpandAll(){this.expandedRows=this.Inventory.InventorySettlementDetails.reduce((i,e)=>(i[e.Id]=!0)&&i,{})}CollapseAll(){this.expandedRows={}}ConvertNumber(i){return Number(i)}Calc(){this.Inventory.TotalNormal=0,this.Inventory.TotalUnNormal=0,this.Inventory.TotalOver=0;for(let i=0;i<this.Inventory.InventorySettlementDetails.length;i++){let e=Number(this.Inventory.InventorySettlementDetails[i].BalanceDocument),n=Number(this.Inventory.InventorySettlementDetails[i].BalanceNow),_=Number(this.Inventory.InventorySettlementDetails[i].WADocument);n>e&&(this.Inventory.InventorySettlementDetails[i].InventoryType=3);let y=Number(this.Inventory.InventorySettlementDetails[i].InventoryType);y==1&&(this.Inventory.TotalNormal+=(e-n)*_),y==2&&(this.Inventory.TotalUnNormal+=(e-n)*_),y==3&&n-e>0&&(this.Inventory.TotalOver+=(n-e)*_)}}Save(){if(this.Inventory.StoreId=this.SearchModel.StoreId,this.Inventory.DocNo=this.SearchModel.DocNo,this.Inventory.DocDate==""||this.Inventory.DocDate==null)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate")),!1;if(this.Inventory.StoreId==0||this.Inventory.StoreId==null)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyOffer.Error.EnterStore")),!1;for(let n=0;n<this.Inventory.InventorySettlementDetails.length;n++){let _=this.Inventory.InventorySettlementDetails[n].ProductName,y=this.Inventory.InventorySettlementDetails[n].BalanceDocument,x=Number(`${this.Inventory.InventorySettlementDetails[n].BalanceNow}`.trim()),ve=Number(this.Inventory.InventorySettlementDetails[n].InventoryType),E=this.Inventory.InventorySettlementDetails[n].WADocument;if(y>0&&x<0)return alert("BalanceDocument > 0 && (BalanceNow <= 0)"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+_),!1;if(Number(x)>0&&E<=0)return alert("Number(BalanceNow) > 0 && WADocument <= 0"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.WANow")+" "+_),!1;if((Number(x)<0||x<0)&&E>0)return alert("(Number(BalanceNow) < 0 || (BalanceNow <= 0))  && WADocument > 0"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+_),!1;if(Number(x)<0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+_),!1;if(ve==0&&Number(y)-Number(x)>0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.InventoryType")+" "+_),!1}let e={InventorySettlementDetails:this.Inventory.InventorySettlementDetails.filter(n=>n.BalanceDocument>0&&n.BalanceNow!="null"||Number(n.BalanceNow)>0),Id:0,Name:"",Code:"",DocDate:this._Apiservice.ConvertISODate(this.Inventory.DocDate),DocNo:this.Inventory.DocNo,StoreId:this.Inventory.StoreId,StoreName:this.Inventory.StoreName,TotalNormal:this.Inventory.TotalNormal,TotalUnNormal:this.Inventory.TotalUnNormal,TotalOver:this.Inventory.TotalOver};if(e.Id==0){let n=this._Apiservice.post("StorageSettlementEP/Add",e,!0).subscribe({next:_=>{_.IsSuccess==!0&&_.Obj!=null?(this._AppModeService._Toastr.success(_.Message),this.ResetPage(),this.GetPageInfo()):this._AppModeService._Toastr.error(_.Message)}});this.SubscriptionArr.push(n)}return!0}ResetPage(){this.Inventory={InventorySettlementDetails:[],Id:0,Name:"",Code:"",DocDate:"",DocNo:0,StoreId:0,StoreName:"",TotalNormal:0,TotalUnNormal:0,TotalOver:0};let i=O(0,1e3).subscribe(e=>{this.Inventory.DocDate=this._Apiservice.NowDate()});this.SubscriptionArr.push(i)}StartConnection(){this.Hub_Connection=new Se().withUrl(`${U.signalrUrl}/InventorySettlement`,{skipNegotiation:!0,transport:ue.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(i=>{console.log("Error Hub Connection",i)})}ServerListener(){this.Hub_Connection?.on("AddInventorySettlement",i=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==i.BranchId&&(this.Inventory.DocNo=i.DocNo)})}trackByMethod(i,e){return e.Id}ngOnDestroy(){for(let i=0;i<this.SubscriptionArr.length;i++)this.SubscriptionArr[i].unsubscribe()}};d.\u0275fac=function(e){return new(e||d)(N(me),N(ne),N(ge),N(L))},d.\u0275cmp=R({type:d,selectors:[["app-inventory-settlement"]],standalone:!0,features:[k],decls:3,vars:6,consts:[["content",""],["SelectStorages",""],["SelectItemGroup",""],["SelectFromStore",""],["dt1",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","AddUrl","GetById","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-center"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","px-1"],["for","DocNo"],["type","number","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"d-block","text-center"],["for","Store",1,"my-1"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[1,"my-1"],["for","Item"],["placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],[1,"col-12","text-center","px-1","my-3"],[1,"btn","btn-success","my-2","my-lg-0","mx-3","px-5","shadow-none","Save",3,"click"],[1,"col-12"],[1,"table","table-striped","table-hover","w-100"],["dataKey","Id",3,"expandedRowKeys","value","paginator","rows","tableStyle","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["appendTo","table",3,"first","rows","totalRecords","rowsPerPageOptions","onPageChange",4,"ngIf"],["appendTo","table",3,"first","rows","totalRecords","onPageChange",4,"ngIf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn","btn-success","py-3","px-5",3,"click"],["type","button",1,"btn","btn-secondary","py-3","px-5",3,"click"],[1,"form-text","text-muted"],[1,"flex","flex-wrap","justify-content-end","gap-2"],["label","Expand All","icon","pi pi-plus","text","",3,"onClick"],["label","Collapse All","icon","pi pi-minus","text","",3,"onClick"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon"],[1,"text-dark"],["min","0","type","number",1,"form-control","text-center",3,"keyup","change","ngModelChange","ngModel"],[1,"p-0","text-center"],["class","py-3 m-0 text-dark text-center",4,"ngIf"],["class"," py-3 m-0 text-danger text-center",4,"ngIf"],["class"," py-3 m-0 text-success text-center",4,"ngIf"],["class","col-12 text-center",4,"ngIf"],["type","button","severity","danger",3,"click","icon"],[1,"py-3","m-0","text-dark","text-center"],[1,"py-3","m-0","text-danger","text-center"],[1,"py-3","m-0","text-success","text-center"],[1,"col-12","text-center"],[1,"btn","btn-success","px-4","mx-1",3,"click","disabled"],[1,"btn","btn-danger","px-3","mx-1",3,"click","disabled"],["colspan","8",1,"p-0"],["dataKey","Id",3,"value"],["appendTo","table",3,"onPageChange","first","rows","totalRecords","rowsPerPageOptions"],["appendTo","table",3,"onPageChange","first","rows","totalRecords"]],template:function(e,n){if(e&1){let _=T();a(0,"app-dynamic-component",5),I("OpenModalEvent",function(){return p(_),m(n.OpenModal())})("ShowToEditeEvent",function(){return p(_),m(n.ShowToEdite())}),r(),C(1,Ge,83,69,"ng-template",null,0,j)}if(e&2){let _=f(2);S("PageTitle","InventorySettlement.InventorySettlement")("TablePaging",n.TablePaging)("FullScreen",!0)("AddUrl","InventorySettlementEP/Add")("GetById","InventorySettlementEP/GetById")("OutModal",_)}},dependencies:[le,re,ie,F,ae,oe,H,K,$,J,z,W,pe,ce,se,Q,te,ee,Z,Y,q,X,de,_e]});let o=d;return o})();export{st as InventorySettlementComponent};
