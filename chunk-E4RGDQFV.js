import{a as Ie,b as xe,c as Ce}from"./chunk-BZPR73YG.js";import{a as ge}from"./chunk-ABGH7SJD.js";import{a as he}from"./chunk-AFVHDR2Z.js";import{b as me,c as Te,h as Se}from"./chunk-RMPXGUPG.js";import"./chunk-6G7QKXJW.js";import"./chunk-PE2JD36L.js";import{a as fe}from"./chunk-NNHHLG53.js";import"./chunk-RAAURFHQ.js";import{a as pe,b as de}from"./chunk-UVSBIWKY.js";import"./chunk-5EQTOVFJ.js";import{a as ue}from"./chunk-OZ63RRZR.js";import"./chunk-3T7HRBK4.js";import"./chunk-G323P4PR.js";import"./chunk-NZD6IPKE.js";import"./chunk-EKOK3I7J.js";import{a as se,b as le,c as ce,d as _e}from"./chunk-SU7IEUNK.js";import"./chunk-MYPGER6Q.js";import"./chunk-CETGYK4I.js";import{c as ae}from"./chunk-F7IHWOEY.js";import{c as Z,d as ee}from"./chunk-GJAIQ3XH.js";import{b as K,c as G,d as X,g as te,i as re,l as ne,n as ie,v as oe}from"./chunk-UA6GT64L.js";import{A as Y,d as J,e as z,j as q}from"./chunk-GOUT62LL.js";import{$b as b,Cb as c,Db as p,Eb as P,Ib as A,Mb as C,Nb as a,Qb as E,Rb as O,Tb as F,Ub as B,Vb as R,Wb as I,X as v,Xb as f,Yb as h,Zb as y,_b as M,ac as w,bc as D,cc as $,db as _,dc as W,eb as N,ia as Q,na as j,nc as T,oc as u,pc as H,qc as k,vb as x,xa as s,xb as g,ya as l}from"./chunk-RH76WUG2.js";import{a as U,b as V}from"./chunk-3EYC4JTX.js";var be=["content"],we=["GLComponent"],De=["dynamiccomponent"];function Pe(o,m){if(o&1&&(c(0,"span",31),f(1),T(2,"date"),p()),o&2){let n=a(2);_(),y(" ",H(2,1,n.Transfer.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function ye(o,m){if(o&1){let n=A();c(0,"p-calendar",32),D("ngModelChange",function(e){s(n);let r=a(2);return w(r.Transfer.DocDate,e)||(r.Transfer.DocDate=e),l(e)}),p()}if(o&2){let n=a(2);b("ngModel",n.Transfer.DocDate),g("showOtherMonths",!0)("showTime",!0)("showIcon",!0)("showOnFocus",!0)}}function Ne(o,m){if(o&1&&(c(0,"small",33),f(1),p()),o&2){let n=a(2);_(),M("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Ae(o,m){if(o&1&&f(0),o&2){let n=m.item;y(" ",n.Name," ")}}function Me(o,m){if(o&1&&(c(0,"small",33),f(1),p()),o&2){let n=a(2);_(),M("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Ee(o,m){if(o&1&&f(0),o&2){let n=m.item;y(" ",n.Name," ")}}function Ue(o,m){if(o&1&&(c(0,"small",33),f(1),p()),o&2){let n=a().$implicit,t=a(2);_(),M("Loaded ",n.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ve(o,m){if(o&1&&f(0),o&2){let n=m.item;M(" ",n.Name," - ",n.Code," ")}}function Fe(o,m){if(o&1){let n=A();c(0,"button",49),C("click",function(){s(n);let e=a().index,r=a(2),i=I(5);return l(r.GetItemBalance(e,i))}),P(1,"i",50),p()}if(o&2){let n=a(3);g("disabled",n._Apiservice.DisabledButton)}}function Be(o,m){if(o&1&&(c(0,"small",33),f(1),p()),o&2){let n=a().$implicit,t=a(2);_(),M("Loaded ",n.ProductUnits.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Re(o,m){if(o&1&&f(0),o&2){let n=m.item;y(" ",n.Name," ")}}function Oe(o,m){if(o&1){let n=A();c(0,"tr")(1,"td",34)(2,"div",35)(3,"span",36),f(4),p(),c(5,"button",37),C("click",function(){s(n);let e=a(2);return l(e.AppendRow())}),P(6,"i",38),p(),c(7,"button",39),C("click",function(){let e=s(n).index,r=a(2);return l(r.RemoveRow(e))}),P(8,"i",40),p()()(),c(9,"td",41),T(10,"translate"),c(11,"ng-select",42,6),T(13,"translate"),C("clear",function(){let e=s(n).$implicit;return l(e.Items=[])})("focus",function(){let e=s(n).index,r=I(12),i=a(2);return i.ChangeSearchApiDetails("Items",r,e),l(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(n).index,r=I(12),i=a(2);return i.ChangeSearchApiDetails("Items",r,e),l(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(n).index,r=I(12),i=a(2);return l(i.ChangeSearchApiDetails("Items",r,e))})("close",function(){s(n);let e=a(2);return l(e._AppModeService.ResetCurrentPage())})("open",function(){s(n);let e=a(2);return l(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(n),r=e.$implicit,i=e.index,d=a(2);return l(d.SelectItem(r.ProductId,i))}),D("ngModelChange",function(e){let r=s(n).$implicit;return w(r.ProductId,e)||(r.ProductId=e),l(e)}),x(14,Ue,2,2,"ng-template",24)(15,Ve,1,2,"ng-template",25),p(),x(16,Fe,2,1,"button",43),p(),c(17,"td",44),T(18,"translate"),c(19,"ng-select",45,7),T(21,"translate"),C("clear",function(){let e=s(n).$implicit;return l(e.ProductUnits=[])})("focus",function(){let e=s(n).index,r=I(20),i=a(2);return i.ChangeSearchApiDetails("ItemUnits",r,e),l(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(n).index,r=I(20),i=a(2);return i.ChangeSearchApiDetails("ItemUnits",r,e),l(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(n).index,r=I(20),i=a(2);return l(i.ChangeSearchApiDetails("ItemUnits",r,e))})("close",function(){s(n);let e=a(2);return l(e._AppModeService.ResetCurrentPage())})("open",function(){s(n);let e=a(2);return l(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(n),r=e.$implicit,i=e.index,d=a(2);return l(d.SelectUnit(r.ProductUnitId,i))}),D("ngModelChange",function(e){let r=s(n).$implicit;return w(r.ProductUnitId,e)||(r.ProductUnitId=e),l(e)}),x(22,Be,2,2,"ng-template",24)(23,Re,1,1,"ng-template",25),p()(),c(24,"td",46),T(25,"translate"),c(26,"div",47)(27,"input",48),D("ngModelChange",function(e){let r=s(n).$implicit;return w(r.Quantity,e)||(r.Quantity=e),l(e)}),p()()()()}if(o&2){let n=m.$implicit,t=m.index,e=a(2);_(),E("title",t+1),_(3),h(t+1),_(3),g("disabled",e.Transfer.TransferDetails.length==1),_(2),E("title",u(10,21,"TransferStorage.Name")),_(2),O("placeholder","  ",u(13,23,"SaleInvoice.ChooseProduct"),""),g("items",n.Items)("dropdownPosition","bottom")("searchable",!0)("virtualScroll",!0),b("ngModel",n.ProductId),_(5),g("ngIf",n.ProductId>0&&e.Transfer.FromStoreId>0&&e.Transfer.ToStoreId>0),_(),E("title",u(18,25,"SaleInvoice.Units")),_(2),O("placeholder","  ",u(21,27,"Item.ItemUnit"),""),g("items",n.ProductUnits)("dropdownPosition","bottom")("disabled",n.ProductId==0||n.ProductId==null),b("ngModel",n.ProductUnitId),_(5),E("title",u(25,29,"SaleInvoice.Quantity")),_(3),b("ngModel",n.Quantity)}}function ke(o,m){if(o&1){let n=A();P(0,"app-modal-header",10),c(1,"div",11)(2,"div",12)(3,"div",13)(4,"label",14),f(5),T(6,"translate"),p(),P(7,"input",15),p(),c(8,"div",16)(9,"label",17),f(10),T(11,"translate"),p(),c(12,"input",18),D("ngModelChange",function(e){s(n);let r=a();return w(r.Transfer.Notes,e)||(r.Transfer.Notes=e),l(e)}),p()(),c(13,"div",16),x(14,Pe,3,4,"span",19)(15,ye,1,5,"p-calendar",20),p(),c(16,"div",21)(17,"p",22),f(18),T(19,"translate"),p(),c(20,"ng-select",23,4),C("clear",function(){s(n);let e=a();return l(e.Storages=[])})("focus",function(){s(n);let e=I(21),r=a();return r.ChangeSearchApi("FromStore",e),l(r._AppModeService.ResetCurrentPage())})("keyup",function(){s(n);let e=I(21),r=a();return r.ChangeSearchApi("FromStore",e),l(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(n);let e=I(21),r=a();return l(r.ChangeSearchApi("FromStore",e))})("close",function(){s(n);let e=a();return l(e._AppModeService.ResetCurrentPage())})("open",function(){s(n);let e=a();return l(e._AppModeService.ResetCurrentPage())})("change",function(){s(n);let e=a();return l(e.SelectValue(e.Transfer.FromStoreId,"FromStore"))}),D("ngModelChange",function(e){s(n);let r=a();return w(r.Transfer.FromStoreId,e)||(r.Transfer.FromStoreId=e),l(e)}),x(22,Ne,2,2,"ng-template",24)(23,Ae,1,1,"ng-template",25),p()(),c(24,"div",21)(25,"p",22),f(26),T(27,"translate"),p(),c(28,"ng-select",23,5),C("clear",function(){s(n);let e=a();return l(e.Storages=[])})("focus",function(){s(n);let e=I(29),r=a();return r.ChangeSearchApi("ToStore",e),l(r._AppModeService.ResetCurrentPage())})("keyup",function(){s(n);let e=I(29),r=a();return r.ChangeSearchApi("ToStore",e),l(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(n);let e=I(29),r=a();return l(r.ChangeSearchApi("ToStore",e))})("close",function(){s(n);let e=a();return l(e._AppModeService.ResetCurrentPage())})("open",function(){s(n);let e=a();return l(e._AppModeService.ResetCurrentPage())})("change",function(){s(n);let e=a();return l(e.SelectValue(e.Transfer.ToStoreId,"ToStore"))}),D("ngModelChange",function(e){s(n);let r=a();return w(r.Transfer.ToStoreId,e)||(r.Transfer.ToStoreId=e),l(e)}),x(30,Me,2,2,"ng-template",24)(31,Ee,1,1,"ng-template",25),p()()(),c(32,"div",26)(33,"table",27)(34,"thead")(35,"tr")(36,"th"),f(37,"#"),p(),c(38,"th",28),f(39),T(40,"translate"),p(),c(41,"th",28),f(42),T(43,"translate"),p(),c(44,"th",28),f(45),T(46,"translate"),p()()(),c(47,"tbody"),x(48,Oe,28,31,"tr",29),p()()()(),c(49,"app-modal-footer",30),C("SaveEvent",function(){s(n);let e=a();return l(e.Save())})("UpdateEvent",function(){s(n);let e=a();return l(e.Save())})("OpenGlEvent",function(){s(n);let e=a();return l(e.OpenGl())})("CloseEvent",function(){let e=s(n).$implicit,r=a();return e.close("Close click"),l(r.ResetPage())}),p()}if(o&2){let n=a();g("PageTitle",n.TablePaging.PageTitle),_(5),h(u(6,26,"Table.DocNo")),_(2),g("value",n.Transfer.DocNo)("disabled",!0),_(3),h(u(11,28,"Table.Notes")),_(2),b("ngModel",n.Transfer.Notes),_(2),g("ngIf",n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!1),_(),g("ngIf",n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!0),_(3),h(u(19,30,"TransferStorage.FromStoreId")),_(2),g("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",n.Transfer.FromStoreId),_(6),h(u(27,32,"TransferStorage.ToStoreId")),_(2),g("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",n.Transfer.ToStoreId),_(11),h(u(40,34,"TransferStorage.Name")),_(3),h(u(43,36,"SaleInvoice.Units")),_(3),h(u(46,38,"TransferStorage.Quantity")),_(3),g("ngForOf",n.Transfer.TransferDetails),_(),g("Id",n.Transfer.Id)("Gl",!0)}}function Ge(o,m){if(o&1&&(c(0,"tr")(1,"td")(2,"span",54),f(3),p()(),c(4,"td")(5,"span",54),f(6),p()()()),o&2){let n=m.$implicit;_(3),h(n.Name),_(3),h(n.Qty)}}function Le(o,m){if(o&1&&(c(0,"tr")(1,"td")(2,"span",54),f(3),p()(),c(4,"td")(5,"span",54),f(6),p()()()),o&2){let n=m.$implicit;_(3),h(n.Name),_(3),h(n.Qty)}}function Qe(o,m){if(o&1&&(c(0,"div",51)(1,"p",52),f(2),T(3,"translate"),p(),c(4,"table",53)(5,"thead")(6,"tr")(7,"th"),f(8),T(9,"translate"),p(),c(10,"th"),f(11),T(12,"translate"),p()()(),c(13,"tbody"),x(14,Ge,7,2,"tr",29),p()(),c(15,"p",52),f(16),T(17,"translate"),p(),c(18,"table",53)(19,"thead")(20,"tr")(21,"th"),f(22),T(23,"translate"),p(),c(24,"th"),f(25),T(26,"translate"),p()()(),c(27,"tbody"),x(28,Le,7,2,"tr",29),p()()()),o&2){let n=a();_(2),y(" ",u(3,8,"TransferStorage.BalanceFrom")," "),_(6),h(u(9,10,"SaleInvoice.Name")),_(3),h(u(12,12,"Table.Balance")),_(3),g("ngForOf",n.ItemBalanceFrom),_(2),y(" ",u(17,14,"TransferStorage.BalanceTo")," "),_(6),h(u(23,16,"SaleInvoice.Name")),_(3),h(u(26,18,"Table.Balance")),_(3),g("ngForOf",n.ItemBalanceTo)}}var St=(()=>{let m=class m{constructor(t,e,r,i,d){this._ActivatedRoute=t,this._AppModeService=e,this._SharedObjectModelService=r,this._DefaultSettingsService=i,this._Apiservice=d,this._ServiceLifeTime=Q(G),this.TablePaging={PageTitle:"TransferStorage.TransferStorage",GetById:"TransferStorageEP/GetById",DeleteUrl:"TransferStorageEP/Delete",PrintUrl:"Transfer",BranchFilter:!0,Url:"Global/GetAll",TableName:"Transfer",Join:!0,JoinTables:["Storages SF","Storages ST"],JoinConditions:["T.FromStoreId = SF.Id","T.ToStoreId = ST.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","SF.Name AS FromStoreName","ST.Name AS ToStoreName"],TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes",ExistSearchField:"T.Notes"},{SortName:"FromStoreName",CellName:"TransferStorage.FromStoreId",ExistSearchField:"SF.Name"},{SortName:"ToStoreName",CellName:"TransferStorage.ToStoreId",ExistSearchField:"ST.Name"}]},this.Transfer={Id:0,Name:"",Notes:"",Code:"",FromStoreId:null,FromStoreName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,DocNo:0,DocDate:"",TransferDetails:[{Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""}]},this.Storages=[],this.ItemBalanceFrom=[],this.ItemBalanceTo=[]}ngOnInit(){let t=Number(this._ActivatedRoute.snapshot.queryParams.Id);t>0&&this.GetByIdRoute(t),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(t){this._Apiservice.getById("TransferStorageEP/GetById",t,!0).pipe(v(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this.GLComponent.Gl=e.Obj.Gl,this.Drow(e.Obj.model),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})}})}OpenModal(){this.ResetPage(),this.GetPageInfo()}GetPageInfo(){this._Apiservice.get("TransferStorageEP/GetPageInfo",!1).pipe(v(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{this.Transfer.DocNo=t.Obj}})}ShowToEdite(t){this.GLComponent.Gl=t.Gl,this.Drow(t.PageModel)}Drow(t){this.Transfer={Id:t.Id,Name:t.Name,Notes:t.Notes,Code:t.Code,FromStoreId:t.FromStoreId,FromStoreName:t.FromStoreName,ToStoreId:t.ToStoreId,ToStoreName:t.ToStoreName,TotalQty:t.TotalQty,DocNo:t.DocNo,DocDate:new Date(`${t.DocDate}`),TransferDetails:t.TransferDetails},this.Storages=[],this.Storages.push({Id:t.FromStoreId,Name:t.FromStoreName}),this.Storages.push({Id:t.ToStoreId,Name:t.ToStoreName});for(let e=0;e<this.Transfer.TransferDetails.length;e++){let r=this.Transfer.TransferDetails[e];r.Items=[{Id:r.ProductId,Name:r.ProductName,NameAndCode:r.ProductName}],r.ProductUnits=[{Id:r.ProductUnitId,Name:r.ProductUnitName,NameAndUnitFactor:r.ProductUnitName}]}}ChangeSearchApi(t,e){let r=`${e.searchTerm}`.trim();(r==""||r=="null")&&(e.searchTerm="",r=""),this._AppModeService.CurrentPage+=1;let i={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:r,SearchField:"Name"};(t=="FromStore"||t=="ToStore")&&(i.TableName="Storages",i.BranchFilter=!0),this._Apiservice.post("Global/GetAll",i,!1).pipe(v(this._ServiceLifeTime.Destroyed$)).subscribe({next:d=>{this.HandleResponse(d.Obj,t)}})}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,(e=="FromStore"||e=="ToStore")&&(this.Storages=this._SharedObjectModelService.RemoveDuplicates(this.Storages.concat(t.DataReturn),"Id"))}ChangeSearchApiDetails(t,e,r){let i=`${e.searchTerm}`.trim();(i==""||i=="null")&&(e.searchTerm="",i=""),this._AppModeService.CurrentPage+=1;let d={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:i,SearchField:"Name"};if(t=="Items"&&(d.Columns=["Id","Name","Code"],d.Conditions="ProductType != 2"),t=="ItemUnits"){let S=this.Transfer.TransferDetails[r].ProductId==null?0:this.Transfer.TransferDetails[r].ProductId;d.Conditions=`ItemId = ${S}`,d.Join=!0,d.JoinTables=["Units U"],d.NoPaging=!0,d.JoinConditions=["T.UnitId = U.Id"],d.Columns=["T.Id","U.Name","T.UnitFactor"],d.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",d,!1).pipe(v(this._ServiceLifeTime.Destroyed$)).subscribe({next:S=>{this.HandleResponseDetails(S.Obj,t,r)}})}HandleResponseDetails(t,e,r){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Items"&&(this.Transfer.TransferDetails[r].Items=this._SharedObjectModelService.RemoveDuplicates(this.Transfer.TransferDetails[r].Items.concat(t.DataReturn),"Id"),this.Transfer.TransferDetails[r].Items=this.Transfer.TransferDetails[r].Items.map(i=>V(U({},i),{NameAndCode:i.Code!=null?`${i.Name} - ${i.Code}`:`${i.Name}`}))),e=="ItemUnits"&&(this.Transfer.TransferDetails[r].ProductUnits=t.DataReturn.map(i=>V(U({},i),{NameAndUnitFactor:i.UnitFactor!=null?`${i.Name} - ${i.UnitFactor}`:`${i.Name}`})))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let r=[];(e=="FromStore"||e=="ToStore")&&(r=this.Storages);let i=r.find(d=>d.Id==t);if(i==null){this._AppModeService.DontPlay();return}else this.Transfer[`${e}Id`]=t,this.Transfer[`${e}Name`]=i.Name}else this.Transfer[`${e}Id`]=null,this.Transfer[`${e}Name`]=""}SelectItem(t,e){if(t!=null&&t>0){let r=this.Transfer.TransferDetails[e].Items.find(i=>i.Id==t);if(r!=null)this.Transfer.TransferDetails[e].ProductId=r.Id,this.Transfer.TransferDetails[e].ProductName=r.Name,this.Transfer.TransferDetails[e].ProductUnitId=null,this.Transfer.TransferDetails[e].ProductUnits=[],this.AfterSelectem(r.Id,e);else{this._Apiservice.DontPlay();return}}else this.Transfer.TransferDetails[e].ProductUnitId=null,this.Transfer.TransferDetails[e].ProductUnits=[]}AfterSelectem(t,e){if(t>0){let r={TableName:"ItemUnits",Columns:["Id","Name"],CurrentPage:1,PageSize:1,SearchText:"",SearchField:"Name"};r.Conditions=`ItemId = ${t}`,r.Join=!0,r.JoinTables=["Units U"],r.JoinConditions=["T.UnitId = U.Id"],r.Columns=["T.Id","U.Name","T.UnitFactor"],r.SearchField="U.Name",this._Apiservice.post("Global/GetAll",r,!1).pipe(v(this._ServiceLifeTime.Destroyed$)).subscribe({next:i=>{i.Obj.DataReturn=i.Obj.DataReturn.map(S=>V(U({},S),{NameAndUnitFactor:S.UnitFactor!=null?`${S.Name} - ${S.UnitFactor}`:`${S.Name}`}));let d=i.Obj.DataReturn[0];d!=null&&(this.Transfer.TransferDetails[e].ProductUnits=i.Obj.DataReturn,this.Transfer.TransferDetails[e].ProductUnitId=d.Id,this.Transfer.TransferDetails[e].Quantity=1)}})}}SelectUnit(t,e){if(t!=null&&t>0){let r=this.Transfer.TransferDetails[e].ProductUnits.find(i=>i.Id==t);if(r!=null)this.Transfer.TransferDetails[e].ProductUnitId=r.Id,this.Transfer.TransferDetails[e].ProductUnitName=r.Name;else{this._Apiservice.DontPlay();return}}}TotalRow(t){let e=Number(this.Transfer.TransferDetails[t].Price),r=Number(this.Transfer.TransferDetails[t].Quantity);return Number(e*r)}TotalTransfer(){let t=0;for(let e=0;e<this.Transfer.TransferDetails.length;e++)this.Transfer.TransferDetails[e].ProductId>0&&this.Transfer.TransferDetails[e].ProductUnitId>0&&(t+=Number(this.Transfer.TransferDetails[e].Price)*Number(this.Transfer.TransferDetails[e].Quantity));return Number(t)}AppendRow(){let t={Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""};return this.Transfer.TransferDetails.push(t),this._AppModeService.AppendTd(),!0}RemoveRow(t){return this.Transfer.TransferDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Transfer.Error.ErrorFirstRow")),!1):(this.Transfer.TransferDetails.splice(t,1),this.TotalTransfer(),!0)}GetItemBalance(t,e){let r=this.Transfer.TransferDetails[t];if(this.Transfer.ToStoreId==0||this.Transfer.ToStoreId==null||this.Transfer.FromStoreId==0||this.Transfer.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Storage"));return}if(r.ProductId==0||r.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}let i={ProductId:r.ProductId,FromStoreId:this.Transfer.FromStoreId,ToStoreId:this.Transfer.ToStoreId};this._Apiservice.post("ItemEP/ProductBalance",i,!0).pipe(v(this._ServiceLifeTime.Destroyed$)).subscribe({next:d=>{this._AppModeService._NgbModal.open(e,{size:"xl",centered:!0}),this.ItemBalanceFrom=d.Obj.FromStorageBalance,this.ItemBalanceTo=d.Obj.ToStorageBalance}})}Save(){if(this.Transfer.DocDate==""||this.Transfer.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate"));return}if(this.Transfer.FromStoreId==0||this.Transfer.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterFromStore"));return}if(this.Transfer.ToStoreId==0||this.Transfer.ToStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterToStore"));return}if(this.Transfer.ToStoreId==this.Transfer.FromStoreId){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.ErrorExistStore"));return}for(let e=0;e<this.Transfer.TransferDetails.length;e++){let r=e,i=Number(this.Transfer.TransferDetails[e].ProductId),d=Number(this.Transfer.TransferDetails[e].Quantity),S=Number(this.Transfer.TransferDetails[e].ProductUnitId),ve=Number(this.Transfer.TransferDetails[e].Price);if(i==null||i==null||i<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}if(S==null||S==null||S<=0||isNaN(S)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyTransfer.Error.EnterUnit"));return}if(this.Transfer.TransferDetails.filter(L=>L.ProductId==i&&L.ProductUnitId==S).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(r+1));return}if(d==null||d==null||isNaN(d)||d<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterQuantity"));return}this.Transfer.TransferDetails[e].ProductUnitId=S,this.Transfer.TransferDetails[e].ProductId=i,this.Transfer.TransferDetails[e].Price=ve}let t={DocDate:this._Apiservice.ConvertISODate(this.Transfer.DocDate),DocNo:this.Transfer.DocNo,TransferDetails:this.Transfer.TransferDetails,FromStoreId:this.Transfer.FromStoreId,FromStoreName:this.Transfer.FromStoreName,ToStoreId:this.Transfer.ToStoreId,ToStoreName:this.Transfer.ToStoreName,TotalQty:this.Transfer.TotalQty,Id:this.Transfer.Id,Name:this.Transfer.Name,Code:this.Transfer.Code,Notes:this.Transfer.Notes};t.Id==0&&this._Apiservice.post("TransferStorageEP/Add",t,!0).pipe(v(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this.DynamicComponent.Paging.DataReturn.push(e.Obj)}}),t.Id>0&&this._Apiservice.put("TransferStorageEP/Update",t,!0).pipe(v(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.UpdateSuccess"));let r=e.Obj,i=this.DynamicComponent.Paging.DataReturn.find(d=>d.Id==r.Id);i!=null&&Object.assign(i,r),this.ResetPage(),this.GetPageInfo()}})}OpenGl(){this.GLComponent.Open()}StartConnection(){this.Hub_Connection=new Ce().withUrl(`${K.signalrUrl}/Transfer`,{skipNegotiation:!0,transport:xe.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(Ie.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(t=>{console.log(t)})}ServerListener(){this.Hub_Connection?.on("AddTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&(this.Transfer.DocNo=t.DocNo)}),this.Hub_Connection?.on("UpdateTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Transfer.Id&&(alert(this._AppModeService._Translate.instant("Show.UpdateModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.UpdateModelAnother"),t.User),this._AppModeService._NgbModal.dismissAll())}),this.Hub_Connection?.on("DeleteTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Transfer.Id&&(alert(this._AppModeService._Translate.instant("Show.DeleteModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.DeleteModelAnother"),t.User),this.DynamicComponent.Paging.DataReturn=this.DynamicComponent.Paging.DataReturn.filter(r=>r.Id!=t.Id),this._AppModeService._NgbModal.dismissAll())})}ResetPage(){this.Transfer={Id:0,Name:"",Notes:"",Code:"",FromStoreId:null,FromStoreName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,DocNo:0,DocDate:"",TransferDetails:[{Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""}]},this._DefaultSettingsService.ResetDate(this.Transfer)}ngOnDestroy(){}};m.\u0275fac=function(e){return new(e||m)(N(Y),N(ae),N(ue),N(he),N(X))},m.\u0275cmp=j({type:m,selectors:[["app-transfer-storage"]],viewQuery:function(e,r){if(e&1&&(F(be,5),F(we,5),F(De,5)),e&2){let i;B(i=R())&&(r.ContentModel=i.first),B(i=R())&&(r.GLComponent=i.first),B(i=R())&&(r.DynamicComponent=i.first)}},standalone:!0,features:[$([G]),W],decls:8,vars:8,consts:[["dynamiccomponent",""],["content",""],["ItemBalance",""],["GLComponent",""],["SelectFromStore",""],["SelectToStore",""],["SelectItem22",""],["SelectUnits",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","PrintUrl","DeleteUrl","OutModal"],[1,"col-8"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-end","col-12","px-2"],[1,"col-12","col-sm-6","col-md-6","col-lg-3","col-xl-1","p-1"],["for","DocNo"],["type","number","appNumericInput","",1,"form-control","text-center",3,"value","disabled"],[1,"col-12","col-sm-6","col-md-6","col-lg-4","col-xl-3","p-1"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block text-center ",4,"ngIf"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12","class"," shadow-none text-center w-100",3,"ngModel","showOtherMonths","showTime","showIcon","showOnFocus","ngModelChange",4,"ngIf"],[1,"col-12","col-sm-6","col-md-6","col-lg-4","col-xl-2","p-1"],[1,"m-0"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["id","ProductTable",1,"DivPaging","table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-1","mb-0"],[1,"col-3"],[4,"ngFor","ngForOf"],[3,"SaveEvent","UpdateEvent","OpenGlEvent","CloseEvent","Id","Gl"],[1,"d-block","text-center"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showOtherMonths","showTime","showIcon","showOnFocus"],[1,"form-text","text-muted"],[1,"p-0",3,"title"],[1,"d-flex","justify-content-center","align-items-center","col-11","col-md-12"],[1,"d-none","d-lg-inline"],[1,"btn-Add","btn",3,"click"],[1,"mx-1","fw-bold","pi","pi-plus"],[1,"btn-Delete","btn-Page","btn",3,"click","disabled"],[1,"mx-1","pi","pi-trash","fw-bold"],[1,"ngSelect","d-flex","mx-auto","flex-wrap","justify-content-center",3,"title"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-10","col-lg-9","col-xl-10",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["class","btn btn-Refresh d-block d-md-inline-block",3,"disabled","click",4,"ngIf"],[1,"ngSelect",3,"title"],["bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","disabled","ngModel"],[3,"title"],[1,"p-0","col-10","col-lg-12"],["name","Quantity","type","number","appNumericInput","",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"btn","btn-Refresh","d-block","d-md-inline-block",3,"click","disabled"],[1,"pi","pi-eye","d-block","mx-auto"],[1,"modal-body"],[1,"my-2","text-center"],[1,"table","table-striped","table-hover"],[1,"text-dark"]],template:function(e,r){if(e&1){let i=A();c(0,"app-dynamic-component",8,0),C("OpenModalEvent",function(){return s(i),l(r.OpenModal())})("ShowToEditeEvent",function(S){return s(i),l(r.ShowToEdite(S))}),p(),x(2,ke,50,40,"ng-template",null,1,k)(4,Qe,29,20,"ng-template",9,2,k),P(6,"app-glsheard",null,3)}if(e&2){let i=I(3);g("PageTitle",r.TablePaging.PageTitle)("TablePaging",r.TablePaging)("FullScreen",!1)("GlResponse",!0)("GetById",r.TablePaging.GetById)("PrintUrl",r.TablePaging.PrintUrl)("DeleteUrl",r.TablePaging.DeleteUrl)("OutModal",i)}},dependencies:[de,pe,q,oe,te,ie,re,ne,J,z,ee,Z,_e,ce,se,le,Se,ge,me,fe,Te],styles:["svg[_ngcontent-%COMP%]{cursor:pointer}"]});let o=m;return o})();export{St as TransferStorageComponent};
