import{a as Ge}from"./chunk-PAI6ZM6M.js";import{a as Re,b as ke,c as Ue}from"./chunk-BZPR73YG.js";import{a as Be}from"./chunk-RI6KAADW.js";import{a as Ee}from"./chunk-3UDBFBON.js";import{a as Ae,b as we,d as Pe,h as Me}from"./chunk-ZV4STMPN.js";import{a as Ne}from"./chunk-VSYXDL23.js";import{o as Ce,x as be}from"./chunk-BHSN7HFD.js";import{a as Te,b as De}from"./chunk-6BJKXUWP.js";import{a as Ve}from"./chunk-LUZO7NCR.js";import{a as ge,b as Se,c as fe,d as ye}from"./chunk-MZIKAFPE.js";import{k as xe}from"./chunk-RVJIMCIT.js";import{c as F}from"./chunk-NUFVOF6D.js";import{c as ce,d as ae}from"./chunk-KALZ37GW.js";import{b as re,c as j,f as le,h as se,k as _e,m as pe,n as de,o as ue,p as me,q as Ie,s as ve,u as he}from"./chunk-N4FWSTCP.js";import{A as oe,d as te,e as ie,j as ne}from"./chunk-VTADEU6K.js";import{$b as b,Cb as _,Db as p,Eb as V,Fb as z,Gb as X,Ib as T,Mb as S,Nb as r,Qb as P,Rb as B,Tb as O,Ub as W,Vb as L,Wb as y,X as M,Xb as m,Yb as D,Zb as C,_b as E,ab as K,ac as A,bc as w,ca as Z,db as s,dc as Y,eb as k,ha as Q,na as J,nc as v,oc as h,pc as ee,qc as H,vb as x,wa as q,xa as a,xb as u,ya as l}from"./chunk-J5UB44FZ.js";import{a as U,b as G}from"./chunk-3EYC4JTX.js";var Oe=(()=>{let d=class d{constructor(t,e){this._Apiservice=t,this._AppModeService=e,this.ScaleSettingsArr=[],this.GetScaleSettings()}GetScaleSettings(){let t={TableName:"ScaleSettings",Columns:["Id","Name","ZaraNumber","BarCodeLength","ProductCodeLength","WeightCodeLength"],Conditions:"",NoPaging:!0};this._Apiservice.post("Global/GetAll",t,!1).pipe(M(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?this.ScaleSettingsArr=e.Obj.DataReturn:this._AppModeService._Toastr.error(e.Message)}})}};d.\u0275fac=function(e){return new(e||d)(Q(j),Q(F))},d.\u0275prov=Z({token:d,factory:d.\u0275fac,providedIn:"root"});let o=d;return o})();var $e=["GLComponent"],Ze=["dynamiccomponent"],Je=["content"],qe=["OherModal"],Ke=["AllHold"],ze=["ProductTable"];function Xe(o,d){o&1&&(_(0,"th",61),m(1),v(2,"translate"),p()),o&2&&(s(),C(" ",h(2,1,"SaleInvoice.DiscountRate")," % "))}function Ye(o,d){o&1&&(_(0,"th",64),m(1),v(2,"translate"),p()),o&2&&(s(),C(" ",h(2,1,"SaleInvoice.Discount"),""))}function et(o,d){if(o&1&&(_(0,"tr")(1,"th",58)(2,"span",59),m(3,"#"),p()(),_(4,"th",60),m(5),v(6,"translate"),p(),_(7,"th",61),m(8),v(9,"translate"),p(),_(10,"th",61),m(11),v(12,"translate"),p(),_(13,"th",61),m(14),v(15,"translate"),p(),x(16,Xe,3,3,"th",62)(17,Ye,3,3,"th",63),_(18,"th",64),m(19),v(20,"translate"),p()()),o&2){let i=r(2);s(5),D(h(6,7,"SaleInvoice.Name")),s(3),D(h(9,9,"SaleInvoice.Unit")),s(3),D(h(12,11,"SaleInvoice.Quantity")),s(3),D(h(15,13,"SaleInvoice.Price")),s(2),u("ngIf",(i._DefaultSettingsService.DefaultSettings==null?null:i._DefaultSettingsService.DefaultSettings.HideColumnDiscountRate)==!1),s(),u("ngIf",(i._DefaultSettingsService.DefaultSettings==null?null:i._DefaultSettingsService.DefaultSettings.HideColumnDiscount)==!1),s(2),D(h(20,15,"SaleInvoice.TotalPriceAfterDiscount"))}}function tt(o,d){if(o&1&&(_(0,"small",93),m(1),p()),o&2){let i=r().$implicit,t=r(2);s(),E("Loaded ",i.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function it(o,d){if(o&1&&m(0),o&2){let i=d.item;E(" ",i.Name," - ",i.Code," ")}}function nt(o,d){if(o&1&&(_(0,"small",93),m(1),p()),o&2){let i=r().$implicit,t=r(2);s(),E("Loaded ",i.ProductUnits.length," of ",t._SharedObjectModelService.TotalItems,"")}}function ot(o,d){if(o&1&&m(0),o&2){let i=d.item;C(" ",i.NameAndUnitFactor," ")}}function rt(o,d){if(o&1&&(_(0,"span",92),m(1),p()),o&2){let i=r().$implicit;s(),D(i.Price)}}function ct(o,d){if(o&1){let i=T();_(0,"input",94),v(1,"translate"),S("change",function(){a(i);let e=r(3);return l(e.CalcInvoice())})("keyup",function(){a(i);let e=r(3);return l(e.CalcInvoice())}),w("ngModelChange",function(e){a(i);let n=r().$implicit;return A(n.Price,e)||(n.Price=e),l(e)}),p()}if(o&2){let i=r(),t=i.$implicit,e=i.rowIndex;P("placeholder",h(1,7,"SaleInvoice.Price")),B("id","Price",e,""),B("name","Price",e,""),u("disabled",t.ProductId==null||t.ProductUnitId==null),b("ngModel",t.Price)}}function at(o,d){if(o&1){let i=T();_(0,"td",79)(1,"div",80)(2,"button",81),S("click",function(){a(i);let e=r().rowIndex,n=r(2);return n.Button("DiscountRate","+",e),l(n.Discount("DiscountRate",e))}),V(3,"i",69),p(),_(4,"div",82)(5,"input",94),v(6,"translate"),S("change",function(){a(i);let e=r().rowIndex,n=r(2);return l(n.Discount("DiscountRate",e))})("keyup",function(){a(i);let e=r().rowIndex,n=r(2);return l(n.Discount("DiscountRate",e))}),w("ngModelChange",function(e){a(i);let n=r().$implicit;return A(n.DiscountRate,e)||(n.DiscountRate=e),l(e)}),p()(),_(7,"button",84),S("click",function(){a(i);let e=r().rowIndex,n=r(2);return n.Button("DiscountRate","-",e),l(n.Discount("DiscountRate",e))}),_(8,"i",85),m(9," - "),p()()()()}if(o&2){let i=r(),t=i.$implicit,e=i.rowIndex;s(2),u("disabled",t.ProductId==null||t.ProductUnitId==null),s(3),B("placeholder","",h(6,10,"SaleInvoice.DiscountRate")," %"),B("id","DiscountRate",e,""),B("name","DiscountRate",e,""),u("disabled",t.ProductId==null||t.ProductUnitId==null),b("ngModel",t.DiscountRate),s(2),u("disabled",t.ProductId==null||t.ProductUnitId==null)}}function lt(o,d){if(o&1){let i=T();_(0,"td",79)(1,"div",90)(2,"input",94),v(3,"translate"),S("change",function(){a(i);let e=r().rowIndex,n=r(2);return l(n.Discount("Discount",e))})("keyup",function(){a(i);let e=r().rowIndex,n=r(2);return l(n.Discount("Discount",e))}),w("ngModelChange",function(e){a(i);let n=r().$implicit;return A(n.Discount,e)||(n.Discount=e),l(e)}),p()()()}if(o&2){let i=r(),t=i.$implicit,e=i.rowIndex;s(2),P("placeholder",h(3,7,"SaleInvoice.Discount")),B("id","Discount",e,""),B("name","Discount",e,""),u("disabled",t.ProductId==null||t.ProductUnitId==null),b("ngModel",t.Discount)}}function st(o,d){if(o&1){let i=T();_(0,"tr")(1,"td",65)(2,"div",66)(3,"span",67),m(4),p(),_(5,"button",68),S("click",function(){a(i);let e=r(2);return l(e.AppendRow())}),V(6,"i",69),p(),_(7,"button",70),S("click",function(){let e=a(i).rowIndex,n=r(2);return l(n.RemoveRow(e))}),V(8,"i",71),p()()(),_(9,"td",72),v(10,"translate"),_(11,"div",73)(12,"ng-select",74,7),v(14,"translate"),S("clear",function(){let e=a(i).$implicit;return l(e.Items=[])})("focus",function(){let e=a(i).rowIndex,n=y(13),c=r(2);return c.ChangeSearchApiDetails("Items",n,e),l(c._AppModeService.ResetCurrentPage())})("keyup",function(){let e=a(i).rowIndex,n=y(13),c=r(2);return c.ChangeSearchApiDetails("Items",n,e),l(c._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=a(i).rowIndex,n=y(13),c=r(2);return l(c.ChangeSearchApiDetails("Items",n,e))})("close",function(){a(i);let e=r(2);return l(e._AppModeService.ResetCurrentPage())})("open",function(){a(i);let e=r(2);return l(e._AppModeService.ResetCurrentPage())})("change",function(){let e=a(i),n=e.$implicit,c=e.rowIndex,I=y(13);return r(2).SelectItem(n.ProductId,c),l(I.blur())}),w("ngModelChange",function(e){let n=a(i).$implicit;return A(n.ProductId,e)||(n.ProductId=e),l(e)}),x(15,tt,2,2,"ng-template",28)(16,it,1,2,"ng-template",29),p(),_(17,"button",75),S("click",function(){let e=a(i).rowIndex,n=r(2),c=y(7);return l(n.ProductBalance(e,c))}),V(18,"i",76),p()()(),_(19,"td",77),v(20,"translate"),_(21,"ng-select",78,8),v(23,"translate"),S("clear",function(){let e=a(i).$implicit;return l(e.ProductUnits=[])})("focus",function(){let e=a(i).rowIndex,n=y(22),c=r(2);return c.ChangeSearchApiDetails("ItemUnits",n,e),l(c._AppModeService.ResetCurrentPage())})("keyup",function(){let e=a(i).rowIndex,n=y(22),c=r(2);return c.ChangeSearchApiDetails("ItemUnits",n,e),l(c._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=a(i).rowIndex,n=y(22),c=r(2);return l(c.ChangeSearchApiDetails("ItemUnits",n,e))})("close",function(){a(i);let e=r(2);return l(e._AppModeService.ResetCurrentPage())})("open",function(){a(i);let e=r(2);return l(e._AppModeService.ResetCurrentPage())})("change",function(){let e=a(i),n=e.$implicit,c=e.rowIndex,I=y(22);return r(2).SelectUnit(n.ProductUnitId,c),l(I.blur())}),w("ngModelChange",function(e){let n=a(i).$implicit;return A(n.ProductUnitId,e)||(n.ProductUnitId=e),l(e)}),x(24,nt,2,2,"ng-template",28)(25,ot,1,1,"ng-template",29),p()(),_(26,"td",79)(27,"div",80)(28,"button",81),S("click",function(){let e=a(i).rowIndex,n=r(2);return l(n.Button("Quantity","+",e))}),V(29,"i",69),p(),_(30,"div",82)(31,"input",83),v(32,"translate"),S("change",function(){a(i);let e=r(2);return l(e.CalcInvoice())})("keyup",function(){a(i);let e=r(2);return l(e.CalcInvoice())}),w("ngModelChange",function(e){let n=a(i).$implicit;return A(n.Quantity,e)||(n.Quantity=e),l(e)}),p()(),_(33,"button",84),S("click",function(){let e=a(i).rowIndex,n=r(2);return l(n.Button("Quantity","-",e))}),_(34,"i",85),m(35," - "),p()()()(),_(36,"td",79)(37,"div",86),x(38,rt,2,1,"span",87)(39,ct,2,9,"input",88),p()(),x(40,at,10,12,"td",89)(41,lt,4,9,"td",89),_(42,"td",79)(43,"div",90)(44,"span",91),m(45),v(46,"translate"),p(),_(47,"span",92),m(48),p()()()()}if(o&2){let i=d.$implicit,t=d.rowIndex,e=r(2);s(),P("title",t+1),s(3),D(t+1),s(3),u("disabled",e.Invoice.InvoiceDetails.length==1),s(2),P("title",h(10,36,"TransferStorage.Name")),s(3),B("placeholder","  ",h(14,38,"SaleInvoice.ChooseProduct"),""),u("dropdownPosition","bottom")("items",i.Items)("virtualScroll",!0)("searchable",!0),b("ngModel",i.ProductId),s(5),u("disabled",e._AppModeService.DisabledButton||i.ProductId==null),s(2),P("title",h(20,40,"Item.ItemUnit")),s(2),B("placeholder","  ",h(23,42,"Item.ItemUnit"),""),u("dropdownPosition","bottom")("items",i.ProductUnits)("disabled",i.ProductId==0||i.ProductId==null)("virtualScroll",!0)("searchable",!0),b("ngModel",i.ProductUnitId),s(7),u("disabled",i.ProductId==null||i.ProductUnitId==null),s(3),B("id","Quantity",t,""),B("name","Quantity",t,""),P("placeholder",h(32,44,"SaleInvoice.Quantity")),u("disabled",i.ProductId==null||i.ProductUnitId==null),b("ngModel",i.Quantity),s(2),u("disabled",i.ProductId==null||i.ProductUnitId==null),s(5),u("ngIf",e.ScreenName=="SaleInvoice"),s(),u("ngIf",e.ScreenName!="SaleInvoice"),s(),u("ngIf",e._DefaultSettingsService.DefaultSettings.HideColumnDiscountRate==!1),s(),u("ngIf",e._DefaultSettingsService.DefaultSettings.HideColumnDiscount==!1),s(4),D(h(46,46,"SaleInvoice.TotalPriceAfterDiscount")),s(3),D(e._AppModeService.GetTwoNumberAfterZero(i.TotalPriceAfterDiscount))}}function _t(o,d){if(o&1&&(_(0,"small",93),m(1),p()),o&2){let i=r(2);s(),E("Loaded ",i.ItemsBarCode.length," of ",i._SharedObjectModelService.TotalItems,"")}}function pt(o,d){if(o&1&&m(0),o&2){let i=d.item;E(" ",i.Name," - ",i.Code," ")}}function dt(o,d){if(o&1){let i=T();_(0,"div",95)(1,"input",96),v(2,"translate"),S("change",function(){a(i);let e=r(2);return l(e.ChangeGlobalDis("GlobalDiscountRate"))})("keyup",function(){a(i);let e=r(2);return l(e.ChangeGlobalDis("GlobalDiscountRate"))}),w("ngModelChange",function(e){a(i);let n=r(2);return A(n.GlobalDiscountRate,e)||(n.GlobalDiscountRate=e),l(e)}),p()()}if(o&2){let i=r(2);s(),B("placeholder","",h(2,3,"SaleInvoice.DiscountRate")," %"),b("ngModel",i.GlobalDiscountRate)}}function ut(o,d){if(o&1){let i=T();_(0,"div",95)(1,"input",97),v(2,"translate"),S("change",function(){a(i);let e=r(2);return l(e.ChangeGlobalDis("GlobalDiscount"))})("keyup",function(){a(i);let e=r(2);return l(e.ChangeGlobalDis("GlobalDiscount"))}),w("ngModelChange",function(e){a(i);let n=r(2);return A(n.GlobalDiscount,e)||(n.GlobalDiscount=e),l(e)}),p()()}if(o&2){let i=r(2);s(),P("placeholder",h(2,2,"SaleInvoice.Discount")),b("ngModel",i.GlobalDiscount)}}function mt(o,d){if(o&1){let i=T();_(0,"div",98)(1,"div",99)(2,"div",100)(3,"label",101),m(4),v(5,"translate"),p(),_(6,"div",102)(7,"input",103),S("change",function(){a(i);let e=r(2);return l(e.ChangeClientType(1))}),w("ngModelChange",function(e){a(i);let n=r(2);return A(n.Invoice.ClientType,e)||(n.Invoice.ClientType=e),l(e)}),p()()()(),_(8,"div",99)(9,"div",100)(10,"label",104),m(11),v(12,"translate"),p(),_(13,"div",102)(14,"input",105),S("change",function(){a(i);let e=r(2);return l(e.ChangeClientType(2))}),w("ngModelChange",function(e){a(i);let n=r(2);return A(n.Invoice.ClientType,e)||(n.Invoice.ClientType=e),l(e)}),p()()()()()}if(o&2){let i=r(2);s(4),C(" ",h(5,8,"SaleInvoice.Window")," "),s(3),b("ngModel",i.Invoice.ClientType),u("checked",i.Invoice.ClientType==1)("value",1),s(4),C(" ",h(12,10,"SaleInvoice.Always")," "),s(3),u("value",2)("checked",i.Invoice.ClientType==2),b("ngModel",i.Invoice.ClientType)}}function It(o,d){if(o&1&&(_(0,"span",59),m(1),v(2,"date"),p()),o&2){let i=r(2);s(),C(" ",ee(2,1,i.Invoice.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function vt(o,d){if(o&1){let i=T();_(0,"p-calendar",106),w("ngModelChange",function(e){a(i);let n=r(2);return A(n.Invoice.DocDate,e)||(n.Invoice.DocDate=e),l(e)}),p()}if(o&2){let i=r(2);b("ngModel",i.Invoice.DocDate),u("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function ht(o,d){if(o&1&&(_(0,"small",93),m(1),p()),o&2){let i=r(3);s(),E("Loaded ",i.StoreArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function gt(o,d){if(o&1&&m(0),o&2){let i=d.item;C(" ",i.Name," ")}}function St(o,d){if(o&1){let i=T();_(0,"button",112),S("click",function(){a(i);let e=r(3);return l(e.SecoundScreen(e.EnumScreen.Storage))}),V(1,"i",113),p()}}function ft(o,d){if(o&1){let i=T();_(0,"div",107)(1,"div",108)(2,"ng-select",109,9),v(4,"translate"),S("clear",function(){a(i);let e=r(2);return l(e.StoreArr=[])})("focus",function(){a(i);let e=y(3),n=r(2);return n.ChangeSearchApi("Storages",e),l(n._AppModeService.ResetCurrentPage())})("keyup",function(){a(i);let e=y(3),n=r(2);return n.ChangeSearchApi("Storages",e),l(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){a(i);let e=y(3),n=r(2);return l(n.ChangeSearchApi("Storages",e))})("close",function(){a(i);let e=r(2);return l(e._AppModeService.ResetCurrentPage())})("open",function(){a(i);let e=r(2);return l(e._AppModeService.ResetCurrentPage())})("change",function(){a(i);let e=r(2);return l(e.SelectValue(e.Invoice.StoreId,"Store"))}),w("ngModelChange",function(e){a(i);let n=r(2);return A(n.Invoice.StoreId,e)||(n.Invoice.StoreId=e),l(e)}),x(5,ht,2,2,"ng-template",28)(6,gt,1,1,"ng-template",29),p()(),_(7,"div",110),x(8,St,2,0,"button",111),p()()}if(o&2){let i=r(2);s(2),P("placeholder",h(4,8,"Place")),u("items",i.StoreArr)("dropdownPosition","top")("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",i.Invoice.StoreId),s(6),u("ngIf",i.ScreenName=="BuyInvoice")}}function yt(o,d){if(o&1&&(_(0,"small",93),m(1),p()),o&2){let i=r(3);s(),E("Loaded ",i.SupplierArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function xt(o,d){if(o&1&&m(0),o&2){let i=d.item;C(" ",i.Name," ")}}function Tt(o,d){if(o&1){let i=T();_(0,"div",107)(1,"div",108)(2,"ng-select",114,10),v(4,"translate"),S("clear",function(){a(i);let e=r(2);return l(e.SupplierArr=[])})("focus",function(){a(i);let e=y(3),n=r(2);return n.ChangeSearchApi("Suppliers",e),l(n._AppModeService.ResetCurrentPage())})("keyup",function(){a(i);let e=y(3),n=r(2);return n.ChangeSearchApi("Suppliers",e),l(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){a(i);let e=y(3),n=r(2);return l(n.ChangeSearchApi("Suppliers",e))})("change",function(){a(i);let e=r(2);return l(e.SelectValue(e.Invoice.SupplierId,"Supplier"))})("close",function(){a(i);let e=r(2);return l(e._AppModeService.ResetCurrentPage())})("open",function(){a(i);let e=r(2);return l(e._AppModeService.ResetCurrentPage())}),w("ngModelChange",function(e){a(i);let n=r(2);return A(n.Invoice.SupplierId,e)||(n.Invoice.SupplierId=e),l(e)}),x(5,yt,2,2,"ng-template",28)(6,xt,1,1,"ng-template",29),p()(),_(7,"div",115)(8,"button",116),S("click",function(){a(i);let e=r(2);return l(e.SecoundScreen(e.EnumScreen.Supplier))}),V(9,"i",117),p()()()}if(o&2){let i=r(2);s(2),P("placeholder",h(4,7,"BuyOffer.Supplier")),u("items",i.SupplierArr)("dropdownPosition","top")("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",i.Invoice.SupplierId)}}function Dt(o,d){if(o&1){let i=T();_(0,"input",120),w("ngModelChange",function(e){a(i);let n=r(3);return A(n.Invoice.ClientName,e)||(n.Invoice.ClientName=e),l(e)}),p()}if(o&2){let i=r(3);u("disabled",!0),b("ngModel",i.Invoice.ClientName)}}function Ct(o,d){if(o&1&&(_(0,"small",93),m(1),p()),o&2){let i=r(4);s(),E("Loaded ",i.ClientArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function bt(o,d){if(o&1&&m(0),o&2){let i=d.item;C(" ",i.Name," ")}}function At(o,d){if(o&1){let i=T();_(0,"ng-select",121,11),v(2,"translate"),S("clear",function(){a(i);let e=r(3);return l(e.ClientArr=[])})("focus",function(){a(i);let e=y(1),n=r(3);return n.ChangeSearchApi("Clients",e),l(n._AppModeService.ResetCurrentPage())})("keyup",function(){a(i);let e=y(1),n=r(3);return n.ChangeSearchApi("Clients",e),l(n._AppModeService.ResetCurrentPage())})("change",function(){a(i);let e=y(1),n=r(3);return l(n.ChangeSearchApi("Clients",e))})("scrollToEnd",function(){a(i);let e=y(1),n=r(3);return l(n.ChangeSearchApi("Clients",e))})("change",function(){a(i);let e=r(3);return l(e.SelectValue(e.Invoice.ClientId,"Client"))})("close",function(){a(i);let e=r(3);return l(e._AppModeService.ResetCurrentPage())})("open",function(){a(i);let e=r(3);return l(e._AppModeService.ResetCurrentPage())}),w("ngModelChange",function(e){a(i);let n=r(3);return A(n.Invoice.ClientId,e)||(n.Invoice.ClientId=e),l(e)}),x(3,Ct,2,2,"ng-template",28)(4,bt,1,1,"ng-template",29),p()}if(o&2){let i=r(3);P("placeholder",h(2,7,"SaleOffer.Client")),u("items",i.ClientArr)("dropdownPosition","top")("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",i.Invoice.ClientId)}}function wt(o,d){if(o&1){let i=T();_(0,"div",107)(1,"div",108),x(2,Dt,1,2,"input",118)(3,At,5,9,"ng-select",119),p(),_(4,"div",115)(5,"button",116),S("click",function(){a(i);let e=r(2);return l(e.SecoundScreen(e.EnumScreen.Client))}),V(6,"i",117),p()()()}if(o&2){let i=r(2);s(2),u("ngIf",i.Invoice.ClientType==1),s(),u("ngIf",i.Invoice.ClientType==2)}}function Nt(o,d){if(o&1&&(_(0,"div",122)(1,"div",123)(2,"span",124),m(3),v(4,"translate"),p(),_(5,"div",125),V(6,"input",126),p()(),_(7,"div",123)(8,"span",127),m(9),v(10,"translate"),p(),_(11,"div",125),V(12,"input",128),p()()()),o&2){let i=r(2);s(3),D(h(4,6,"NetThamBranch")),s(3),u("disabled",!0)("value",i._AppModeService.GetTwoNumberAfterZero(i.NetAccountPerson.NetThamBranch)),s(3),D(h(10,8,"NetOtherBranch")),s(3),u("disabled",!0)("value",i._AppModeService.GetTwoNumberAfterZero(i.NetAccountPerson.NetOtherBranch))}}function Vt(o,d){o&1&&(_(0,"option",132),m(1),v(2,"translate"),p()),o&2&&(u("value",3),s(),D(h(2,2,"SaleInvoice.Delivery")))}function Pt(o,d){if(o&1){let i=T();_(0,"div",38)(1,"input",135),v(2,"translate"),S("keyup",function(){a(i);let e=r(3);return l(e.ChangeCash())})("change",function(){a(i);let e=r(3);return l(e.ChangeCash())}),w("ngModelChange",function(e){a(i);let n=r(3);return A(n.Invoice.Cash,e)||(n.Invoice.Cash=e),l(e)}),p()()}if(o&2){let i=r(3);s(),P("placeholder",h(2,3,"SaleInvoice.Cash")),u("disabled",i.Invoice.PaymentType==3),b("ngModel",i.Invoice.Cash)}}function Mt(o,d){if(o&1&&(_(0,"small",93),m(1),p()),o&2){let i=r(4);s(),E("Loaded ",i.TreasuryArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function Bt(o,d){if(o&1&&m(0),o&2){let i=d.item;C(" ",i.Name," ")}}function Et(o,d){if(o&1){let i=T();_(0,"div",107)(1,"div",108)(2,"ng-select",136,12),v(4,"translate"),S("clear",function(){a(i);let e=r(3);return l(e.TreasuryArr=[])})("focus",function(){a(i);let e=y(3),n=r(3);return n.ChangeSearchApi("Treasury",e),l(n._AppModeService.ResetCurrentPage())})("keyup",function(){a(i);let e=y(3),n=r(3);return n.ChangeSearchApi("Treasury",e),l(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){a(i);let e=y(3),n=r(3);return l(n.ChangeSearchApi("Treasury",e))})("close",function(){a(i);let e=r(3);return l(e._AppModeService.ResetCurrentPage())})("open",function(){a(i);let e=r(3);return l(e._AppModeService.ResetCurrentPage())})("change",function(){a(i);let e=r(3);return l(e.SelectValue(e.Invoice.TreasuryId,"Treasury"))}),w("ngModelChange",function(e){a(i);let n=r(3);return A(n.Invoice.TreasuryId,e)||(n.Invoice.TreasuryId=e),l(e)}),x(5,Mt,2,2,"ng-template",28)(6,Bt,1,1,"ng-template",29),p()(),_(7,"div",115)(8,"button",116),S("click",function(){a(i);let e=r(3);return l(e.SecoundScreen(e.EnumScreen.Treasury))}),V(9,"i",117),p()()()}if(o&2){let i=r(3);s(2),P("placeholder",h(4,8,"BuyInvoice.Treasury")),u("items",i.TreasuryArr)("dropdownPosition","top")("autofocus",!1)("virtualScroll",!0)("searchable",!0)("disabled",i.Invoice.PaymentType==3||i.Invoice.Cash==""||i.Invoice.Cash==0),b("ngModel",i.Invoice.TreasuryId)}}function Rt(o,d){if(o&1){let i=T();_(0,"div",38)(1,"input",137),v(2,"translate"),S("keyup",function(){a(i);let e=r(3);return l(e.ChangeCash())})("change",function(){a(i);let e=r(3);return l(e.ChangeCash())}),w("ngModelChange",function(e){a(i);let n=r(3);return A(n.Invoice.Visa,e)||(n.Invoice.Visa=e),l(e)}),p()()}if(o&2){let i=r(3);s(),P("placeholder",h(2,3,"SaleInvoice.Visa")),u("disabled",i.Invoice.PaymentType==3),b("ngModel",i.Invoice.Visa)}}function kt(o,d){if(o&1&&(_(0,"small",93),m(1),p()),o&2){let i=r(4);s(),E("Loaded ",i.BankAccountArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function Ut(o,d){if(o&1&&m(0),o&2){let i=d.item;C(" ",i.Name," ")}}function Gt(o,d){if(o&1){let i=T();_(0,"div",107)(1,"div",108)(2,"ng-select",138,13),v(4,"translate"),S("clear",function(){a(i);let e=r(3);return l(e.BankAccountArr=[])})("focus",function(){a(i);let e=y(3),n=r(3);return n.ChangeSearchApi("BankAccounts",e),l(n._AppModeService.ResetCurrentPage())})("keyup",function(){a(i);let e=y(3),n=r(3);return n.ChangeSearchApi("BankAccounts",e),l(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){a(i);let e=y(3),n=r(3);return l(n.ChangeSearchApi("BankAccounts",e))})("close",function(){a(i);let e=r(3);return l(e._AppModeService.ResetCurrentPage())})("open",function(){a(i);let e=r(3);return l(e._AppModeService.ResetCurrentPage())})("change",function(){a(i);let e=r(3);return l(e.SelectValue(e.Invoice.BankAccountId,"BankAccount"))}),w("ngModelChange",function(e){a(i);let n=r(3);return A(n.Invoice.BankAccountId,e)||(n.Invoice.BankAccountId=e),l(e)}),x(5,kt,2,2,"ng-template",28)(6,Ut,1,1,"ng-template",29),p()(),_(7,"div",115)(8,"button",116),S("click",function(){a(i);let e=r(3);return l(e.SecoundScreen(e.EnumScreen.BankAccount))}),V(9,"i",117),p()()()}if(o&2){let i=r(3);s(2),P("placeholder",h(4,7,"BuyInvoice.Bank")),u("items",i.BankAccountArr)("dropdownPosition","top")("virtualScroll",!0)("searchable",!0)("disabled",i.Invoice.PaymentType==3||i.Invoice.Visa==""||i.Invoice.Visa==0),b("ngModel",i.Invoice.BankAccountId)}}function Ot(o,d){if(o&1&&(_(0,"small",93),m(1),p()),o&2){let i=r(4);s(),E("Loaded ",i.EmployeeArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function Wt(o,d){if(o&1&&m(0),o&2){let i=d.item;C(" ",i.Name," ")}}function Lt(o,d){if(o&1){let i=T();_(0,"div",38)(1,"p",139),m(2),v(3,"translate"),p(),_(4,"ng-select",140,14),S("clear",function(){a(i);let e=r(3);return l(e.EmployeeArr=[])})("focus",function(){a(i);let e=y(5),n=r(3);return n.ChangeSearchApi("Employee",e),l(n._AppModeService.ResetCurrentPage())})("keyup",function(){a(i);let e=y(5),n=r(3);return n.ChangeSearchApi("Employee",e),l(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){a(i);let e=y(5),n=r(3);return l(n.ChangeSearchApi("Employee",e))})("close",function(){a(i);let e=r(3);return l(e._AppModeService.ResetCurrentPage())})("open",function(){a(i);let e=r(3);return l(e._AppModeService.ResetCurrentPage())})("change",function(){a(i);let e=r(3);return l(e.SelectValue(e.Invoice.EmployeeId,"Employee"))}),w("ngModelChange",function(e){a(i);let n=r(3);return A(n.Invoice.EmployeeId,e)||(n.Invoice.EmployeeId=e),l(e)}),x(6,Ot,2,2,"ng-template",28)(7,Wt,1,1,"ng-template",29),p()()}if(o&2){let i=r(3);s(2),D(h(3,7,"BuyReport.Employee")),s(2),u("items",i.EmployeeArr)("dropdownPosition","top")("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",i.Invoice.EmployeeId)}}function Ht(o,d){if(o&1&&(V(0,"input",142),v(1,"translate")),o&2){let i=r(4);P("placeholder",h(1,3,"BuyInvoice.Debt")),P("value",i.Invoice.Debt),u("disabled",!0)}}function jt(o,d){if(o&1&&(_(0,"div",38),x(1,Ht,2,5,"input",141),p()),o&2){let i=r(3);s(),u("ngIf",i.Invoice.Debt!=null)}}function Ft(o,d){if(o&1){let i=T();_(0,"div",129)(1,"div",130)(2,"select",131),S("change",function(){a(i);let e=r(2);return l(e.ChangePamentType(e.Invoice.PaymentType))}),w("ngModelChange",function(e){a(i);let n=r(2);return A(n.Invoice.PaymentType,e)||(n.Invoice.PaymentType=e),l(e)}),_(3,"option",132),m(4),v(5,"translate"),p(),_(6,"option",132),m(7),v(8,"translate"),p(),x(9,Vt,3,4,"option",133),p()(),x(10,Pt,3,5,"div",134)(11,Et,10,10,"div",42)(12,Rt,3,5,"div",134)(13,Gt,10,9,"div",42)(14,Lt,8,9,"div",134)(15,jt,2,1,"div",134),p()}if(o&2){let i=r(2);s(2),b("ngModel",i.Invoice.PaymentType),s(),u("value",1),s(),D(h(5,12,"SaleInvoice.Cash")),s(2),u("value",2),s(),D(h(8,14,"SaleInvoice.Debt")),s(2),u("ngIf",i.ScreenName=="SaleInvoice"),s(),u("ngIf",i.Invoice.PaymentType!=3),s(),u("ngIf",i.Invoice.PaymentType!=3),s(),u("ngIf",i.Invoice.PaymentType!=3),s(),u("ngIf",i.Invoice.PaymentType!=3),s(),u("ngIf",i.Invoice.PaymentType==3),s(),u("ngIf",i.Invoice.PaymentType==2)}}function Qt(o,d){if(o&1&&(_(0,"div")(1,"span",46),m(2),v(3,"translate"),p(),_(4,"span",47),m(5),p()()),o&2){let i=r(2);s(2),D(h(3,2,"SaleInvoice.TotalDiscount")),s(3),C("",i._AppModeService.GetTwoNumberAfterZero(i.Invoice.TotalDisc)," ")}}function $t(o,d){if(o&1&&(_(0,"div")(1,"span",46),m(2),v(3,"translate"),p(),_(4,"span",47),m(5),p()()),o&2){let i=r(2);s(2),D(h(3,2,"SaleInvoice.DiscountRate")),s(3),C("",i._AppModeService.GetTwoNumberAfterZero(i.Invoice.TotalDiscRate)," ")}}function Zt(o,d){if(o&1&&(_(0,"i",46),m(1),v(2,"translate"),_(3,"i",56),m(4),p()()),o&2){let i=r(2);s(),C("",h(2,2,"SaleInvoice.TotalVat")," "),s(3),C(" ",i._DefaultSettingsService.DefaultSettings==null?null:i._DefaultSettingsService.DefaultSettings.Vat," % ")}}function Jt(o,d){if(o&1&&(_(0,"i",46),m(1),v(2,"translate"),_(3,"i",56),m(4),p()()),o&2){let i=r(2);s(),C(" ",h(2,2,"SaleInvoice.TotalVat")," "),s(3),C(" ",i._AppModeService.GetTwoNumberAfterZero(i.Invoice.TotalVatRate)," % ")}}function qt(o,d){if(o&1&&(_(0,"div")(1,"span",46),m(2),v(3,"translate"),p(),_(4,"span",47),m(5),p()()),o&2){let i=r(2);s(2),D(h(3,2,"BuyInvoice.ReturnAmount")),s(3),C(" ",i._AppModeService.GetTwoNumberAfterZero(i.ReturnAmount)," ")}}function Kt(o,d){if(o&1){let i=T();_(0,"button",143),S("click",function(){a(i);let e=r(2);return l(e.Save())}),m(1),v(2,"translate"),_(3,"span",56),m(4,"Ctrl + Space"),p(),V(5,"i",144),p()}if(o&2){let i=r(2);u("disabled",i._AppModeService.DisabledButton),s(),C(" ",h(2,2,"Model.Save")," ")}}function zt(o,d){if(o&1){let i=T();_(0,"button",75),S("click",function(){a(i);let e=r(3);return l(e.Save())}),m(1),v(2,"translate"),_(3,"span",56),m(4,"Ctrl + Space"),p(),V(5,"i",144),p()}if(o&2){let i=r(3);u("disabled",i._AppModeService.DisabledButton),s(),C(" ",h(2,2,"Model.Update")," ")}}function Xt(o,d){if(o&1&&(_(0,"span"),x(1,zt,6,4,"button",145),p()),o&2){let i=r(2);s(),u("ngIf",i.Invoice.Id!=0)}}function Yt(o,d){if(o&1){let i=T();_(0,"button",146),S("click",function(){a(i);let e=r(2);return l(e.OpenGl())}),m(1),v(2,"translate"),p()}o&2&&(s(),C(" ",h(2,1,"Model.Gl")," "))}function ei(o,d){if(o&1){let i=T();_(0,"button",147),S("click",function(){a(i);let e=r(2);return l(e.HoldInvoice())}),m(1," \u062A\u0639\u0644\u064A\u0642 Hold "),_(2,"span",56),m(3,"Ctrl + X"),p()()}if(o&2){let i=r(2);u("disabled",i._AppModeService.DisabledButton)}}function ti(o,d){if(o&1){let i=T();_(0,"button",148),S("click",function(){a(i);let e=r(2);return l(e.ShowHoldInvoice())}),m(1," \u0639\u0631\u0636 Hold "),_(2,"span",56),m(3,"Ctrl + Z"),p()()}if(o&2){let i=r(2);u("disabled",i._AppModeService.DisabledButton)}}function ii(o,d){if(o&1){let i=T();V(0,"app-modal-header",19),_(1,"div",20)(2,"div",21)(3,"p-table",22),x(4,et,21,17,"ng-template",23)(5,st,49,48,"ng-template",24),p()()(),_(6,"div",25)(7,"div",26)(8,"ng-select",27,6),S("clear",function(){a(i);let e=r();return l(e.ItemsBarCode=[])})("focus",function(){a(i);let e=y(9),n=r();return n.HandleProductCode(e),l(n._AppModeService.ResetCurrentPage())})("keyup",function(){a(i);let e=y(9),n=r();return n.HandleProductCode(e),l(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){a(i);let e=y(9),n=r();return l(n.HandleProductCode(e))})("close",function(){a(i);let e=r();return e._AppModeService.ResetCurrentPage(),l(e.ItemsBarCode=[])})("open",function(){a(i);let e=r();return l(e._AppModeService.ResetCurrentPage())})("change",function(){a(i);let e=y(9),n=r();return n.SelectProductScan(n.ProductBarCodeId),e.handleClearClick(),e.blur(),l(n.ItemsBarCode=[])}),w("ngModelChange",function(e){a(i);let n=r();return A(n.ProductBarCodeId,e)||(n.ProductBarCodeId=e),l(e)}),x(10,_t,2,2,"ng-template",28)(11,pt,1,2,"ng-template",29),p()(),_(12,"div",30),x(13,dt,3,5,"div",31)(14,ut,3,4,"div",31),p(),_(15,"div",32),V(16,"input",33),p(),_(17,"div",34)(18,"input",35),v(19,"translate"),w("ngModelChange",function(e){a(i);let n=r();return A(n.Invoice.Notes,e)||(n.Invoice.Notes=e),l(e)}),p()(),x(20,mt,15,12,"div",36),p(),_(21,"div",37)(22,"div",38),x(23,It,3,4,"span",39)(24,vt,1,5,"p-calendar",40),p(),x(25,ft,9,10,"div",41)(26,Tt,10,9,"div",41)(27,wt,7,2,"div",42)(28,Nt,13,10,"div",43)(29,Ft,16,16,"div",44),p(),_(30,"div",45)(31,"div")(32,"span",46),m(33),v(34,"translate"),p(),_(35,"span",47),m(36),p()(),_(37,"div")(38,"span",46),m(39),v(40,"translate"),p(),_(41,"span",47),m(42),p()(),x(43,Qt,6,4,"div",48)(44,$t,6,4,"div",48),_(45,"div")(46,"span"),x(47,Zt,5,4,"i",49)(48,Jt,5,4,"i",49),p(),_(49,"span",47),m(50),p()(),_(51,"div")(52,"span",46),m(53),v(54,"translate"),p(),_(55,"span",47),m(56),p()(),x(57,qt,6,4,"div",48),p(),_(58,"div",50),x(59,Kt,6,4,"button",51)(60,Xt,2,1,"span",48)(61,Yt,3,3,"button",52)(62,ei,4,1,"button",53)(63,ti,4,1,"button",54),_(64,"button",55),S("click",function(){let e=a(i).$implicit,n=r();return e.close("Close click"),l(n.ResetPage())}),m(65),v(66,"translate"),_(67,"span",56),m(68,"Esc"),p(),V(69,"i",57),p()()}if(o&2){let i=r();u("PageTitle",i.PageTitle),s(3),u("value",i.Invoice.InvoiceDetails)("responsive",!0)("scrollable",!0),s(5),u("dropdownPosition","top")("items",i.ItemsBarCode)("virtualScroll",!0)("searchable",!0),b("ngModel",i.ProductBarCodeId),s(5),u("ngIf",(i._DefaultSettingsService.DefaultSettings==null?null:i._DefaultSettingsService.DefaultSettings.HideColumnDiscountRate)==!1),s(),u("ngIf",(i._DefaultSettingsService.DefaultSettings==null?null:i._DefaultSettingsService.DefaultSettings.HideColumnDiscount)==!1),s(2),u("value",i.Invoice.DocNo)("disabled",!0),s(2),P("placeholder",h(19,41,"Table.Notes")),b("ngModel",i.Invoice.Notes),s(2),u("ngIf",i.ScreenName=="SaleOffer"||i.ScreenName=="SaleInvoice"),s(3),u("ngIf",i._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!1),s(),u("ngIf",i._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!0),s(),u("ngIf",i.ScreenName=="BuyInvoice"||i.ScreenName=="SaleInvoice"&&i._DefaultSettingsService.DefaultSettings.HideSorage==!1),s(),u("ngIf",i.ScreenName=="BuyOffer"||i.ScreenName=="BuyInvoice"),s(),u("ngIf",i.ScreenName=="SaleOffer"||i.ScreenName=="SaleInvoice"),s(),u("ngIf",i._DefaultSettingsService.DefaultSettings.HidePersonBalanceBranch==!1),s(),u("ngIf",i.ScreenName=="BuyInvoice"||i.ScreenName=="SaleInvoice"),s(4),D(h(34,43,"ProductCount")),s(3),D(i.Invoice.InvoiceDetails.length),s(3),D(h(40,45,"SaleInvoice.TotalInvoice")),s(3),C(" ",i._AppModeService.GetTwoNumberAfterZero(i.Invoice.TotalInvoice)," "),s(),u("ngIf",(i._DefaultSettingsService.DefaultSettings==null?null:i._DefaultSettingsService.DefaultSettings.HideColumnDiscount)==!1),s(),u("ngIf",(i._DefaultSettingsService.DefaultSettings==null?null:i._DefaultSettingsService.DefaultSettings.HideColumnDiscountRate)==!1),s(3),u("ngIf",i.Invoice.Id==0),s(),u("ngIf",i.Invoice.Id>0),s(2),D(i._AppModeService.GetTwoNumberAfterZero(i.Invoice.TotalInvoiceVatAmount)),s(3),D(h(54,47,"SaleInvoice.TotalAfterVat")),s(3),C("",i._AppModeService.GetTwoNumberAfterZero(i.Invoice.TotalInvoiceAfterVat)," "),s(),u("ngIf",(i.ScreenName=="BuyInvoice"||i.ScreenName=="SaleInvoice")&&i.Invoice.Id>0),s(2),u("ngIf",i.Invoice.Id==0),s(),u("ngIf",i._Apiservice.environment.SystemUpdate&&(i.ScreenName=="BuyInvoice"||i.ScreenName=="SaleInvoice")||i.ScreenName!="BuyInvoice"&&i.ScreenName!="SaleInvoice"),s(),u("ngIf",i.Invoice.Id>0),s(),u("ngIf",i.ScreenName=="BuyInvoice"||i.ScreenName=="SaleInvoice"),s(),u("ngIf",i.ScreenName=="BuyInvoice"||i.ScreenName=="SaleInvoice"),s(2),C(" ",h(66,49,"Model.Close")," ")}}function ni(o,d){if(o&1){let i=T();z(0),_(1,"app-dynamic-component",149,15),S("ShowToEditeNoDataViewEvent",function(e){let n=a(i).$implicit,c=r();return l(c.GetSaleHold(e,n))}),p(),X(),_(3,"div",50)(4,"button",55),S("click",function(){let e=a(i).$implicit;return l(e.close("Close click"))}),m(5),v(6,"translate"),p()()}if(o&2){let i=r();s(),u("PageTitle","SaleInvoice.AllHold")("TablePaging",i.OutTablePaging)("IsModal",!0)("GetById","HoldInvoiceEP/GetById")("DeleteUrl","HoldInvoiceEP/Delete"),s(4),D(h(6,6,"Model.Close"))}}function oi(o,d){if(o&1&&(_(0,"tr")(1,"td")(2,"span",153),m(3),p()(),_(4,"td")(5,"span",153),m(6),p()()()),o&2){let i=d.$implicit;s(3),D(i.Name+" - "+i.UnitFactor),s(3),D(i.Qty)}}function ri(o,d){if(o&1&&(_(0,"div",150)(1,"table",151)(2,"thead")(3,"tr")(4,"th"),m(5),v(6,"translate"),p(),_(7,"th"),m(8),v(9,"translate"),p()()(),_(10,"tbody"),x(11,oi,7,2,"tr",152),p()()()),o&2){let i=r();s(5),D(h(6,3,"SaleInvoice.Name")),s(3),D(h(9,5,"Table.Balance")),s(3),u("ngForOf",i.ItemBalanceList)}}function ci(o,d){if(o&1){let i=T();_(0,"app-dynamic-modal",154),S("CloseParentModel",function(){let e=a(i).$implicit,n=r();return e.close("model close"),l(n.ResetSharedScreen())}),p()}if(o&2){let i=r();u("PageTitle",i.SharedScreen.PageTitle)("DataView",i.SharedScreen.DataView)("AddUrl",i.SharedScreen.AddUrl)("UpdateUrl",i.SharedScreen.UpdateUrl)("DeleteUrl",i.SharedScreen.DeleteUrl)("NotInsertTablePaging",!0)("GetById",i.SharedScreen.GetById)}}var Ei=(()=>{let d=class d{constructor(t,e,n,c,I,f,g){this._SharedScreenService=t,this._ScaleSettingsService=e,this._ActivatedRoute=n,this._SharedObjectModelService=c,this._DefaultSettingsService=I,this._AppModeService=f,this._Apiservice=g,this.SignalR=!1,this.GlResponse=!1,this.TablePaging={},this.OutTablePaging={},this.PageTitle="",this.ScreenName="",this.AddUrl="",this.UpdateUrl="",this.DeleteUrl="",this.GetById="",this.PrintUrl="",this.Invoice={InvoiceCollected:!1,ClientType:2,DocNo:0,DocDate:"",InvoiceDetails:[{Code:"",Name:"",ProductType:0,Items:[],ProductUnits:[],Balance:0,ProductId:null,ProductUnitId:null,Price:"",Quantity:"",TotalPrice:0,TotalPriceAfterVat:0,TotalPriceAfterDiscount:0,Discount:"",DiscountRate:"",Vat:this._DefaultSettingsService.DefaultSettings.Vat,Id:0,Notes:"",ProductName:"",UnitName:""}],TotalInvoice:0,TotalDiscRate:0,TotalDisc:0,TotalInvoiceAfterDisc:0,TotalInvoiceAfterVat:0,TotalInvoiceVatAmount:0,TotalVatRate:0,Cash:"",Visa:"",Debt:"",TreasuryId:null,TreasuryName:"",BankAccountId:null,BankAccountName:"",EmployeeId:null,EmployeeName:"",StoreId:null,StoreName:"",ClientId:null,ClientName:"",SupplierId:null,SupplierName:"",Id:0,PaymentType:1,Name:"",Notes:"",Code:"",InvoiceCollection:0},this.SupplierArr=[],this.ClientArr=[],this.TreasuryArr=[],this.BankAccountArr=[],this.EmployeeArr=[],this.StoreArr=[],this.ItemBalanceList=[],this.NetAccountPerson={NetThamBranch:0,NetOtherBranch:0},this.ReturnAmount=0,this.GlobalDiscountRate="",this.GlobalDiscount="",this.ItemsBarCode=[],this.ProductBarCodeId=null,this.Weight="",this.SharedScreen={AddUrl:"",DataView:[],DeleteUrl:"",PageTitle:"",TablePaging:{},UpdateUrl:"",GetById:""},this.EnumScreen={None:0,Client:1,Supplier:2,Treasury:3,BankAccount:4,Storage:5}}ngOnChanges(){let t=Number(this._ActivatedRoute.snapshot.queryParams.Id);t>0&&this.GetByIdRoute(t)}ngOnInit(){this.SignalR&&(this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener())}StartConnection(){this.Hub_Connection=new Ue().withUrl(`${re.signalrUrl}/${this.ScreenName}`,{skipNegotiation:!0,transport:ke.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(Re.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(t=>{console.log(t)})}ServerListener(){this.Hub_Connection?.on(`Update${this.ScreenName}`,t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Invoice.Id&&(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.UpdateModelAnother"),t.User),this._AppModeService._NgbModal.dismissAll())}),this.Hub_Connection?.on(`Delete${this.ScreenName}`,t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Invoice.Id&&(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.DeleteModelAnother"),t.User),this.DynamicComponent.Paging.DataReturn=this.DynamicComponent.Paging.DataReturn.filter(n=>n.Id!=t.Id),this._AppModeService._NgbModal.dismissAll())})}GetPageInfo(){this._Apiservice.get(`${this.ScreenName}EP/GetPageInfo`,!1).pipe(M(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this.Invoice.DocNo=t.Obj,this._AppModeService.DisabledButton=!1):(this._AppModeService.DisabledButton=!1,this._AppModeService._Toastr.error(t.Message))},error:t=>{this._AppModeService.DisabledButton=!1}})}OpenModal(){this._AppModeService.DisabledButton=!0,this.ResetPage(),this.GetPageInfo()}OpenGl(){this.GLComponent.Open()}ChangeSearchApi(t,e){let n="";n=`${e.searchTerm}`.trim(),(n==""||n=="null")&&(e.searchTerm="",n=""),this._AppModeService.CurrentPage+=1;let c={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:n,SearchField:"Name"};t=="Storages"&&(c.BranchFilter=!0),t=="Treasury"&&(c.BranchFilter=!0),t=="Items"&&(c.Columns=["Id","Name","Code"],c.SearchField="Code"),this._Apiservice.post("Global/GetAll",c,!1).pipe(M(this._Apiservice.destroy$)).subscribe({next:I=>{I.IsSuccess==!0&&I.Obj!=null?this.HandleResponse(I.Obj,t):this._AppModeService._Toastr.error(I.Message)}})}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Suppliers"&&(this.SupplierArr=this._SharedObjectModelService.RemoveDuplicates(this.SupplierArr.concat(t.DataReturn),"Id")),e=="Clients"&&(this.ClientArr=this._SharedObjectModelService.RemoveDuplicates(this.ClientArr.concat(t.DataReturn),"Id")),e=="Storages"&&(this.StoreArr=this._SharedObjectModelService.RemoveDuplicates(this.StoreArr.concat(t.DataReturn),"Id")),e=="Treasury"&&(this.TreasuryArr=this._SharedObjectModelService.RemoveDuplicates(this.TreasuryArr.concat(t.DataReturn),"Id")),e=="BankAccounts"&&(this.BankAccountArr=this._SharedObjectModelService.RemoveDuplicates(this.BankAccountArr.concat(t.DataReturn),"Id")),e=="Employee"&&(this.EmployeeArr=this._SharedObjectModelService.RemoveDuplicates(this.EmployeeArr.concat(t.DataReturn),"Id")),e=="Items"&&(this.ItemsBarCode=this._SharedObjectModelService.RemoveDuplicates(this.ItemsBarCode.concat(t.DataReturn),"Id").map(n=>G(U({},n),{NameAndCode:n.Code!=null?`${n.Name} - ${n.Code}`:`${n.Name}`})))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let n=[];e=="Supplier"&&(n=this.SupplierArr),e=="Client"&&(n=this.ClientArr),e=="Store"&&(n=this.StoreArr),e=="Treasury"&&(n=this.TreasuryArr),e=="BankAccount"&&(n=this.BankAccountArr),e=="Employee"&&(n=this.EmployeeArr);let c=n.find(I=>I.Id==t);if(c==null){this._AppModeService.DontPlay();return}else this.Invoice[`${e}Id`]=t,this.Invoice[`${e}Name`]=c.Name,e=="Supplier"&&this.GetNetSupplier(t),e=="Client"&&this.GetNetClient(t)}else this.Invoice[`${e}Id`]=null,this.Invoice[`${e}Name`]="",(e=="Supplier"||e=="Client")&&(this.NetAccountPerson={NetThamBranch:0,NetOtherBranch:0})}HandleProductCode(t){let e="";if(e=`${t.searchTerm}`.trim(),e=="null"&&(t.searchTerm="",e="",t.searchTerm=e),e!=""){for(let n=0;n<this._ScaleSettingsService.ScaleSettingsArr.length;n++){let c=this._ScaleSettingsService.ScaleSettingsArr[n];if(e.length==c.BarCodeLength&&e.startsWith(c.ZaraNumber)){let I=e.substring(c.ZaraNumber.length,c.BarCodeLength).substring(0,c.ProductCodeLength);this.Weight=e.substring(c.ZaraNumber.length).substring(c.ProductCodeLength);let f=Number(this.Weight.substring(0,2)),g=Number(this.Weight.substring(2,this.Weight.length));this.Weight=`${f}.${g}`,t.searchTerm=I,this.ChangeSearchApi("Items",t);break}}return}else this.ChangeSearchApi("Items",t)}SelectProductScan(t){if(t!=null&&t>0){let e=this.ItemsBarCode.find(I=>I.Id==t),n=this.Invoice.InvoiceDetails.findIndex(I=>I.ProductId===null),c=this.Invoice.InvoiceDetails[n];if(c!=null)c.Items=[{Id:e.Id,Name:e.Name,NameAndCode:e.Name+" - "+e.Code}],c.ProductId=t,this.AfterSelectem(t,n);else{this.AppendRow();let I=this.Invoice.InvoiceDetails.findIndex(g=>g.ProductId===null),f=this.Invoice.InvoiceDetails[I];f.Items=[{Id:e.Id,Name:e.Name,NameAndCode:e.Name+" - "+e.Code}],f.ProductId=t,this.AfterSelectem(t,I)}this.ItemsBarCode=[],this.ProductBarCodeId=null}this._AppModeService._Toastr.ScannerSound()}ChangeSearchApiDetails(t,e,n){let c=`${e.searchTerm}`.trim();(c==""||c=="null")&&(e.searchTerm="",c="");let I="";this.ScreenName=="BuyInvoice"&&t=="Items"&&(I="ProductType != 2"),this.ScreenName=="SaleInvoice"&&this._DefaultSettingsService.DefaultSettings.HideSorage==!0&&t=="Items"&&(I="ProductType = 2"),this._AppModeService.CurrentPage+=1;let f={TableName:t,Columns:["Id","Name"],Conditions:I,PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:c,SearchField:"Name"};if(t=="Items"&&(f.Columns=["Id","Name","Code"],f.ItemWithItemUnit=!0),t=="ItemUnits"){let g=this.Invoice.InvoiceDetails[n].ProductId==null?0:this.Invoice.InvoiceDetails[n].ProductId;f.Conditions=`ItemId = ${g}`,f.Join=!0,f.JoinTables=["Units U"],f.NoPaging=!0,f.JoinConditions=["T.UnitId = U.Id"],f.Columns=["T.Id","U.Name","T.UnitFactor"],f.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",f,!1).pipe(M(this._Apiservice.destroy$)).subscribe({next:g=>{g.IsSuccess==!0&&g.Obj!=null?this.HandleResponseDetails(g.Obj,t,n):this._AppModeService._Toastr.error(g.Message)}})}HandleResponseDetails(t,e,n){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Items"&&(this.Invoice.InvoiceDetails[n].Items=this._SharedObjectModelService.RemoveDuplicates(this.Invoice.InvoiceDetails[n].Items.concat(t.DataReturn),"Id"),this.Invoice.InvoiceDetails[n].Items=this.Invoice.InvoiceDetails[n].Items.map(c=>G(U({},c),{NameAndCode:c.Code!=null?`${c.Name} - ${c.Code}`:`${c.Name}`}))),e=="ItemUnits"&&(this.Invoice.InvoiceDetails[n].ProductUnits=t.DataReturn.map(c=>G(U({},c),{NameAndUnitFactor:c.UnitFactor!=null?`${c.Name} - ${c.UnitFactor}`:`${c.Name}`})))}AppendRow(){let t={ProductType:0,ProductUnits:[],Items:[],ProductId:null,ProductUnitId:null,Balance:0,Price:"",Quantity:"",TotalPrice:0,TotalPriceAfterVat:0,TotalPriceAfterDiscount:0,Discount:"",DiscountRate:"",Vat:this._DefaultSettingsService.DefaultSettings.Vat,Code:"",Name:"",Id:0,Notes:"",ProductName:"",UnitName:""};this.Invoice.InvoiceDetails.push(t),this._AppModeService.AppendTd()}RemoveRow(t){return this.Invoice.InvoiceDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.Invoice.InvoiceDetails.splice(t,1),this.CalcInvoice(),!0)}SelectItem(t,e){if(t!=null&&t>0){let n=this.Invoice.InvoiceDetails[e].Items.find(c=>c.Id==t);if(n!=null)this.Invoice.InvoiceDetails[e].ProductId=n.Id,this.Invoice.InvoiceDetails[e].ProductName=n.Name,this.Invoice.InvoiceDetails[e].ProductUnitId=null,this.Invoice.InvoiceDetails[e].ProductUnits=[],this.AfterSelectem(n.Id,e);else{this._Apiservice.DontPlay();return}}else this.Invoice.InvoiceDetails[e].ProductUnitId=null,this.Invoice.InvoiceDetails[e].ProductUnits=[],this.ScreenName=="SaleInvoice"&&(this.Invoice.InvoiceDetails[e].Price="")}AfterSelectem(t,e){if(t>0){let n={TableName:"ItemUnits",Columns:["Id","Name"],NoPaging:!0,SearchText:"",SearchField:"Name"};n.Conditions=`ItemId = ${t}`,n.Join=!0,n.JoinTables=["Units U"],n.JoinConditions=["T.UnitId = U.Id"],n.Columns=["T.Id","U.Name","T.UnitFactor","T.DefaultUnit"],n.SearchField="U.Name",this._Apiservice.post("Global/GetAll",n,!1).pipe(M(this._Apiservice.destroy$)).subscribe({next:c=>{if(c.IsSuccess==!0&&c.Obj!=null){c.Obj.DataReturn=c.Obj.DataReturn.map(g=>G(U({},g),{NameAndUnitFactor:g.UnitFactor!=null?`${g.Name} - ${g.UnitFactor}`:`${g.Name}`}));let I=c.Obj.DataReturn,f=I.find(g=>g.DefaultUnit==!0);if(f&&this.Invoice.InvoiceDetails.find(N=>N.ProductId==t&&N.ProductUnitId==f.Id)==null){this.Invoice.InvoiceDetails[e].ProductUnits=[{Id:f.Id,NameAndUnitFactor:f.Name+" - "+f.UnitFactor}],this.Invoice.InvoiceDetails[e].ProductUnitId=f.Id,this.Invoice.InvoiceDetails[e].Quantity=this.Weight!=""?this.Weight:1,Number(this.GlobalDiscount)>0&&(this.Invoice.InvoiceDetails[e].Discount=Number(this.GlobalDiscount)),Number(this.GlobalDiscountRate)>0&&(this.Invoice.InvoiceDetails[e].DiscountRate=Number(this.GlobalDiscountRate)),this.Weight="",this.ScreenName=="SaleInvoice"?this.SelectUnit(f.Id,e):this.ChangeGlobalDis("");return}for(let g=0;g<I.length;g++){let N=this.Invoice.InvoiceDetails.find(R=>R.ProductId==t&&R.ProductUnitId==I[g].Id);if(N==null){this.Invoice.InvoiceDetails[e].ProductUnits=[{Id:I[g].Id,NameAndUnitFactor:I[g].Name+" - "+I[g].UnitFactor}],this.Invoice.InvoiceDetails[e].ProductUnitId=I[g].Id,this.Invoice.InvoiceDetails[e].Quantity=this.Weight!=""?this.Weight:1,Number(this.GlobalDiscount)>0&&(this.Invoice.InvoiceDetails[e].Discount=Number(this.GlobalDiscount)),Number(this.GlobalDiscountRate)>0&&(this.Invoice.InvoiceDetails[e].DiscountRate=Number(this.GlobalDiscountRate)),this.Weight="",this.ScreenName=="SaleInvoice"?this.SelectUnit(I[g].Id,e):this.ChangeGlobalDis("");break}N!=null&&g==I.length-1&&this.Invoice.InvoiceDetails.splice(e,1)}this.CalcInvoice()}else this._AppModeService._Toastr.error(c.Message)}})}}SelectUnit(t,e){if(t!=null&&t>0){let n=this.Invoice.InvoiceDetails[e].ProductUnits.find(c=>c.Id==t);if(n!=null){if(this.Invoice.InvoiceDetails[e].ProductUnitId=n.Id,this.Invoice.InvoiceDetails[e].ProductUnitName=n.Name,this.ScreenName=="SaleInvoice"){this._AppModeService.DisabledButton=!0;let c={ProductId:this.Invoice.InvoiceDetails[e].ProductId,ProductUnitId:n.Id};this._Apiservice.post("ProductPricingEP/ProductPice",c,!1).pipe(M(this._Apiservice.destroy$)).subscribe({next:I=>{I.IsSuccess==!0&&I.Obj!=null?(this.Invoice.InvoiceDetails[e].Price=I.Obj,this.ChangeGlobalDis(""),this._AppModeService.DisabledButton=!1):(this._AppModeService.DisabledButton=!1,this._AppModeService._Toastr.error(I.Message))},error:I=>{this._AppModeService.DisabledButton=!1},complete:()=>{this._AppModeService.DisabledButton=!1}})}}else{this._Apiservice.DontPlay();return}}else this.ScreenName=="SaleInvoice"&&(this.Invoice.InvoiceDetails[e].Price="")}ProductBalance(t,e){this._AppModeService.DisabledButton=!0;let n={ProductId:this.Invoice.InvoiceDetails[t].ProductId==null?0:this.Invoice.InvoiceDetails[t].ProductId,StoreId:this.Invoice.StoreId==null?0:this.Invoice.StoreId};this._Apiservice.post("ItemEP/ProductBalance",n,!0).pipe(M(this._Apiservice.destroy$)).subscribe({next:c=>{c.IsSuccess==!0&&c.Obj!=null?(this._AppModeService.DisabledButton=!1,this.ItemBalanceList=c.Obj.StorageBalance,this._AppModeService._NgbModal.open(e,{size:"xl",centered:!0})):(this._AppModeService.DisabledButton=!1,this._AppModeService._Toastr.error(c.Message))},error:c=>{this._AppModeService.DisabledButton=!1}})}ChangeClientType(t){this.Invoice.ClientId=null,this.Invoice.ClientName=" ",t==1&&(this.Invoice.ClientType=1,this.Invoice.ClientName="\u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u0627\u0641\u062A\u0631\u0627\u0636\u064A"),t==2&&(this.Invoice.ClientType=2),this.NetAccountPerson={NetThamBranch:0,NetOtherBranch:0}}Discount(t,e){let n=this.Invoice.InvoiceDetails[e];t=="DiscountRate"&&Number(n.DiscountRate)>0&&(n.Discount=""),t=="Discount"&&Number(n.Discount)>0&&(n.DiscountRate=""),(Number(n.DiscountRate)>100||Number(n.DiscountRate)<0)&&(n.DiscountRate=""),Number(n.Discount)<0&&(n.Discount=""),Number(n.Price)<0&&(n.Price=""),Number(n.Quantity)<0&&(n.Quantity=""),this.CalcInvoice()}ChangeGlobalDis(t){let e="",n="";if(t=="GlobalDiscountRate"&&(n=isNaN(Number(this.GlobalDiscountRate))==!0||Number(this.GlobalDiscountRate)==0?"":Number(this.GlobalDiscountRate),this.GlobalDiscount="",e=""),t=="GlobalDiscount"&&(e=isNaN(Number(this.GlobalDiscount))==!0||Number(this.GlobalDiscount)==0?"":Number(this.GlobalDiscount),this.GlobalDiscountRate="",n=""),t==""){n=isNaN(Number(this.GlobalDiscountRate))==!0||Number(this.GlobalDiscountRate)==0?"":Number(this.GlobalDiscountRate),e=isNaN(Number(this.GlobalDiscount))==!0||Number(this.GlobalDiscount)==0?"":Number(this.GlobalDiscount),this.GlobalDiscountRate=n,this.GlobalDiscount=e,Number(e)==0&&Number(n)==0&&this.CalcInvoice();return}for(let c=0;c<this.Invoice.InvoiceDetails.length;c++)Number(this.Invoice.InvoiceDetails[c].ProductId)>0&&(this.Invoice.InvoiceDetails[c].Discount=e,this.Invoice.InvoiceDetails[c].DiscountRate=n);this.CalcInvoice()}Button(t,e,n){e=="+"&&this.Invoice.InvoiceDetails[n][`${t}`]++,e=="-"&&(this.Invoice.InvoiceDetails[n][`${t}`]=this.Invoice.InvoiceDetails[n][`${t}`]<=0?0:this.Invoice.InvoiceDetails[n][`${t}`]-1),this.CalcInvoice()}GetNetSupplier(t){this._DefaultSettingsService.DefaultSettings.HidePersonBalanceBranch==!1&&this._Apiservice.getById("SupplierEP/SupplierNetAmount",t,!1).pipe(M(this._Apiservice.destroy$)).subscribe({next:e=>{this._AppModeService.DisabledButton=!1,e.IsSuccess==!0&&e.Obj!=null?this.NetAccountPerson={NetThamBranch:e.Obj.NetThamBranch,NetOtherBranch:e.Obj.NetOtherBranch}:this._AppModeService._Toastr.error(e.Message)},error:e=>{this._AppModeService.DisabledButton=!1}})}GetNetClient(t){this._DefaultSettingsService.DefaultSettings.HidePersonBalanceBranch==!1&&this._Apiservice.getById("ClientEP/ClientNetAmount",t,!1).pipe(M(this._Apiservice.destroy$)).subscribe({next:e=>{this._AppModeService.DisabledButton=!1,e.IsSuccess==!0&&e.Obj!=null?this.NetAccountPerson={NetThamBranch:e.Obj.NetThamBranch,NetOtherBranch:e.Obj.NetOtherBranch}:this._AppModeService._Toastr.error(e.Message)},error:e=>{this._AppModeService.DisabledButton=!1}})}GetByIdRoute(t){this._Apiservice.getById(this.GetById,t,!0).pipe(M(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.GLComponent.Gl=e.Obj.Gl,this.Drow(e.Obj.model),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(e.Message)}})}ShowToEdite(t){this.GLComponent.Gl=t.Gl,this.ReturnAmount=t.ReturnAmount,this.Drow(t.PageModel)}Drow(t){this.Invoice={Id:t.Id,PaymentType:t.PaymentType,Name:t.Name,Notes:t.Notes,Code:t.Code,InvoiceCollection:t.InvoiceCollection,InvoiceCollected:t.InvoiceCollected,ClientType:t.ClientType,DocNo:t.DocNo,DocDate:new Date(t.DocDate),TotalInvoice:t.TotalInvoice,TotalDiscRate:t.TotalDiscRate,TotalDisc:t.TotalDisc,TotalInvoiceAfterDisc:t.TotalInvoiceAfterDisc,TotalInvoiceAfterVat:t.TotalInvoiceAfterVat,TotalInvoiceVatAmount:t.TotalInvoiceVatAmount,TotalVatRate:t.TotalVatRate,Cash:t.Cash,Visa:t.Visa,Debt:t.Debt,SupplierId:t.SupplierId,SupplierName:t.SupplierName,ClientId:t.ClientId,ClientName:t.ClientName,TreasuryId:t.TreasuryId,TreasuryName:t.TreasuryName,BankAccountId:t.BankAccountId,BankAccountName:t.BankAccountName,EmployeeId:t.EmployeeId,EmployeeName:t.EmployeeName,StoreId:t.StoreId,StoreName:t.StoreName,InvoiceDetails:t[`${this.ScreenName}Details`]},t.SupplierId>0&&(this.SupplierArr=[{Id:t.SupplierId,Name:t.SupplierName}]),t.ClientId>0&&(this.ClientArr=[{Id:t.ClientId,Name:t.ClientName}]),t.TreasuryId>0&&(this.TreasuryArr=[{Id:t.TreasuryId,Name:t.TreasuryName}]),t.BankAccountId>0&&(this.BankAccountArr=[{Id:t.BankAccountId,Name:t.BankAccountName}]),t.EmployeeId>0&&(this.EmployeeArr=[{Id:t.EmployeeId,Name:t.EmployeeName}]),t.StoreId>0&&(this.StoreArr=[{Id:t.StoreId,Name:t.StoreName}]);for(let e=0;e<this.Invoice.InvoiceDetails.length;e++){let n=this.Invoice.InvoiceDetails[e];n.Discount=n.Discount==0?"":n.Discount,n.DiscountRate=n.DiscountRate==0?"":n.DiscountRate,this.Invoice.InvoiceDetails[e].Items=[{Id:n.ProductId,Name:n.ProductName,NameAndCode:n.ProductName}],this.Invoice.InvoiceDetails[e].ProductUnits=[{Id:n.ProductUnitId,Name:n.ProductUnitName,NameAndUnitFactor:n.ProductUnitName}]}this._AppModeService.DisabledButton=!1}TotalInvoiceVatAmount(){let t=0;for(let e=0;e<this.Invoice.InvoiceDetails.length;e++){let n=Number(this.Invoice.InvoiceDetails[e].Price),c=Number(this.Invoice.InvoiceDetails[e].Quantity),I=n*c,f=Number(this.Invoice.InvoiceDetails[e].Vat),g=Number(this.Invoice.InvoiceDetails[e].Discount),N=Number(this.Invoice.InvoiceDetails[e].DiscountRate);if(g>0&&(t+=(I-g)*(f/100)),N>0){let R=N/100*I;t+=(I-R)*(f/100)}g==0&&N==0&&(t+=I*(f/100))}return Number(t)}CalcInvoice(){this.Invoice.TotalDiscRate=0,this.Invoice.TotalInvoiceAfterDisc=0,this.Invoice.TotalInvoiceAfterVat=0,this.Invoice.TotalVatRate=0,this.Invoice.TotalDisc=0,this.Invoice.TotalInvoice=0,this.Invoice.TotalInvoiceVatAmount=0;for(let t=0;t<this.Invoice.InvoiceDetails.length;t++){let e=Number(this.Invoice.InvoiceDetails[t].Price),n=Number(this.Invoice.InvoiceDetails[t].Quantity),c=Number(this.Invoice.InvoiceDetails[t].Discount),I=Number(this.Invoice.InvoiceDetails[t].DiscountRate),f=Number(this.Invoice.InvoiceDetails[t].Vat),g=e*n;this.Invoice.InvoiceDetails[t].TotalPrice=Number(g),this.Invoice.TotalInvoice+=Number(g),this.Invoice.InvoiceDetails[t].Discount=c==0?"":c;let N=0;I>0&&(N=I/100*g),c>0&&(N=c),this.Invoice.TotalDisc+=N,this.Invoice.InvoiceDetails[t].TotalPriceAfterDiscount=g-N,this.Invoice.InvoiceDetails[t].TotalPriceAfterVat=Number((e*n-N)*(f/100)+(e*n-N))}this.Invoice.TotalDiscRate=this.Invoice.TotalInvoice==0?0:Number(this.Invoice.TotalDisc/this.Invoice.TotalInvoice*100),this.Invoice.TotalInvoiceAfterDisc=Number(this.Invoice.TotalInvoice-this.Invoice.TotalDisc),this.Invoice.TotalInvoiceVatAmount=this.TotalInvoiceVatAmount(),this.Invoice.TotalInvoiceAfterVat=Number(this.Invoice.TotalInvoiceAfterDisc+this.Invoice.TotalInvoiceVatAmount),this.Invoice.TotalVatRate=this.Invoice.TotalInvoiceAfterDisc==0?0:Number(this.Invoice.TotalInvoiceVatAmount/this.Invoice.TotalInvoiceAfterDisc*100),this.Invoice.TotalDiscRate=Number(this.Invoice.TotalDiscRate),this.Invoice.TotalInvoiceAfterDisc=Number(this.Invoice.TotalInvoiceAfterDisc),this.Invoice.TotalInvoiceVatAmount=Number(this.Invoice.TotalInvoiceVatAmount),this.Invoice.TotalVatRate=Number(this.Invoice.TotalVatRate),this.Invoice.TotalInvoice=Number(this.Invoice.TotalInvoice),this.Invoice.TotalDisc=Number(this.Invoice.TotalDisc),this.Invoice.TotalInvoiceAfterVat=this._AppModeService.GetTwoNumberAfterZero(Number(this.Invoice.TotalInvoiceAfterVat)),this.ChangeCash()}Validate(){if((this.ScreenName=="BuyOffer"||this.ScreenName=="BuyInvoice")&&(this.Invoice.SupplierId==0||this.Invoice.SupplierId==null))return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterSupplier")),!1;if(this.ScreenName=="BuyInvoice"&&(this.Invoice.StoreId==0||this.Invoice.StoreId==null))return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterStore")),!1;if(this.ScreenName=="SaleOffer"&&(this.Invoice.ClientId==0||this.Invoice.ClientId==null))return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.EnterClient")),!1;if(this.ScreenName=="SaleInvoice"&&this.Invoice.ClientType==2&&(this.Invoice.ClientId==0||this.Invoice.ClientId==null))return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.EnterClient")),!1;if(this.Invoice.DocDate==""||this.Invoice.DocDate==null)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate")),!1;for(let t=0;t<this.Invoice.InvoiceDetails.length;t++){let e=t,n=Number(this.Invoice.InvoiceDetails[t].ProductId),c=Number(this.Invoice.InvoiceDetails[t].Price),I=Number(this.Invoice.InvoiceDetails[t].Quantity),f=Number(this.Invoice.InvoiceDetails[t].Discount),g=Number(this.Invoice.InvoiceDetails[t].DiscountRate),N=Number(this.Invoice.InvoiceDetails[t].Vat),R=Number(this.Invoice.InvoiceDetails[t].ProductUnitId),We=Number(this.Invoice.InvoiceDetails[t].TotalPriceAfterDiscount),Le=Number(this.Invoice.InvoiceDetails[t].TotalPriceAfterVat);if(isNaN(n)||n<=0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterProduct")+" "+(e+1)),!1;if(R<=0||isNaN(R))return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterUnit")+" "+(e+1)),!1;if(this.Invoice.InvoiceDetails.filter($=>$.ProductId==n&&$.ProductUnitId==R).length>=2)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(e+1)),!1;if(isNaN(c)||c<=0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterPrice")+" "+(e+1)),!1;if(isNaN(I)||I<=0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterQuantity")+" "+(e+1)),!1;if(isNaN(f)||f<0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.ErrorDiscount")+" "+(e+1)),!1;if(isNaN(g)||g<0||g>100)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorDiscountRate")+" "+(e+1)),!1;if(isNaN(N)||N<0||N>100)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.ErrorVat")+" "+(e+1)),!1;if(Le<0||We<0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.ErrorNetRow")+" "+(e+1)),!1}if(this.Invoice.TotalInvoice<0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash")),!1;if(this.Invoice.TotalInvoiceAfterVat<0||this.Invoice.TotalInvoiceAfterVat<0&&this.Invoice.TotalInvoiceAfterDisc<0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.ErrorTotal")),!1;if(this.ScreenName=="SaleInvoice"||this.ScreenName=="BuyInvoice"){if(Number(this.Invoice.Visa)<0||isNaN(Number(this.Invoice.Visa)))return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash")),!1;if(Number(this.Invoice.Cash)<0||isNaN(Number(this.Invoice.Cash)))return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash")),!1;if(Number(this.Invoice.Debt)<0||isNaN(Number(this.Invoice.Debt)))return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorDebt")),!1;if(Number(this.Invoice.Visa)>0&&(this.Invoice.BankAccountId<=0||this.Invoice.BankAccountId==null))return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.EnterBank")),!1;if(Number(this.Invoice.Cash)>0&&(this.Invoice.TreasuryId<=0||this.Invoice.TreasuryId==null))return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.EnterTreasury")),!1;if(this.Invoice.PaymentType==1&&Number(this.Invoice.Cash)+Number(this.Invoice.Visa)!=this.Invoice.TotalInvoiceAfterVat)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash")),!1;if(this.Invoice.PaymentType==2&&Number(this.Invoice.Cash)+Number(this.Invoice.Visa)+Number(this.Invoice.Debt)!=this.Invoice.TotalInvoiceAfterVat)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorDebt")),!1;if(this.Invoice.PaymentType==2&&Number(this.Invoice.Debt)<=0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorDebt")),!1;if(this.Invoice.PaymentType==3&&this.Invoice.EmployeeId==null)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SalesReport.ChooseEmployee")),!1}return!0}ChangePamentType(t){this.Invoice.BankAccountId=null,this.Invoice.BankAccountName="",this.Invoice.TreasuryId=null,this.Invoice.TreasuryName="",this.Invoice.EmployeeId=null,this.Invoice.EmployeeName="",t==1&&(this.Invoice.PaymentType=1,this.Invoice.Visa="",this.Invoice.Debt="",this.Invoice.Cash=this.Invoice.TotalInvoiceAfterVat),t==2&&(this.Invoice.PaymentType=2,this.Invoice.Cash="",this.Invoice.Visa="",this.Invoice.Debt=this.Invoice.TotalInvoiceAfterVat),t==3&&(this.Invoice.Visa="",this.Invoice.Cash="",this.Invoice.Debt="",this.Invoice.TreasuryId=null,this.Invoice.TreasuryName="",this.Invoice.BankAccountId=null,this.Invoice.BankAccountName=""),this.ChangeCash()}ChangeCash(){this.Invoice.PaymentType==2&&(this.Invoice.Debt=Number(this.Invoice.TotalInvoiceAfterVat-(Number(this.Invoice.Cash)+Number(this.Invoice.Visa)))),this.Invoice.PaymentType==1&&(this.Invoice.Cash=Number(this.Invoice.TotalInvoiceAfterVat-Number(this.Invoice.Visa)),this.Invoice.Visa=Number(this.Invoice.TotalInvoiceAfterVat-Number(this.Invoice.Cash))),this.Invoice.TreasuryId=Number(this.Invoice.Cash)==0?null:this.Invoice.TreasuryId,this.Invoice.BankAccountId=Number(this.Invoice.Visa)==0?null:this.Invoice.BankAccountId,this.Invoice.TreasuryName=Number(this.Invoice.Cash)==0?"":this.Invoice.TreasuryName,this.Invoice.BankAccountName=Number(this.Invoice.Visa)==0?"":this.Invoice.BankAccountName,this.Invoice.Cash=Number(this.Invoice.Cash)==0?"":this._AppModeService.GetTwoNumberAfterZero(this.Invoice.Cash),this.Invoice.Visa=Number(this.Invoice.Visa)==0?"":this._AppModeService.GetTwoNumberAfterZero(this.Invoice.Visa),this.Invoice.Debt=Number(this.Invoice.Debt)==0?"":this._AppModeService.GetTwoNumberAfterZero(this.Invoice.Debt),this.DefaultBankTreasury()}HandleMyDefaultSettings(){let t=this._DefaultSettingsService.DefaultSettings;this.ScreenName=="SaleInvoice"&&(this.Invoice.PaymentType=t.SaleInvoicePaymentType>0?t.SaleInvoicePaymentType:1,t.SaleInvoiceStoreId>0&&(this.StoreArr=[],this.Invoice.StoreId=t.SaleInvoiceStoreId,this.StoreArr.push({Id:t.SaleInvoiceStoreId,Name:t.SaleInvoiceStoreName})),t.SaleInvoiceClientType>0&&(this.Invoice.ClientType=t.SaleInvoiceClientType,this.Invoice.ClientName="\u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u0627\u0641\u062A\u0631\u0627\u0636\u064A")),this.ScreenName=="BuyInvoice"&&(this.Invoice.PaymentType=t.BuyInvoicePaymentType>0?t.BuyInvoicePaymentType:1,t.BuyInvoiceStoreId>0&&(this.StoreArr=[],this.Invoice.StoreId=t.BuyInvoiceStoreId,this.StoreArr.push({Id:t.BuyInvoiceStoreId,Name:t.BuyInvoiceStoreName})))}DefaultBankTreasury(){let t=this._DefaultSettingsService.DefaultSettings;this.ScreenName=="SaleInvoice"&&(this.Invoice.Cash>0&&t.SaleInvoiceTreasuryId>0&&this.Invoice.Id==0&&(this.TreasuryArr=[],this.Invoice.TreasuryId=t.SaleInvoiceTreasuryId,this.TreasuryArr.push({Id:t.SaleInvoiceTreasuryId,Name:t.SaleInvoiceTreasuryName})),this.Invoice.Visa>0&&t.SaleInvoiceBankAccountId>0&&this.Invoice.Id==0&&(this.BankAccountArr=[],this.Invoice.BankAccountId=t.SaleInvoiceBankAccountId,this.BankAccountArr.push({Id:t.SaleInvoiceBankAccountId,Name:t.SaleInvoiceBankAccountName}))),this.ScreenName=="BuyInvoice"&&(this.Invoice.Cash>0&&t.BuyInvoiceTreasuryId>0&&this.Invoice.Id==0&&(this.TreasuryArr=[],this.Invoice.TreasuryId=t.BuyInvoiceTreasuryId,this.TreasuryArr.push({Id:t.BuyInvoiceTreasuryId,Name:t.BuyInvoiceTreasuryName})),this.Invoice.Visa>0&&t.BuyInvoiceBankAccountId>0&&this.Invoice.Id==0&&(this.BankAccountArr=[],this.Invoice.BankAccountId=t.BuyInvoiceBankAccountId,this.BankAccountArr.push({Id:t.BuyInvoiceBankAccountId,Name:t.BuyInvoiceBankAccountName})))}Save(){if(this.CalcInvoice(),this.Validate()==!1)return;this.Invoice.Cash=this.Invoice.Cash==""?0:this.Invoice.Cash,this.Invoice.Visa=this.Invoice.Visa==""?0:this.Invoice.Visa,this.Invoice.Debt=this.Invoice.Debt==""?0:this.Invoice.Debt,this.Invoice[`${this.ScreenName}Details`]=this.Invoice.InvoiceDetails.map(e=>G(U({},e),{Discount:e.Discount==""?0:e.Discount,DiscountRate:e.DiscountRate==""?0:e.DiscountRate}));let t={Id:this.Invoice.Id,PaymentType:Number(this.Invoice.PaymentType),Name:this.Invoice.Name,Notes:this.Invoice.Notes,Code:this.Invoice.Code,InvoiceCollection:this.Invoice.InvoiceCollection,InvoiceCollected:this.Invoice.InvoiceCollected,ClientType:this.Invoice.ClientType,DocNo:this.Invoice.DocNo,DocDate:this._Apiservice.ConvertISODate(this.Invoice.DocDate),TotalInvoice:this.Invoice.TotalInvoice,TotalDiscRate:this.Invoice.TotalDiscRate,TotalDisc:this.Invoice.TotalDisc,TotalInvoiceAfterDisc:this.Invoice.TotalInvoiceAfterDisc,TotalInvoiceAfterVat:this.Invoice.TotalInvoiceAfterVat,TotalInvoiceVatAmount:this.Invoice.TotalInvoiceVatAmount,TotalVatRate:this.Invoice.TotalVatRate,Cash:Number(this.Invoice.Cash),Visa:Number(this.Invoice.Visa),Debt:Number(this.Invoice.Debt),TreasuryId:this.Invoice.TreasuryId,TreasuryName:this.Invoice.TreasuryName,BankAccountId:this.Invoice.BankAccountId,BankAccountName:this.Invoice.BankAccountName,EmployeeId:this.Invoice.EmployeeId,EmployeeName:this.Invoice.EmployeeName,StoreId:this.Invoice.StoreId,StoreName:this.Invoice.StoreName,ClientId:this.Invoice.ClientId==null?0:this.Invoice.ClientId,ClientName:this.Invoice.ClientName,SupplierId:this.Invoice.SupplierId,SupplierName:this.Invoice.SupplierName};t[`${this.ScreenName}Details`]=this.Invoice[`${this.ScreenName}Details`],t.Id==0&&this._Apiservice.post(this.AddUrl,t,!0).pipe(M(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo(),this.DynamicComponent.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}}),t.Id>0&&this._Apiservice.put(this.UpdateUrl,t,!0).pipe(M(this._Apiservice.destroy$)).subscribe({next:e=>{if(e.IsSuccess==!0&&e.Obj!=null){this._AppModeService._Toastr.success(e.Message);let n=e.Obj,c=this.DynamicComponent.Paging.DataReturn.find(I=>I.Id==n.Id);c!=null&&Object.assign(c,n),this.ResetPage(),this.GetPageInfo()}else this._AppModeService._Toastr.error(e.Message)}})}HoldInvoice(){let t=this.Invoice.InvoiceDetails.filter(c=>c.ProductId>0).map(c=>G(U({},c),{Discount:c.Discount==""?0:c.Discount,DiscountRate:c.DiscountRate==""?0:c.DiscountRate,Price:c.Price==""?0:c.Price}));if(t.length==0)return;if(this.ScreenName=="SaleInvoice"&&this.Invoice.ClientType==2&&(this.Invoice.ClientId==0||this.Invoice.ClientId==null)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.EnterClient"));return}let e=0;this.ScreenName=="SaleInvoice"&&(e=1),this.ScreenName=="BuyInvoice"&&(e=2);let n={ClientId:this.Invoice.ClientId,ClientType:this.Invoice.ClientType,ClientName:this.Invoice.ClientName,SupplierId:this.Invoice.SupplierId,SupplierName:this.Invoice.SupplierName,HoldType:e,HoldInvoiceDetails:t,Id:0,TotalInvoice:this.Invoice.TotalInvoice,TotalDisc:this.Invoice.TotalDisc,TotalDiscRate:this.Invoice.TotalDiscRate,TotalInvoiceAfterDisc:this.Invoice.TotalInvoiceAfterDisc,TotalInvoiceAfterVat:this.Invoice.TotalInvoiceAfterVat,TotalInvoiceVatAmount:this.Invoice.TotalInvoiceVatAmount,TotalVatRate:this.Invoice.TotalVatRate};this._Apiservice.post("HoldInvoiceEP/Add",n,!0).pipe(M(this._Apiservice.destroy$)).subscribe({next:c=>{c.IsSuccess==!0&&c.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo()):this._AppModeService._Toastr.error(c.Message)}})}ShowHoldInvoice(){let t="",e=[],n=[],c="Name",I={};this.ScreenName=="SaleInvoice"&&(t="HoldType = 1",e=["Clients Client"],n=["T.ClientId = Client.Id"],c="Client.Name AS ClientName",I={SortName:"ClientName",CellName:"SaleInvoice.Client",ExistSearchField:"Client.Name"}),this.ScreenName=="BuyInvoice"&&(t="HoldType = 2",e=["Suppliers Supplier"],n=["T.SupplierId = Supplier.Id"],c="Supplier.Name AS SupplierName",I={SortName:"SupplierName",CellName:"BuyInvoice.Supplier",ExistSearchField:"Supplier.Name"}),this.OutTablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"HoldInvoice",Conditions:t,Join:!0,JoinTables:e,JoinConditions:n,Columns:["T.Id",c,"T.TotalInvoice","T.TotalDisc","T.TotalInvoiceVatAmount","T.TotalInvoiceAfterVat","T.Notes"]},Required:!1,TableCell:[I,{SortName:"TotalInvoice",CellName:"Table.Total"},{SortName:"TotalDisc",CellName:"Table.Discount"},{SortName:"TotalInvoiceVatAmount",CellName:"Table.Vat"},{SortName:"TotalInvoiceAfterVat",CellName:"Table.NetTotal"}]},this._AppModeService._NgbModal.open(this.AllHoldModel,{size:"xl"})}GetSaleHold(t,e){let n=t;if(console.log(n),n.Id>0){this.Invoice.ClientId=n.ClientId,this.Invoice.ClientName=n.ClientName,this.Invoice.SupplierId=n.SupplierId,this.Invoice.SupplierName=n.SupplierName,n.SupplierId>0&&(this.SupplierArr=[{Id:n.SupplierId,Name:n.SupplierName}]),n.ClientId>0&&(this.ClientArr=[{Id:n.ClientId,Name:n.ClientName}]),this.Invoice.InvoiceDetails=[];for(let c=0;c<n.HoldInvoiceDetails.length;c++){let I=n.HoldInvoiceDetails[c];I.Items=[{Id:I.ProductId,Name:I.ProductName,NameAndCode:I.ProductName}],I.ProductUnits=[{Id:I.ProductUnitId,Name:I.ProductUnitName,NameAndUnitFactor:I.ProductUnitName}],this.Invoice.InvoiceDetails.push(I)}e.close("Close click"),this.CalcInvoice(),this.ChangeCash()}}ResetPage(){this.Invoice={InvoiceCollected:!1,ClientType:2,DocNo:0,DocDate:"",InvoiceDetails:[{Code:"",Name:"",ProductType:0,Items:[],ProductUnits:[],Balance:0,ProductId:null,ProductUnitId:null,Price:"",Quantity:"",TotalPrice:0,TotalPriceAfterVat:0,TotalPriceAfterDiscount:0,Discount:"",DiscountRate:"",Vat:this._DefaultSettingsService.DefaultSettings.Vat,Id:0,Notes:"",ProductName:"",UnitName:""}],TotalInvoice:0,TotalDiscRate:0,TotalDisc:0,TotalInvoiceAfterDisc:0,TotalInvoiceAfterVat:0,TotalInvoiceVatAmount:0,TotalVatRate:0,Cash:"",Visa:"",Debt:"",TreasuryId:null,TreasuryName:"",BankAccountId:null,BankAccountName:"",EmployeeId:null,EmployeeName:"",StoreId:null,StoreName:"",ClientId:null,ClientName:"",SupplierId:null,SupplierName:"",Id:0,PaymentType:1,Name:"",Notes:"",Code:"",InvoiceCollection:0},this.NetAccountPerson={NetThamBranch:0,NetOtherBranch:0},this.GlobalDiscountRate="",this.GlobalDiscount="",this._DefaultSettingsService.ResetDate(this.Invoice),this.HandleMyDefaultSettings(),this.ReturnAmount=0}ResetDetails(){let t={ProductType:0,ProductUnits:[],Items:[],ProductId:null,ProductUnitId:null,Balance:0,Price:"",Quantity:"",TotalPrice:0,TotalPriceAfterVat:0,TotalPriceAfterDiscount:0,Discount:"",DiscountRate:"",Vat:this._DefaultSettingsService.DefaultSettings.Vat,Code:"",Name:"",Id:0,Notes:"",ProductName:"",UnitName:""};if(this.Invoice.InvoiceDetails.length>0&&(this.Invoice.InvoiceDetails=this.Invoice.InvoiceDetails.filter(e=>e.ProductId!=0&&e.ProductId!=null&&e.ProductType!=2),this.Invoice.InvoiceDetails.length==0)){this.Invoice.InvoiceDetails.push(t),this.CalcInvoice();return}}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}handleKeyboardEvent(t){if(t.ctrlKey&&t.key==="Shift"&&(t.preventDefault(),this.AppendRow()),t.ctrlKey&&(t.key==="\u064A"||t.key==="d"||t.key==="D")&&(t.preventDefault(),this.Invoice.InvoiceDetails.length>1)){for(let e=this.Invoice.InvoiceDetails.length-1;e>0;e--)if(this.Invoice.InvoiceDetails[e].ProductId==null){this.RemoveRow(e);break}}t.ctrlKey&&(t.key===" "||t.key==="Space")&&(t.preventDefault(),this._Apiservice.environment.SystemUpdate==!0&&(this.ScreenName=="BuyInvoice"||this.ScreenName=="SaleInvoice")&&this.Save(),this.ScreenName!="BuyInvoice"&&this.ScreenName!="SaleInvoice"&&this.Save()),t.ctrlKey&&(t.key==="\u0621"||t.key==="x"||t.key==="X")&&(t.preventDefault(),this.HoldInvoice()),t.ctrlKey&&(t.key==="\u0626"||t.key==="z"||t.key==="Z")&&(t.preventDefault(),this.ShowHoldInvoice())}SecoundScreen(t){t==this.EnumScreen.Client&&(this.SharedScreen=this._SharedScreenService.ClientScreen()),t==this.EnumScreen.Supplier&&(this.SharedScreen=this._SharedScreenService.SupplierScreen()),t==this.EnumScreen.Treasury&&(this.SharedScreen=this._SharedScreenService.TreasuryScreen()),t==this.EnumScreen.BankAccount&&(this.SharedScreen=this._SharedScreenService.BankAccountScreen()),t==this.EnumScreen.Storage&&(this.SharedScreen=this._SharedScreenService.StorageScreen()),this._AppModeService._NgbModal.open(this.OherModal,{size:"xl"})}ResetSharedScreen(){this.SharedScreen={AddUrl:"",DataView:[],DeleteUrl:"",PageTitle:"",TablePaging:{},UpdateUrl:"",GetById:""}}};d.\u0275fac=function(e){return new(e||d)(k(Ge),k(Oe),k(oe),k(Ve),k(Ee),k(F),k(j))},d.\u0275cmp=J({type:d,selectors:[["app-dynamic-invoice"]],viewQuery:function(e,n){if(e&1&&(O($e,5),O(Ze,5),O(Je,5),O(qe,5),O(Ke,5),O(ze,5)),e&2){let c;W(c=L())&&(n.GLComponent=c.first),W(c=L())&&(n.DynamicComponent=c.first),W(c=L())&&(n.ContentModel=c.first),W(c=L())&&(n.OherModal=c.first),W(c=L())&&(n.AllHoldModel=c.first),W(c=L())&&(n.tableContainer=c.first)}},hostBindings:function(e,n){e&1&&S("keydown",function(I){return n.handleKeyboardEvent(I)},!1,K)},inputs:{SignalR:"SignalR",GlResponse:"GlResponse",TablePaging:"TablePaging",PageTitle:"PageTitle",ScreenName:"ScreenName",AddUrl:"AddUrl",UpdateUrl:"UpdateUrl",DeleteUrl:"DeleteUrl",GetById:"GetById",PrintUrl:"PrintUrl"},standalone:!0,features:[q,Y],decls:12,vars:8,consts:[["dynamiccomponent",""],["content",""],["AllHold",""],["ItemBalance",""],["OherModal",""],["GLComponent",""],["Select",""],["SelectItem22",""],["SelectUnits",""],["SelectStore",""],["SelectSupplier",""],["SelectClient",""],["SelectTreasury",""],["SelectBank",""],["SelectEmployee",""],["appdynamiccomponent",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","PrintUrl","DeleteUrl","OutModal"],[1,"modalConent"],[1,"col-8"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0","Invoicemodalbody"],["id","ProductTable",1,"DivPaging","table-responsive","col-12","p-0","ProductTable"],[1,"",3,"value","responsive","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"bg-white","InvoiceContent","col-12","d-flex","flex-wrap","align-items-center"],["id","myContainer",1,"col-12","col-md-4","p-1"],["id","ngSelectComponent","placeholder","BarCode","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[1,"col-12","col-md-6","col-xl-3","p-1","d-flex"],["class","d-inline-block mx-1",4,"ngIf"],[1,"col-12","col-md-6","col-xl-1","p-1"],["type","number","appNumericInput","",1,"form-control","text-center",3,"value","disabled"],[1,"col-12","col-md-6","col-xl-2","p-1"],["type","text",1,"form-control","text-center",3,"ngModelChange","placeholder","ngModel"],["class","col-12  col-md-4 col-xl-2 p-1 d-flex text-center justify-content-center ",4,"ngIf"],[1,"bg-white","d-flex","flex-wrap","align-items-end","col-12","InvoiceContent"],[1,"col-12","col-md-4","col-lg-3","col-xl-2","p-1"],["class","d-block text-center ",4,"ngIf"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12","class","  text-center w-100",3,"ngModel","showTime","showIcon","showOnFocus","showOtherMonths","ngModelChange",4,"ngIf"],["class","col-12 col-md-4 col-lg-3 col-xl-2 p-1  d-flex align-items-end",4,"ngIf"],["class","col-12 col-md-4 col-lg-3 col-xl-2 p-1 d-flex align-items-end",4,"ngIf"],["class","col-12 col-sm-6 col-md-12 col-lg-4 col-xl-4 p-1 d-flex flex-wrap align-items-center    ",4,"ngIf"],["class","col-12  p-1 d-flex flex-wrap align-items-end",4,"ngIf"],[1,"d-flex","flex-wrap","px-lg-2","TotalsContainer"],[1,"smal-header"],[1,""],[4,"ngIf"],["class","smal-header",4,"ngIf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],["class","btn btn-Add m-0",3,"disabled","click",4,"ngIf"],["class","btn btn-Add",3,"click",4,"ngIf"],["class","btn btn-Primary ",3,"disabled","click",4,"ngIf"],["class","btn btn-Info ",3,"disabled","click",4,"ngIf"],["type","button",1,"btn","btn-light","btn-Close","border","border-1","border-dark",3,"click"],[1,"mx-1"],[1,"mx-1","pi","pi-cancle"],[1,"col-"],[1,"d-block","text-center"],[1,"col-3"],[1,"col-2"],["class","col-2",4,"ngIf"],["class","col-1",4,"ngIf"],[1,"col-1"],[1,"Flex1",3,"title"],[1,"d-flex","justify-content-center","align-items-center","col-11","col-md-12"],[1,"d-none","d-lg-inline"],[1,"btn-Primary","py-2","px-2","btn","mx-2",3,"click"],[1,"mx-1","fw-bold","pi","pi-plus"],[1,"btn-Delete","btn-Page","btn","py-2","px-2",3,"click","disabled"],[1,"mx-1","pi","pi-trash","fw-bold"],[1,"SelectProduct",3,"title"],[1,"d-flex","col-12"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-11","col-lg-10",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","placeholder","virtualScroll","searchable","ngModel"],[1,"btn","btn-Refresh",3,"click","disabled"],[1,"pi","pi-eye","d-block","mx-auto","fw-bold"],[1,"SelectProductUnit",3,"title"],["bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","placeholder","disabled","virtualScroll","searchable","ngModel"],[1,"p-1"],[1,"d-flex","justify-content-around","align-items-center","col-12"],[1,"btn","btn-Primary","px-1","py-1",3,"click","disabled"],[1,"col-8","px-1"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"change","keyup","ngModelChange","id","name","placeholder","disabled","ngModel"],[1,"btn","btn-Info","px-1","py-1",3,"click","disabled"],[1,"mx-1","px-1","pi","fw-bold"],[1,"col-12"],["class","text-dark d-block text-center",4,"ngIf"],["min","0","type","number","appNumericInput","","class","form-control text-center px-0",3,"placeholder","id","name","disabled","ngModel","change","keyup","ngModelChange",4,"ngIf"],["class","p-1",4,"ngIf"],[1,"text-center","col-12"],[1,"text-dark","d-block","d-md-none","text-center"],[1,"text-dark","d-block","text-center"],[1,"form-text","text-muted"],["min","0","type","number","appNumericInput","",1,"form-control","text-center","px-0",3,"change","keyup","ngModelChange","placeholder","id","name","disabled","ngModel"],[1,"d-inline-block","mx-1"],["type","number","appNumericInput","","name","GlobalDiscountRate","id","GlobalDiscountRate",1,"form-control","text-center",3,"change","keyup","ngModelChange","placeholder","ngModel"],["type","number","appNumericInput","","name","GlobalDiscount","id","GlobalDiscount",1,"form-control","text-center",3,"change","keyup","ngModelChange","placeholder","ngModel"],[1,"col-12","col-md-4","col-xl-2","p-1","d-flex","text-center","justify-content-center"],[1,"form-check","p-0","text-center","mx-2"],[1,"d-flex","align-items-center"],["for","ClientType1",1,"p-0","text-center"],[1,"text-end"],["type","radio","name","ClientType","id","ClientType1",1,"form-check-input","mx-2",3,"change","ngModelChange","ngModel","checked","value"],["for","ClientType2",1,"p-0","text-center"],["type","radio","name","ClientType","id","ClientType2",1,"form-check-input","mx-2",3,"change","ngModelChange","value","checked","ngModel"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"col-12","col-md-4","col-lg-3","col-xl-2","p-1","d-flex","align-items-end"],[1,"col-10","p-0"],["bindLabel","Name","bindValue","Id",1,"p-0","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","autofocus","placeholder","virtualScroll","searchable","ngModel"],[1,"p-0"],["class","btn btn-Refresh px-2 py-2 mb-0",3,"click",4,"ngIf"],[1,"btn","btn-Refresh","px-2","py-2","mb-0",3,"click"],[1,"m-0","p-0","text-center","fw-bold","pi","pi-plus"],["bindLabel","Name","bindValue","Id",1,"p-0",3,"clear","focus","keyup","scrollToEnd","change","close","open","ngModelChange","items","dropdownPosition","autofocus","placeholder","virtualScroll","searchable","ngModel"],[1,"col-2","px-0"],[1,"btn","btn-Refresh","px-2","py-1","mb-0",3,"click"],[1,"m-0","my-2","p-0","text-center","fw-bold","pi","pi-plus"],["placeholder","Name","type","text","class","form-control text-center","name","","id","Client_Name",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["class","p-0 text-center","bindLabel","Name","bindValue","Id",3,"items","dropdownPosition","autofocus","placeholder","virtualScroll","searchable","ngModel","clear","focus","keyup","change","scrollToEnd","close","open","ngModelChange",4,"ngIf"],["placeholder","Name","type","text","name","","id","Client_Name",1,"form-control","text-center",3,"ngModelChange","disabled","ngModel"],["bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","change","scrollToEnd","close","open","ngModelChange","items","dropdownPosition","autofocus","placeholder","virtualScroll","searchable","ngModel"],[1,"col-12","col-sm-6","col-md-12","col-lg-4","col-xl-4","p-1","d-flex","flex-wrap","align-items-center"],[1,"col-6","p-1","d-flex","align-items-center","justify-content-between"],[1,"col-5","text-center"],[1,"col-6"],["type","number","appNumericInput","","name","NetThamBranch","id","NetThamBranch",1,"form-control","text-center",3,"disabled","value"],[1,"col-6","text-center"],["type","number","appNumericInput","","name","NetOtherBranch","id","NetOtherBranch",1,"form-control","text-center",3,"disabled","value"],[1,"col-12","p-1","d-flex","flex-wrap","align-items-end"],[1,"col-12","col-md-4","col-lg-2","col-xl-1","p-1"],["name","","id","",1,"form-select",3,"change","ngModelChange","ngModel"],[3,"value"],[3,"value",4,"ngIf"],["class","col-12 col-md-4 col-lg-3 col-xl-2 p-1",4,"ngIf"],["min","0","type","number","appNumericInput","","id","Cash",1,"form-control","py-2","text-center",3,"keyup","change","ngModelChange","placeholder","disabled","ngModel"],["bindLabel","Name","bindValue","Id",1,"p-0",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","autofocus","placeholder","virtualScroll","searchable","disabled","ngModel"],["min","0","type","number","appNumericInput","","id","Visa",1,"form-control","py-2","text-center",3,"keyup","change","ngModelChange","placeholder","disabled","ngModel"],["bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","virtualScroll","searchable","disabled","ngModel"],[1,"d-inline"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","autofocus","virtualScroll","searchable","ngModel"],["id","Debt","min","0","type","number","appNumericInput","","class","form-control text-center",3,"placeholder","disabled","value",4,"ngIf"],["id","Debt","min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"placeholder","disabled","value"],[1,"btn","btn-Add","m-0",3,"click","disabled"],[1,"mx-1","pi","pi-save"],["class","btn btn-Refresh",3,"disabled","click",4,"ngIf"],[1,"btn","btn-Add",3,"click"],[1,"btn","btn-Primary",3,"click","disabled"],[1,"btn","btn-Info",3,"click","disabled"],[3,"ShowToEditeNoDataViewEvent","PageTitle","TablePaging","IsModal","GetById","DeleteUrl"],[1,"modal-body"],[1,"table","table-striped","table-hover"],[4,"ngFor","ngForOf"],[1,"text-dark"],[3,"CloseParentModel","PageTitle","DataView","AddUrl","UpdateUrl","DeleteUrl","NotInsertTablePaging","GetById"]],template:function(e,n){if(e&1){let c=T();_(0,"app-dynamic-component",16,0),S("OpenModalEvent",function(){return a(c),l(n.OpenModal())})("ShowToEditeEvent",function(f){return a(c),l(n.ShowToEdite(f))}),p(),x(2,ii,70,51,"ng-template",17,1,H)(4,ni,7,8,"ng-template",18,2,H)(6,ri,12,7,"ng-template",18,3,H)(8,ci,1,7,"ng-template",18,4,H),V(10,"app-glsheard",null,5)}if(e&2){let c=y(3);u("PageTitle",n.PageTitle)("TablePaging",n.TablePaging)("FullScreen",!0)("GlResponse",n.GlResponse)("GetById",n.GetById)("PrintUrl",n.PrintUrl)("DeleteUrl",n.DeleteUrl)("OutModal",c)}},dependencies:[be,Ce,xe,ne,De,Te,he,me,Ie,le,pe,ue,de,se,ve,_e,ye,fe,ge,Se,te,ie,Ae,ae,ce,Me,Be,Ne,we,Pe]});let o=d;return o})();export{Ei as a};
