import{a as de}from"./chunk-VSYXDL23.js";import{g as ne,h as oe,o as ae,s as ce,x as le}from"./chunk-BHSN7HFD.js";import"./chunk-6BJKXUWP.js";import"./chunk-3Y7UQ2M3.js";import{a as se}from"./chunk-BHTRH7BV.js";import{g as ie,h as re}from"./chunk-VUX2NRX2.js";import"./chunk-RXBBGPQB.js";import"./chunk-GEJP5WQO.js";import"./chunk-GNF256I6.js";import{a as X,b as Y,c as Z,d as ee}from"./chunk-MZIKAFPE.js";import"./chunk-EGE4BGUH.js";import{k as te}from"./chunk-RVJIMCIT.js";import{c as Q}from"./chunk-ITQ57RKD.js";import{b as W,c as F,d as $}from"./chunk-KALZ37GW.js";import{c as B,f as z,h as L,k as H,m as K,s as q,u as J}from"./chunk-N4FWSTCP.js";import{G as U,e as D}from"./chunk-VTADEU6K.js";import{$b as V,Cb as l,Db as a,Eb as A,Ib as C,Mb as f,Nb as g,Wb as v,X as T,Xb as _,Yb as I,Zb as x,_b as M,ac as E,bc as G,db as c,dc as k,eb as w,ec as j,na as N,nc as h,oc as S,vb as b,xa as p,xb as P,ya as u}from"./chunk-J5UB44FZ.js";import{a as R,b as O}from"./chunk-3EYC4JTX.js";var pe=()=>({"min-width":"75rem"}),ue=()=>["Name"];function me(n,s){if(n&1&&(l(0,"small",26),_(1),a()),n&2){let r=g();c(),M("Loaded ",r.Groups.length," of ",r._SharedObjectModelService.TotalItems,"")}}function _e(n,s){if(n&1&&_(0),n&2){let r=s.item;x(" ",r.Name," ")}}function ge(n,s){if(n&1&&(l(0,"small",26),_(1),a()),n&2){let r=g();c(),M("Loaded ",r.Items.length," of ",r._SharedObjectModelService.TotalItems,"")}}function Pe(n,s){if(n&1&&_(0),n&2){let r=s.item;x(" ",r.NameAndCode," ")}}function he(n,s){if(n&1){let r=C();l(0,"button",27),f("click",function(){p(r);let i=g();return u(i.EmptyPage())}),_(1),h(2,"translate"),a()}n&2&&(c(),I(S(2,1,"Model.ResetPage")))}function Se(n,s){if(n&1){let r=C();l(0,"button",28),f("click",function(){p(r);let i=g();return u(i.Send())}),_(1),h(2,"translate"),A(3,"i",29),a()}n&2&&(c(),x("",S(2,1,"Model.Send")," "))}function fe(n,s){if(n&1){let r=C();l(0,"div",30)(1,"p-button",31),f("onClick",function(){p(r);let i=g();return u(i.ExpandAll())}),a(),l(2,"p-button",32),f("onClick",function(){p(r);let i=g();return u(i.CollapseAll())}),a()()}}function Ie(n,s){n&1&&(l(0,"tr")(1,"th",33),_(2),h(3,"translate"),a(),l(4,"th",34),_(5),h(6,"translate"),a(),l(7,"th",34),_(8),h(9,"translate"),a(),l(10,"th"),_(11,"-"),a()()),n&2&&(c(2),I(S(3,3,"Table.Units")),c(3),I(S(6,5,"Table.Name")),c(3),I(S(9,7,"Table.WA")))}function Ce(n,s){if(n&1){let r=C();l(0,"tr")(1,"td"),A(2,"p-button",35),a(),l(3,"td")(4,"span",36),_(5),a()(),l(6,"td")(7,"span",36),_(8),a()(),l(9,"td")(10,"button",37),f("click",function(){let i=p(r).$implicit,e=g();return u(e.RemoveProcut(i))}),A(11,"i",38),a()()()}if(n&2){let r=s.$implicit,t=s.expanded,i=g();c(2),P("pRowToggler",r)("text",!0)("rounded",!0)("plain",!0)("icon",t?"pi pi-chevron-down":i._Apiservice.Language=="ar"?"pi pi-chevron-left":"pi pi-chevron-right"),c(3),I(r.ProductName),c(3),I(r.WA)}}function be(n,s){n&1&&(l(0,"tr")(1,"th"),_(2),h(3,"translate"),a(),l(4,"th"),_(5),h(6,"translate"),a()()),n&2&&(c(2),x("",S(3,2,"Table.Name")," "),c(3),I(S(6,4,"Table.Price")))}function ve(n,s){if(n&1&&(l(0,"span",46),_(1),h(2,"translate"),a()),n&2){let r=g().$implicit,t=g(2);c(),M(" ",S(2,2,"ProductPricing.Hamesh")," => ",(t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)).toFixed(2),"")}}function xe(n,s){if(n&1&&(l(0,"span",47),_(1),h(2,"translate"),a()),n&2){let r=g().$implicit,t=g(2);c(),M(" ",S(2,2,"ProductPricing.Hamesh")," => ",(t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)).toFixed(2)," ")}}function Me(n,s){if(n&1){let r=C();l(0,"tr")(1,"td",41)(2,"span",42),_(3),a(),b(4,ve,3,4,"span",43)(5,xe,3,4,"span",44),a(),l(6,"td")(7,"input",45),G("ngModelChange",function(i){let e=p(r).$implicit;return E(e.ProductUnitPrice,i)||(e.ProductUnitPrice=i),u(i)}),a()()()}if(n&2){let r=s.$implicit,t=g(2);c(3),M(" ",r.ProductUnitName," - ",r.ProductUnitWA,""),c(),P("ngIf",t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)<0),c(),P("ngIf",t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)>=0),c(2),V("ngModel",r.ProductUnitPrice)}}function Te(n,s){if(n&1&&(l(0,"tr")(1,"td",39)(2,"p-table",40),b(3,be,7,6,"ng-template",21)(4,Me,8,5,"ng-template",22),a()()()),n&2){let r=s.$implicit;c(2),P("value",r.ProductPricingDetails)}}function we(n,s){if(n&1){let r=C();l(0,"p-paginator",48),f("onPageChange",function(i){p(r);let e=g();return u(e.onPageChange(i))}),a()}if(n&2){let r=g();P("first",r._SharedObjectModelService.Paging.CurrentPage)("rows",r._SharedObjectModelService.Paging.PageSize)("totalRecords",r._SharedObjectModelService.Paging.TotalItems)("rowsPerPageOptions",r._AppModeService.RowCount)}}function Ae(n,s){if(n&1){let r=C();l(0,"p-paginator",49),f("onPageChange",function(i){p(r);let e=g();return u(e.onPageChange(i))}),a()}if(n&2){let r=g();P("first",r._SharedObjectModelService.Paging.CurrentPage)("rows",r._SharedObjectModelService.Paging.PageSize)("totalRecords",r._SharedObjectModelService.Paging.TotalItems)}}var Qe=(()=>{let s=class s{constructor(t,i,e,o){this._AppModeService=t,this._SharedObjectModelService=i,this.Translate=e,this._Apiservice=o,this.ProductPricing=[],this.Groups=[],this.Items=[],this.SearchModel={ProductId:null,ProductGroupId:null},this.expandedRows={}}ngOnInit(){this._SharedObjectModelService.Paging={PageSize:10,CurrentPage:1,TotalPages:0,TotalItems:0,DataReturn:[]}}ChangeSearchApi(t,i){let e=`${i.searchTerm}`.trim();(e==""||e=="null")&&(i.searchTerm="",e=""),this._AppModeService.CurrentPage+=1;let o={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:e,SearchField:"Name"};t=="Storages"&&(o.BranchFilter=!0),t=="Items"&&(o.Columns=["Id","Name","Code"],this.SearchModel.ProductGroupId>0&&(o.Conditions=` ItemGroupId = ${this.SearchModel.ProductGroupId}`)),t=="ItemsCode"&&(o.TableName="Items",o.Columns=["Id","Name","Code"],o.SearchText=i,this.SearchModel.ProductGroupId>0&&(o.Conditions=`ProductType != 2 And ItemGroupId = ${this.SearchModel.ProductGroupId}`)),this._Apiservice.post("Global/GetAll",o,!1).pipe(T(this._Apiservice.destroy$)).subscribe({next:d=>{d.IsSuccess==!0&&d.Obj!=null?this.HandleResponse(d.Obj,t):this._AppModeService._Toastr.error(d.Message)}})}HandleResponse(t,i){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,i=="ItemGroups"&&(this.Groups=this._SharedObjectModelService.RemoveDuplicates(this.Groups.concat(t.DataReturn),"Id")),i=="Items"&&(this.Items=this._SharedObjectModelService.RemoveDuplicates(this.Items.concat(t.DataReturn),"Id"),this.Items=this.Items.map(e=>O(R({},e),{NameAndCode:`${e.Name} - ${e.Code}`}))),i=="ItemsCode"&&(this.Items=t.DataReturn,this.Items=this.Items.map(e=>O(R({},e),{NameAndCode:`${e.Name} - ${e.Code}`})))}SelectValue(t,i){if(t!=null&&(t>0||t!="")){let e=[];i=="ProductGroup"&&(e=this.Groups),i=="Product"&&(e=this.Items);let o=e.find(d=>d.Id==t);if(o==null){this._AppModeService.DontPlay();return}else this.SearchModel[`${i}Id`]=t,this.SearchModel[`${i}Name`]=o.Name}else this.SearchModel[`${i}Id`]=null,this.SearchModel[`${i}Name`]=""}ConvertNumber(t){return Number(t)}Search(){if(this.SearchModel.ProductId==null&&this.SearchModel.ProductGroupId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductPricing.Error.GroupOrProduct"));return}let t={ProductId:this.SearchModel.ProductId==null?0:this.SearchModel.ProductId,ProductGroupId:this.SearchModel.ProductGroupId==null?0:this.SearchModel.ProductGroupId,CurrentPage:1,PageSize:this._SharedObjectModelService.Paging.PageSize};this._Apiservice.post("ProductPricingEP/GetPageInfo",t,!0).pipe(T(this._Apiservice.destroy$)).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?(this.ProductPricing=this._SharedObjectModelService.RemoveDuplicates(this.ProductPricing.concat(i.Obj.DataReturn),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=i.Obj.TotalItems,this.SearchModel.ProductId=null):this._AppModeService._Toastr.error(i.Message)}})}onPageChange(t){t.page++,t.first,t.rows,this._SharedObjectModelService.Paging.CurrentPage=t.first,this._SharedObjectModelService.Paging.PageSize=t.rows;let i={ItemId:this.SearchModel.ItemId==null?0:this.SearchModel.ItemId,ItemGroupId:this.SearchModel.ItemGroupId==null?0:this.SearchModel.ItemGroupId,PageSize:this._SharedObjectModelService.Paging.PageSize,CurrentPage:t.page};this._Apiservice.post("ProductPricingEP/GetPageInfo",i,!0).pipe(T(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.ProductPricing=this._SharedObjectModelService.RemoveDuplicates(this.ProductPricing.concat(e.Obj.DataReturn),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=e.Obj.TotalItems):this._AppModeService._Toastr.error(e.Message)}})}RemoveProcut(t){this.ProductPricing=this.ProductPricing.filter(i=>i.ProductId!=t.ProductId)}ExpandAll(){this.expandedRows=this.ProductPricing.reduce((t,i)=>(t[i.ProductId]=!0)&&t,{})}CollapseAll(){this.expandedRows={}}Send(){for(let t=0;t<this.ProductPricing.length;t++){let i=this.ProductPricing[t].ProductPricingDetails;for(let e=0;e<i.length;e++){let o=i[e],d=t+1,m=Number(o.ProductUnitWA),y=Number(o.ProductUnitPrice);if(y<0||isNaN(y)){this._AppModeService._Toastr.error(this.Translate.instant("ProductPricing.Error.ErrorNumber")+" "+d);return}if(m>0&&y<m){this._AppModeService._Toastr.error(this.Translate.instant("ProductPricing.Error.SmallWA")+" "+d);return}o.ProductUnitPrice=y}}this._Apiservice.post("ProductPricingEP/Add",this.ProductPricing,!0).pipe(T(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this._AppModeService._Toastr.success(this.Translate.instant("Success.AddSuccess")),this.EmptyPage()):this._AppModeService._Toastr.error(t.Message)}})}EmptyPage(){this.SearchModel={ItemGroupId:null,ItemId:null},this.ProductPricing=[]}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};s.\u0275fac=function(i){return new(i||s)(w(Q),w(se),w(W),w(B))},s.\u0275cmp=N({type:s,selectors:[["app-product-pricing"]],standalone:!0,features:[k],decls:39,vars:35,consts:[["SelectGroup",""],["SelectFromStore",""],["dt1",""],["clas","bg-light"],[1,"title-box","font-weight-normal"],[1,"min","border"],[1,"d-flex","flex-wrap","align-items-end","py-2","col-12"],[1,"col-12","col-md-3","p-2"],["for","FromStoreId",1,"my-1"],["placeholder","Search","appendTo","div","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],[1,"col-12","col-md-6","p-2"],[1,"btn-Add","btn",3,"click"],[1,"mx-1","pi","pi-search"],["class","btn-Delete btn-Page  btn",3,"click",4,"ngIf"],["type","button","class","btn-Add btn",3,"click",4,"ngIf"],[1,"DivPaging","col-12","p-0","table-responsive"],["dataKey","ProductId","sortMode","multiple",3,"value","expandedRowKeys","lazy","scrollable","paginator","rows","tableStyle","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["appendTo","table",3,"first","rows","totalRecords","rowsPerPageOptions","onPageChange",4,"ngIf"],["appendTo","table",3,"first","rows","totalRecords","onPageChange",4,"ngIf"],[1,"form-text","text-muted"],[1,"btn-Delete","btn-Page","btn",3,"click"],["type","button",1,"btn-Add","btn",3,"click"],[1,"mx-1","pi","pi-save"],[1,"flex","flex-wrap","justify-content-end","gap-2","CollapseGroup"],["icon","pi pi-plus","text","",3,"onClick"],["icon","pi pi-minus","text","",3,"onClick"],[1,"col-2"],[1,"col-6"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon"],[1,"text-dark","d-block","text-center"],[1,"btn","btn-Delete",3,"click"],[1,"mx-1","pi","pi-trash","fw-bold"],["colspan","7",1,"p-0"],["dataKey","ProductId",3,"value"],[1,"p-1"],[1,"text-dark"],["class","d-block text-center my-1 text-danger",4,"ngIf"],["class","d-block text-center my-1 text-success",4,"ngIf"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"d-block","text-center","my-1","text-danger"],[1,"d-block","text-center","my-1","text-success"],["appendTo","table",3,"onPageChange","first","rows","totalRecords","rowsPerPageOptions"],["appendTo","table",3,"onPageChange","first","rows","totalRecords"]],template:function(i,e){if(i&1){let o=C();l(0,"section",3)(1,"div",4)(2,"h4"),_(3),h(4,"translate"),a()(),l(5,"div",5)(6,"div",6)(7,"div",7)(8,"p",8),_(9),h(10,"translate"),a(),l(11,"ng-select",9,0),f("clear",function(){return p(o),u(e.Groups=[])})("focus",function(){p(o);let m=v(12);return e.ChangeSearchApi("ItemGroups",m),u(e._AppModeService.ResetCurrentPage())})("keyup",function(){p(o);let m=v(12);return e.ChangeSearchApi("ItemGroups",m),u(e._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(o);let m=v(12);return u(e.ChangeSearchApi("ItemGroups",m))})("close",function(){return p(o),u(e._AppModeService.ResetCurrentPage())})("open",function(){return p(o),u(e._AppModeService.ResetCurrentPage())})("change",function(){return p(o),e.SelectValue(e.SearchModel.ProductGroupId,"ProductGroup"),e.SearchModel.ProductId=null,u(e.Items=[])}),G("ngModelChange",function(m){return p(o),E(e.SearchModel.ProductGroupId,m)||(e.SearchModel.ProductGroupId=m),u(m)}),b(13,me,2,2,"ng-template",10)(14,_e,1,1,"ng-template",11),a()(),l(15,"div",7)(16,"p",8),_(17),h(18,"translate"),a(),l(19,"ng-select",12,1),f("clear",function(){return p(o),u(e.Items=[])})("focus",function(){p(o);let m=v(20);return e.ChangeSearchApi("Items",m),u(e._AppModeService.ResetCurrentPage())})("keyup",function(){p(o);let m=v(20);return e.ChangeSearchApi("Items",m),u(e._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(o);let m=v(20);return u(e.ChangeSearchApi("Items",m))})("close",function(){return p(o),u(e._AppModeService.ResetCurrentPage())})("open",function(){return p(o),u(e._AppModeService.ResetCurrentPage())})("change",function(){return p(o),u(e.SelectValue(e.SearchModel.ProductId,"Product"))}),G("ngModelChange",function(m){return p(o),E(e.SearchModel.ProductId,m)||(e.SearchModel.ProductId=m),u(m)}),b(21,ge,2,2,"ng-template",10)(22,Pe,1,1,"ng-template",11),a()(),l(23,"div",13)(24,"button",14),f("click",function(){return p(o),u(e.Search())}),_(25),h(26,"translate"),A(27,"i",15),a(),b(28,he,3,3,"button",16)(29,Se,4,3,"button",17),a()(),l(30,"div",18)(31,"p-table",19,2),b(33,fe,3,0,"ng-template",20)(34,Ie,12,9,"ng-template",21)(35,Ce,12,7,"ng-template",22)(36,Te,5,1,"ng-template",23),a(),b(37,we,1,4,"p-paginator",24)(38,Ae,1,3,"p-paginator",25),a()()()}i&2&&(c(3),I(S(4,25,"ProductPricing.ProductPricing")),c(6),I(S(10,27,"Item.ItemGroup")),c(2),P("items",e.Groups)("virtualScroll",!0)("searchable",!0),V("ngModel",e.SearchModel.ProductGroupId),c(6),I(S(18,29,"Table.Item")),c(2),P("items",e.Items)("autofocus",!1)("virtualScroll",!0)("searchable",!0),V("ngModel",e.SearchModel.ProductId),c(6),x("",S(26,31,"Model.Search")," "),c(3),P("ngIf",e.ProductPricing.length>0),c(),P("ngIf",e.ProductPricing.length>0),c(2),P("value",e.ProductPricing)("expandedRowKeys",e.expandedRows)("lazy",!0)("scrollable",!0)("paginator",!1)("rows",e._SharedObjectModelService.Paging.PageSize)("tableStyle",j(33,pe))("globalFilterFields",j(34,ue)),c(6),P("ngIf",e._SharedObjectModelService.Paging.TotalItems>=10),c(),P("ngIf",e._SharedObjectModelService.Paging.TotalItems<10))},dependencies:[U,D,J,z,K,L,q,H,$,F,ee,Z,X,Y,oe,ne,te,le,ae,ce,re,ie,de],styles:[".min[_ngcontent-%COMP%]{min-height:100vh}"]});let n=s;return n})();export{Qe as ProductPricingComponent};
