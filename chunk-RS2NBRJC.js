import{a as _e,b as Se,c as ge}from"./chunk-BZPR73YG.js";import{a as he}from"./chunk-X4NKGLB3.js";import{a as Pe}from"./chunk-3UDBFBON.js";import{b as ce,j as de}from"./chunk-A6MDEMU4.js";import"./chunk-3ZAIJ4IV.js";import"./chunk-Y5QDR55A.js";import{a as ue}from"./chunk-VSYXDL23.js";import"./chunk-BHSN7HFD.js";import{a as le,b as ae}from"./chunk-6BJKXUWP.js";import"./chunk-3Y7UQ2M3.js";import{a as me}from"./chunk-BHTRH7BV.js";import"./chunk-VUX2NRX2.js";import"./chunk-RXBBGPQB.js";import"./chunk-GEJP5WQO.js";import"./chunk-GNF256I6.js";import{a as ne,b as re,c as oe,d as pe}from"./chunk-MZIKAFPE.js";import"./chunk-EGE4BGUH.js";import"./chunk-RVJIMCIT.js";import{c as se}from"./chunk-ITQ57RKD.js";import{c as Y,d as J}from"./chunk-KALZ37GW.js";import{b as q,c as z,f as K,h as X,k as Z,m as ee,s as ie,u as te}from"./chunk-N4FWSTCP.js";import{A as Q,c as W,d as $,e as H,j as U}from"./chunk-VTADEU6K.js";import{$b as C,Cb as p,Db as l,Eb as T,Ib as b,Mb as x,Nb as c,Qb as w,Rb as A,Tb as E,Ub as V,Vb as O,Wb as N,X as f,Xb as g,Yb as R,Zb as P,_b as B,ac as y,bc as M,db as o,dc as j,eb as D,gc as G,na as k,nc as S,oc as h,pc as F,qc as L,vb as I,xa as u,xb as _,ya as d}from"./chunk-J5UB44FZ.js";import"./chunk-3EYC4JTX.js";var Ie=["content"],ve=["GLComponent"],xe=(r,m)=>({"btn-Add":r,"btn-Refresh":m});function De(r,m){if(r&1&&(p(0,"span",27),g(1),S(2,"date"),l()),r&2){let s=c(2);o(),P(" ",F(2,1,s.SuppliersPermissions.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function be(r,m){if(r&1){let s=b();p(0,"div",28,2)(2,"p-calendar",29),M("ngModelChange",function(e){u(s);let t=c(2);return y(t.SuppliersPermissions.DocDate,e)||(t.SuppliersPermissions.DocDate=e),d(e)}),l()()}if(r&2){let s=c(2);o(2),C("ngModel",s.SuppliersPermissions.DocDate),_("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function Ce(r,m){if(r&1&&(p(0,"small",38),g(1),l()),r&2){let s=c().$implicit,i=c(2);o(),B("Loaded ",s.Suppliers.length," of ",i._SharedObjectModelService.TotalItems,"")}}function ye(r,m){if(r&1&&g(0),r&2){let s=m.item;P(" ",s.Name," ")}}function Me(r,m){if(r&1&&(p(0,"span",39),g(1),l()),r&2){let s=c().$implicit;o(),P(" ",s.AmountPermissions," ")}}function Te(r,m){if(r&1){let s=b();p(0,"tr")(1,"td",30),S(2,"translate"),p(3,"ng-select",31,3),x("clear",function(){let e=u(s).$implicit;return d(e.Suppliers=[])})("focus",function(){let e=u(s).index,t=N(4),n=c(2);return n.ChangeSearchApiDetails("Suppliers",t,e),d(n._AppModeService.ResetCurrentPage())})("keyup",function(){let e=u(s).index,t=N(4),n=c(2);return n.ChangeSearchApiDetails("Suppliers",t,e),d(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=u(s).index,t=N(4),n=c(2);return d(n.ChangeSearchApiDetails("Suppliers",t,e))})("close",function(){u(s);let e=c(2);return d(e._AppModeService.ResetCurrentPage())})("open",function(){u(s);let e=c(2);return d(e._AppModeService.ResetCurrentPage())})("change",function(){let e=u(s),t=e.$implicit,n=e.index,a=c(2);return d(a.SelectValueDetails(t.SupplierId,"Supplier",n))}),M("ngModelChange",function(e){let t=u(s).$implicit;return y(t.SupplierId,e)||(t.SupplierId=e),d(e)}),I(5,Ce,2,2,"ng-template",32)(6,ye,1,1,"ng-template",33),l()(),p(7,"td",34),S(8,"translate"),I(9,Me,2,1,"span",35),l(),p(10,"td",34),S(11,"translate"),p(12,"input",36),x("keyup",function(){let e=u(s),t=e.$implicit,n=e.index,a=c(2);return a.TotalSuppliersPermissions(),d(a.ChangeAmount(t.SupplierId,n))}),M("ngModelChange",function(e){let t=u(s).$implicit;return y(t.Amount,e)||(t.Amount=e),d(e)}),l()(),p(13,"td",34),S(14,"translate"),p(15,"input",37),M("ngModelChange",function(e){let t=u(s).$implicit;return y(t.Notes,e)||(t.Notes=e),d(e)}),l()()()}if(r&2){let s=m.$implicit,i=m.index,e=c(2);o(),w("title",h(2,23,"TransferStorage.Name")),o(2),_("items",s.Suppliers)("autofocus",!1)("dropdownPosition",e._AppModeService.DropdownPosition(i))("virtualScroll",!0)("searchable",!0),C("ngModel",s.SupplierId),o(4),w("title",h(8,25,"MoneyIn.Debt")),o(2),_("ngIf",s.SupplierId>0),o(),w("title",h(11,27,"MoneyIn.Price")),o(2),A("name","Amount",i,""),A("id","Amount",i,""),_("disabled",s.SupplierId==0||s.SupplierId==null),C("ngModel",s.Amount),o(),w("title",h(14,29,"MoneyIn.Notes")),o(2),A("name","Notes",i,""),A("id","Notes",i,""),_("disabled",s.SupplierId==0||s.SupplierId==null),C("ngModel",s.Notes)}}function we(r,m){r&1&&(p(0,"span"),g(1),S(2,"translate"),l()),r&2&&(o(),P(" ",h(2,1,"Model.Save"),""))}function Ae(r,m){r&1&&(p(0,"span"),g(1),S(2,"translate"),l()),r&2&&(o(),P(" ",h(2,1,"Model.Update"),""))}function Ne(r,m){if(r&1){let s=b();p(0,"button",40),x("click",function(){u(s);let e=c(2);return d(e.OpenGl())}),g(1),S(2,"translate"),l()}r&2&&(o(),P(" ",h(2,1,"Model.Gl")," "))}function Ee(r,m){if(r&1){let s=b();T(0,"app-modal-header",5),p(1,"div",6)(2,"div",7)(3,"div",8),T(4,"input",9),l(),p(5,"div",10)(6,"label",11),g(7),S(8,"translate"),l(),p(9,"input",12),M("ngModelChange",function(e){u(s);let t=c();return y(t.SuppliersPermissions.Notes,e)||(t.SuppliersPermissions.Notes=e),d(e)}),l()(),p(10,"div",13),I(11,De,3,4,"span",14)(12,be,3,5,"div",15),l()(),p(13,"div",16)(14,"table",17)(15,"thead")(16,"th",18),g(17),S(18,"translate"),l(),p(19,"th",18),g(20),S(21,"translate"),l(),p(22,"th",18),g(23),S(24,"translate"),l(),p(25,"th",19),g(26),S(27,"translate"),l()(),p(28,"tbody"),I(29,Te,16,31,"tr",20),l()()()(),p(30,"div",21)(31,"button",22),x("click",function(){u(s);let e=c();return d(e.Save())}),I(32,we,3,3,"span",23)(33,Ae,3,3,"span",23),T(34,"i",24),l(),I(35,Ne,3,3,"button",25),p(36,"button",26),x("click",function(){let e=u(s).$implicit,t=c();return e.close("Close click"),d(t.ResetPage())}),g(37),S(38,"translate"),l()()}if(r&2){let s=c();_("PageTitle","SuppliersPermissions.SuppliersPermissions"),o(4),_("disabled",!0)("value",s.SuppliersPermissions.DocNo),o(3),R(h(8,18,"Table.Notes")),o(2),C("ngModel",s.SuppliersPermissions.Notes),o(2),_("ngIf",(s._DefaultSettingsService.DefaultSettings==null?null:s._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),o(),_("ngIf",(s._DefaultSettingsService.DefaultSettings==null?null:s._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),o(5),P(" ",h(18,20,"MoneyIn.Suppliers")," "),o(3),P(" ",h(21,22,"MoneyIn.Debt")," "),o(3),P(" ",h(24,24,"MoneyIn.Price")," "),o(3),P(" ",h(27,26,"MoneyIn.Notes")," "),o(3),_("ngForOf",s.SuppliersPermissions.SuppliersPermissionsDetails)("ngForTrackBy",s.trackByMethod),o(2),_("ngClass",G(30,xe,s.SuppliersPermissions.Id==0,s.SuppliersPermissions.Id!=0)),o(),_("ngIf",s.SuppliersPermissions.Id==0),o(),_("ngIf",s.SuppliersPermissions.Id!=0),o(2),_("ngIf",s.SuppliersPermissions.Id>0),o(2),R(h(38,28,"Model.Close"))}}var ti=(()=>{let m=class m{constructor(i,e,t,n,a){this._ActivatedRoute=i,this._SharedObjectModelService=e,this._AppModeService=t,this._DefaultSettingsService=n,this._Apiservice=a,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"SuppliersPermissions",Columns:["Id","DocNo","DocDate","Notes"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"}]},this.SuppliersPermissions={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SuppliersPermissionsDetails:[{Amount:"",SupplierId:null,SupplierName:"",Id:0,Code:"",Name:"",Suppliers:[],AmountPermissions:""}]}}ngOnInit(){let i=Number(this._ActivatedRoute.snapshot.queryParams.Id);i>0&&this.GetByIdRoute(i),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(i){this._Apiservice.getById("SuppliersPermissionsEP/GetById",i,!0).pipe(f(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._SharedObjectModelService.PageModel=e.Obj.model,this._SharedObjectModelService.Gl=e.Obj.Gl,this.Drow(this._SharedObjectModelService.PageModel),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(e.Message)}})}OpenModal(){this.ResetPage(),this.GetPageInfo()}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(i){this.SuppliersPermissions={DocDate:new Date(i.DocDate),DocNo:i.DocNo,Id:i.Id,Name:i.Name,Code:i.Code,SuppliersPermissionsDetails:i.SuppliersPermissionsDetails};for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++){this.SuppliersPermissions.SuppliersPermissionsDetails[e].Suppliers=[],this.SuppliersPermissions.SuppliersPermissionsDetails[e].Suppliers=[{Id:this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId,Name:this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierName}];let t=this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId;this._Apiservice.getById("SupplierEP/TotalSuppliersPermissions",t,!1).pipe(f(this._Apiservice.destroy$)).subscribe({next:n=>{n.IsSuccess==!0&&n.Obj!=null?this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions=n.Obj:this._AppModeService._Toastr.error(n.Message)}})}}OpenGl(){this.GLComponent.Open()}StartConnection(){this.Hub_Connection=new ge().withUrl(`${q.signalrUrl}/SuppliersPermissions`,{skipNegotiation:!0,transport:Se.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(_e.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(i=>{console.log(i)})}GetPageInfo(){this._Apiservice.get("SuppliersPermissionsEP/GetPageInfo",!1).pipe(f(this._Apiservice.destroy$)).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?this.SuppliersPermissions.DocNo=i.Obj:this._AppModeService._Toastr.error(i.Message)}})}AppendRow(i){return this.Row={SupplierId:null,Amount:"",AmountPermissions:0,SupplierName:"",Suppliers:[],Code:"",Id:0,Name:""},this.SuppliersPermissions.SuppliersPermissionsDetails.push(this.Row),this.TotalSuppliersPermissions(),!0}RemoveRow(i){return this.SuppliersPermissions.SuppliersPermissionsDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.SuppliersPermissions.SuppliersPermissionsDetails.splice(i,1),this.TotalSuppliersPermissions(),!0)}TotalSuppliersPermissions(){let i=0;for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++)i+=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].Amount);return Number(i.toFixed(2))}ChangeSearchApiDetails(i,e,t){let n=`${e.searchTerm}`.trim();(n==""||n=="null")&&(e.searchTerm="",n=""),this._AppModeService.CurrentPage+=1;let a={TableName:i,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:n,SearchField:"Name"};this._Apiservice.post("Global/GetAll",a,!1).pipe(f(this._Apiservice.destroy$)).subscribe({next:v=>{v.IsSuccess==!0&&v.Obj!=null?this.HandleResponseDetails(v.Obj,i,t):this._AppModeService._Toastr.error(v.Message)}})}HandleResponseDetails(i,e,t){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=i.TotalItems,e=="Suppliers"&&(this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers=this._SharedObjectModelService.RemoveDuplicates(this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers.concat(i.DataReturn),"Id"))}SelectValueDetails(i,e,t){if(i!=null&&i>0){let n=[];e=="Supplier"&&(n=this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers);let a=n.find(v=>v.Id==i);if(a!=null)this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Id`]=a.Id,this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Name`]=a.Name,this.TotalPermissions(a.Id,t);else{this._Apiservice.DontPlay();return}}else this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Id`]=null,this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Name`]=[]}TotalPermissions(i,e){this._Apiservice.getById("SupplierEP/TotalSuppliersPermissions",i,!1).pipe(f(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions=t.Obj:this._AppModeService._Toastr.error(t.Message)}})}ChangeAmount(i,e){}Save(){if(this.SuppliersPermissions.DocDate==""||this.SuppliersPermissions.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++){let t=e,n=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId),a=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].Amount),v=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions);if(n>0){if(a<=0||isNaN(a)||a==null||a==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("MoneyIn.Error.EnterAmount"));return}if(this.SuppliersPermissions.SuppliersPermissionsDetails.filter(fe=>fe.SupplierId==n).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(t+1));return}}}let i={DocNo:this.SuppliersPermissions.DocNo,DocDate:this._Apiservice.ConvertISODate(this.SuppliersPermissions.DocDate),SuppliersPermissionsDetails:this.SuppliersPermissions.SuppliersPermissionsDetails,Id:this.SuppliersPermissions.Id,Name:"",Code:""};i.Id==0&&this._Apiservice.post("SuppliersPermissionsEP/Add",i,!0).pipe(f(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}}),i.Id>0&&this._Apiservice.put("SuppliersPermissionsEP/Update",i,!0).pipe(f(this._Apiservice.destroy$)).subscribe({next:e=>{if(e.IsSuccess==!0&&e.Obj!=null){this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo();let t=e.Obj,n=this._SharedObjectModelService.Paging.DataReturn.find(a=>a.Id==t.Id);n!=null&&Object.assign(n,t)}else this._AppModeService._Toastr.error(e.Message)}})}ResetPage(){this.SuppliersPermissions={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SuppliersPermissionsDetails:[{Amount:"",SupplierId:null,SupplierName:"",Id:0,Code:"",Name:"",Suppliers:[],AmountPermissions:0}]},this._DefaultSettingsService.ResetDate(this.SuppliersPermissions)}ServerListener(){this.Hub_Connection?.on("AddSuppliersPermissions",i=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==i.BranchId&&(this.SuppliersPermissions.DocNo=i.DocNo)})}trackByMethod(i,e){return e.Id}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};m.\u0275fac=function(e){return new(e||m)(D(Q),D(me),D(se),D(Pe),D(z))},m.\u0275cmp=k({type:m,selectors:[["app-suppliers-permissions"]],viewQuery:function(e,t){if(e&1&&(E(Ie,5),E(ve,5)),e&2){let n;V(n=O())&&(t.ContentModel=n.first),V(n=O())&&(t.GLComponent=n.first)}},standalone:!0,features:[j],decls:5,vars:6,consts:[["content",""],["GLComponent",""],["ddddd",""],["SelectSuppliersDetails",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","GlResponse","GetById","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"col-12","d-flex","flex","flex-wrap","align-items-end","px-2"],[1,"col-12","col-sm-6","col-lg-2","col-xl-1","p-1"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"col-12","col-sm-6","col-lg-3","col-xl-2","p-1"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-12","col-sm-6","col-xl-3","p-1"],["class","d-block text-center",4,"ngIf"],["class","formdate",4,"ngIf"],[1,"DivPaging","table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-3","mb-0"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn",3,"click","ngClass"],[4,"ngIf"],[1,"mx-1","pi","pi-save"],["class","btn btn-Add",3,"click",4,"ngIf"],["type","button",1,"btn","btn-light","btn-Close","border","border-1","border-dark",3,"click"],[1,"d-block","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"ngSelect",3,"title"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[3,"title"],["class","text-dark d-block text-center col-11 col-md-12",4,"ngIf"],["min","0","step","1","type","number","appNumericInput","",1,"form-control","shadow-none","text-center",3,"keyup","ngModelChange","disabled","ngModel","name","id"],["type","text",1,"form-control","shadow-none","text-center",3,"ngModelChange","disabled","ngModel","name","id"],[1,"form-text","text-muted"],[1,"text-dark","d-block","text-center","col-11","col-md-12"],[1,"btn","btn-Add",3,"click"]],template:function(e,t){if(e&1){let n=b();p(0,"app-dynamic-component",4),x("OpenModalEvent",function(){return u(n),d(t.OpenModal())})("ShowToEditeEvent",function(){return u(n),d(t.ShowToEdite())}),l(),I(1,Ee,39,33,"ng-template",null,0,L),T(3,"app-glsheard",null,1)}if(e&2){let n=N(2);_("PageTitle","SuppliersPermissions.SuppliersPermissions")("TablePaging",t.TablePaging)("GlResponse",!0)("GetById","SuppliersPermissionsEP/GetById")("DeleteUrl","SuppliersPermissionsEP/Delete")("OutModal",n)}},dependencies:[ae,le,U,H,$,W,te,K,ee,X,ie,Z,J,Y,pe,oe,ne,re,de,he,ce,ue]});let r=m;return r})();export{ti as SuppliersPermissionsComponent};
