import{a as ce,b as de}from"./chunk-6T4APQIW.js";import{a as _e}from"./chunk-N7IVJGNV.js";import{a as Se}from"./chunk-BSPLJHNP.js";import{c as me,j as ue}from"./chunk-GCFZKOIQ.js";import"./chunk-QI74C7BQ.js";import"./chunk-PWIKXZ6E.js";import"./chunk-VTL7OYUD.js";import{a as pe,b as le}from"./chunk-73GIXY73.js";import"./chunk-WL6N6SLT.js";import{a as ae}from"./chunk-64BGN5RD.js";import"./chunk-34JSETBR.js";import"./chunk-QFTVA365.js";import"./chunk-LNYZIAUP.js";import"./chunk-HYE6JRVA.js";import{a as ee,b as ie,c as te,d as se}from"./chunk-YTUM3KNK.js";import{b as oe}from"./chunk-BEBWNCBB.js";import{b as $,c as q,f as z,h as Y,k as J,m as K,s as X,u as Z}from"./chunk-SLSEXWRZ.js";import{c as ne,d as re}from"./chunk-4L6P5Z5M.js";import{A as Q,c as W,d as L,e as H,j as U}from"./chunk-JM67XKKX.js";import{$b as T,Bb as l,Cb as a,Db as w,Hb as I,Lb as C,Mb as u,Qb as A,Sb as N,Tb as E,Ub as V,Vb as x,Wb as S,Xb as O,Yb as h,Zb as j,_b as v,ac as y,cb as p,cc as k,db as D,fc as B,mc as g,na as R,nc as P,oc as G,pc as F,ub as f,wb as _,xa as c,ya as d}from"./chunk-VIO7ZK3G.js";import"./chunk-3EYC4JTX.js";var ge=["content"],Pe=["GLComponent"],fe=(r,m)=>({"btn-success":r,"btn-primary":m});function Ce(r,m){if(r&1&&(l(0,"span",23),S(1),g(2,"date"),a()),r&2){let s=u(2);p(),h(" ",G(2,1,s.SuppliersPermissions.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function be(r,m){if(r&1){let s=I();l(0,"div",24,2)(2,"p-calendar",25),y("ngModelChange",function(e){c(s);let t=u(2);return T(t.SuppliersPermissions.DocDate,e)||(t.SuppliersPermissions.DocDate=e),d(e)}),a()()}if(r&2){let s=x(1),i=u(2);p(2),_("showClear",i.SuppliersPermissions.DocDate!=null&&i.SuppliersPermissions.DocDate!="")("appendTo",s)("showOtherMonths",!0),v("ngModel",i.SuppliersPermissions.DocDate),_("showTime",!0)}}function De(r,m){if(r&1&&(l(0,"small",33),S(1),a()),r&2){let s=u().$implicit,i=u(2);p(),j("Loaded ",s.Suppliers.length," of ",i._SharedObjectModelService.TotalItems,"")}}function Ie(r,m){if(r&1&&S(0),r&2){let s=m.item;h(" ",s.Name," ")}}function xe(r,m){if(r&1&&(l(0,"span",34),S(1),a()),r&2){let s=u().$implicit;p(),h(" ",s.AmountPermissions," ")}}function ve(r,m){if(r&1){let s=I();l(0,"tr")(1,"td",26)(2,"ng-select",27,3),C("clear",function(){let e=c(s).$implicit;return d(e.Suppliers=[])})("focus",function(){let e=c(s).index,t=x(3),n=u(2);return n.ChangeSearchApiDetails("Suppliers",t,e),d(n._AppModeService.ResetCurrentPage())})("keyup",function(){let e=c(s).index,t=x(3),n=u(2);return n.ChangeSearchApiDetails("Suppliers",t,e),d(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=c(s).index,t=x(3),n=u(2);return d(n.ChangeSearchApiDetails("Suppliers",t,e))})("close",function(){c(s);let e=u(2);return d(e._AppModeService.ResetCurrentPage())})("open",function(){c(s);let e=u(2);return d(e._AppModeService.ResetCurrentPage())})("change",function(){let e=c(s),t=e.$implicit,n=e.index,o=u(2);return d(o.SelectValueDetails(t.SupplierId,"Supplier",n))}),y("ngModelChange",function(e){let t=c(s).$implicit;return T(t.SupplierId,e)||(t.SupplierId=e),d(e)}),f(4,De,2,2,"ng-template",28)(5,Ie,1,1,"ng-template",29),a()(),l(6,"td"),f(7,xe,2,1,"span",30),a(),l(8,"td")(9,"input",31),C("keyup",function(){let e=c(s),t=e.$implicit,n=e.index,o=u(2);return o.TotalSuppliersPermissions(),d(o.ChangeAmount(t.SupplierId,n))}),y("ngModelChange",function(e){let t=c(s).$implicit;return T(t.Amount,e)||(t.Amount=e),d(e)}),a()(),l(10,"td")(11,"input",32),y("ngModelChange",function(e){let t=c(s).$implicit;return T(t.Notes,e)||(t.Notes=e),d(e)}),a()()()}if(r&2){let s=m.$implicit,i=m.index,e=u(2);p(2),_("items",s.Suppliers)("autofocus",!1)("dropdownPosition",e._AppModeService.DropdownPosition(i))("virtualScroll",!0)("searchable",!0),v("ngModel",s.SupplierId),p(5),_("ngIf",s.SupplierId>0),p(2),A("name","Amount",i,""),A("id","Amount",i,""),_("disabled",s.SupplierId==0||s.SupplierId==null),v("ngModel",s.Amount),p(2),A("name","Notes",i,""),A("id","Notes",i,""),_("disabled",s.SupplierId==0||s.SupplierId==null),v("ngModel",s.Notes)}}function Te(r,m){r&1&&(l(0,"span"),S(1),g(2,"translate"),a()),r&2&&(p(),h(" ",P(2,1,"Model.Save"),""))}function ye(r,m){r&1&&(l(0,"span"),S(1),g(2,"translate"),a()),r&2&&(p(),h(" ",P(2,1,"Model.Update"),""))}function Me(r,m){if(r&1){let s=I();l(0,"button",35),C("click",function(){c(s);let e=u(2);return d(e.OpenGl())}),S(1),g(2,"translate"),a()}r&2&&(p(),h(" ",P(2,1,"Model.Gl")," "))}function Ae(r,m){if(r&1){let s=I();w(0,"app-modal-header",5),l(1,"div",6)(2,"div",7)(3,"div",8),w(4,"input",9),a(),l(5,"div",8)(6,"label",10),S(7),g(8,"translate"),a(),l(9,"input",11),y("ngModelChange",function(e){c(s);let t=u();return T(t.SuppliersPermissions.Notes,e)||(t.SuppliersPermissions.Notes=e),d(e)}),a()(),l(10,"div",8),f(11,Ce,3,4,"span",12)(12,be,3,5,"div",13),a()(),l(13,"table",14)(14,"thead")(15,"th",15),S(16),g(17,"translate"),a(),l(18,"th",15),S(19),g(20,"translate"),a(),l(21,"th",15),S(22),g(23,"translate"),a(),l(24,"th",16),S(25),g(26,"translate"),a()(),l(27,"tbody"),f(28,ve,12,19,"tr",17),a()()(),l(29,"div",18)(30,"button",19),C("click",function(){c(s);let e=u();return d(e.Save())}),f(31,Te,3,3,"span",20)(32,ye,3,3,"span",20),a(),f(33,Me,3,3,"button",21),l(34,"button",22),C("click",function(){let e=c(s).$implicit,t=u();return e.close("Close click"),d(t.ResetPage())}),S(35),g(36,"translate"),a()()}if(r&2){let s=u();_("PageTitle","SuppliersPermissions.SuppliersPermissions"),p(4),_("disabled",!0)("value",s.SuppliersPermissions.DocNo),p(3),O(P(8,18,"Table.Notes")),p(2),v("ngModel",s.SuppliersPermissions.Notes),p(2),_("ngIf",(s._DefaultSettingsService.DefaultSettings==null?null:s._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),p(),_("ngIf",(s._DefaultSettingsService.DefaultSettings==null?null:s._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),p(4),h(" ",P(17,20,"MoneyIn.Suppliers")," "),p(3),h(" ",P(20,22,"MoneyIn.Debt")," "),p(3),h(" ",P(23,24,"MoneyIn.Price")," "),p(3),h(" ",P(26,26,"MoneyIn.Notes")," "),p(3),_("ngForOf",s.SuppliersPermissions.SuppliersPermissionsDetails)("ngForTrackBy",s.trackByMethod),p(2),_("ngClass",B(30,fe,s.SuppliersPermissions.Id==0,s.SuppliersPermissions.Id!=0)),p(),_("ngIf",s.SuppliersPermissions.Id==0),p(),_("ngIf",s.SuppliersPermissions.Id!=0),p(),_("ngIf",s.SuppliersPermissions.Id>0),p(2),O(P(36,28,"Model.Close"))}}var Je=(()=>{let m=class m{constructor(i,e,t,n,o){this._ActivatedRoute=i,this._SharedObjectModelService=e,this._AppModeService=t,this._DefaultSettingsService=n,this._Apiservice=o,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"SuppliersPermissions",Columns:["Id","DocNo","DocDate","Notes"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"}]},this.SubscriptionArr=[],this.SuppliersPermissions={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SuppliersPermissionsDetails:[{Amount:"",SupplierId:null,SupplierName:"",Id:0,Code:"",Name:"",Suppliers:[],AmountPermissions:""}]}}ngOnInit(){let i=Number(this._ActivatedRoute.snapshot.queryParams.Id);i>0&&this.GetByIdRoute(i),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(i){let e=this._Apiservice.getById("SuppliersPermissionsEP/GetById",i,!0).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this._SharedObjectModelService.PageModel=t.Obj.model,this._SharedObjectModelService.Gl=t.Obj.Gl,this.Drow(this._SharedObjectModelService.PageModel),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(t.Message)}});this.SubscriptionArr.push(e)}OpenModal(){this.ResetPage(),this.GetPageInfo()}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(i){this.SuppliersPermissions={DocDate:new Date(i.DocDate),DocNo:i.DocNo,Id:i.Id,Name:i.Name,Code:i.Code,SuppliersPermissionsDetails:i.SuppliersPermissionsDetails};for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++){this.SuppliersPermissions.SuppliersPermissionsDetails[e].Suppliers=[],this.SuppliersPermissions.SuppliersPermissionsDetails[e].Suppliers=[{Id:this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId,Name:this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierName}];let t=this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId,n=this._Apiservice.post("SupplierEP/TotalSuppliersPermissions",t,!1).subscribe({next:o=>{o.IsSuccess==!0&&o.Obj!=null?this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions=o.Obj:this._AppModeService._Toastr.error(o.Message)}});this.SubscriptionArr.push(n)}}OpenGl(){this.GLComponent.Open()}StartConnection(){this.Hub_Connection=new de().withUrl(`${$.signalrUrl}/SuppliersPermissions`,{skipNegotiation:!0,transport:ce.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(i=>{console.log("Error Hub Connection",i)})}GetPageInfo(){let i=this._Apiservice.get("SuppliersPermissionsEP/GetPageInfo",!1).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?this.SuppliersPermissions.DocNo=e.Obj:this._AppModeService._Toastr.error(e.Message)}});this.SubscriptionArr.push(i)}AppendRow(i){return this.Row={SupplierId:null,Amount:"",AmountPermissions:0,SupplierName:"",Suppliers:[],Code:"",Id:0,Name:""},this.SuppliersPermissions.SuppliersPermissionsDetails.push(this.Row),this.TotalSuppliersPermissions(),!0}RemoveRow(i){return this.SuppliersPermissions.SuppliersPermissionsDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.SuppliersPermissions.SuppliersPermissionsDetails.splice(i,1),this.TotalSuppliersPermissions(),!0)}TotalSuppliersPermissions(){let i=0;for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++)i+=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].Amount);return Number(i.toFixed(2))}ChangeSearchApiDetails(i,e,t){let n=`${e.searchTerm}`.trim();(n==""||n=="null")&&(e.searchTerm="",n=""),this._AppModeService.CurrentPage+=1;let o={TableName:i,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:n,SearchField:"Name"},b=this._Apiservice.post("Global/GetAll",o,!1).subscribe({next:M=>{M.IsSuccess==!0&&M.Obj!=null?this.HandleResponseDetails(M.Obj,i,t):this._AppModeService._Toastr.error(M.Message)}});this.SubscriptionArr.push(b)}HandleResponseDetails(i,e,t){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=i.TotalItems,e=="Suppliers"&&(this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers=this._SharedObjectModelService.RemoveDuplicates(this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers.concat(i.DataReturn),"Id"))}SelectValueDetails(i,e,t){if(i!=null&&i>0){let n=[];e=="Supplier"&&(n=this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers);let o=n.find(b=>b.Id==i);if(o!=null)this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Id`]=o.Id,this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Name`]=o.Name,this.TotalPermissions(o.Id,t);else{this._Apiservice.DontPlay();return}}else this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Id`]=null,this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Name`]=[]}TotalPermissions(i,e){let t=this._Apiservice.post("SupplierEP/TotalSuppliersPermissions",i,!1).subscribe({next:n=>{n.IsSuccess==!0&&n.Obj!=null?this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions=n.Obj:this._AppModeService._Toastr.error(n.Message)}});this.SubscriptionArr.push(t)}ChangeAmount(i,e){}Save(){if(this.SuppliersPermissions.DocDate==""||this.SuppliersPermissions.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++){let t=e,n=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId),o=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].Amount),b=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions);if(n>0){if(o<=0||isNaN(o)||o==null||o==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("MoneyIn.Error.EnterAmount"));return}if(this.SuppliersPermissions.SuppliersPermissionsDetails.filter(he=>he.SupplierId==n).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(t+1));return}}}let i={DocNo:this.SuppliersPermissions.DocNo,DocDate:this._Apiservice.ConvertISODate(this.SuppliersPermissions.DocDate),SuppliersPermissionsDetails:this.SuppliersPermissions.SuppliersPermissionsDetails,Id:this.SuppliersPermissions.Id,Name:"",Code:""};if(i.Id==0){let e=this._Apiservice.post("SuppliersPermissionsEP/Add",i,!0).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(t.Obj)):this._AppModeService._Toastr.error(t.Message)}});this.SubscriptionArr.push(e)}if(i.Id>0){let e=this._Apiservice.put("SuppliersPermissionsEP/Update",i,!0).subscribe({next:t=>{if(t.IsSuccess==!0&&t.Obj!=null){this._AppModeService._Toastr.success(t.Message),this.ResetPage(),this.GetPageInfo();let n=t.Obj,o=this._SharedObjectModelService.Paging.DataReturn.find(b=>b.Id==n.Id);o!=null&&Object.assign(o,n)}else this._AppModeService._Toastr.error(t.Message)}});this.SubscriptionArr.push(e)}}ResetPage(){this.SuppliersPermissions={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SuppliersPermissionsDetails:[{Amount:"",SupplierId:null,SupplierName:"",Id:0,Code:"",Name:"",Suppliers:[],AmountPermissions:0}]},this._DefaultSettingsService.ResetDate(this.SuppliersPermissions)}ServerListener(){this.Hub_Connection?.on("AddSuppliersPermissions",i=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==i.BranchId&&(this.SuppliersPermissions.DocNo=i.DocNo)})}trackByMethod(i,e){return e.Id}ngOnDestroy(){for(let i=0;i<this.SubscriptionArr.length;i++)this.SubscriptionArr[i].unsubscribe()}};m.\u0275fac=function(e){return new(e||m)(D(Q),D(ae),D(oe),D(Se),D(q))},m.\u0275cmp=R({type:m,selectors:[["app-suppliers-permissions"]],viewQuery:function(e,t){if(e&1&&(N(ge,5),N(Pe,5)),e&2){let n;E(n=V())&&(t.ContentModel=n.first),E(n=V())&&(t.GLComponent=n.first)}},standalone:!0,features:[k],decls:5,vars:7,consts:[["content",""],["GLComponent",""],["ddddd",""],["SelectSuppliersDetails",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"col-12","d-flex","flex","flex-wrap","align-items-end"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","px-1"],["type","number","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block",4,"ngIf"],["class","formdate",4,"ngIf"],[1,"table","table-hover","table-striped","table-light","mt-3","mb-0"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn","py-3","px-5",3,"click","ngClass"],[4,"ngIf"],["class","btn btn-info mx-3 py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-secondary","py-3","px-5",3,"click"],[1,"d-block"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","showClear","appendTo","showOtherMonths","ngModel","showTime"],[1,"ngSelect"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["class","text-dark",4,"ngIf"],["min","0","step","1","type","number",1,"form-control","shadow-none","text-center",3,"keyup","ngModelChange","disabled","ngModel","name","id"],["type","text",1,"form-control","shadow-none","text-center",3,"ngModelChange","disabled","ngModel","name","id"],[1,"form-text","text-muted"],[1,"text-dark"],[1,"btn","btn-info","mx-3","py-3","px-5",3,"click"]],template:function(e,t){if(e&1){let n=I();l(0,"app-dynamic-component",4),C("OpenModalEvent",function(){return c(n),d(t.OpenModal())})("ShowToEditeEvent",function(){return c(n),d(t.ShowToEdite())}),a(),f(1,Ae,37,33,"ng-template",null,0,F),w(3,"app-glsheard",null,1)}if(e&2){let n=x(2);_("PageTitle","SuppliersPermissions.SuppliersPermissions")("TablePaging",t.TablePaging)("FullScreen",!0)("GlResponse",!0)("GetById","SuppliersPermissionsEP/GetById")("DeleteUrl","SuppliersPermissionsEP/Delete")("OutModal",n)}},dependencies:[le,pe,U,H,L,W,Z,z,K,Y,X,J,re,ne,se,te,ee,ie,ue,_e,me]});let r=m;return r})();export{Je as SuppliersPermissionsComponent};
