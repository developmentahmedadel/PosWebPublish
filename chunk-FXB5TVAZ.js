import{a as he}from"./chunk-X4NKGLB3.js";import{a as Te}from"./chunk-3UDBFBON.js";import{b as pe,j as me}from"./chunk-A6MDEMU4.js";import"./chunk-3ZAIJ4IV.js";import"./chunk-Y5QDR55A.js";import{a as de}from"./chunk-VSYXDL23.js";import"./chunk-BHSN7HFD.js";import{a as ce,b as le}from"./chunk-6BJKXUWP.js";import"./chunk-3Y7UQ2M3.js";import{a as _e}from"./chunk-BHTRH7BV.js";import"./chunk-VUX2NRX2.js";import"./chunk-RXBBGPQB.js";import"./chunk-GEJP5WQO.js";import"./chunk-GNF256I6.js";import{a as ie,b as ae,c as oe,d as se}from"./chunk-MZIKAFPE.js";import"./chunk-EGE4BGUH.js";import"./chunk-RVJIMCIT.js";import{c as re}from"./chunk-ITQ57RKD.js";import{c as Y,d as K}from"./chunk-KALZ37GW.js";import{c as q,f as X,h as Z,k as ee,m as te,u as ne}from"./chunk-N4FWSTCP.js";import{A as H,G as z,d as $,e as L,j as J}from"./chunk-VTADEU6K.js";import{$b as v,Cb as l,Db as p,Eb as N,Ib as D,Mb as B,Nb as o,Qb as F,Rb as E,Tb as R,Ub as U,Vb as O,Wb as g,X as y,Xb as h,Yb as I,Zb as x,_b as P,ac as b,bc as w,db as _,dc as Q,eb as M,na as G,nc as T,oc as u,pc as W,qc as k,vb as C,xa as s,xb as f,ya as c}from"./chunk-J5UB44FZ.js";import{a as A,b as V}from"./chunk-3EYC4JTX.js";var fe=["content"],ue=["GLComponent"];function ge(a,d){if(a&1&&(l(0,"span",35),h(1),T(2,"date"),p()),a&2){let r=o(2);_(),x(" ",W(2,1,r.TransferBanches.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Se(a,d){if(a&1){let r=D();l(0,"div",36)(1,"p-calendar",37),w("ngModelChange",function(e){s(r);let t=o(2);return b(t.TransferBanches.DocDate,e)||(t.TransferBanches.DocDate=e),c(e)}),p()()}if(a&2){let r=o(2);_(),v("ngModel",r.TransferBanches.DocDate),f("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function Be(a,d){if(a&1&&(l(0,"small",38),h(1),p()),a&2){let r=o(2);_(),P("Loaded ",r.Branches.length," of ",r._SharedObjectModelService.TotalItems,"")}}function xe(a,d){if(a&1&&h(0),a&2){let r=d.item;x(" ",r.Name," ")}}function Ie(a,d){if(a&1&&(l(0,"small",38),h(1),p()),a&2){let r=o(2);_(),P("Loaded ",r.FromStorages.length," of ",r._SharedObjectModelService.TotalItems,"")}}function Ce(a,d){if(a&1&&h(0),a&2){let r=d.item;x(" ",r.Name,`
`)}}function ve(a,d){if(a&1&&(l(0,"small",38),h(1),p()),a&2){let r=o(2);_(),P("Loaded ",r.Branches.length," of ",r._SharedObjectModelService.TotalItems,"")}}function be(a,d){if(a&1&&h(0),a&2){let r=d.item;x(" ",r.Name,`
`)}}function we(a,d){if(a&1&&(l(0,"small",38),h(1),p()),a&2){let r=o(2);_(),P("Loaded ",r.ToStorages.length," of ",r._SharedObjectModelService.TotalItems,"")}}function Ne(a,d){if(a&1&&h(0),a&2){let r=d.item;x(" ",r.Name,`
`)}}function De(a,d){if(a&1&&(l(0,"small",38),h(1),p()),a&2){let r=o().$implicit,n=o(2);_(),P("Loaded ",r.Items.length," of ",n._SharedObjectModelService.TotalItems,"")}}function ye(a,d){if(a&1&&h(0),a&2){let r=d.item;P(" ",r.Name," - ",r.Code," ")}}function Pe(a,d){if(a&1){let r=D();l(0,"button",53),B("click",function(){s(r);let e=o().index,t=o(2),i=g(4);return c(t.GetItemBalance(e,i))}),N(1,"i",54),p()}if(a&2){let r=o(3);f("disabled",r._AppModeService.DisabledButton)}}function Me(a,d){if(a&1&&(l(0,"small",38),h(1),p()),a&2){let r=o().$implicit,n=o(2);_(),P("Loaded ",r.ProductUnits.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Fe(a,d){if(a&1&&h(0),a&2){let r=d.item;x(" ",r.Name," ")}}function Ae(a,d){if(a&1){let r=D();l(0,"tr")(1,"td",39)(2,"div",40)(3,"span",41),h(4),p(),l(5,"button",42),B("click",function(){s(r);let e=o(2);return c(e.AppendRow())}),N(6,"i",43),p(),l(7,"button",44),B("click",function(){let e=s(r).index,t=o(2);return c(t.RemoveRow(e))}),N(8,"i",45),p()()(),l(9,"td",46),T(10,"translate"),l(11,"ng-select",47,7),T(13,"translate"),B("clear",function(){let e=s(r).$implicit;return c(e.Items=[])})("focus",function(){let e=s(r).index,t=g(12),i=o(2);return i.ChangeSearchApiDetails("Items",t,e),c(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(r).index,t=g(12),i=o(2);return i.ChangeSearchApiDetails("Items",t,e),c(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(r).index,t=g(12),i=o(2);return c(i.ChangeSearchApiDetails("Items",t,e))})("close",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(r),t=e.$implicit,i=e.index,m=o(2);return c(m.SelectItem(t.ProductId,i))}),w("ngModelChange",function(e){let t=s(r).$implicit;return b(t.ProductId,e)||(t.ProductId=e),c(e)}),C(14,De,2,2,"ng-template",21)(15,ye,1,2,"ng-template",22),p(),C(16,Pe,2,1,"button",48),p(),l(17,"td",49),T(18,"translate"),l(19,"ng-select",50,8),T(21,"translate"),B("clear",function(){let e=s(r).$implicit;return c(e.ProductUnits=[])})("focus",function(){let e=s(r).index,t=g(20),i=o(2);return i.ChangeSearchApiDetails("ItemUnits",t,e),c(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(r).index,t=g(20),i=o(2);return i.ChangeSearchApiDetails("ItemUnits",t,e),c(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(r).index,t=g(20),i=o(2);return c(i.ChangeSearchApiDetails("ItemUnits",t,e))})("close",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(r),t=e.$implicit,i=e.index,m=o(2);return c(m.SelectUnit(t.ProductUnitId,i))}),w("ngModelChange",function(e){let t=s(r).$implicit;return b(t.ProductUnitId,e)||(t.ProductUnitId=e),c(e)}),C(22,Me,2,2,"ng-template",21)(23,Fe,1,1,"ng-template",22),p()(),l(24,"td",51),T(25,"translate"),l(26,"input",52),B("change",function(){let e=s(r).index,t=o(2);return c(t.TotalRow(e))})("keyup",function(){let e=s(r).index,t=o(2);return c(t.TotalRow(e))}),w("ngModelChange",function(e){let t=s(r).$implicit;return b(t.Quantity,e)||(t.Quantity=e),c(e)}),p()()()}if(a&2){let r=d.$implicit,n=d.index,e=o(2);_(),F("title",n+1),_(3),I(n+1),_(3),f("disabled",e.TransferBanches.TransferBranchesDetails.length==1),_(2),F("title",u(10,22,"TransferStorage.Name")),_(2),E("placeholder","  ",u(13,24,"SaleInvoice.ChooseProduct"),""),f("items",r.Items)("dropdownPosition","bottom")("searchable",!0)("virtualScroll",!0),v("ngModel",r.ProductId),_(5),f("ngIf",r.ProductId>0&&e.TransferBanches.FromStoreId>0&&e.TransferBanches.ToStoreId>0),_(),F("title",u(18,26,"SaleInvoice.Units")),_(2),E("placeholder","  ",u(21,28,"Item.ItemUnit"),""),f("items",r.ProductUnits)("dropdownPosition","bottom")("disabled",r.ProductId==0||r.ProductId==null),v("ngModel",r.ProductUnitId),_(5),F("title",u(25,30,"SaleInvoice.Quantity")),_(2),f("disabled",r.ProductId<=0||r.UnitId<=0),v("ngModel",r.Quantity)}}function Ve(a,d){if(a&1){let r=D();l(0,"button",55),B("click",function(){s(r);let e=o(2);return c(e.Save())}),l(1,"span"),h(2),T(3,"translate"),p(),N(4,"i",56),p()}a&2&&(_(2),x(" ",u(3,1,"Model.Save"),""))}function Ee(a,d){if(a&1){let r=D();l(0,"button",57),B("click",function(){s(r);let e=o(2);return c(e.ResetPage())}),l(1,"span"),h(2),T(3,"translate"),p()()}a&2&&(_(2),x(" ",u(3,1,"Model.New"),""))}function Re(a,d){if(a&1){let r=D();l(0,"button",55),B("click",function(){s(r);let e=o(2);return c(e.OpenGl())}),h(1),T(2,"translate"),p()}a&2&&(_(),x(" ",u(2,1,"Model.Gl")," "))}function Ue(a,d){if(a&1){let r=D();N(0,"app-modal-header",11),l(1,"div",12)(2,"div",13)(3,"div",14),N(4,"input",15),p(),l(5,"div",14),N(6,"input",15),p(),l(7,"div",14)(8,"p",16),h(9),T(10,"translate"),p(),l(11,"input",17),w("ngModelChange",function(e){s(r);let t=o();return b(t.TransferBanches.Notes,e)||(t.TransferBanches.Notes=e),c(e)}),p()(),l(12,"div",14),C(13,ge,3,4,"span",18)(14,Se,2,5,"div",19),p()(),l(15,"div",13)(16,"div",14)(17,"p",16),h(18),T(19,"translate"),p(),l(20,"ng-select",20,3),B("clear",function(){s(r);let e=o();return c(e.Branches=[])})("focus",function(){s(r);let e=g(21),t=o();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=g(21),t=o();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=g(21),t=o();return c(t.ChangeSearchApi("Branch",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.FromBranchId,"FromBranch"))}),w("ngModelChange",function(e){s(r);let t=o();return b(t.TransferBanches.FromBranchId,e)||(t.TransferBanches.FromBranchId=e),c(e)}),C(22,Be,2,2,"ng-template",21)(23,xe,1,1,"ng-template",22),p()(),l(24,"div",14)(25,"p",23),h(26),T(27,"translate"),p(),l(28,"ng-select",24,4),B("clear",function(){s(r);let e=o();return c(e.FromStorages=[])})("focus",function(){s(r);let e=g(29),t=o();return t.ChangeSearchApi("FromStore",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=g(29),t=o();return t.ChangeSearchApi("FromStore",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=g(29),t=o();return c(t.ChangeSearchApi("FromStore",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.FromStoreId,"FromStore"))}),w("ngModelChange",function(e){s(r);let t=o();return b(t.TransferBanches.FromStoreId,e)||(t.TransferBanches.FromStoreId=e),c(e)}),C(30,Ie,2,2,"ng-template",21)(31,Ce,1,1,"ng-template",22),p()(),l(32,"div",14)(33,"p",16),h(34),T(35,"translate"),p(),l(36,"ng-select",20,5),B("clear",function(){s(r);let e=o();return c(e.Branches=[])})("focus",function(){s(r);let e=g(37),t=o();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=g(37),t=o();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=g(37),t=o();return c(t.ChangeSearchApi("Branch",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.ToBranchId,"ToBranch"))}),w("ngModelChange",function(e){s(r);let t=o();return b(t.TransferBanches.ToBranchId,e)||(t.TransferBanches.ToBranchId=e),c(e)}),C(38,ve,2,2,"ng-template",21)(39,be,1,1,"ng-template",22),p()(),l(40,"div",14)(41,"p",16),h(42),T(43,"translate"),p(),l(44,"ng-select",25,6),B("clear",function(){s(r);let e=o();return c(e.ToStorages=[])})("focus",function(){s(r);let e=g(45),t=o();return t.ChangeSearchApi("ToStore",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=g(45),t=o();return t.ChangeSearchApi("ToStore",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=g(45),t=o();return c(t.ChangeSearchApi("ToStore",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.ToStoreId,"ToStore"))}),w("ngModelChange",function(e){s(r);let t=o();return b(t.TransferBanches.ToStoreId,e)||(t.TransferBanches.ToStoreId=e),c(e)}),C(46,we,2,2,"ng-template",21)(47,Ne,1,1,"ng-template",22),p()()(),l(48,"div",26)(49,"table",27)(50,"thead")(51,"tr")(52,"th",28),h(53,"#"),p(),l(54,"th",29),h(55),T(56,"translate"),p(),l(57,"th",29),h(58),T(59,"translate"),p(),l(60,"th",29),h(61),T(62,"translate"),p()()(),l(63,"tbody"),C(64,Ae,27,32,"tr",30),p()()()(),l(65,"div",31),C(66,Ve,5,3,"button",32)(67,Ee,4,3,"button",33)(68,Re,3,3,"button",32),l(69,"button",34),B("click",function(){let e=s(r).$implicit,t=o();return e.close("Close click"),c(t.ResetPage())}),h(70),T(71,"translate"),p()()}if(a&2){let r=o();f("PageTitle","TransferBanches.TransferBanches"),_(4),f("disabled",!0)("value",r.TransferBanches.DocNoFrom),_(2),f("disabled",!0)("value",r.TransferBanches.DocNoTo),_(3),I(u(10,43,"Table.Notes")),_(2),v("ngModel",r.TransferBanches.Notes),_(2),f("ngIf",(r._DefaultSettingsService.DefaultSettings==null?null:r._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),_(),f("ngIf",(r._DefaultSettingsService.DefaultSettings==null?null:r._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),_(4),I(u(19,45,"TransferBanches.BranchFrom")),_(2),f("items",r.Branches)("autofocus",!1)("virtualScroll",!0)("searchable",!0),v("ngModel",r.TransferBanches.FromBranchId),_(6),I(u(27,47,"TransferStorage.FromStoreId")),_(2),f("items",r.FromStorages)("autofocus",!1)("virtualScroll",!0)("disabled",r.TransferBanches.FromBranchId==null)("searchable",!0),v("ngModel",r.TransferBanches.FromStoreId),_(6),I(u(35,49,"TransferBanches.BranchTo")),_(2),f("items",r.Branches)("autofocus",!1)("virtualScroll",!0)("searchable",!0),v("ngModel",r.TransferBanches.ToBranchId),_(6),I(u(43,51,"TransferStorage.ToStoreId")),_(2),f("items",r.ToStorages)("autofocus",!1)("virtualScroll",!0)("searchable",!0)("disabled",r.TransferBanches.ToBranchId==null),v("ngModel",r.TransferBanches.ToStoreId),_(11),I(u(56,53,"TransferStorage.Name")),_(3),I(u(59,55,"SaleInvoice.Units")),_(3),I(u(62,57,"TransferStorage.Quantity")),_(3),f("ngForOf",r.TransferBanches.TransferBranchesDetails),_(2),f("ngIf",r.TransferBanches.Id==0),_(),f("ngIf",r.TransferBanches.Id>0),_(),f("ngIf",r.TransferBanches.Id>0),_(2),I(u(71,59,"Model.Close"))}}function Oe(a,d){if(a&1&&(l(0,"tr")(1,"td"),h(2),p(),l(3,"td"),h(4),p()()),a&2){let r=d.$implicit;_(2),x(" ",r.Name," "),_(2),x(" ",r.Qty," ")}}function ke(a,d){if(a&1&&(l(0,"tr")(1,"td"),h(2),p(),l(3,"td"),h(4),p()()),a&2){let r=d.$implicit;_(2),x(" ",r.Name," "),_(2),x(" ",r.Qty," ")}}function je(a,d){if(a&1&&(l(0,"div",58)(1,"p",59),h(2),T(3,"translate"),p(),l(4,"table",60)(5,"thead")(6,"tr")(7,"th"),h(8),T(9,"translate"),p(),l(10,"th"),h(11),T(12,"translate"),p()()(),l(13,"tbody"),C(14,Oe,5,2,"tr",30),p()(),l(15,"p",59),h(16),T(17,"translate"),p(),l(18,"table",60)(19,"thead")(20,"tr")(21,"th"),h(22),T(23,"translate"),p(),l(24,"th"),h(25),T(26,"translate"),p()()(),l(27,"tbody"),C(28,ke,5,2,"tr",30),p()()()),a&2){let r=o();_(2),x(" ",u(3,8,"TransferStorage.BalanceFrom")," "),_(6),I(u(9,10,"SaleInvoice.Name")),_(3),I(u(12,12,"Table.Balance")),_(3),f("ngForOf",r.ItemBalanceFrom),_(2),x(" ",u(17,14,"TransferStorage.BalanceTo")," "),_(6),I(u(23,16,"SaleInvoice.Name")),_(3),I(u(26,18,"Table.Balance")),_(3),f("ngForOf",r.ItemBalanceTo)}}var lt=(()=>{let d=class d{constructor(n,e,t,i,m){this._ActivatedRoute=n,this._AppModeService=e,this._SharedObjectModelService=t,this._DefaultSettingsService=i,this._Apiservice=m,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"TransferBranches",Join:!0,JoinTables:["Storages SF","Storages ST"],JoinConditions:["T.FromStoreId = SF.Id","T.ToStoreId = ST.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","T.FromBranchName","SF.Name AS FromStoreName","T.ToBranchName","ST.Name AS ToStoreName"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"FromBranchName",CellName:"TransferBanches.BranchFrom"},{SortName:"FromStoreName",CellName:"TransferStorage.FromStoreId",ExistSearchField:"SF.Name"},{SortName:"ToBranchName",CellName:"TransferBanches.BranchTo"},{SortName:"ToStoreName",CellName:"TransferStorage.ToStoreId",ExistSearchField:"ST.Name"},{SortName:"Notes",CellName:"Table.Notes",ExistSearchField:"T.Notes"}]},this.Branches=[],this.ToStorages=[],this.FromStorages=[],this.TransferBanches={DocNo:0,DocDate:"",DocNoTo:0,DocNoFrom:0,TransferBranchesDetails:[{ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0}],FromStoreId:null,FromStoreName:"",FromBranchId:null,FromBranchName:"",ToBranchId:null,ToBranchName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,TotalPrice:0,Id:0,Name:"",Code:""},this.ItemBalanceFrom=[],this.ItemBalanceTo=[]}ngOnInit(){let n=Number(this._ActivatedRoute.snapshot.queryParams.Id);n>0&&this.GetByIdRoute(n)}GetByIdRoute(n){this._Apiservice.getById("TransferBranchesEP/GetById",n,!0).pipe(y(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._SharedObjectModelService.PageModel=e.Obj.model,this._SharedObjectModelService.Gl=e.Obj.Gl,this.Drow(this._SharedObjectModelService.PageModel),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(e.Message)}})}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(n){this.TransferBanches={Id:n.Id,DocNo:n.DocNo,DocDate:new Date(`${n.DocDate}`),DocNoTo:n.DocNoTo,DocNoFrom:n.DocNoFrom,FromStoreId:n.FromStoreId,FromBranchId:n.FromBranchId,ToBranchId:n.ToBranchId,ToStoreId:n.ToStoreId,TotalQty:n.TotalQty,TotalPrice:n.TotalPrice,TransferBranchesDetails:n.TransferBranchesDetails},this.Branches=[],this.Branches.push({Id:n.FromBranchId,Name:n.FromBranchName}),this.Branches.push({Id:n.ToBranchId,Name:n.ToBranchName}),this.FromStorages.push({Id:n.FromStoreId,Name:n.FromStoreName}),this.ToStorages.push({Id:n.ToStoreId,Name:n.ToStoreName});for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++){let t=this.TransferBanches.TransferBranchesDetails[e];t.Items=[{Id:t.ProductId,Name:t.ProductName,NameAndCode:t.ProductName}],t.ProductUnits=[{Id:t.ProductUnitId,Name:t.ProductUnitName,NameAndUnitFactor:t.ProductUnitName}]}}OpenModal(){this.ResetPage()}OpenGl(){this.GLComponent.Open()}ChangeSearchApi(n,e){let t=`${e.searchTerm}`.trim();(t==""||t=="null")&&(e.searchTerm="",t=""),this._AppModeService.CurrentPage+=1;let i={TableName:n,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:t,SearchField:"Name"};n=="FromStore"&&(i.TableName="Storages",i.Conditions=`BranchId = ${this.TransferBanches.FromBranchId}`),n=="ToStore"&&(i.TableName="Storages",i.Conditions=`BranchId = ${this.TransferBanches.ToBranchId}`),this._Apiservice.post("Global/GetAll",i,!1).pipe(y(this._Apiservice.destroy$)).subscribe({next:m=>{m.IsSuccess==!0&&m.Obj!=null?this.HandleResponse(m.Obj,n):this._AppModeService._Toastr.error(m.Message)}})}HandleResponse(n,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=n.TotalItems,e=="FromStore"&&(this.FromStorages=this._SharedObjectModelService.RemoveDuplicates(this.FromStorages.concat(n.DataReturn),"Id")),e=="ToStore"&&(this.ToStorages=this._SharedObjectModelService.RemoveDuplicates(this.ToStorages.concat(n.DataReturn),"Id")),e=="Branch"&&(this.Branches=this._SharedObjectModelService.RemoveDuplicates(this.Branches.concat(n.DataReturn),"Id"))}SelectValue(n,e){if(n!=null&&(n>0||n!="")){let t=[];e=="FromStore"&&(t=this.FromStorages),e=="ToStore"&&(t=this.ToStorages),(e=="FromBranch"||e=="ToBranch")&&(t=this.Branches);let i=t.find(m=>m.Id==n);if(i==null){this._AppModeService.DontPlay();return}else this.TransferBanches[`${e}Id`]=n,this.TransferBanches[`${e}Name`]=i.Name,(e=="FromBranch"||e=="ToBranch")&&(this.GetDocNo(),e=="ToBranch"&&(this.TransferBanches.ToStoreId=null,this.ToStorages=[]),e=="FromBranch"&&(this.TransferBanches.FromStoreId=null,this.FromStorages=[]))}else this.TransferBanches[`${e}Id`]=null,this.TransferBanches[`${e}Name`]="",e=="ToBranch"&&(this.TransferBanches.DocNoTo=0,this.ToStorages=[],this.TransferBanches.ToStoreId=null),e=="FromBranch"&&(this.TransferBanches.DocNoFrom=0,this.FromStorages=[],this.TransferBanches.FromStoreId=null)}ChangeSearchApiDetails(n,e,t){let i=`${e.searchTerm}`.trim();(i==""||i=="null")&&(e.searchTerm="",i=""),this._AppModeService.CurrentPage+=1;let m={TableName:n,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:i,SearchField:"Name"};if(n=="Items"&&(m.Columns=["Id","Name","Code"],m.Conditions="ProductType != 2"),n=="ItemUnits"){let S=this.TransferBanches.TransferBranchesDetails[t].ProductId==null?0:this.TransferBanches.TransferBranchesDetails[t].ProductId;m.Conditions=`ItemId = ${S}`,m.Join=!0,m.JoinTables=["Units U"],m.NoPaging=!0,m.JoinConditions=["T.UnitId = U.Id"],m.Columns=["T.Id","U.Name","T.UnitFactor"],m.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",m,!1).pipe(y(this._Apiservice.destroy$)).subscribe({next:S=>{S.IsSuccess==!0&&S.Obj!=null?this.HandleResponseDetails(S.Obj,n,t):this._AppModeService._Toastr.error(S.Message)}})}HandleResponseDetails(n,e,t){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=n.TotalItems,e=="Items"&&(this.TransferBanches.TransferBranchesDetails[t].Items=this._SharedObjectModelService.RemoveDuplicates(this.TransferBanches.TransferBranchesDetails[t].Items.concat(n.DataReturn),"Id"),this.TransferBanches.TransferBranchesDetails[t].Items=this.TransferBanches.TransferBranchesDetails[t].Items.map(i=>V(A({},i),{NameAndCode:i.Code!=null?`${i.Name} - ${i.Code}`:`${i.Name}`}))),e=="ItemUnits"&&(this.TransferBanches.TransferBranchesDetails[t].ProductUnits=n.DataReturn.map(i=>V(A({},i),{NameAndUnitFactor:i.UnitFactor!=null?`${i.Name} - ${i.UnitFactor}`:`${i.Name}`})))}SelectItem(n,e){if(n!=null&&n>0){let t=this.TransferBanches.TransferBranchesDetails[e].Items.find(i=>i.Id==n);if(t!=null)this.TransferBanches.TransferBranchesDetails[e].ProductId=t.Id,this.TransferBanches.TransferBranchesDetails[e].ProductName=t.Name,this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=null,this.TransferBanches.TransferBranchesDetails[e].ProductUnits=[],this.AfterSelectem(t.Id,e);else{this._Apiservice.DontPlay();return}}else this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=null,this.TransferBanches.TransferBranchesDetails[e].ProductUnits=[]}AfterSelectem(n,e){if(n>0){let t={TableName:"ItemUnits",Columns:["Id","Name"],CurrentPage:1,PageSize:1,SearchText:"",SearchField:"Name"};t.Conditions=`ItemId = ${n}`,t.Join=!0,t.JoinTables=["Units U"],t.JoinConditions=["T.UnitId = U.Id"],t.Columns=["T.Id","U.Name","T.UnitFactor"],t.SearchField="U.Name",this._Apiservice.post("Global/GetAll",t,!1).pipe(y(this._Apiservice.destroy$)).subscribe({next:i=>{if(i.IsSuccess==!0&&i.Obj!=null){i.Obj.DataReturn=i.Obj.DataReturn.map(S=>V(A({},S),{NameAndUnitFactor:S.UnitFactor!=null?`${S.Name} - ${S.UnitFactor}`:`${S.Name}`}));let m=i.Obj.DataReturn[0];m!=null&&(this.TransferBanches.TransferBranchesDetails[e].ProductUnits=i.Obj.DataReturn,this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=m.Id,this.TransferBanches.TransferBranchesDetails[e].Quantity=1)}else this._AppModeService._Toastr.error(i.Message)}})}}SelectUnit(n,e){if(n!=null&&n>0){let t=this.TransferBanches.TransferBranchesDetails[e].ProductUnits.find(i=>i.Id==n);if(t!=null)this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=t.Id,this.TransferBanches.TransferBranchesDetails[e].ProductUnitName=t.Name;else{this._Apiservice.DontPlay();return}}}GetDocNo(){let n=this.TransferBanches.FromBranchId==null?0:this.TransferBanches.FromBranchId,e=this.TransferBanches.ToBranchId==null?0:this.TransferBanches.ToBranchId;this._Apiservice.get(`TransferBranchesEP/GetPageInfo?FromBranchId=${n}&ToBranchId=${e}`).pipe(y(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this.TransferBanches.DocNoFrom=t.Obj.FromDocNo,this.TransferBanches.DocNoTo=t.Obj.ToDocNo):this._AppModeService._Toastr.error(t.Message)}})}AppendRow(){let n={ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0};return this.TransferBanches.TransferBranchesDetails.push(n),this._AppModeService.AppendTd(),!0}RemoveRow(n){return this.TransferBanches.TransferBranchesDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.TransferBanches.TransferBranchesDetails.splice(n,1),this.TotalTransfer(),!0)}GetItemBalance(n,e){let t=this.TransferBanches.TransferBranchesDetails[n];if(this.TransferBanches.ToStoreId==0||this.TransferBanches.ToStoreId==null||this.TransferBanches.FromStoreId==0||this.TransferBanches.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.EnterStore"));return}if(t.ProductId==0||t.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.SelectItem"));return}let i={ProductId:t.ProductId,FromStoreId:this.TransferBanches.FromStoreId,ToStoreId:this.TransferBanches.ToStoreId,BranchId:this.TransferBanches.FromBranchId,SecoundBranchId:this.TransferBanches.ToBranchId};this._Apiservice.post("ItemEP/ProductBalance",i,!0).pipe(y(this._Apiservice.destroy$)).subscribe({next:m=>{m.IsSuccess==!0&&m.Obj!=null?(this.ItemBalanceFrom=m.Obj.BalanceFrom,this.ItemBalanceTo=m.Obj.BalanceTo,this._AppModeService._NgbModal.open(e,{size:"xl",centered:!0})):this._AppModeService._Toastr.error(m.Message)}})}TotalRow(n){let e=Number(this.TransferBanches.TransferBranchesDetails[n].Price),t=Number(this.TransferBanches.TransferBranchesDetails[n].Quantity);return this.TransferBanches.TransferBranchesDetails[n].TotalPrice=Number(e*t),this.TotalTransfer(),Number(e*t)}TotalTransfer(){let n=0;for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++)n+=Number(this.TransferBanches.TransferBranchesDetails[e].Price)*Number(this.TransferBanches.TransferBranchesDetails[e].Quantity);return this.TransferBanches.TotalPrice=Number(n),Number(n)}Save(){if(this.TransferBanches.DocDate==""||this.TransferBanches.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate"));return}if(this.TransferBanches.FromBranchId==0||this.TransferBanches.FromBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.EnterFromBranchId"));return}if(this.TransferBanches.FromStoreId==0||this.TransferBanches.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.FromStoreId"));return}if(this.TransferBanches.ToBranchId==0||this.TransferBanches.ToBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.EnterToBranchId"));return}if(this.TransferBanches.ToStoreId==0||this.TransferBanches.ToStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.ToStoreId"));return}if(this.TransferBanches.FromBranchId==0||this.TransferBanches.ToBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.ToFrom"));return}if(this.TransferBanches.DocNoFrom<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.DocNoFrom"));return}if(this.TransferBanches.DocNoTo<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.DocNoTo"));return}if(this.TransferBanches.FromBranchId==this.TransferBanches.ToBranchId){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.SameBranch"));return}for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++){let t=e,i=Number(this.TransferBanches.TransferBranchesDetails[e].ProductId),m=Number(this.TransferBanches.TransferBranchesDetails[e].Quantity);this.TransferBanches.TransferBranchesDetails[e].Price=0;let S=Number(this.TransferBanches.TransferBranchesDetails[e].ProductUnitId);if(i==null||i==null||i<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}if(S==null||S==null||S<=0||isNaN(S)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterUnit"));return}if(this.TransferBanches.TransferBranchesDetails.filter(j=>j.ProductId==i&&j.ProductUnitId==S).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(t+1));return}if(m==null||m==null||isNaN(m)||m<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterQuantity"));return}}let n={DocNo:this.TransferBanches.DocNo,DocDate:this._Apiservice.ConvertISODate(this.TransferBanches.DocDate),DocNoFrom:this.TransferBanches.DocNoFrom,DocNoTo:this.TransferBanches.DocNoTo,TransferBranchesDetails:this.TransferBanches.TransferBranchesDetails,FromStoreId:this.TransferBanches.FromStoreId,FromStoreName:this.TransferBanches.FromStoreName,FromBranchId:this.TransferBanches.FromBranchId,FromBranchName:this.TransferBanches.FromBranchName,ToBranchId:this.TransferBanches.ToBranchId,ToBranchName:this.TransferBanches.ToBranchName,ToStoreId:this.TransferBanches.ToStoreId,ToStoreName:this.TransferBanches.ToStoreName,TotalQty:this.TransferBanches.TotalQty,TotalPrice:this.TransferBanches.TotalPrice,Id:0,Name:"",Code:""};this._Apiservice.post("TransferBranchesEP/Add",n,!0).pipe(y(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this._SharedObjectModelService.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}})}ResetPage(){this.TransferBanches={DocNo:0,DocDate:"",DocNoTo:0,DocNoFrom:0,TransferBranchesDetails:[{ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0}],FromStoreId:null,FromStoreName:"",FromBranchId:null,FromBranchName:"",ToBranchId:null,ToBranchName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,TotalPrice:0,Id:0,Name:"",Code:""},this._DefaultSettingsService.ResetDate(this.TransferBanches)}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};d.\u0275fac=function(e){return new(e||d)(M(H),M(re),M(_e),M(Te),M(q))},d.\u0275cmp=G({type:d,selectors:[["app-transfer-banches"]],viewQuery:function(e,t){if(e&1&&(R(fe,5),R(ue,5)),e&2){let i;U(i=O())&&(t.ContentModel=i.first),U(i=O())&&(t.GLComponent=i.first)}},standalone:!0,features:[Q],decls:7,vars:7,consts:[["content",""],["ItemBalance",""],["GLComponent",""],["SelectFromBranch",""],["SelectFromStore",""],["SelectToBranch",""],["SelectToStore",""],["SelectItem22",""],["SelectUnits",""],[3,"ShowToEditeEvent","OpenModalEvent","PageTitle","TablePaging","GlResponse","GetById","DeleteUrl","PrintUrl","OutModal"],[1,"col-8"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-end","col-12","p-2"],[1,"col-12","col-sm-6","col-md-6","col-lg-4","col-xl-3","p-1"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"my-1"],["type","text","name","DocDate","id","DocDate",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block col-12 text-center",4,"ngIf"],["class","formdate",4,"ngIf"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["for","FromStoreId",1,"my-1"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","disabled","searchable","ngModel"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","disabled","ngModel"],["id","ProductTable",1,"DivPaging","table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-1","mb-0"],[1,"col-1"],[1,"col-2"],[4,"ngFor","ngForOf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],["class","btn btn-Add",3,"click",4,"ngIf"],["class","btn btn-Refresh",3,"click",4,"ngIf"],["type","button",1,"btn","btn-light","btn-Close","border","border-1","border-dark",3,"click"],[1,"d-block","col-12","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"form-text","text-muted"],[1,"p-0",3,"title"],[1,"d-flex","justify-content-center","align-items-center","col-11","col-md-12"],[1,"d-none","d-lg-inline"],[1,"btn-Add","btn",3,"click"],[1,"mx-1","fw-bold","pi","pi-plus"],[1,"btn-Delete","btn-Page","btn",3,"click","disabled"],[1,"mx-1","pi","pi-trash","fw-bold"],[1,"ngSelect","d-flex","mx-auto","flex-wrap","justify-content-center",3,"title"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-10","col-lg-9","col-xl-10",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["class","btn btn-Refresh d-block d-md-inline-block",3,"disabled","click",4,"ngIf"],[1,"ngSelect",3,"title"],["bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","disabled","ngModel"],[3,"title"],["name","Quantity","type","number","appNumericInput","",1,"form-control","text-center",3,"change","keyup","ngModelChange","disabled","ngModel"],[1,"btn","btn-Refresh","d-block","d-md-inline-block",3,"click","disabled"],[1,"pi","pi-eye","d-block","mx-auto"],[1,"btn","btn-Add",3,"click"],[1,"mx-1","pi","pi-save"],[1,"btn","btn-Refresh",3,"click"],[1,"modal-body"],[1,"my-2","text-center"],[1,"table","table-striped","table-hover"]],template:function(e,t){if(e&1){let i=D();l(0,"app-dynamic-component",9),B("ShowToEditeEvent",function(){return s(i),c(t.ShowToEdite())})("OpenModalEvent",function(){return s(i),c(t.OpenModal())}),p(),C(1,Ue,72,61,"ng-template",null,0,k)(3,je,29,20,"ng-template",10,1,k),N(5,"app-glsheard",null,2)}if(e&2){let i=g(2);f("PageTitle","TransferBanches.TransferBanches")("TablePaging",t.TablePaging)("GlResponse",!0)("GetById","TransferBranchesEP/GetById")("DeleteUrl","TransferBranchesEP/Delete")("PrintUrl","TransferBranches")("OutModal",i)}},dependencies:[le,ce,J,z,se,oe,ie,ae,L,$,ne,X,te,Z,ee,K,Y,me,he,pe,de]});let a=d;return a})();export{lt as TransferBanchesComponent};
