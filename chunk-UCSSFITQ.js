import{a as Te,b as ue,c as fe}from"./chunk-BZPR73YG.js";import{a as ge}from"./chunk-D7RC4W4V.js";import{a as Se}from"./chunk-R22ILC4E.js";import{b as me,j as he}from"./chunk-JSAFLJSP.js";import"./chunk-EDAXKXER.js";import{a as de}from"./chunk-VSYXDL23.js";import"./chunk-ZFVZF6NJ.js";import"./chunk-CCUNZCGD.js";import{a as pe}from"./chunk-6KCN6SOZ.js";import{a as le,b as _e}from"./chunk-OFCF557E.js";import"./chunk-PHRVA4P6.js";import"./chunk-5KZZH3PQ.js";import"./chunk-ENJ54XRO.js";import{a as ae,b as oe,c as se,d as ce}from"./chunk-ZWNSIIKM.js";import"./chunk-KZSRC3MR.js";import"./chunk-TQD4QWDO.js";import{c as K,d as X,g as ie}from"./chunk-JS2GAZTB.js";import{F as q,H as j,I as Y,_ as Z,aa as ee,c as $,d as H,da as te,fa as ne,i as J,na as re,z}from"./chunk-WSHLQXZC.js";import{$b as v,Cb as l,Db as p,Eb as y,Ib as N,Mb as B,Nb as o,Qb as F,Rb as E,Tb as U,Ub as R,Vb as O,Wb as g,X as D,Xb as h,Yb as I,Zb as x,_b as P,ac as b,bc as w,db as _,dc as L,eb as M,na as W,nc as T,oc as f,pc as Q,qc as k,vb as C,xa as s,xb as u,ya as c}from"./chunk-J5UB44FZ.js";import{a as A,b as V}from"./chunk-3EYC4JTX.js";var Be=["content"],xe=["GLComponent"];function Ie(a,m){if(a&1&&(l(0,"span",37),h(1),T(2,"date"),p()),a&2){let r=o(2);_(),x(" ",Q(2,1,r.TransferBanches.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Ce(a,m){if(a&1){let r=N();l(0,"div",38)(1,"p-calendar",39),w("ngModelChange",function(e){s(r);let n=o(2);return b(n.TransferBanches.DocDate,e)||(n.TransferBanches.DocDate=e),c(e)}),p()()}if(a&2){let r=o(2);_(),v("ngModel",r.TransferBanches.DocDate),u("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function ve(a,m){if(a&1&&(l(0,"small",40),h(1),p()),a&2){let r=o(2);_(),P("Loaded ",r.Branches.length," of ",r._SharedObjectModelService.TotalItems,"")}}function be(a,m){if(a&1&&h(0),a&2){let r=m.item;x(" ",r.Name," ")}}function we(a,m){if(a&1&&(l(0,"small",40),h(1),p()),a&2){let r=o(2);_(),P("Loaded ",r.FromStorages.length," of ",r._SharedObjectModelService.TotalItems,"")}}function ye(a,m){if(a&1&&h(0),a&2){let r=m.item;x(" ",r.Name,`
`)}}function Ne(a,m){if(a&1&&(l(0,"small",40),h(1),p()),a&2){let r=o(2);_(),P("Loaded ",r.Branches.length," of ",r._SharedObjectModelService.TotalItems,"")}}function De(a,m){if(a&1&&h(0),a&2){let r=m.item;x(" ",r.Name,`
`)}}function Pe(a,m){if(a&1&&(l(0,"small",40),h(1),p()),a&2){let r=o(2);_(),P("Loaded ",r.ToStorages.length," of ",r._SharedObjectModelService.TotalItems,"")}}function Me(a,m){if(a&1&&h(0),a&2){let r=m.item;x(" ",r.Name,`
`)}}function Fe(a,m){if(a&1&&(l(0,"small",40),h(1),p()),a&2){let r=o().$implicit,t=o(2);_(),P("Loaded ",r.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ae(a,m){if(a&1&&h(0),a&2){let r=m.item;P(" ",r.Name," - ",r.Code," ")}}function Ve(a,m){if(a&1){let r=N();l(0,"button",55),B("click",function(){s(r);let e=o().index,n=o(2),i=g(4);return c(n.GetItemBalance(e,i))}),y(1,"i",56),p()}if(a&2){let r=o(3);u("disabled",r._AppModeService.DisabledButton)}}function Ee(a,m){if(a&1&&(l(0,"small",40),h(1),p()),a&2){let r=o().$implicit,t=o(2);_(),P("Loaded ",r.ProductUnits.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ue(a,m){if(a&1&&h(0),a&2){let r=m.item;x(" ",r.Name," ")}}function Re(a,m){if(a&1){let r=N();l(0,"tr")(1,"td",41)(2,"div",42)(3,"button",43),B("click",function(){s(r);let e=o(2);return c(e.AppendRow())}),y(4,"i",44),p(),l(5,"span",45),h(6),p(),l(7,"button",46),B("click",function(){let e=s(r).index,n=o(2);return c(n.RemoveRow(e))}),y(8,"i",47),p()()(),l(9,"td",48),T(10,"translate"),l(11,"ng-select",49,7),T(13,"translate"),B("clear",function(){let e=s(r).$implicit;return c(e.Items=[])})("focus",function(){let e=s(r).index,n=g(12),i=o(2);return i.ChangeSearchApiDetails("Items",n,e),c(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(r).index,n=g(12),i=o(2);return i.ChangeSearchApiDetails("Items",n,e),c(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(r).index,n=g(12),i=o(2);return c(i.ChangeSearchApiDetails("Items",n,e))})("close",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(r),n=e.$implicit,i=e.index,d=o(2);return c(d.SelectItem(n.ProductId,i))}),w("ngModelChange",function(e){let n=s(r).$implicit;return b(n.ProductId,e)||(n.ProductId=e),c(e)}),C(14,Fe,2,2,"ng-template",22)(15,Ae,1,2,"ng-template",23),p(),C(16,Ve,2,1,"button",50),p(),l(17,"td",51),T(18,"translate"),l(19,"ng-select",52,8),T(21,"translate"),B("clear",function(){let e=s(r).$implicit;return c(e.ProductUnits=[])})("focus",function(){let e=s(r).index,n=g(20),i=o(2);return i.ChangeSearchApiDetails("ItemUnits",n,e),c(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(r).index,n=g(20),i=o(2);return i.ChangeSearchApiDetails("ItemUnits",n,e),c(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(r).index,n=g(20),i=o(2);return c(i.ChangeSearchApiDetails("ItemUnits",n,e))})("close",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(r),n=e.$implicit,i=e.index,d=o(2);return c(d.SelectUnit(n.ProductUnitId,i))}),w("ngModelChange",function(e){let n=s(r).$implicit;return b(n.ProductUnitId,e)||(n.ProductUnitId=e),c(e)}),C(22,Ee,2,2,"ng-template",22)(23,Ue,1,1,"ng-template",23),p()(),l(24,"td",53),T(25,"translate"),l(26,"input",54),B("change",function(){let e=s(r).index,n=o(2);return c(n.TotalRow(e))})("keyup",function(){let e=s(r).index,n=o(2);return c(n.TotalRow(e))}),w("ngModelChange",function(e){let n=s(r).$implicit;return b(n.Quantity,e)||(n.Quantity=e),c(e)}),p()()()}if(a&2){let r=m.$implicit,t=m.index,e=o(2);_(),F("title",t+1),_(5),I(t+1),_(),u("disabled",e.TransferBanches.TransferBranchesDetails.length==1),_(2),F("title",f(10,22,"TransferStorage.Name")),_(2),E("placeholder","  ",f(13,24,"SaleInvoice.ChooseProduct"),""),u("items",r.Items)("dropdownPosition","top")("searchable",!0)("virtualScroll",!0),v("ngModel",r.ProductId),_(5),u("ngIf",r.ProductId>0&&e.TransferBanches.FromStoreId>0&&e.TransferBanches.ToStoreId>0),_(),F("title",f(18,26,"SaleInvoice.Units")),_(2),E("placeholder","  ",f(21,28,"Item.ItemUnit"),""),u("items",r.ProductUnits)("dropdownPosition","top")("disabled",r.ProductId==0||r.ProductId==null),v("ngModel",r.ProductUnitId),_(5),F("title",f(25,30,"SaleInvoice.Quantity")),_(2),u("disabled",r.ProductId<=0||r.UnitId<=0),v("ngModel",r.Quantity)}}function Oe(a,m){if(a&1){let r=N();l(0,"button",57),B("click",function(){s(r);let e=o(2);return c(e.Save())}),l(1,"span"),h(2),T(3,"translate"),p(),y(4,"i",58),p()}a&2&&(_(2),x(" ",f(3,1,"Model.Save"),""))}function ke(a,m){if(a&1){let r=N();l(0,"button",59),B("click",function(){s(r);let e=o(2);return c(e.ResetPage())}),l(1,"span"),h(2),T(3,"translate"),p()()}a&2&&(_(2),x(" ",f(3,1,"Model.New"),""))}function je(a,m){if(a&1){let r=N();l(0,"button",60),B("click",function(){s(r);let e=o(2);return c(e.OpenGl())}),h(1),T(2,"translate"),p()}a&2&&(_(),x(" ",f(2,1,"Model.Gl")," "))}function Ge(a,m){if(a&1){let r=N();y(0,"app-modal-header",11),l(1,"div",12)(2,"div",13)(3,"div",14),y(4,"input",15),p(),l(5,"div",14),y(6,"input",15),p(),l(7,"div",14)(8,"p",16),h(9),T(10,"translate"),p(),l(11,"input",17),w("ngModelChange",function(e){s(r);let n=o();return b(n.TransferBanches.Notes,e)||(n.TransferBanches.Notes=e),c(e)}),p()(),l(12,"div",14),C(13,Ie,3,4,"span",18)(14,Ce,2,5,"div",19),p()(),l(15,"div",13)(16,"div",20)(17,"p",16),h(18),T(19,"translate"),p(),l(20,"ng-select",21,3),B("clear",function(){s(r);let e=o();return c(e.Branches=[])})("focus",function(){s(r);let e=g(21),n=o();return n.ChangeSearchApi("Branch",e),c(n._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=g(21),n=o();return n.ChangeSearchApi("Branch",e),c(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=g(21),n=o();return c(n.ChangeSearchApi("Branch",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.FromBranchId,"FromBranch"))}),w("ngModelChange",function(e){s(r);let n=o();return b(n.TransferBanches.FromBranchId,e)||(n.TransferBanches.FromBranchId=e),c(e)}),C(22,ve,2,2,"ng-template",22)(23,be,1,1,"ng-template",23),p()(),l(24,"div",20)(25,"p",24),h(26),T(27,"translate"),p(),l(28,"ng-select",25,4),B("clear",function(){s(r);let e=o();return c(e.FromStorages=[])})("focus",function(){s(r);let e=g(29),n=o();return n.ChangeSearchApi("FromStore",e),c(n._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=g(29),n=o();return n.ChangeSearchApi("FromStore",e),c(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=g(29),n=o();return c(n.ChangeSearchApi("FromStore",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.FromStoreId,"FromStore"))}),w("ngModelChange",function(e){s(r);let n=o();return b(n.TransferBanches.FromStoreId,e)||(n.TransferBanches.FromStoreId=e),c(e)}),C(30,we,2,2,"ng-template",22)(31,ye,1,1,"ng-template",23),p()(),l(32,"div",20)(33,"p",16),h(34),T(35,"translate"),p(),l(36,"ng-select",21,5),B("clear",function(){s(r);let e=o();return c(e.Branches=[])})("focus",function(){s(r);let e=g(37),n=o();return n.ChangeSearchApi("Branch",e),c(n._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=g(37),n=o();return n.ChangeSearchApi("Branch",e),c(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=g(37),n=o();return c(n.ChangeSearchApi("Branch",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.ToBranchId,"ToBranch"))}),w("ngModelChange",function(e){s(r);let n=o();return b(n.TransferBanches.ToBranchId,e)||(n.TransferBanches.ToBranchId=e),c(e)}),C(38,Ne,2,2,"ng-template",22)(39,De,1,1,"ng-template",23),p()(),l(40,"div",20)(41,"p",16),h(42),T(43,"translate"),p(),l(44,"ng-select",26,6),B("clear",function(){s(r);let e=o();return c(e.ToStorages=[])})("focus",function(){s(r);let e=g(45),n=o();return n.ChangeSearchApi("ToStore",e),c(n._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=g(45),n=o();return n.ChangeSearchApi("ToStore",e),c(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=g(45),n=o();return c(n.ChangeSearchApi("ToStore",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.ToStoreId,"ToStore"))}),w("ngModelChange",function(e){s(r);let n=o();return b(n.TransferBanches.ToStoreId,e)||(n.TransferBanches.ToStoreId=e),c(e)}),C(46,Pe,2,2,"ng-template",22)(47,Me,1,1,"ng-template",23),p()()(),l(48,"div",27)(49,"table",28)(50,"thead")(51,"tr")(52,"th",29),h(53,"#"),p(),l(54,"th",30),h(55),T(56,"translate"),p(),l(57,"th",30),h(58),T(59,"translate"),p(),l(60,"th",30),h(61),T(62,"translate"),p()()(),l(63,"tbody"),C(64,Re,27,32,"tr",31),p()()()(),l(65,"div",32),C(66,Oe,5,3,"button",33)(67,ke,4,3,"button",34)(68,je,3,3,"button",35),l(69,"button",36),B("click",function(){let e=s(r).$implicit,n=o();return e.close("Close click"),c(n.ResetPage())}),h(70),T(71,"translate"),p()()}if(a&2){let r=o();u("PageTitle","TransferBanches.TransferBanches"),_(4),u("disabled",!0)("value",r.TransferBanches.DocNoFrom),_(2),u("disabled",!0)("value",r.TransferBanches.DocNoTo),_(3),I(f(10,43,"Table.Notes")),_(2),v("ngModel",r.TransferBanches.Notes),_(2),u("ngIf",(r._DefaultSettingsService.DefaultSettings==null?null:r._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),_(),u("ngIf",(r._DefaultSettingsService.DefaultSettings==null?null:r._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),_(4),I(f(19,45,"TransferBanches.BranchFrom")),_(2),u("items",r.Branches)("autofocus",!1)("virtualScroll",!0)("searchable",!0),v("ngModel",r.TransferBanches.FromBranchId),_(6),I(f(27,47,"TransferStorage.FromStoreId")),_(2),u("items",r.FromStorages)("autofocus",!1)("virtualScroll",!0)("disabled",r.TransferBanches.FromBranchId==null)("searchable",!0),v("ngModel",r.TransferBanches.FromStoreId),_(6),I(f(35,49,"TransferBanches.BranchTo")),_(2),u("items",r.Branches)("autofocus",!1)("virtualScroll",!0)("searchable",!0),v("ngModel",r.TransferBanches.ToBranchId),_(6),I(f(43,51,"TransferStorage.ToStoreId")),_(2),u("items",r.ToStorages)("autofocus",!1)("virtualScroll",!0)("searchable",!0)("disabled",r.TransferBanches.ToBranchId==null),v("ngModel",r.TransferBanches.ToStoreId),_(11),I(f(56,53,"TransferStorage.Name")),_(3),I(f(59,55,"SaleInvoice.Units")),_(3),I(f(62,57,"TransferStorage.Quantity")),_(3),u("ngForOf",r.TransferBanches.TransferBranchesDetails),_(2),u("ngIf",r.TransferBanches.Id==0),_(),u("ngIf",r.TransferBanches.Id>0),_(),u("ngIf",r.TransferBanches.Id>0),_(2),I(f(71,59,"Model.Close"))}}function We(a,m){if(a&1&&(l(0,"tr")(1,"td"),h(2),p(),l(3,"td"),h(4),p()()),a&2){let r=m.$implicit;_(2),x(" ",r.Name," "),_(2),x(" ",r.Qty," ")}}function Le(a,m){if(a&1&&(l(0,"tr")(1,"td"),h(2),p(),l(3,"td"),h(4),p()()),a&2){let r=m.$implicit;_(2),x(" ",r.Name," "),_(2),x(" ",r.Qty," ")}}function Qe(a,m){if(a&1&&(l(0,"div",61)(1,"p",62),h(2),T(3,"translate"),p(),l(4,"table",63)(5,"thead")(6,"tr")(7,"th"),h(8),T(9,"translate"),p(),l(10,"th"),h(11),T(12,"translate"),p()()(),l(13,"tbody"),C(14,We,5,2,"tr",31),p()(),l(15,"p",62),h(16),T(17,"translate"),p(),l(18,"table",63)(19,"thead")(20,"tr")(21,"th"),h(22),T(23,"translate"),p(),l(24,"th"),h(25),T(26,"translate"),p()()(),l(27,"tbody"),C(28,Le,5,2,"tr",31),p()()()),a&2){let r=o();_(2),x(" ",f(3,8,"TransferStorage.BalanceFrom")," "),_(6),I(f(9,10,"SaleInvoice.Name")),_(3),I(f(12,12,"Table.Balance")),_(3),u("ngForOf",r.ItemBalanceFrom),_(2),x(" ",f(17,14,"TransferStorage.BalanceTo")," "),_(6),I(f(23,16,"SaleInvoice.Name")),_(3),I(f(26,18,"Table.Balance")),_(3),u("ngForOf",r.ItemBalanceTo)}}var Tt=(()=>{let m=class m{constructor(t,e,n,i,d){this._ActivatedRoute=t,this._AppModeService=e,this._SharedObjectModelService=n,this._DefaultSettingsService=i,this._Apiservice=d,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"TransferBranches",Join:!0,JoinTables:["Storages SF","Storages ST"],JoinConditions:["T.FromStoreId = SF.Id","T.ToStoreId = ST.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","T.FromBranchName","SF.Name AS FromStoreName","T.ToBranchName","ST.Name AS ToStoreName"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"FromBranchName",CellName:"TransferBanches.BranchFrom"},{SortName:"FromStoreName",CellName:"TransferStorage.FromStoreId",ExistSearchField:"SF.Name"},{SortName:"ToBranchName",CellName:"TransferBanches.BranchTo"},{SortName:"ToStoreName",CellName:"TransferStorage.ToStoreId",ExistSearchField:"ST.Name"},{SortName:"Notes",CellName:"Table.Notes",ExistSearchField:"T.Notes"}]},this.Branches=[],this.ToStorages=[],this.FromStorages=[],this.TransferBanches={DocNo:0,DocDate:"",DocNoTo:0,DocNoFrom:0,TransferBranchesDetails:[{ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0}],FromStoreId:null,FromStoreName:"",FromBranchId:null,FromBranchName:"",ToBranchId:null,ToBranchName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,TotalPrice:0,Id:0,Name:"",Code:""},this.ItemBalanceFrom=[],this.ItemBalanceTo=[]}ngOnInit(){let t=Number(this._ActivatedRoute.snapshot.queryParams.Id);t>0&&this.GetByIdRoute(t),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(t){this._Apiservice.getById("TransferBranchesEP/GetById",t,!0).pipe(D(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._SharedObjectModelService.PageModel=e.Obj.model,this._SharedObjectModelService.Gl=e.Obj.Gl,this.Drow(this._SharedObjectModelService.PageModel),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(e.Message)}})}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){this.TransferBanches={Id:t.Id,DocNo:t.DocNo,DocDate:new Date(`${t.DocDate}`),DocNoTo:t.DocNoTo,DocNoFrom:t.DocNoFrom,FromStoreId:t.FromStoreId,FromBranchId:t.FromBranchId,ToBranchId:t.ToBranchId,ToStoreId:t.ToStoreId,TotalQty:t.TotalQty,TotalPrice:t.TotalPrice,TransferBranchesDetails:t.TransferBranchesDetails},this.Branches=[],this.Branches.push({Id:t.FromBranchId,Name:t.FromBranchName}),this.Branches.push({Id:t.ToBranchId,Name:t.ToBranchName}),this.FromStorages.push({Id:t.FromStoreId,Name:t.FromStoreName}),this.ToStorages.push({Id:t.ToStoreId,Name:t.ToStoreName});for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++){let n=this.TransferBanches.TransferBranchesDetails[e];n.Items=[{Id:n.ProductId,Name:n.ProductName,NameAndCode:n.ProductName}],n.ProductUnits=[{Id:n.ProductUnitId,Name:n.ProductUnitName,NameAndUnitFactor:n.ProductUnitName}]}}OpenModal(){this.ResetPage()}OpenGl(){this.GLComponent.Open()}ChangeSearchApi(t,e){let n=`${e.searchTerm}`.trim();(n==""||n=="null")&&(e.searchTerm="",n=""),this._AppModeService.CurrentPage+=1;let i={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:n,SearchField:"Name"};t=="FromStore"&&(i.TableName="Storages",i.Conditions=`BranchId = ${this.TransferBanches.FromBranchId}`),t=="ToStore"&&(i.TableName="Storages",i.Conditions=`BranchId = ${this.TransferBanches.ToBranchId}`),this._Apiservice.post("Global/GetAll",i,!1).pipe(D(this._Apiservice.destroy$)).subscribe({next:d=>{d.IsSuccess==!0&&d.Obj!=null?this.HandleResponse(d.Obj,t):this._AppModeService._Toastr.error(d.Message)}})}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="FromStore"&&(this.FromStorages=this._SharedObjectModelService.RemoveDuplicates(this.FromStorages.concat(t.DataReturn),"Id")),e=="ToStore"&&(this.ToStorages=this._SharedObjectModelService.RemoveDuplicates(this.ToStorages.concat(t.DataReturn),"Id")),e=="Branch"&&(this.Branches=this._SharedObjectModelService.RemoveDuplicates(this.Branches.concat(t.DataReturn),"Id"))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let n=[];e=="FromStore"&&(n=this.FromStorages),e=="ToStore"&&(n=this.ToStorages),(e=="FromBranch"||e=="ToBranch")&&(n=this.Branches);let i=n.find(d=>d.Id==t);if(i==null){this._AppModeService.DontPlay();return}else this.TransferBanches[`${e}Id`]=t,this.TransferBanches[`${e}Name`]=i.Name,(e=="FromBranch"||e=="ToBranch")&&(this.GetDocNo(),e=="ToBranch"&&(this.TransferBanches.ToStoreId=null,this.ToStorages=[]),e=="FromBranch"&&(this.TransferBanches.FromStoreId=null,this.FromStorages=[],this.ResetWa()))}else this.TransferBanches[`${e}Id`]=null,this.TransferBanches[`${e}Name`]="",e=="ToBranch"&&(this.TransferBanches.DocNoTo=0,this.ToStorages=[],this.TransferBanches.ToStoreId=null),e=="FromBranch"&&(this.TransferBanches.DocNoFrom=0,this.FromStorages=[],this.TransferBanches.FromStoreId=null)}ResetWa(){}ChangeSearchApiDetails(t,e,n){let i=`${e.searchTerm}`.trim();(i==""||i=="null")&&(e.searchTerm="",i=""),this._AppModeService.CurrentPage+=1;let d={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:i,SearchField:"Name"};if(t=="Items"&&(d.Columns=["Id","Name","Code"],d.Conditions="ProductType != 2"),t=="ItemUnits"){let S=this.TransferBanches.TransferBranchesDetails[n].ProductId==null?0:this.TransferBanches.TransferBranchesDetails[n].ProductId;d.Conditions=`ItemId = ${S}`,d.Join=!0,d.JoinTables=["Units U"],d.NoPaging=!0,d.JoinConditions=["T.UnitId = U.Id"],d.Columns=["T.Id","U.Name","T.UnitFactor"],d.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",d,!1).pipe(D(this._Apiservice.destroy$)).subscribe({next:S=>{S.IsSuccess==!0&&S.Obj!=null?this.HandleResponseDetails(S.Obj,t,n):this._AppModeService._Toastr.error(S.Message)}})}HandleResponseDetails(t,e,n){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Items"&&(this.TransferBanches.TransferBranchesDetails[n].Items=this._SharedObjectModelService.RemoveDuplicates(this.TransferBanches.TransferBranchesDetails[n].Items.concat(t.DataReturn),"Id"),this.TransferBanches.TransferBranchesDetails[n].Items=this.TransferBanches.TransferBranchesDetails[n].Items.map(i=>V(A({},i),{NameAndCode:i.Code!=null?`${i.Name} - ${i.Code}`:`${i.Name}`}))),e=="ItemUnits"&&(this.TransferBanches.TransferBranchesDetails[n].ProductUnits=t.DataReturn.map(i=>V(A({},i),{NameAndUnitFactor:i.UnitFactor!=null?`${i.Name} - ${i.UnitFactor}`:`${i.Name}`})))}SelectItem(t,e){if(t!=null&&t>0){let n=this.TransferBanches.TransferBranchesDetails[e].Items.find(i=>i.Id==t);if(n!=null)this.TransferBanches.TransferBranchesDetails[e].ProductId=n.Id,this.TransferBanches.TransferBranchesDetails[e].ProductName=n.Name,this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=null,this.TransferBanches.TransferBranchesDetails[e].ProductUnits=[],this.AfterSelectem(n.Id,e);else{this._Apiservice.DontPlay();return}}else this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=null,this.TransferBanches.TransferBranchesDetails[e].ProductUnits=[]}AfterSelectem(t,e){if(t>0){let n={TableName:"ItemUnits",Columns:["Id","Name"],CurrentPage:1,PageSize:1,SearchText:"",SearchField:"Name"};n.Conditions=`ItemId = ${t}`,n.Join=!0,n.JoinTables=["Units U"],n.JoinConditions=["T.UnitId = U.Id"],n.Columns=["T.Id","U.Name","T.UnitFactor"],n.SearchField="U.Name",this._Apiservice.post("Global/GetAll",n,!1).pipe(D(this._Apiservice.destroy$)).subscribe({next:i=>{if(i.IsSuccess==!0&&i.Obj!=null){i.Obj.DataReturn=i.Obj.DataReturn.map(S=>V(A({},S),{NameAndUnitFactor:S.UnitFactor!=null?`${S.Name} - ${S.UnitFactor}`:`${S.Name}`}));let d=i.Obj.DataReturn[0];d!=null&&(this.TransferBanches.TransferBranchesDetails[e].ProductUnits=i.Obj.DataReturn,this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=d.Id,this.TransferBanches.TransferBranchesDetails[e].Quantity=1)}else this._AppModeService._Toastr.error(i.Message)}})}}SelectUnit(t,e){if(t!=null&&t>0){let n=this.TransferBanches.TransferBranchesDetails[e].ProductUnits.find(i=>i.Id==t);if(n!=null)this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=n.Id,this.TransferBanches.TransferBranchesDetails[e].ProductUnitName=n.Name,this.UnitWa(n.Id,e);else{this._Apiservice.DontPlay();return}}}UnitWa(t,e){}StartConnection(){this.Hub_Connection=new fe().withUrl(`${j.signalrUrl}/TransferBranches?ClientEnum=${j.ClientEnum}`,{skipNegotiation:!0,transport:ue.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(Te.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(t=>{console.log(t)})}GetDocNo(){let t=this.TransferBanches.FromBranchId==null?0:this.TransferBanches.FromBranchId,e=this.TransferBanches.ToBranchId==null?0:this.TransferBanches.ToBranchId;this._Apiservice.get(`TransferBranchesEP/GetPageInfo?FromBranchId=${t}&ToBranchId=${e}`).pipe(D(this._Apiservice.destroy$)).subscribe({next:n=>{n.IsSuccess==!0&&n.Obj!=null?(this.TransferBanches.DocNoFrom=n.Obj.FromDocNo,this.TransferBanches.DocNoTo=n.Obj.ToDocNo):this._AppModeService._Toastr.error(n.Message)}})}AppendRow(){let t={ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0};return this.TransferBanches.TransferBranchesDetails.push(t),this._AppModeService.AppendTd(),!0}RemoveRow(t){return this.TransferBanches.TransferBranchesDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.TransferBanches.TransferBranchesDetails.splice(t,1),this.TotalTransfer(),!0)}GetItemBalance(t,e){let n=this.TransferBanches.TransferBranchesDetails[t];if(this.TransferBanches.ToStoreId==0||this.TransferBanches.ToStoreId==null||this.TransferBanches.FromStoreId==0||this.TransferBanches.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.EnterStore"));return}if(n.ProductId==0||n.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.SelectItem"));return}let i={ProductId:n.ProductId,FromStoreId:this.TransferBanches.FromStoreId,ToStoreId:this.TransferBanches.ToStoreId,BranchId:this.TransferBanches.FromBranchId,SecoundBranchId:this.TransferBanches.ToBranchId};this._Apiservice.post("ItemEP/ProductBalance",i,!0).pipe(D(this._Apiservice.destroy$)).subscribe({next:d=>{d.IsSuccess==!0&&d.Obj!=null?(this.ItemBalanceFrom=d.Obj.BalanceFrom,this.ItemBalanceTo=d.Obj.BalanceTo,this._AppModeService._NgbModal.open(e,{size:"xl",centered:!0})):this._AppModeService._Toastr.error(d.Message)}})}TotalRow(t){let e=Number(this.TransferBanches.TransferBranchesDetails[t].Price),n=Number(this.TransferBanches.TransferBranchesDetails[t].Quantity);return this.TransferBanches.TransferBranchesDetails[t].TotalPrice=Number(e*n),this.TotalTransfer(),Number(e*n)}TotalTransfer(){let t=0;for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++)t+=Number(this.TransferBanches.TransferBranchesDetails[e].Price)*Number(this.TransferBanches.TransferBranchesDetails[e].Quantity);return this.TransferBanches.TotalPrice=Number(t),Number(t)}Save(){if(this.TransferBanches.DocDate==""||this.TransferBanches.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate"));return}if(this.TransferBanches.FromBranchId==0||this.TransferBanches.FromBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.EnterFromBranchId"));return}if(this.TransferBanches.FromStoreId==0||this.TransferBanches.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.FromStoreId"));return}if(this.TransferBanches.ToBranchId==0||this.TransferBanches.ToBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.EnterToBranchId"));return}if(this.TransferBanches.ToStoreId==0||this.TransferBanches.ToStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.ToStoreId"));return}if(this.TransferBanches.FromBranchId==0||this.TransferBanches.ToBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.ToFrom"));return}if(this.TransferBanches.DocNoFrom<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.DocNoFrom"));return}if(this.TransferBanches.DocNoTo<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.DocNoTo"));return}if(this.TransferBanches.FromBranchId==this.TransferBanches.ToBranchId){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.SameBranch"));return}for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++){let n=e,i=Number(this.TransferBanches.TransferBranchesDetails[e].ProductId),d=Number(this.TransferBanches.TransferBranchesDetails[e].Quantity);this.TransferBanches.TransferBranchesDetails[e].Price=0;let S=Number(this.TransferBanches.TransferBranchesDetails[e].ProductUnitId);if(i==null||i==null||i<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}if(S==null||S==null||S<=0||isNaN(S)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterUnit"));return}if(this.TransferBanches.TransferBranchesDetails.filter(G=>G.ProductId==i&&G.ProductUnitId==S).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(n+1));return}if(d==null||d==null||isNaN(d)||d<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterQuantity"));return}}let t={DocNo:this.TransferBanches.DocNo,DocDate:this._Apiservice.ConvertISODate(this.TransferBanches.DocDate),DocNoFrom:this.TransferBanches.DocNoFrom,DocNoTo:this.TransferBanches.DocNoTo,TransferBranchesDetails:this.TransferBanches.TransferBranchesDetails,FromStoreId:this.TransferBanches.FromStoreId,FromStoreName:this.TransferBanches.FromStoreName,FromBranchId:this.TransferBanches.FromBranchId,FromBranchName:this.TransferBanches.FromBranchName,ToBranchId:this.TransferBanches.ToBranchId,ToBranchName:this.TransferBanches.ToBranchName,ToStoreId:this.TransferBanches.ToStoreId,ToStoreName:this.TransferBanches.ToStoreName,TotalQty:this.TransferBanches.TotalQty,TotalPrice:this.TransferBanches.TotalPrice,Id:0,Name:"",Code:""};this._Apiservice.post("TransferBranchesEP/Add",t,!0).pipe(D(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this._SharedObjectModelService.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}})}ResetPage(){this.TransferBanches={DocNo:0,DocDate:"",DocNoTo:0,DocNoFrom:0,TransferBranchesDetails:[{ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0}],FromStoreId:null,FromStoreName:"",FromBranchId:null,FromBranchName:"",ToBranchId:null,ToBranchName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,TotalPrice:0,Id:0,Name:"",Code:""},this._DefaultSettingsService.ResetDate(this.TransferBanches)}ServerListener(){this.Hub_Connection?.on("AddTransferBranches",t=>{this.GetDocNo()})}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};m.\u0275fac=function(e){return new(e||m)(M(z),M(ie),M(pe),M(Se),M(Y))},m.\u0275cmp=W({type:m,selectors:[["app-transfer-banches"]],viewQuery:function(e,n){if(e&1&&(U(Be,5),U(xe,5)),e&2){let i;R(i=O())&&(n.ContentModel=i.first),R(i=O())&&(n.GLComponent=i.first)}},standalone:!0,features:[L],decls:7,vars:7,consts:[["content",""],["ItemBalance",""],["GLComponent",""],["SelectFromBranch",""],["SelectFromStore",""],["SelectToBranch",""],["SelectToStore",""],["SelectItem22",""],["SelectUnits",""],[3,"ShowToEditeEvent","OpenModalEvent","PageTitle","TablePaging","GlResponse","GetById","DeleteUrl","PrintUrl","OutModal"],[1,"col-8"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-end","col-12","pt-2"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","col-xl-2","p-1"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"my-1"],["type","text","name","DocDate","id","DocDate",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block col-12 text-center",4,"ngIf"],["class","formdate",4,"ngIf"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","p-1"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["for","FromStoreId",1,"my-1"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","disabled","searchable","ngModel"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","disabled","ngModel"],["id","ProductTable",1,"table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-4","mb-0"],[1,"col-1"],[1,"col-2"],[4,"ngFor","ngForOf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],["class","btn btn-success py-3 px-5",3,"click",4,"ngIf"],["class","btn btn-primary py-3 px-5",3,"click",4,"ngIf"],["class","btn btn-info mx-3 py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-light","border","border-1","border-dark","px-5","py-3",3,"click"],[1,"d-block","col-12","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"form-text","text-muted"],[1,"",3,"title"],[1,"d-flex","justify-content-center","align-items-center","col-11","col-md-12"],[1,"px-3","mx-1","text-center","mx-auto","btn","btn-success",3,"click"],[1,"mx-1","fs-5","fw-bold","pi","pi-plus"],[1,"d-none","d-lg-inline"],[1,"px-3","mx-1","text-center","mx-auto","btn","btn-danger",3,"click","disabled"],[1,"mx-1","pi","pi-trash","fw-bold","fs-5"],[1,"ngSelect","d-flex",3,"title"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-12","col-md-11",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["class","col-1 d-block text-center btn btn-info py-0 px-2 mx-2",3,"disabled","click",4,"ngIf"],[1,"ngSelect",3,"title"],["bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","disabled","ngModel"],[3,"title"],["name","Quantity","type","number","appNumericInput","",1,"form-control","text-center",3,"change","keyup","ngModelChange","disabled","ngModel"],[1,"col-1","d-block","text-center","btn","btn-info","py-0","px-2","mx-2",3,"click","disabled"],[1,"pi","pi-eye","d-block","mx-auto"],[1,"btn","btn-success","py-3","px-5",3,"click"],[1,"mx-1","pi","pi-save"],[1,"btn","btn-primary","py-3","px-5",3,"click"],[1,"btn","btn-info","mx-3","py-3","px-5",3,"click"],[1,"modal-body"],[1,"my-2","text-center"],[1,"table","table-striped","table-hover"]],template:function(e,n){if(e&1){let i=N();l(0,"app-dynamic-component",9),B("ShowToEditeEvent",function(){return s(i),c(n.ShowToEdite())})("OpenModalEvent",function(){return s(i),c(n.OpenModal())}),p(),C(1,Ge,72,61,"ng-template",null,0,k)(3,Qe,29,20,"ng-template",10,1,k),y(5,"app-glsheard",null,2)}if(e&2){let i=g(2);u("PageTitle","TransferBanches.TransferBanches")("TablePaging",n.TablePaging)("GlResponse",!0)("GetById","TransferBranchesEP/GetById")("DeleteUrl","TransferBranchesEP/Delete")("PrintUrl","TransferBranches")("OutModal",i)}},dependencies:[_e,le,J,q,ce,se,ae,oe,H,$,re,Z,ne,ee,te,X,K,he,ge,me,de]});let a=m;return a})();export{Tt as TransferBanchesComponent};
