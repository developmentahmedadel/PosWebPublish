import{a as ge,b as ve}from"./chunk-6T4APQIW.js";import{a as Ie}from"./chunk-PBWISRCH.js";import{c as de,j as Se}from"./chunk-D4UU44IK.js";import"./chunk-4LHCKT7C.js";import{a as ue}from"./chunk-VSYXDL23.js";import"./chunk-3ZAIJ4IV.js";import{g as ae,h as le,j as se,n as pe,s as me}from"./chunk-PPWB5S3T.js";import{b as ce}from"./chunk-FF7KVUSC.js";import{h as re}from"./chunk-VNF6RC2R.js";import{a as _e}from"./chunk-H6HTMPGV.js";import"./chunk-GKF6IR3T.js";import"./chunk-76NAH4W4.js";import"./chunk-O7NQZYPY.js";import{k as oe}from"./chunk-EWI5J5KH.js";import{a as X,b as Y,c as Z,d as ee}from"./chunk-X4LTGZKH.js";import{c as te,d as ne,g as ie}from"./chunk-OFZNSK7N.js";import{H as $,I as L,L as H,N as z,Q as K,S as J,Y as Q,_ as q,d as W,i as U}from"./chunk-CXJLKQ4R.js";import{$b as w,Cb as a,Db as r,Eb as P,Ib as C,Mb as I,Nb as c,Wb as f,X as T,Xb as s,Yb as g,Zb as y,_b as A,ac as M,bc as N,db as l,dc as k,eb as D,ec as G,na as R,nc as S,oc as v,pc as j,qc as F,vb as x,xa as p,xb as d,ya as m,z as O}from"./chunk-J5UB44FZ.js";import{a as V,b as B}from"./chunk-3EYC4JTX.js";var ye=()=>["Name","TotalQty","Wa","TotaPrice"];function xe(o,_){if(o&1&&(a(0,"small",38),s(1),r()),o&2){let n=c(2);l(),A("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function fe(o,_){if(o&1&&s(0),o&2){let n=_.item;y(" ",n.Name," ")}}function Ce(o,_){if(o&1&&(a(0,"small",38),s(1),r()),o&2){let n=c(2);l(),A("Loaded ",n.Groups.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Te(o,_){if(o&1&&s(0),o&2){let n=_.item;y(" ",n.Name," ")}}function be(o,_){if(o&1&&(a(0,"small",38),s(1),r()),o&2){let n=c(2);l(),A("Loaded ",n.Items.length," of ",n._SharedObjectModelService.TotalItems,"")}}function we(o,_){if(o&1&&s(0),o&2){let n=_.item;y(" ",n.NameAndCode," ")}}function Me(o,_){if(o&1){let n=C();a(0,"div",39)(1,"p-button",40),I("onClick",function(){p(n);let e=c(2);return m(e.ExpandAll())}),r(),a(2,"p-button",41),I("onClick",function(){p(n);let e=c(2);return m(e.CollapseAll())}),r()()}}function Ne(o,_){o&1&&(a(0,"tr")(1,"th"),s(2),S(3,"translate"),r(),a(4,"th"),s(5),S(6,"translate"),r(),a(7,"th"),s(8),S(9,"translate"),r(),a(10,"th"),s(11),S(12,"translate"),r(),a(13,"th"),s(14),S(15,"translate"),r(),a(16,"th"),s(17),S(18,"translate"),r(),a(19,"th"),s(20),S(21,"translate"),r(),a(22,"th"),s(23,"-"),r()()),o&2&&(l(2),g(v(3,7,"Table.Units")),l(3),g(v(6,9,"Table.Name")),l(3),g(v(9,11,"Table.BalanceDaftare")),l(3),g(v(12,13,"Table.BalanceNow")),l(3),g(v(15,15,"Table.WA")),l(3),g(v(18,17,"Table.Amount")),l(3),g(v(21,19,"Table.Status")))}function De(o,_){if(o&1&&P(0,"p-button",51),o&2){let n=c(),t=n.$implicit,e=n.expanded,i=c(2);d("pRowToggler",t)("text",!0)("rounded",!0)("plain",!0)("icon",e?"pi pi-chevron-down":i._Apiservice.Language=="ar"?"pi pi-chevron-left":"pi pi-chevron-right")}}function Pe(o,_){o&1&&(a(0,"p",52),s(1," \u0645\u062A\u0633\u0627\u0648\u064A "),r())}function Ae(o,_){o&1&&(a(0,"p",53),s(1," \u0639\u062C\u0632 "),r())}function Ee(o,_){o&1&&(a(0,"p",54),s(1," \u0641\u0627\u0626\u0636 "),r())}function Ve(o,_){if(o&1){let n=C();a(0,"div",55)(1,"button",56),I("click",function(){p(n);let e=c().$implicit,i=c(2);return e.InventoryType=1,m(i.Calc())}),s(2," \u0637\u0628\u064A\u0639\u064A "),r(),a(3,"button",57),I("click",function(){p(n);let e=c().$implicit,i=c(2);return e.InventoryType=2,m(i.Calc())}),s(4," \u063A\u064A\u0631 \u0637\u0628\u064A\u0639\u064A "),r()()}if(o&2){let n=c().$implicit;l(),d("disabled",n.InventoryType==1),l(2),d("disabled",n.InventoryType==2)}}function Be(o,_){if(o&1){let n=C();a(0,"p-button",58),I("click",function(){p(n);let e=c().$implicit,i=c(2);return m(i.RemoveProcut(e))}),r()}o&2&&d("icon","pi pi-trash")}function Oe(o,_){if(o&1){let n=C();a(0,"tr")(1,"td"),x(2,De,1,5,"p-button",42),r(),a(3,"td")(4,"span",43),s(5),r()(),a(6,"td")(7,"span",43),s(8),r()(),a(9,"td")(10,"input",44),I("keyup",function(){p(n);let e=c(2);return m(e.Calc())})("change",function(){p(n);let e=c(2);return m(e.Calc())})("change",function(){let e=p(n).$implicit,i=c(2);return m(i.ConvertNumber(e.BalanceNow)==e.BalanceDocument?e.InventoryType=0:e.InventoryType=e.InventoryType)}),N("ngModelChange",function(e){let i=p(n).$implicit;return M(i.BalanceNow,e)||(i.BalanceNow=e),m(e)}),r()(),a(11,"td")(12,"span",43),s(13),r()(),a(14,"td")(15,"span",43),s(16),r()(),a(17,"td",45),x(18,Pe,2,0,"p",46)(19,Ae,2,0,"p",47)(20,Ee,2,0,"p",48)(21,Ve,5,2,"div",49),r(),a(22,"td"),x(23,Be,1,1,"p-button",50),r()()}if(o&2){let n=_.$implicit,t=c(2);l(2),d("ngIf",t.Inventory.Id==0),l(3),y(" ",n.ProductName,""),l(3),y(" ",n.BalanceDocument.toFixed(2)," "),l(2),d("disabled",t.Inventory.Id>0),w("ngModel",n.BalanceNow),l(3),y(" ",n.WADocument.toFixed(2)," "),l(3),y(" ",n.TotaPriceDocument.toFixed(2)," "),l(2),d("ngIf",t.ConvertNumber(n.BalanceNow)==n.BalanceDocument),l(),d("ngIf",t.ConvertNumber(n.BalanceNow)<n.BalanceDocument),l(),d("ngIf",t.ConvertNumber(n.BalanceNow)>n.BalanceDocument),l(),d("ngIf",t.ConvertNumber(n.BalanceNow)<n.BalanceDocument),l(2),d("ngIf",t.Inventory.Id==0)}}function Re(o,_){o&1&&(a(0,"tr")(1,"th"),s(2),S(3,"translate"),r(),a(4,"th"),s(5),S(6,"translate"),r()()),o&2&&(l(2),y("",v(3,2,"Table.Name")," "),l(3),g(v(6,4,"Table.Quantity")))}function ke(o,_){if(o&1&&(a(0,"tr")(1,"td")(2,"span",43),s(3),r()(),a(4,"td")(5,"span",43),s(6),r()()()),o&2){let n=_.$implicit;l(3),y(" ",n.UnitName," "),l(3),y(" ",n.Qty," ")}}function Ge(o,_){if(o&1&&(a(0,"tr")(1,"td",59)(2,"p-table",60),x(3,Re,7,6,"ng-template",30)(4,ke,7,2,"ng-template",31),r()()()),o&2){let n=_.$implicit;l(2),d("value",n.ItemUnits)}}function je(o,_){if(o&1){let n=C();a(0,"p-paginator",61),I("onPageChange",function(e){p(n);let i=c(2);return m(i.onPageChange(e))}),r()}if(o&2){let n=c(2);d("first",n._SharedObjectModelService.Paging.CurrentPage)("rows",n._SharedObjectModelService.Paging.PageSize)("totalRecords",n._SharedObjectModelService.Paging.TotalItems)("rowsPerPageOptions",n._AppModeService.RowCount)}}function Fe(o,_){if(o&1){let n=C();a(0,"p-paginator",62),I("onPageChange",function(e){p(n);let i=c(2);return m(i.onPageChange(e))}),r()}if(o&2){let n=c(2);d("first",n._SharedObjectModelService.Paging.CurrentPage)("rows",n._SharedObjectModelService.Paging.PageSize)("totalRecords",n._SharedObjectModelService.Paging.TotalItems)}}function We(o,_){if(o&1){let n=C();a(0,"button",63),I("click",function(){p(n);let e=c(2);return m(e.Save())}),a(1,"span"),s(2),S(3,"translate"),r(),P(4,"i",64),r()}o&2&&(l(2),y(" ",v(3,1,"Model.Save"),""))}function Ue(o,_){if(o&1){let n=C();P(0,"app-modal-header",6),a(1,"div",7)(2,"div",8)(3,"div",9)(4,"label",10),s(5),S(6,"translate"),r(),P(7,"input",11),r(),a(8,"div",9)(9,"label",12),s(10),S(11,"translate"),r(),a(12,"input",13),N("ngModelChange",function(e){p(n);let i=c();return M(i.Inventory.Notes,e)||(i.Inventory.Notes=e),m(e)}),r()(),a(13,"div",9)(14,"span",14),s(15),S(16,"date"),r()(),a(17,"div",15)(18,"p",16),s(19),S(20,"translate"),r(),a(21,"ng-select",17,1),I("clear",function(){p(n);let e=c();return m(e.Storages=[])})("focus",function(){p(n);let e=f(22),i=c();return i.ChangeSearchApi("Storages",e),m(i._AppModeService.ResetCurrentPage())})("keyup",function(){p(n);let e=f(22),i=c();return i.ChangeSearchApi("Storages",e),m(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(n);let e=f(22),i=c();return m(i.ChangeSearchApi("Storages",e))})("close",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(n);let e=c();return e.SelectValue(e.SearchModel.StoreId,"Store"),m(e.ResetPage())}),N("ngModelChange",function(e){p(n);let i=c();return M(i.SearchModel.StoreId,e)||(i.SearchModel.StoreId=e),m(e)}),x(23,xe,2,2,"ng-template",18)(24,fe,1,1,"ng-template",19),r()(),a(25,"div",15)(26,"p",20),s(27),S(28,"translate"),r(),a(29,"ng-select",17,2),I("clear",function(){p(n);let e=c();return m(e.Groups=[])})("focus",function(){p(n);let e=f(30),i=c();return i.ChangeSearchApi("ItemGroups",e),m(i._AppModeService.ResetCurrentPage())})("keyup",function(){p(n);let e=f(30),i=c();return i.ChangeSearchApi("ItemGroups",e),m(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(n);let e=f(30),i=c();return m(i.ChangeSearchApi("ItemGroups",e))})("close",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(n);let e=c();return e.SelectValue(e.SearchModel.GroupId,"Group"),e.SearchModel.ProductId=null,m(e.ResetPage())}),N("ngModelChange",function(e){p(n);let i=c();return M(i.SearchModel.GroupId,e)||(i.SearchModel.GroupId=e),m(e)}),x(31,Ce,2,2,"ng-template",18)(32,Te,1,1,"ng-template",19),r()(),a(33,"div",15)(34,"label",21),s(35),S(36,"translate"),r(),a(37,"ng-select",22,3),I("clear",function(){p(n);let e=c();return m(e.Items=[])})("focus",function(){p(n);let e=f(38),i=c();return i.ChangeSearchApi("Items",e),m(i._AppModeService.ResetCurrentPage())})("keyup",function(){p(n);let e=f(38),i=c();return i.ChangeSearchApi("Items",e),m(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(n);let e=f(38),i=c();return m(i.ChangeSearchApi("Items",e))})("close",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(n);let e=c();return e.SelectValue(e.SearchModel.ProductId,"Product"),e.SearchModel.GroupId=null,m(e.ResetPage())}),N("ngModelChange",function(e){p(n);let i=c();return M(i.SearchModel.ProductId,e)||(i.SearchModel.ProductId=e),m(e)}),x(39,be,2,2,"ng-template",18)(40,we,1,1,"ng-template",19),r()(),a(41,"div",23)(42,"button",24),I("click",function(){p(n);let e=c();return m(e.Search())}),s(43),S(44,"translate"),r()()(),a(45,"div",25)(46,"table",26)(47,"thead")(48,"tr")(49,"th"),s(50),S(51,"translate"),r(),a(52,"th"),s(53),S(54,"translate"),r(),a(55,"th"),s(56),S(57,"translate"),r()()(),a(58,"tbody")(59,"tr")(60,"td"),s(61),r(),a(62,"td"),s(63),r(),a(64,"td"),s(65),r()()()()(),a(66,"div",27)(67,"p-table",28,4),x(69,Me,3,0,"ng-template",29)(70,Ne,24,21,"ng-template",30)(71,Oe,24,12,"ng-template",31)(72,Ge,5,1,"ng-template",32),r(),x(73,je,1,4,"p-paginator",33)(74,Fe,1,3,"p-paginator",34),r()(),a(75,"div",35),x(76,We,5,3,"button",36),a(77,"button",37),I("click",function(){let e=p(n).$implicit,i=c();return e.close("Close click"),m(i.ResetPage())}),s(78),S(79,"translate"),r()()}if(o&2){let n=c();d("PageTitle","InventorySettlement.InventorySettlement"),l(5),g(v(6,41,"Table.DocNo")),l(2),d("disabled",!0)("value",n.SearchModel.DocNo),l(3),g(v(11,43,"Table.Notes")),l(2),w("ngModel",n.Inventory.Notes),l(3),y(" ",j(16,45,n.Inventory.DocDate,"d-M-yyyy h:mm:ss a")," "),l(4),g(v(20,48,"SaleInvoice.Storage")),l(2),d("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),w("ngModel",n.SearchModel.StoreId),l(6),g(v(28,50,"Item.ItemGroup")),l(2),d("items",n.Groups)("autofocus",!1)("virtualScroll",!0)("searchable",!0),w("ngModel",n.SearchModel.GroupId),l(6),y(" ",v(36,52,"BalanceStorage.ItemId"),""),l(2),d("items",n.Items)("autofocus",!1)("virtualScroll",!0)("searchable",!0),w("ngModel",n.SearchModel.ProductId),l(6),g(v(44,54,"Model.Search")),l(7),g(v(51,56,"InventorySettlement.TotalNormal")),l(3),g(v(54,58,"InventorySettlement.TotalUnNormal")),l(3),g(v(57,60,"InventorySettlement.TotalOver")),l(5),g(n.Inventory.TotalNormal.toFixed(2)),l(2),g(n.Inventory.TotalUnNormal.toFixed(2)),l(2),g(n.Inventory.TotalOver.toFixed(2)),l(2),d("expandedRowKeys",n.expandedRows)("value",n.Inventory.InventorySettlementDetails)("paginator",!1)("rows",10)("globalFilterFields",G(64,ye)),l(6),d("ngIf",n._SharedObjectModelService.Paging.TotalItems>=10),l(),d("ngIf",n._SharedObjectModelService.Paging.TotalItems<10),l(2),d("ngIf",n.Inventory.Id==0),l(2),g(v(79,62,"Model.Close"))}}var ut=(()=>{let _=class _{constructor(t,e,i,u){this._SharedObjectModelService=t,this._AppModeService=e,this._DefaultSettingsService=i,this._Apiservice=u,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"InventorySettlement",Join:!0,JoinTables:["Storages SF"],JoinConditions:["T.StoreId = SF.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","SF.Name AS StoreName"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"},{SortName:"StoreName",CellName:"SaleInvoice.Storage",ExistSearchField:"SF.Name"}]},this.Inventory={InventorySettlementDetails:[],Id:0,Name:"",Code:"",DocDate:"",DocNo:0,StoreId:0,StoreName:"",TotalNormal:0,TotalUnNormal:0,TotalOver:0},this.Items=[],this.Groups=[],this.Storages=[],this.SearchModel={GroupId:null,StoreId:null,ProductId:null},this.expandedRows={}}ngOnInit(){}OpenModal(){this.GetPageInfo(),this.SearchModel={GroupId:null,StoreId:null,ProductId:null},this.ResetPage()}GetPageInfo(){this._Apiservice.get("StorageSettlementEP/GetPageInfo",!1).pipe(T(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?this.SearchModel.DocNo=t.Obj:this._AppModeService._Toastr.error(t.Message)}})}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){console.log(t),this.Inventory={InventorySettlementDetails:[],Id:t.Id,Name:"",Code:"",DocDate:new Date(`${t.DocDate}`),DocNo:t.DocNo,StoreId:t.StoreId,StoreName:t.StoreName,TotalNormal:t.TotalNormal,TotalUnNormal:t.TotalUnNormal,TotalOver:t.TotalOver},this.Storages=[{Id:t.StoreId,Name:t.StoreName}],this.SearchModel.StoreId=t.StoreId,this.SearchModel.DocNo=t.DocNo,this.Inventory.InventorySettlementDetails=[];for(let e=0;e<t.InventorySettlementDetails.length;e++){let i=t.InventorySettlementDetails[e];this.Inventory.InventorySettlementDetails.push(i)}}ChangeSearchApi(t,e){let i=`${e.searchTerm}`.trim();(i==""||i=="null")&&(e.searchTerm="",i=""),this._AppModeService.CurrentPage+=1;let u={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:i,SearchField:"Name"};t=="Storages"&&(u.BranchFilter=!0),t=="Items"&&(u.Columns=["Id","Name","Code"],u.Conditions="ProductType != 2"),this._Apiservice.post("Global/GetAll",u,!1).pipe(T(this._Apiservice.destroy$)).subscribe({next:h=>{h.IsSuccess==!0&&h.Obj!=null?this.HandleResponse(h.Obj,t):this._AppModeService._Toastr.error(h.Message)}})}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Storages"&&(this.Storages=this._SharedObjectModelService.RemoveDuplicates(this.Storages.concat(t.DataReturn),"Id")),e=="ItemGroups"&&(this.Groups=this._SharedObjectModelService.RemoveDuplicates(this.Groups.concat(t.DataReturn),"Id")),e=="Items"&&(this.Items=this._SharedObjectModelService.RemoveDuplicates(this.Items.concat(t.DataReturn),"Id"),this.Items=this.Items.map(i=>B(V({},i),{NameAndCode:`${i.Name} - ${i.Code}`})))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let i=[];e=="Store"&&(i=this.Storages),e=="Group"&&(i=this.Groups),e=="Product"&&(i=this.Items);let u=i.find(h=>h.Id==t);if(u==null){this._AppModeService.DontPlay();return}else this.SearchModel[`${e}Id`]=t,this.SearchModel[`${e}Name`]=u.Name}else this.SearchModel[`${e}Id`]=null,this.SearchModel[`${e}Name`]=""}Search(){if(this.SearchModel.StoreId==0||this.SearchModel.StoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyOffer.Error.EnterStore"));return}let t={ProductId:this.SearchModel.ProductId,StoreId:this.SearchModel.StoreId,GroupId:this.SearchModel.GroupId,CurrentPage:1,PageSize:this._SharedObjectModelService.Paging.PageSize};this._Apiservice.post("StorageSettlementEP/GetItems",t,!0).pipe(T(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.Inventory.InventorySettlementDetails=this._SharedObjectModelService.RemoveDuplicates(this.Inventory.InventorySettlementDetails.concat(e.Obj.List),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=e.Obj.TotalItems,this.Inventory.TotalNormal=0,this.Inventory.TotalUnNormal=0,this.Inventory.TotalOver=0):(this.Inventory.InventorySettlementDetails=[],this._AppModeService._Toastr.error(e.Message))}})}onPageChange(t){t.page++,t.first,t.rows,this._SharedObjectModelService.Paging.CurrentPage=t.first,this._SharedObjectModelService.Paging.PageSize=t.rows;let e={ProductId:this.SearchModel.ProductId,StoreId:this.SearchModel.StoreId,GroupId:this.SearchModel.GroupId,PageSize:this._SharedObjectModelService.Paging.PageSize,CurrentPage:t.page};this._Apiservice.post("StorageSettlementEP/GetItems",e,!0).pipe(T(this._Apiservice.destroy$)).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?(this.Inventory.InventorySettlementDetails=this._SharedObjectModelService.RemoveDuplicates(this.Inventory.InventorySettlementDetails.concat(i.Obj.List),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=i.Obj.TotalItems):this._AppModeService._Toastr.error(i.Message)}})}RemoveProcut(t){this.Inventory.InventorySettlementDetails=this.Inventory.InventorySettlementDetails.filter(e=>e.ProductId!=t.ProductId),this.Calc()}ExpandAll(){this.expandedRows=this.Inventory.InventorySettlementDetails.reduce((t,e)=>(t[e.Id]=!0)&&t,{})}CollapseAll(){this.expandedRows={}}ConvertNumber(t){return Number(t)}Calc(){this.Inventory.TotalNormal=0,this.Inventory.TotalUnNormal=0,this.Inventory.TotalOver=0;for(let t=0;t<this.Inventory.InventorySettlementDetails.length;t++){let e=Number(this.Inventory.InventorySettlementDetails[t].BalanceDocument),i=Number(this.Inventory.InventorySettlementDetails[t].BalanceNow),u=Number(this.Inventory.InventorySettlementDetails[t].WADocument);i>e&&(this.Inventory.InventorySettlementDetails[t].InventoryType=3);let h=Number(this.Inventory.InventorySettlementDetails[t].InventoryType);h==1&&(this.Inventory.TotalNormal+=(e-i)*u),h==2&&(this.Inventory.TotalUnNormal+=(e-i)*u),h==3&&i-e>0&&(this.Inventory.TotalOver+=(i-e)*u)}}Save(){if(this.Inventory.StoreId=this.SearchModel.StoreId,this.Inventory.DocNo=this.SearchModel.DocNo,this.Inventory.DocDate==""||this.Inventory.DocDate==null)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate")),!1;if(this.Inventory.StoreId==0||this.Inventory.StoreId==null)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyOffer.Error.EnterStore")),!1;for(let i=0;i<this.Inventory.InventorySettlementDetails.length;i++){let u=this.Inventory.InventorySettlementDetails[i].ProductName,h=this.Inventory.InventorySettlementDetails[i].BalanceDocument,b=Number(`${this.Inventory.InventorySettlementDetails[i].BalanceNow}`.trim()),he=Number(this.Inventory.InventorySettlementDetails[i].InventoryType),E=this.Inventory.InventorySettlementDetails[i].WADocument;if(h>0&&b<0)return alert("BalanceDocument > 0 && (BalanceNow <= 0)"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+u),!1;if(Number(b)>0&&E<=0)return alert("Number(BalanceNow) > 0 && WADocument <= 0"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.WANow")+" "+u),!1;if((Number(b)<0||b<0)&&E>0)return alert("(Number(BalanceNow) < 0 || (BalanceNow <= 0))  && WADocument > 0"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+u),!1;if(Number(b)<0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+u),!1;if(he==0&&Number(h)-Number(b)>0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.InventoryType")+" "+u),!1}let e={InventorySettlementDetails:this.Inventory.InventorySettlementDetails.filter(i=>i.BalanceDocument>0&&i.BalanceNow!="null"||Number(i.BalanceNow)>0),Id:0,Name:"",Code:"",DocDate:this._Apiservice.ConvertISODate(this.Inventory.DocDate),DocNo:this.Inventory.DocNo,StoreId:this.Inventory.StoreId,StoreName:this.Inventory.StoreName,TotalNormal:this.Inventory.TotalNormal,TotalUnNormal:this.Inventory.TotalUnNormal,TotalOver:this.Inventory.TotalOver};return e.Id==0&&this._Apiservice.post("StorageSettlementEP/Add",e,!0).pipe(T(this._Apiservice.destroy$)).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?(this._AppModeService._Toastr.success(i.Message),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(i.Obj)):this._AppModeService._Toastr.error(i.Message)}}),!0}ResetPage(){this.Inventory={InventorySettlementDetails:[],Id:0,Name:"",Code:"",DocDate:"",DocNo:0,StoreId:0,StoreName:"",TotalNormal:0,TotalUnNormal:0,TotalOver:0},O(0,1e3).pipe(T(this._Apiservice.destroy$)).subscribe(t=>{this.Inventory.DocDate=this._Apiservice.NowDate()})}StartConnection(){this.Hub_Connection=new ve().withUrl(`${$.signalrUrl}/InventorySettlement`,{skipNegotiation:!0,transport:ge.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(t=>{console.log("Error Hub Connection",t)})}ServerListener(){this.Hub_Connection?.on("AddInventorySettlement",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&(this.Inventory.DocNo=t.DocNo)})}trackByMethod(t,e){return e.Id}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};_.\u0275fac=function(e){return new(e||_)(D(_e),D(ie),D(Ie),D(L))},_.\u0275cmp=R({type:_,selectors:[["app-inventory-settlement"]],standalone:!0,features:[k],decls:3,vars:5,consts:[["content",""],["SelectStorages",""],["SelectItemGroup",""],["SelectFromStore",""],["dt1",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GetById","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-center"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","p-1"],["for","DocNo"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"d-block","text-center"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","px-1"],["for","Store",1,"my-1"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[1,"my-1"],["for","Item"],["placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],[1,"col-12","text-center","px-1","my-3"],[1,"btn","btn-success","my-2","my-lg-0","mx-3","px-5","shadow-none","Save",3,"click"],[1,"col-12"],[1,"table","table-striped","table-hover","w-100"],[1,"col-12","card","p-0","table-responsive"],["dataKey","Id",3,"expandedRowKeys","value","paginator","rows","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["appendTo","table",3,"first","rows","totalRecords","rowsPerPageOptions","onPageChange",4,"ngIf"],["appendTo","table",3,"first","rows","totalRecords","onPageChange",4,"ngIf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],["class","btn btn-success py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-secondary","py-3","px-5",3,"click"],[1,"form-text","text-muted"],[1,"flex","flex-wrap","justify-content-end","gap-2"],["label","Expand All","icon","pi pi-plus","text","",3,"onClick"],["label","Collapse All","icon","pi pi-minus","text","",3,"onClick"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon",4,"ngIf"],[1,"text-dark"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"keyup","change","ngModelChange","disabled","ngModel"],[1,"p-0","text-center"],["class","py-3 m-0 text-dark text-center",4,"ngIf"],["class"," py-3 m-0 text-danger text-center",4,"ngIf"],["class"," py-3 m-0 text-success text-center",4,"ngIf"],["class","col-12 text-center",4,"ngIf"],["type","button","severity","danger",3,"icon","click",4,"ngIf"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon"],[1,"py-3","m-0","text-dark","text-center"],[1,"py-3","m-0","text-danger","text-center"],[1,"py-3","m-0","text-success","text-center"],[1,"col-12","text-center"],[1,"btn","btn-success","px-4","mx-1",3,"click","disabled"],[1,"btn","btn-danger","px-3","mx-1",3,"click","disabled"],["type","button","severity","danger",3,"click","icon"],["colspan","8",1,"p-0"],["dataKey","Id",3,"value"],["appendTo","table",3,"onPageChange","first","rows","totalRecords","rowsPerPageOptions"],["appendTo","table",3,"onPageChange","first","rows","totalRecords"],[1,"btn","btn-success","py-3","px-5",3,"click"],[1,"mx-1","pi","pi-save"]],template:function(e,i){if(e&1){let u=C();a(0,"app-dynamic-component",5),I("OpenModalEvent",function(){return p(u),m(i.OpenModal())})("ShowToEditeEvent",function(){return p(u),m(i.ShowToEdite())}),r(),x(1,Ue,80,65,"ng-template",null,0,F)}if(e&2){let u=f(2);d("PageTitle","InventorySettlement.InventorySettlement")("TablePaging",i.TablePaging)("FullScreen",!0)("GetById","StorageSettlementEP/GetById")("OutModal",u)}},dependencies:[ce,re,oe,U,le,ae,H,J,z,Q,K,W,me,se,pe,q,ne,te,ee,Z,X,Y,Se,de,ue]});let o=_;return o})();export{ut as InventorySettlementComponent};
