import{a as Pe,b as fe,c as De}from"./chunk-BZPR73YG.js";import{a as ge}from"./chunk-ABGH7SJD.js";import{a as he}from"./chunk-AFVHDR2Z.js";import{b as ce,c as de,h as Se}from"./chunk-RMPXGUPG.js";import"./chunk-6G7QKXJW.js";import"./chunk-PE2JD36L.js";import{a as ue}from"./chunk-NNHHLG53.js";import"./chunk-RAAURFHQ.js";import{a as ae,b as me}from"./chunk-UVSBIWKY.js";import"./chunk-5EQTOVFJ.js";import{a as _e}from"./chunk-OZ63RRZR.js";import"./chunk-3T7HRBK4.js";import"./chunk-G323P4PR.js";import"./chunk-NZD6IPKE.js";import"./chunk-EKOK3I7J.js";import{a as re,b as oe,c as pe,d as le}from"./chunk-SU7IEUNK.js";import"./chunk-MYPGER6Q.js";import"./chunk-CETGYK4I.js";import{c as ne}from"./chunk-F7IHWOEY.js";import{c as J,d as K}from"./chunk-GJAIQ3XH.js";import{b as z,c as R,d as Y,g as X,i as Z,l as ee,n as ie,t as te,v as se}from"./chunk-UA6GT64L.js";import{A as q,d as $,e as H,j as Q}from"./chunk-GOUT62LL.js";import{$b as I,Cb as p,Db as u,Eb as A,Ib as T,Mb as w,Nb as a,Qb as b,Rb as M,Tb as E,Ub as V,Vb as O,Wb as N,X as P,Xb as g,Yb as L,Zb as f,_b as k,ac as x,bc as y,cc as F,db as o,dc as j,eb as v,ia as G,na as B,nc as S,oc as h,pc as W,qc as U,vb as C,xa as m,xb as _,ya as c}from"./chunk-RH76WUG2.js";import"./chunk-3EYC4JTX.js";var Ce=["content"],Ie=["GLComponent"],xe=["dynamiccomponent"];function ye(r,d){if(r&1&&(p(0,"span",23),g(1),S(2,"date"),u()),r&2){let s=a(2);o(),f(" ",W(2,1,s.SuppliersPermissions.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Te(r,d){if(r&1){let s=T();p(0,"div",24,3)(2,"p-calendar",25),y("ngModelChange",function(e){m(s);let t=a(2);return x(t.SuppliersPermissions.DocDate,e)||(t.SuppliersPermissions.DocDate=e),c(e)}),u()()}if(r&2){let s=a(2);o(2),I("ngModel",s.SuppliersPermissions.DocDate),_("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function we(r,d){if(r&1&&(p(0,"small",34),g(1),u()),r&2){let s=a().$implicit,i=a(2);o(),k("Loaded ",s.Suppliers.length," of ",i._SharedObjectModelService.TotalItems,"")}}function be(r,d){if(r&1&&g(0),r&2){let s=d.item;f(" ",s.Name," ")}}function Me(r,d){if(r&1&&(p(0,"span",35),g(1),u()),r&2){let s=a().$implicit;o(),f(" ",s.AmountPermissions," ")}}function Ne(r,d){if(r&1){let s=T();p(0,"tr")(1,"td",26),S(2,"translate"),p(3,"ng-select",27,4),w("clear",function(){let e=m(s).$implicit;return c(e.Suppliers=[])})("focus",function(){let e=m(s).index,t=N(4),n=a(2);return n.ChangeSearchApiDetails("Suppliers",t,e),c(n._AppModeService.ResetCurrentPage())})("keyup",function(){let e=m(s).index,t=N(4),n=a(2);return n.ChangeSearchApiDetails("Suppliers",t,e),c(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=m(s).index,t=N(4),n=a(2);return c(n.ChangeSearchApiDetails("Suppliers",t,e))})("close",function(){m(s);let e=a(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){m(s);let e=a(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=m(s),t=e.$implicit,n=e.index,l=a(2);return c(l.SelectValueDetails(t.SupplierId,"Supplier",n))}),y("ngModelChange",function(e){let t=m(s).$implicit;return x(t.SupplierId,e)||(t.SupplierId=e),c(e)}),C(5,we,2,2,"ng-template",28)(6,be,1,1,"ng-template",29),u()(),p(7,"td",30),S(8,"translate"),C(9,Me,2,1,"span",31),u(),p(10,"td",30),S(11,"translate"),p(12,"input",32),w("keyup",function(){let e=m(s),t=e.$implicit,n=e.index,l=a(2);return l.TotalSuppliersPermissions(),c(l.ChangeAmount(t.SupplierId,n))}),y("ngModelChange",function(e){let t=m(s).$implicit;return x(t.Amount,e)||(t.Amount=e),c(e)}),u()(),p(13,"td",30),S(14,"translate"),p(15,"input",33),y("ngModelChange",function(e){let t=m(s).$implicit;return x(t.Notes,e)||(t.Notes=e),c(e)}),u()()()}if(r&2){let s=d.$implicit,i=d.index,e=a(2);o(),b("title",h(2,23,"TransferStorage.Name")),o(2),_("items",s.Suppliers)("autofocus",!1)("dropdownPosition",e._AppModeService.DropdownPosition(i))("virtualScroll",!0)("searchable",!0),I("ngModel",s.SupplierId),o(4),b("title",h(8,25,"MoneyIn.Debt")),o(2),_("ngIf",s.SupplierId>0),o(),b("title",h(11,27,"MoneyIn.Price")),o(2),M("name","Amount",i,""),M("id","Amount",i,""),_("disabled",s.SupplierId==0||s.SupplierId==null),I("ngModel",s.Amount),o(),b("title",h(14,29,"MoneyIn.Notes")),o(2),M("name","Notes",i,""),M("id","Notes",i,""),_("disabled",s.SupplierId==0||s.SupplierId==null),I("ngModel",s.Notes)}}function Ae(r,d){if(r&1){let s=T();A(0,"app-modal-header",6),p(1,"div",7)(2,"div",8)(3,"div",9),A(4,"input",10),u(),p(5,"div",11)(6,"label",12),g(7),S(8,"translate"),u(),p(9,"input",13),y("ngModelChange",function(e){m(s);let t=a();return x(t.SuppliersPermissions.Notes,e)||(t.SuppliersPermissions.Notes=e),c(e)}),u()(),p(10,"div",14),C(11,ye,3,4,"span",15)(12,Te,3,5,"div",16),u()(),p(13,"div",17)(14,"table",18)(15,"thead")(16,"th",19),g(17),S(18,"translate"),u(),p(19,"th",19),g(20),S(21,"translate"),u(),p(22,"th",19),g(23),S(24,"translate"),u(),p(25,"th",20),g(26),S(27,"translate"),u()(),p(28,"tbody"),C(29,Ne,16,31,"tr",21),u()()()(),p(30,"app-modal-footer",22),w("SaveEvent",function(){m(s);let e=a();return c(e.Save())})("UpdateEvent",function(){m(s);let e=a();return c(e.Save())})("OpenGlEvent",function(){m(s);let e=a();return c(e.OpenGl())})("CloseEvent",function(){let e=m(s).$implicit,t=a();return e.close("Close click"),c(t.ResetPage())}),u()}if(r&2){let s=a();_("PageTitle",s.TablePaging.PageTitle),o(4),_("disabled",!0)("value",s.SuppliersPermissions.DocNo),o(3),L(h(8,15,"Table.Notes")),o(2),I("ngModel",s.SuppliersPermissions.Notes),o(2),_("ngIf",(s._DefaultSettingsService.DefaultSettings==null?null:s._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),o(),_("ngIf",(s._DefaultSettingsService.DefaultSettings==null?null:s._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),o(5),f(" ",h(18,17,"MoneyIn.Suppliers")," "),o(3),f(" ",h(21,19,"MoneyIn.Debt")," "),o(3),f(" ",h(24,21,"MoneyIn.Price")," "),o(3),f(" ",h(27,23,"MoneyIn.Notes")," "),o(3),_("ngForOf",s.SuppliersPermissions.SuppliersPermissionsDetails)("ngForTrackBy",s.trackByMethod),o(),_("Id",s.SuppliersPermissions.Id)("Gl",!0)}}var oi=(()=>{let d=class d{constructor(i,e,t,n,l){this._ActivatedRoute=i,this._SharedObjectModelService=e,this._AppModeService=t,this._DefaultSettingsService=n,this._Apiservice=l,this._ServiceLifeTime=G(R),this.TablePaging={PageTitle:"SuppliersPermissions.SuppliersPermissions",GetById:"SuppliersPermissionsEP/GetById",DeleteUrl:"SuppliersPermissionsEP/Delete",BranchFilter:!0,Url:"Global/GetAll",TableName:"SuppliersPermissions",Columns:["Id","DocNo","DocDate","Notes"],TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"}]},this.SuppliersPermissions={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SuppliersPermissionsDetails:[{Amount:"",SupplierId:null,SupplierName:"",Id:0,Code:"",Name:"",Suppliers:[],AmountPermissions:""}]}}ngOnInit(){let i=Number(this._ActivatedRoute.snapshot.queryParams.Id);i>0&&this.GetByIdRoute(i),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(i){this._Apiservice.getById("SuppliersPermissionsEP/GetById",i,!0).pipe(P(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this.GLComponent.Gl=e.Obj.Gl,this.Drow(e.Obj.model),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})}})}OpenModal(){this.ResetPage(),this.GetPageInfo()}ShowToEdite(i){this.GLComponent.Gl=i.Gl,this.Drow(i.PageModel)}Drow(i){this.SuppliersPermissions={DocDate:new Date(i.DocDate),DocNo:i.DocNo,Id:i.Id,Name:i.Name,Code:i.Code,SuppliersPermissionsDetails:i.SuppliersPermissionsDetails};for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++){this.SuppliersPermissions.SuppliersPermissionsDetails[e].Suppliers=[],this.SuppliersPermissions.SuppliersPermissionsDetails[e].Suppliers=[{Id:this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId,Name:this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierName}];let t=this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId;this._Apiservice.getById("SupplierEP/TotalSuppliersPermissions",t,!1).pipe(P(this._ServiceLifeTime.Destroyed$)).subscribe({next:n=>{this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions=n.Obj}})}}OpenGl(){this.GLComponent.Open()}StartConnection(){this.Hub_Connection=new De().withUrl(`${z.signalrUrl}/SuppliersPermissions`,{skipNegotiation:!0,transport:fe.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(Pe.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(i=>{console.log(i)})}GetPageInfo(){this._Apiservice.get("SuppliersPermissionsEP/GetPageInfo",!1).pipe(P(this._ServiceLifeTime.Destroyed$)).subscribe({next:i=>{this.SuppliersPermissions.DocNo=i.Obj}})}AppendRow(i){return this.Row={SupplierId:null,Amount:"",AmountPermissions:0,SupplierName:"",Suppliers:[],Code:"",Id:0,Name:""},this.SuppliersPermissions.SuppliersPermissionsDetails.push(this.Row),this.TotalSuppliersPermissions(),!0}RemoveRow(i){return this.SuppliersPermissions.SuppliersPermissionsDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.SuppliersPermissions.SuppliersPermissionsDetails.splice(i,1),this.TotalSuppliersPermissions(),!0)}TotalSuppliersPermissions(){let i=0;for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++)i+=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].Amount);return Number(i.toFixed(2))}ChangeSearchApiDetails(i,e,t){let n=`${e.searchTerm}`.trim();(n==""||n=="null")&&(e.searchTerm="",n=""),this._AppModeService.CurrentPage+=1;let l={TableName:i,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:n,SearchField:"Name"};this._Apiservice.post("Global/GetAll",l,!1).pipe(P(this._ServiceLifeTime.Destroyed$)).subscribe({next:D=>{this.HandleResponseDetails(D.Obj,i,t)}})}HandleResponseDetails(i,e,t){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=i.TotalItems,e=="Suppliers"&&(this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers=this._SharedObjectModelService.RemoveDuplicates(this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers.concat(i.DataReturn),"Id"))}SelectValueDetails(i,e,t){if(i!=null&&i>0){let n=[];e=="Supplier"&&(n=this.SuppliersPermissions.SuppliersPermissionsDetails[t].Suppliers);let l=n.find(D=>D.Id==i);if(l!=null)this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Id`]=l.Id,this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Name`]=l.Name,this.TotalPermissions(l.Id,t);else{this._Apiservice.DontPlay();return}}else this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Id`]=null,this.SuppliersPermissions.SuppliersPermissionsDetails[t][`${e}Name`]=[]}TotalPermissions(i,e){this._Apiservice.getById("SupplierEP/TotalSuppliersPermissions",i,!1).pipe(P(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions=t.Obj}})}ChangeAmount(i,e){}Save(){if(this.SuppliersPermissions.DocDate==""||this.SuppliersPermissions.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}for(let e=0;e<this.SuppliersPermissions.SuppliersPermissionsDetails.length;e++){let t=e,n=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].SupplierId),l=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].Amount),D=Number(this.SuppliersPermissions.SuppliersPermissionsDetails[e].AmountPermissions);if(n>0){if(l<=0||isNaN(l)||l==null||l==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("MoneyIn.Error.EnterAmount"));return}if(this.SuppliersPermissions.SuppliersPermissionsDetails.filter(ve=>ve.SupplierId==n).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(t+1));return}}}let i={DocNo:this.SuppliersPermissions.DocNo,DocDate:this._Apiservice.ConvertISODate(this.SuppliersPermissions.DocDate),SuppliersPermissionsDetails:this.SuppliersPermissions.SuppliersPermissionsDetails,Id:this.SuppliersPermissions.Id,Name:"",Code:""};i.Id==0&&this._Apiservice.post("SuppliersPermissionsEP/Add",i,!0).pipe(P(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this.DynamicComponent.Paging.DataReturn.push(e.Obj)}}),i.Id>0&&this._Apiservice.put("SuppliersPermissionsEP/Update",i,!0).pipe(P(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo();let t=e.Obj,n=this.DynamicComponent.Paging.DataReturn.find(l=>l.Id==t.Id);n!=null&&Object.assign(n,t)}})}ResetPage(){this.SuppliersPermissions={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SuppliersPermissionsDetails:[{Amount:"",SupplierId:null,SupplierName:"",Id:0,Code:"",Name:"",Suppliers:[],AmountPermissions:0}]},this._DefaultSettingsService.ResetDate(this.SuppliersPermissions)}ServerListener(){this.Hub_Connection?.on("AddSuppliersPermissions",i=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==i.BranchId&&(this.SuppliersPermissions.DocNo=i.DocNo)})}trackByMethod(i,e){return e.Id}ngOnDestroy(){}};d.\u0275fac=function(e){return new(e||d)(v(q),v(_e),v(ne),v(he),v(Y))},d.\u0275cmp=B({type:d,selectors:[["app-suppliers-permissions"]],viewQuery:function(e,t){if(e&1&&(E(Ce,5),E(Ie,5),E(xe,5)),e&2){let n;V(n=O())&&(t.ContentModel=n.first),V(n=O())&&(t.GLComponent=n.first),V(n=O())&&(t.DynamicComponent=n.first)}},standalone:!0,features:[F([R]),j],decls:6,vars:6,consts:[["dynamiccomponent",""],["content",""],["GLComponent",""],["ddddd",""],["SelectSuppliersDetails",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","GlResponse","GetById","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"col-12","d-flex","flex","flex-wrap","align-items-end","px-2"],[1,"col-12","col-sm-6","col-lg-2","col-xl-1","p-1"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"col-12","col-sm-6","col-lg-3","col-xl-2","p-1"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-12","col-sm-6","col-xl-3","p-1"],["class","d-block text-center",4,"ngIf"],["class","formdate",4,"ngIf"],[1,"DivPaging","table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-3","mb-0"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"SaveEvent","UpdateEvent","OpenGlEvent","CloseEvent","Id","Gl"],[1,"d-block","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"ngSelect",3,"title"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[3,"title"],["class","text-dark d-block text-center col-11 col-md-12",4,"ngIf"],["min","0","step","1","type","number","appNumericInput","",1,"form-control","shadow-none","text-center",3,"keyup","ngModelChange","disabled","ngModel","name","id"],["type","text",1,"form-control","shadow-none","text-center",3,"ngModelChange","disabled","ngModel","name","id"],[1,"form-text","text-muted"],[1,"text-dark","d-block","text-center","col-11","col-md-12"]],template:function(e,t){if(e&1){let n=T();p(0,"app-dynamic-component",5,0),w("OpenModalEvent",function(){return m(n),c(t.OpenModal())})("ShowToEditeEvent",function(D){return m(n),c(t.ShowToEdite(D))}),u(),C(2,Ae,31,25,"ng-template",null,1,U),A(4,"app-glsheard",null,2)}if(e&2){let n=N(3);_("PageTitle",t.TablePaging.PageTitle)("TablePaging",t.TablePaging)("GlResponse",!0)("GetById",t.TablePaging.GetById)("DeleteUrl",t.TablePaging.DeleteUrl)("OutModal",n)}},dependencies:[me,ae,Q,H,$,se,X,ie,Z,te,ee,K,J,le,pe,re,oe,Se,ge,ce,ue,de]});let r=d;return r})();export{oi as SuppliersPermissionsComponent};
