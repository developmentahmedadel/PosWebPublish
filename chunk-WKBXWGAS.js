import{a as De}from"./chunk-ABGH7SJD.js";import{a as ue}from"./chunk-AFVHDR2Z.js";import{b as de,c as ce,h as _e}from"./chunk-RMPXGUPG.js";import"./chunk-6G7QKXJW.js";import"./chunk-PE2JD36L.js";import{a as pe}from"./chunk-NNHHLG53.js";import"./chunk-RAAURFHQ.js";import{a as se,b as le}from"./chunk-UVSBIWKY.js";import"./chunk-5EQTOVFJ.js";import{a as me}from"./chunk-OZ63RRZR.js";import"./chunk-3T7HRBK4.js";import"./chunk-G323P4PR.js";import"./chunk-NZD6IPKE.js";import"./chunk-EKOK3I7J.js";import{a as ne,b as ae,c as oe,d as re}from"./chunk-SU7IEUNK.js";import"./chunk-MYPGER6Q.js";import"./chunk-CETGYK4I.js";import{c as ie}from"./chunk-F7IHWOEY.js";import{c as z,d as Y}from"./chunk-GJAIQ3XH.js";import{c as O,d as q,g as J,i as K,l as X,n as Z,t as ee,v as te}from"./chunk-UA6GT64L.js";import{d as U,e as Q,j as H}from"./chunk-GOUT62LL.js";import{$b as S,Cb as s,Db as m,Eb as A,Ib as y,Mb as T,Nb as l,Qb as w,Rb as M,Tb as E,Ub as P,Vb as V,Wb as N,X as C,Xb as b,Yb as L,Zb as h,_b as k,ac as v,bc as x,cc as F,db as r,dc as j,eb as I,ia as G,na as R,nc as u,oc as g,pc as W,qc as $,vb as B,xa as p,xb as D,ya as c}from"./chunk-RH76WUG2.js";import"./chunk-3EYC4JTX.js";var ge=["GLComponent"],he=["dynamiccomponent"];function Ce(o,_){if(o&1&&(s(0,"span",23),b(1),u(2,"date"),m()),o&2){let n=l(2);r(),h(" ",W(2,1,n.BadDebts.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function fe(o,_){if(o&1){let n=y();s(0,"div",24,3)(2,"p-calendar",25),x("ngModelChange",function(e){p(n);let i=l(2);return v(i.BadDebts.DocDate,e)||(i.BadDebts.DocDate=e),c(e)}),m()()}if(o&2){let n=l(2);r(2),S("ngModel",n.BadDebts.DocDate),D("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function Be(o,_){if(o&1&&(s(0,"small",34),b(1),m()),o&2){let n=l().$implicit,t=l(2);r(),k("Loaded ",n.Clients.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Se(o,_){if(o&1&&b(0),o&2){let n=_.item;h(" ",n.Name," ")}}function ve(o,_){if(o&1&&(s(0,"span",35),b(1),m()),o&2){let n=l().$implicit;r(),h(" ",n.AmountDebts," ")}}function xe(o,_){if(o&1){let n=y();s(0,"tr")(1,"td",26),u(2,"translate"),s(3,"ng-select",27,4),T("clear",function(){let e=p(n).$implicit;return c(e.Clients=[])})("focus",function(){let e=p(n).index,i=N(4),a=l(2);return a.ChangeSearchApiDetails("Clients",i,e),c(a._AppModeService.ResetCurrentPage())})("keyup",function(){let e=p(n).index,i=N(4),a=l(2);return a.ChangeSearchApiDetails("Clients",i,e),c(a._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=p(n).index,i=N(4),a=l(2);return c(a.ChangeSearchApiDetails("Clients",i,e))})("close",function(){p(n);let e=l(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=l(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=p(n),i=e.$implicit,a=e.index,d=l(2);return c(d.SelectValueDetails(i.ClientId,"Client",a))}),x("ngModelChange",function(e){let i=p(n).$implicit;return v(i.ClientId,e)||(i.ClientId=e),c(e)}),B(5,Be,2,2,"ng-template",28)(6,Se,1,1,"ng-template",29),m()(),s(7,"td",30),u(8,"translate"),B(9,ve,2,1,"span",31),m(),s(10,"td",30),u(11,"translate"),s(12,"input",32),T("keyup",function(){let e=p(n),i=e.$implicit,a=e.index,d=l(2);return d.TotalBadDebts(),c(d.ChangeAmount(i.ClientId,a))}),x("ngModelChange",function(e){let i=p(n).$implicit;return v(i.Amount,e)||(i.Amount=e),c(e)}),m()(),s(13,"td",30),u(14,"translate"),s(15,"input",33),x("ngModelChange",function(e){let i=p(n).$implicit;return v(i.Notes,e)||(i.Notes=e),c(e)}),m()()()}if(o&2){let n=_.$implicit,t=_.index,e=l(2);r(),w("title",g(2,23,"TransferStorage.Name")),r(2),D("items",n.Clients)("autofocus",!1)("dropdownPosition",e._AppModeService.DropdownPosition(t))("virtualScroll",!0)("searchable",!0),S("ngModel",n.ClientId),r(4),w("title",g(8,25,"MoneyIn.Debt")),r(2),D("ngIf",n.ClientId>0),r(),w("title",g(11,27,"MoneyIn.Price")),r(2),M("name","Amount",t,""),M("id","Amount",t,""),D("disabled",n.ClientId==0||n.ClientId==null),S("ngModel",n.Amount),r(),w("title",g(14,29,"MoneyIn.Notes")),r(2),M("name","Notes",t,""),M("id","Notes",t,""),D("disabled",n.ClientId==0||n.ClientId==null),S("ngModel",n.Notes)}}function Ie(o,_){if(o&1){let n=y();A(0,"app-modal-header",6),s(1,"div",7)(2,"div",8)(3,"div",9),A(4,"input",10),m(),s(5,"div",11)(6,"label",12),b(7),u(8,"translate"),m(),s(9,"input",13),x("ngModelChange",function(e){p(n);let i=l();return v(i.BadDebts.Notes,e)||(i.BadDebts.Notes=e),c(e)}),m()(),s(10,"div",14),B(11,Ce,3,4,"span",15)(12,fe,3,5,"div",16),m()(),s(13,"div",17)(14,"table",18)(15,"thead")(16,"th",19),b(17),u(18,"translate"),m(),s(19,"th",19),b(20),u(21,"translate"),m(),s(22,"th",19),b(23),u(24,"translate"),m(),s(25,"th",20),b(26),u(27,"translate"),m()(),s(28,"tbody"),B(29,xe,16,31,"tr",21),m()()()(),s(30,"app-modal-footer",22),T("SaveEvent",function(){p(n);let e=l();return c(e.Save())})("UpdateEvent",function(){p(n);let e=l();return c(e.Save())})("OpenGlEvent",function(){p(n);let e=l();return c(e.OpenGl())})("CloseEvent",function(){let e=p(n).$implicit,i=l();return e.close("Close click"),c(i.ResetPage())}),m()}if(o&2){let n=l();D("PageTitle","BadDebts.BadDebts"),r(4),D("disabled",!0)("value",n.BadDebts.DocNo),r(3),L(g(8,15,"Table.Notes")),r(2),S("ngModel",n.BadDebts.Notes),r(2),D("ngIf",(n._DefaultSettingsService.DefaultSettings==null?null:n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),r(),D("ngIf",(n._DefaultSettingsService.DefaultSettings==null?null:n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),r(5),h(" ",g(18,17,"SaleInvoice.Client")," "),r(3),h(" ",g(21,19,"MoneyIn.Debt")," "),r(3),h(" ",g(24,21,"MoneyIn.Price")," "),r(3),h(" ",g(27,23,"MoneyIn.Notes")," "),r(3),D("ngForOf",n.BadDebts.BadDebtsDetails)("ngForTrackBy",n.trackByMethod),r(),D("Id",n.BadDebts.Id)("Gl",!0)}}var Ke=(()=>{let _=class _{constructor(t,e,i,a){this._SharedObjectModelService=t,this._AppModeService=e,this._DefaultSettingsService=i,this._Apiservice=a,this._ServiceLifeTime=G(O),this.TablePaging={PageTitle:"BadDebts.BadDebts",BranchFilter:!0,Url:"Global/GetAll",GetById:"BadDebtsEP/GetById",DeleteUrl:"BadDebtsEP/Delete",TableName:"BadDebts",Columns:["Id","DocNo","DocDate","Notes"],TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"}]},this.BadDebts={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",BadDebtsDetails:[{Amount:"",ClientId:null,ClientName:"",Id:0,Code:"",Name:"",Clients:[],AmountDebts:0}]}}ngOnInit(){}OpenModal(){this.ResetPage(),this.GetPageInfo()}OpenGl(){this.GLComponent.Open()}ShowToEdite(t){this.GLComponent.Gl=t.Gl,this.Drow(t.PageModel)}Drow(t){this.BadDebts={DocDate:new Date(t.DocDate),DocNo:t.DocNo,Id:t.Id,Name:t.Name,Code:t.Code,BadDebtsDetails:t.BadDebtsDetails};for(let e=0;e<this.BadDebts.BadDebtsDetails.length;e++){this.BadDebts.BadDebtsDetails[e].Clients=[],this.BadDebts.BadDebtsDetails[e].Clients=[{Id:this.BadDebts.BadDebtsDetails[e].ClientId,Name:this.BadDebts.BadDebtsDetails[e].ClientName}];let i=this.BadDebts.BadDebtsDetails[e].ClientId;this._Apiservice.getById("ClientEP/TotalBadDepts",i,!1).pipe(C(this._ServiceLifeTime.Destroyed$)).subscribe({next:a=>{this.BadDebts.BadDebtsDetails[e].AmountDebts=a.Obj}})}}GetPageInfo(){this._Apiservice.get("BadDebtsEP/GetPageInfo",!1).pipe(C(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{this.BadDebts.DocNo=t.Obj}})}ChangeSearchApiDetails(t,e,i){let a=`${e.searchTerm}`.trim();(a==""||a=="null")&&(e.searchTerm="",a=""),this._AppModeService.CurrentPage+=1;let d={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:a,SearchField:"Name"};this._Apiservice.post("Global/GetAll",d,!1).pipe(C(this._ServiceLifeTime.Destroyed$)).subscribe({next:f=>{this.HandleResponseDetails(f.Obj,t,i)}})}HandleResponseDetails(t,e,i){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Clients"&&(this.BadDebts.BadDebtsDetails[i].Clients=this._SharedObjectModelService.RemoveDuplicates(this.BadDebts.BadDebtsDetails[i].Clients.concat(t.DataReturn),"Id"))}SelectValueDetails(t,e,i){if(t!=null&&t>0){let a=[];e=="Client"&&(a=this.BadDebts.BadDebtsDetails[i].Clients);let d=a.find(f=>f.Id==t);if(d!=null)this.BadDebts.BadDebtsDetails[i][`${e}Id`]=d.Id,this.BadDebts.BadDebtsDetails[i][`${e}Name`]=d.Name,this.TotalBadDepts(d.Id,i);else{this._Apiservice.DontPlay();return}}else this.BadDebts.BadDebtsDetails[i][`${e}Id`]=null,this.BadDebts.BadDebtsDetails[i][`${e}Name`]=[]}TotalBadDepts(t,e){this._Apiservice.getById("ClientEP/TotalBadDepts",t,!1).pipe(C(this._ServiceLifeTime.Destroyed$)).subscribe({next:i=>{this.BadDebts.BadDebtsDetails[e].AmountDebts=i.Obj}})}AppendRow(){return this.Row={ClientId:null,Amount:"",AmountDebts:0,ClientName:"",Clients:[],Code:"",Id:0,Name:""},this.BadDebts.BadDebtsDetails.push(this.Row),this.TotalBadDebts(),!0}RemoveRow(t){return this.BadDebts.BadDebtsDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.BadDebts.BadDebtsDetails.splice(t,1),this.TotalBadDebts(),!0)}TotalBadDebts(){let t=0;for(let e=0;e<this.BadDebts.BadDebtsDetails.length;e++)t+=Number(this.BadDebts.BadDebtsDetails[e].Amount);return Number(t.toFixed(2))}ChangeAmount(t,e){}Save(){if(this.BadDebts.DocDate==""||this.BadDebts.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}for(let e=0;e<this.BadDebts.BadDebtsDetails.length;e++){let i=e,a=Number(this.BadDebts.BadDebtsDetails[e].ClientId),d=Number(this.BadDebts.BadDebtsDetails[e].Amount),f=Number(this.BadDebts.BadDebtsDetails[e].AmountDebts);if(a>0){if(d<=0||isNaN(d)||d==null||d==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("MoneyIn.Error.EnterAmount"));return}if(this.BadDebts.BadDebtsDetails.filter(be=>be.ClientId==a).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(i+1));return}}}let t={DocNo:this.BadDebts.DocNo,DocDate:this._Apiservice.ConvertISODate(this.BadDebts.DocDate),BadDebtsDetails:this.BadDebts.BadDebtsDetails,Id:this.BadDebts.Id,Name:"",Code:""};t.Id==0&&this._Apiservice.post("BadDebtsEP/Add",t,!0).pipe(C(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo(),this.DynamicComponent.Paging.DataReturn.push(e.Obj)}}),t.Id>0&&this._Apiservice.put("BadDebtsEP/Update",t,!0).pipe(C(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo();let i=e.Obj,a=this.DynamicComponent.Paging.DataReturn.find(d=>d.Id==i.Id);a!=null&&Object.assign(a,i)}})}ResetPage(){this.BadDebts={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",BadDebtsDetails:[{Amount:"",ClientId:null,ClientName:"",Id:0,Code:"",Name:"",Clients:[],AmountDebts:0}]},this._DefaultSettingsService.ResetDate(this.BadDebts)}trackByMethod(t,e){return e.Id}ngOnDestroy(){}};_.\u0275fac=function(e){return new(e||_)(I(me),I(ie),I(ue),I(q))},_.\u0275cmp=R({type:_,selectors:[["app-bad-debts"]],viewQuery:function(e,i){if(e&1&&(E(ge,5),E(he,5)),e&2){let a;P(a=V())&&(i.GLComponent=a.first),P(a=V())&&(i.DynamicComponent=a.first)}},standalone:!0,features:[F([O]),j],decls:6,vars:6,consts:[["dynamiccomponent",""],["content",""],["GLComponent",""],["ddddd",""],["SelectClientssDetails",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","GlResponse","GetById","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"col-12","d-flex","flex","flex-wrap","align-items-end","px-2"],[1,"col-12","col-sm-6","col-lg-2","col-xl-1","p-1"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"col-12","col-sm-6","col-lg-3","col-xl-2","p-1"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-12","col-sm-6","col-xl-3","p-1"],["class","d-block text-center",4,"ngIf"],["class","formdate",4,"ngIf"],[1,"DivPaging","table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-3","mb-0"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"SaveEvent","UpdateEvent","OpenGlEvent","CloseEvent","Id","Gl"],[1,"d-block","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"ngSelect",3,"title"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[3,"title"],["class","text-dark d-block text-center col-11 col-md-12",4,"ngIf"],["min","0","step","1","type","number","appNumericInput","",1,"form-control","shadow-none","text-center",3,"keyup","ngModelChange","disabled","ngModel","name","id"],["type","text",1,"form-control","shadow-none","text-center",3,"ngModelChange","disabled","ngModel","name","id"],[1,"form-text","text-muted"],[1,"text-dark","d-block","text-center","col-11","col-md-12"]],template:function(e,i){if(e&1){let a=y();s(0,"app-dynamic-component",5,0),T("OpenModalEvent",function(){return p(a),c(i.OpenModal())})("ShowToEditeEvent",function(f){return p(a),c(i.ShowToEdite(f))}),m(),B(2,Ie,31,25,"ng-template",null,1,$),A(4,"app-glsheard",null,2)}if(e&2){let a=N(3);D("PageTitle",i.TablePaging.PageTitle)("TablePaging",i.TablePaging)("GlResponse",!0)("GetById",i.TablePaging.GetById)("DeleteUrl",i.TablePaging.DeleteUrl)("OutModal",a)}},dependencies:[le,se,H,Q,U,te,J,Z,K,ee,X,Y,z,re,oe,ne,ae,_e,De,de,pe,ce]});let o=_;return o})();export{Ke as BadDebtsComponent};
