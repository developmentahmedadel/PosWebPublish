import{a as he,b as me}from"./chunk-6T4APQIW.js";import{a as Te}from"./chunk-L75Y42KL.js";import{a as ue}from"./chunk-EHX2YHES.js";import{c as pe,j as de}from"./chunk-DEC3NJ3K.js";import"./chunk-QI74C7BQ.js";import"./chunk-PWIKXZ6E.js";import"./chunk-S52O5BXQ.js";import{a as ce,b as le}from"./chunk-KOJPIKRQ.js";import"./chunk-WL6N6SLT.js";import{a as _e}from"./chunk-HOAF6CDP.js";import"./chunk-34JSETBR.js";import"./chunk-QFTVA365.js";import"./chunk-LNYZIAUP.js";import"./chunk-HYE6JRVA.js";import{a as te,b as ne,c as re,d as ie}from"./chunk-DVVEKPVL.js";import{b as se}from"./chunk-JCTIHYFX.js";import{b as q,c as z,f as Y,h as K,k as X,m as Z,u as ee}from"./chunk-M24M3PNC.js";import{c as ae,d as oe}from"./chunk-4L6P5Z5M.js";import{A as $,G as J,d as Q,e as L,j as H}from"./chunk-JM67XKKX.js";import{$b as w,Bb as l,Cb as p,Db as P,Hb as D,Lb as g,Mb as o,Qb as A,Sb as F,Tb as V,Ub as E,Vb as u,Wb as d,Xb as C,Yb as x,Zb as N,_b as v,ac as y,cb as _,cc as G,db as M,mc as f,na as j,nc as S,oc as W,pc as R,ub as I,wb as T,xa as s,ya as c}from"./chunk-VIO7ZK3G.js";import{a as O,b as k}from"./chunk-3EYC4JTX.js";var fe=["content"],Se=["GLComponent"];function Be(i,h){if(i&1&&(l(0,"span",36),d(1),f(2,"date"),p()),i&2){let r=o(2);_(),x(" ",W(2,1,r.TransferBanches.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function ge(i,h){if(i&1){let r=D();l(0,"div",37,7)(2,"p-calendar",38),y("ngModelChange",function(e){s(r);let t=o(2);return w(t.TransferBanches.DocDate,e)||(t.TransferBanches.DocDate=e),c(e)}),p()()}if(i&2){let r=u(1),n=o(2);_(2),T("showClear",n.TransferBanches.DocDate!=null&&n.TransferBanches.DocDate!="")("appendTo",r)("showOtherMonths",!0),v("ngModel",n.TransferBanches.DocDate),T("showTime",!0)}}function xe(i,h){if(i&1&&(l(0,"small",39),d(1),p()),i&2){let r=o(2);_(),N("Loaded ",r.Branches.length," of ",r._SharedObjectModelService.TotalItems,"")}}function Ie(i,h){if(i&1&&d(0),i&2){let r=h.item;x(" ",r.Name," ")}}function Ce(i,h){if(i&1&&(l(0,"small",39),d(1),p()),i&2){let r=o(2);_(),N("Loaded ",r.FromStorages.length," of ",r._SharedObjectModelService.TotalItems,"")}}function be(i,h){if(i&1&&d(0),i&2){let r=h.item;x(" ",r.Name,`
`)}}function ve(i,h){if(i&1&&(l(0,"small",39),d(1),p()),i&2){let r=o(2);_(),N("Loaded ",r.Branches.length," of ",r._SharedObjectModelService.TotalItems,"")}}function we(i,h){if(i&1&&d(0),i&2){let r=h.item;x(" ",r.Name,`
`)}}function ye(i,h){if(i&1&&(l(0,"small",39),d(1),p()),i&2){let r=o(2);_(),N("Loaded ",r.ToStorages.length," of ",r._SharedObjectModelService.TotalItems,"")}}function De(i,h){if(i&1&&d(0),i&2){let r=h.item;x(" ",r.Name,`
`)}}function Ne(i,h){if(i&1&&(l(0,"small",39),d(1),p()),i&2){let r=o().$implicit,n=o(2);_(),N("Loaded ",r.Items.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Me(i,h){if(i&1&&d(0),i&2){let r=h.item;N(" ",r.Name," - ",r.Code," ")}}function Pe(i,h){if(i&1){let r=D();l(0,"button",50),g("click",function(){s(r);let e=o().index,t=o(2),a=u(4);return c(t.GetItemBalance(e,a))}),P(1,"i",51),p()}if(i&2){let r=o(3);T("disabled",r._AppModeService.DisabledButton)}}function Ae(i,h){if(i&1&&(l(0,"small",39),d(1),p()),i&2){let r=o().$implicit,n=o(2);_(),N("Loaded ",r.ProductUnits.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Fe(i,h){if(i&1&&d(0),i&2){let r=h.item;x(" ",r.Name," ")}}function Ve(i,h){if(i&1){let r=D();l(0,"tr")(1,"td",40)(2,"div",41)(3,"button",42),g("click",function(){let e=s(r).index,t=o(2);return c(t.AppendRow(e))}),d(4,"+"),p(),l(5,"button",43),g("click",function(){let e=s(r).index,t=o(2);return c(t.RemoveRow(e))}),d(6,"-"),p()()(),l(7,"td",44)(8,"ng-select",45,8),f(10,"translate"),g("focus",function(){let e=s(r).index,t=u(9),a=o(2);return a.ChangeSearchApiDetails("Items",t,e),c(a._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(r).index,t=u(9),a=o(2);return a.ChangeSearchApiDetails("Items",t,e),c(a._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(r).index,t=u(9),a=o(2);return c(a.ChangeSearchApiDetails("Items",t,e))})("close",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(r),t=e.$implicit,a=e.index,m=o(2);return c(m.SelectItem(t.ProductId,a))}),y("ngModelChange",function(e){let t=s(r).$implicit;return w(t.ProductId,e)||(t.ProductId=e),c(e)}),I(11,Ne,2,2,"ng-template",22)(12,Me,1,2,"ng-template",23),p(),I(13,Pe,2,1,"button",46),p(),l(14,"td",47)(15,"ng-select",48,9),f(17,"translate"),g("focus",function(){let e=s(r).index,t=u(16),a=o(2);return a.ChangeSearchApiDetails("ItemUnits",t,e),c(a._AppModeService.ResetCurrentPage())})("keyup",function(){let e=s(r).index,t=u(16),a=o(2);return a.ChangeSearchApiDetails("ItemUnits",t,e),c(a._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=s(r).index,t=u(16),a=o(2);return c(a.ChangeSearchApiDetails("ItemUnits",t,e))})("close",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o(2);return c(e._AppModeService.ResetCurrentPage())})("change",function(){let e=s(r),t=e.$implicit,a=e.index,m=o(2);return c(m.SelectUnit(t.ProductUnitId,a))}),y("ngModelChange",function(e){let t=s(r).$implicit;return w(t.ProductUnitId,e)||(t.ProductUnitId=e),c(e)}),I(18,Ae,2,2,"ng-template",22)(19,Fe,1,1,"ng-template",23),p()(),l(20,"td")(21,"input",49),g("change",function(){let e=s(r).index,t=o(2);return c(t.TotalRow(e))})("keyup",function(){let e=s(r).index,t=o(2);return c(t.TotalRow(e))}),y("ngModelChange",function(e){let t=s(r).$implicit;return w(t.Quantity,e)||(t.Quantity=e),c(e)}),p()()()}if(i&2){let r=h.$implicit,n=o(2);_(5),T("disabled",n.TransferBanches.TransferBranchesDetails.length==1),_(3),A("placeholder","  ",S(10,17,"SaleInvoice.ChooseProduct"),""),T("items",r.Items)("dropdownPosition","top")("searchable",!0)("virtualScroll",!0),v("ngModel",r.ProductId),_(5),T("ngIf",r.ProductId>0&&n.TransferBanches.FromStoreId>0&&n.TransferBanches.ToStoreId>0),_(2),A("placeholder","  ",S(17,19,"Item.ItemUnit"),""),T("items",r.ProductUnits)("dropdownPosition","top")("disabled",r.ProductId==0||r.ProductId==null),v("ngModel",r.ProductUnitId),_(6),T("disabled",r.ProductId<=0||r.UnitId<=0),v("ngModel",r.Quantity)}}function Ee(i,h){if(i&1){let r=D();l(0,"button",52),g("click",function(){s(r);let e=o(2);return c(e.Save())}),l(1,"span"),d(2),f(3,"translate"),p()()}i&2&&(_(2),x(" ",S(3,1,"Model.Save"),""))}function Re(i,h){if(i&1){let r=D();l(0,"button",53),g("click",function(){s(r);let e=o(2);return c(e.ResetPage())}),l(1,"span"),d(2),f(3,"translate"),p()()}i&2&&(_(2),x(" ",S(3,1,"Model.New"),""))}function Ue(i,h){if(i&1){let r=D();l(0,"button",54),g("click",function(){s(r);let e=o(2);return c(e.OpenGl())}),d(1),f(2,"translate"),p()}i&2&&(_(),x(" ",S(2,1,"Model.Gl")," "))}function Oe(i,h){if(i&1){let r=D();P(0,"app-modal-header",12),l(1,"div",13)(2,"div",14)(3,"div",15),P(4,"input",16),p(),l(5,"div",15),P(6,"input",16),p(),l(7,"div",15)(8,"p",17),d(9),f(10,"translate"),p(),l(11,"input",18),y("ngModelChange",function(e){s(r);let t=o();return w(t.TransferBanches.Notes,e)||(t.TransferBanches.Notes=e),c(e)}),p()(),l(12,"div",15),I(13,Be,3,4,"span",19)(14,ge,3,5,"div",20),p()(),l(15,"div",14)(16,"div",15)(17,"p",17),d(18),f(19,"translate"),p(),l(20,"ng-select",21,3),g("focus",function(){s(r);let e=u(21),t=o();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=u(21),t=o();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=u(21),t=o();return c(t.ChangeSearchApi("Branch",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.FromBranchId,"FromBranch"))}),y("ngModelChange",function(e){s(r);let t=o();return w(t.TransferBanches.FromBranchId,e)||(t.TransferBanches.FromBranchId=e),c(e)}),I(22,xe,2,2,"ng-template",22)(23,Ie,1,1,"ng-template",23),p()(),l(24,"div",15)(25,"p",24),d(26),f(27,"translate"),p(),l(28,"ng-select",25,4),g("focus",function(){s(r);let e=u(29),t=o();return t.ChangeSearchApi("FromStore",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=u(29),t=o();return t.ChangeSearchApi("FromStore",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=u(29),t=o();return c(t.ChangeSearchApi("FromStore",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.FromStoreId,"FromStore"))}),y("ngModelChange",function(e){s(r);let t=o();return w(t.TransferBanches.FromStoreId,e)||(t.TransferBanches.FromStoreId=e),c(e)}),I(30,Ce,2,2,"ng-template",22)(31,be,1,1,"ng-template",23),p()(),l(32,"div",15)(33,"p",17),d(34),f(35,"translate"),p(),l(36,"ng-select",21,5),g("focus",function(){s(r);let e=u(37),t=o();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=u(37),t=o();return t.ChangeSearchApi("Branch",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=u(37),t=o();return c(t.ChangeSearchApi("Branch",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.ToBranchId,"ToBranch"))}),y("ngModelChange",function(e){s(r);let t=o();return w(t.TransferBanches.ToBranchId,e)||(t.TransferBanches.ToBranchId=e),c(e)}),I(38,ve,2,2,"ng-template",22)(39,we,1,1,"ng-template",23),p()(),l(40,"div",15)(41,"p",17),d(42),f(43,"translate"),p(),l(44,"ng-select",26,6),g("focus",function(){s(r);let e=u(45),t=o();return t.ChangeSearchApi("ToStore",e),c(t._AppModeService.ResetCurrentPage())})("keyup",function(){s(r);let e=u(45),t=o();return t.ChangeSearchApi("ToStore",e),c(t._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){s(r);let e=u(45),t=o();return c(t.ChangeSearchApi("ToStore",e))})("close",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("open",function(){s(r);let e=o();return c(e._AppModeService.ResetCurrentPage())})("change",function(){s(r);let e=o();return c(e.SelectValue(e.TransferBanches.ToStoreId,"ToStore"))}),y("ngModelChange",function(e){s(r);let t=o();return w(t.TransferBanches.ToStoreId,e)||(t.TransferBanches.ToStoreId=e),c(e)}),I(46,ye,2,2,"ng-template",22)(47,De,1,1,"ng-template",23),p()()(),l(48,"table",27)(49,"thead")(50,"tr")(51,"th",28),d(52,"#"),p(),l(53,"th",29),d(54),f(55,"translate"),p(),l(56,"th",29),d(57),f(58,"translate"),p(),l(59,"th",29),d(60),f(61,"translate"),p()()(),l(62,"tbody"),I(63,Ve,22,21,"tr",30),p()()(),l(64,"div",31),I(65,Ee,4,3,"button",32)(66,Re,4,3,"button",33)(67,Ue,3,3,"button",34),l(68,"button",35),g("click",function(){let e=s(r).$implicit,t=o();return e.close("Close click"),c(t.ResetPage())}),d(69),f(70,"translate"),p()()}if(i&2){let r=o();T("PageTitle","TransferBanches.TransferBanches"),_(4),T("disabled",!0)("value",r.TransferBanches.DocNoFrom),_(2),T("disabled",!0)("value",r.TransferBanches.DocNoTo),_(3),C(S(10,43,"Table.Notes")),_(2),v("ngModel",r.TransferBanches.Notes),_(2),T("ngIf",(r._DefaultSettingsService.DefaultSettings==null?null:r._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),_(),T("ngIf",(r._DefaultSettingsService.DefaultSettings==null?null:r._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),_(4),C(S(19,45,"TransferBanches.BranchFrom")),_(2),T("items",r.Branches)("autofocus",!1)("virtualScroll",!0)("searchable",!0),v("ngModel",r.TransferBanches.FromBranchId),_(6),C(S(27,47,"TransferStorage.FromStoreId")),_(2),T("items",r.FromStorages)("autofocus",!1)("virtualScroll",!0)("disabled",r.TransferBanches.FromBranchId==null)("searchable",!0),v("ngModel",r.TransferBanches.FromStoreId),_(6),C(S(35,49,"TransferBanches.BranchTo")),_(2),T("items",r.Branches)("autofocus",!1)("virtualScroll",!0)("searchable",!0),v("ngModel",r.TransferBanches.ToBranchId),_(6),C(S(43,51,"TransferStorage.ToStoreId")),_(2),T("items",r.ToStorages)("autofocus",!1)("virtualScroll",!0)("searchable",!0)("disabled",r.TransferBanches.ToBranchId==null),v("ngModel",r.TransferBanches.ToStoreId),_(10),C(S(55,53,"TransferStorage.Name")),_(3),C(S(58,55,"SaleInvoice.Units")),_(3),C(S(61,57,"TransferStorage.Quantity")),_(3),T("ngForOf",r.TransferBanches.TransferBranchesDetails),_(2),T("ngIf",r.TransferBanches.Id==0),_(),T("ngIf",r.TransferBanches.Id>0),_(),T("ngIf",r.TransferBanches.Id>0),_(2),C(S(70,59,"Model.Close"))}}function ke(i,h){if(i&1&&(l(0,"tr")(1,"td"),d(2),p(),l(3,"td"),d(4),p()()),i&2){let r=h.$implicit;_(2),x(" ",r.Name," "),_(2),x(" ",r.Qty," ")}}function je(i,h){if(i&1&&(l(0,"tr")(1,"td"),d(2),p(),l(3,"td"),d(4),p()()),i&2){let r=h.$implicit;_(2),x(" ",r.Name," "),_(2),x(" ",r.Qty," ")}}function Ge(i,h){if(i&1&&(l(0,"div",55)(1,"p",56),d(2),f(3,"translate"),p(),l(4,"table",57)(5,"thead")(6,"tr")(7,"th"),d(8),f(9,"translate"),p(),l(10,"th"),d(11),f(12,"translate"),p()()(),l(13,"tbody"),I(14,ke,5,2,"tr",30),p()(),l(15,"p",56),d(16),f(17,"translate"),p(),l(18,"table",57)(19,"thead")(20,"tr")(21,"th"),d(22),f(23,"translate"),p(),l(24,"th"),d(25),f(26,"translate"),p()()(),l(27,"tbody"),I(28,je,5,2,"tr",30),p()()()),i&2){let r=o();_(2),x(" ",S(3,8,"TransferStorage.BalanceFrom")," "),_(6),C(S(9,10,"SaleInvoice.Name")),_(3),C(S(12,12,"Table.Balance")),_(3),T("ngForOf",r.ItemBalanceFrom),_(2),x(" ",S(17,14,"TransferStorage.BalanceTo")," "),_(6),C(S(23,16,"SaleInvoice.Name")),_(3),C(S(26,18,"Table.Balance")),_(3),T("ngForOf",r.ItemBalanceTo)}}var _t=(()=>{let h=class h{constructor(n,e,t,a,m){this._ActivatedRoute=n,this._AppModeService=e,this._SharedObjectModelService=t,this._DefaultSettingsService=a,this._Apiservice=m,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"TransferBranches",Join:!0,JoinTables:["Storages SF","Storages ST"],JoinConditions:["T.FromStoreId = SF.Id","T.ToStoreId = ST.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","T.FromBranchName","SF.Name AS FromStoreName","T.ToBranchName","ST.Name AS ToStoreName"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"FromBranchName",CellName:"TransferBanches.BranchFrom"},{SortName:"FromStoreName",CellName:"TransferStorage.FromStoreId",ExistSearchField:"SF.Name"},{SortName:"ToBranchName",CellName:"TransferBanches.BranchTo"},{SortName:"ToStoreName",CellName:"TransferStorage.ToStoreId",ExistSearchField:"ST.Name"},{SortName:"Notes",CellName:"Table.Notes"}]},this.SubscriptionArr=[],this.Branches=[],this.ToStorages=[],this.FromStorages=[],this.TransferBanches={DocNo:0,DocDate:"",DocNoTo:0,DocNoFrom:0,TransferBranchesDetails:[{ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0}],FromStoreId:null,FromStoreName:"",FromBranchId:null,FromBranchName:"",ToBranchId:null,ToBranchName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,TotalPrice:0,Id:0,Name:"",Code:""},this.ItemBalanceFrom=[],this.ItemBalanceTo=[]}ngOnInit(){let n=Number(this._ActivatedRoute.snapshot.queryParams.Id);n>0&&this.GetByIdRoute(n),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(n){let e=this._Apiservice.getById("TransferBranchesEP/GetById",n,!0).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this._SharedObjectModelService.PageModel=t.Obj.model,this._SharedObjectModelService.Gl=t.Obj.Gl,this.Drow(this._SharedObjectModelService.PageModel),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(t.Message)}});this.SubscriptionArr.push(e)}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(n){this.TransferBanches={Id:n.Id,DocNo:n.DocNo,DocDate:new Date(`${n.DocDate}`),DocNoTo:n.DocNoTo,DocNoFrom:n.DocNoFrom,FromStoreId:n.FromStoreId,FromBranchId:n.FromBranchId,ToBranchId:n.ToBranchId,ToStoreId:n.ToStoreId,TotalQty:n.TotalQty,TotalPrice:n.TotalPrice,TransferBranchesDetails:n.TransferBranchesDetails},this.Branches=[],this.Branches.push({Id:n.FromBranchId,Name:n.FromBranchName}),this.Branches.push({Id:n.ToBranchId,Name:n.ToBranchName}),this.FromStorages.push({Id:n.FromStoreId,Name:n.FromStoreName}),this.ToStorages.push({Id:n.ToStoreId,Name:n.ToStoreName});for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++){let t=this.TransferBanches.TransferBranchesDetails[e];t.Items=[{Id:t.ProductId,Name:t.ProductName,NameAndCode:t.ProductName}],t.ProductUnits=[{Id:t.ProductUnitId,Name:t.ProductUnitName}]}}OpenModal(){this.ResetPage()}OpenGl(){this.GLComponent.Open()}ChangeSearchApi(n,e){let t=`${e.searchTerm}`.trim();(t==""||t=="null")&&(e.searchTerm="",t=""),this._AppModeService.CurrentPage+=1;let a={TableName:n,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:t,SearchField:"Name"};n=="FromStore"&&(a.TableName="Storages",a.Conditions=`BranchId = ${this.TransferBanches.FromBranchId}`),n=="ToStore"&&(a.TableName="Storages",a.Conditions=`BranchId = ${this.TransferBanches.ToBranchId}`);let m=this._Apiservice.post("Global/GetAll",a,!1).subscribe({next:B=>{B.IsSuccess==!0&&B.Obj!=null?this.HandleResponse(B.Obj,n):this._AppModeService._Toastr.error(B.Message)}});this.SubscriptionArr.push(m)}HandleResponse(n,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=n.TotalItems,e=="FromStore"&&(this.FromStorages=this._SharedObjectModelService.RemoveDuplicates(this.FromStorages.concat(n.DataReturn),"Id")),e=="ToStore"&&(this.ToStorages=this._SharedObjectModelService.RemoveDuplicates(this.ToStorages.concat(n.DataReturn),"Id")),e=="Branch"&&(this.Branches=this._SharedObjectModelService.RemoveDuplicates(this.Branches.concat(n.DataReturn),"Id"))}SelectValue(n,e){if(n!=null&&(n>0||n!="")){let t=[];e=="FromStore"&&(t=this.FromStorages),e=="ToStore"&&(t=this.ToStorages),(e=="FromBranch"||e=="ToBranch")&&(t=this.Branches);let a=t.find(m=>m.Id==n);if(a==null){this._AppModeService.DontPlay();return}else this.TransferBanches[`${e}Id`]=n,this.TransferBanches[`${e}Name`]=a.Name,(e=="FromBranch"||e=="ToBranch")&&(this.GetDocNo(),e=="ToBranch"&&(this.TransferBanches.ToStoreId=null,this.ToStorages=[]),e=="FromBranch"&&(this.TransferBanches.FromStoreId=null,this.FromStorages=[],this.ResetWa()))}else this.TransferBanches[`${e}Id`]=null,this.TransferBanches[`${e}Name`]="",e=="ToBranch"&&(this.TransferBanches.DocNoTo=0,this.ToStorages=[],this.TransferBanches.ToStoreId=null),e=="FromBranch"&&(this.TransferBanches.DocNoFrom=0,this.FromStorages=[],this.TransferBanches.FromStoreId=null)}ResetWa(){}ChangeSearchApiDetails(n,e,t){let a=`${e.searchTerm}`.trim();(a==""||a=="null")&&(e.searchTerm="",a=""),this._AppModeService.CurrentPage+=1;let m={TableName:n,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:a,SearchField:"Name"};if(n=="Items"&&(m.Columns=["Id","Name","Code"],m.Conditions="ProductType != 2"),n=="ItemUnits"){let b=this.TransferBanches.TransferBranchesDetails[t].ProductId==null?0:this.TransferBanches.TransferBranchesDetails[t].ProductId;m.Conditions=`ItemId = ${b}`,m.Join=!0,m.JoinTables=["Units U"],m.JoinConditions=["T.UnitId = U.Id"],m.Columns=["T.Id","U.Name","T.Code"],m.SearchField="U.Name"}let B=this._Apiservice.post("Global/GetAll",m,!1).subscribe({next:b=>{b.IsSuccess==!0&&b.Obj!=null?this.HandleResponseDetails(b.Obj,n,t):this._AppModeService._Toastr.error(b.Message)}});this.SubscriptionArr.push(B)}HandleResponseDetails(n,e,t){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=n.TotalItems,e=="Items"&&(this.TransferBanches.TransferBranchesDetails[t].Items=this._SharedObjectModelService.RemoveDuplicates(this.TransferBanches.TransferBranchesDetails[t].Items.concat(n.DataReturn),"Id"),this.TransferBanches.TransferBranchesDetails[t].Items=this.TransferBanches.TransferBranchesDetails[t].Items.map(a=>k(O({},a),{NameAndCode:a.Code!=null?`${a.Name} - ${a.Code}`:`${a.Name}`}))),e=="ItemUnits"&&(this.TransferBanches.TransferBranchesDetails[t].ProductUnits=n.DataReturn)}SelectItem(n,e){if(n!=null&&n>0){let t=this.TransferBanches.TransferBranchesDetails[e].Items.find(a=>a.Id==n);if(t!=null)this.TransferBanches.TransferBranchesDetails[e].ProductId=t.Id,this.TransferBanches.TransferBranchesDetails[e].ProductName=t.Name,this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=null,this.TransferBanches.TransferBranchesDetails[e].ProductUnits=[],this.AfterSelectem(t.Id,e);else{this._Apiservice.DontPlay();return}}else this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=null,this.TransferBanches.TransferBranchesDetails[e].ProductUnits=[]}AfterSelectem(n,e){if(n>0){let t={TableName:"ItemUnits",Columns:["Id","Name"],CurrentPage:1,PageSize:1,SearchText:"",SearchField:"Name"};t.Conditions=`ItemId = ${n}`,t.Join=!0,t.JoinTables=["Units U"],t.JoinConditions=["T.UnitId = U.Id"],t.Columns=["T.Id","U.Name","T.Code"],t.SearchField="U.Name";let a=this._Apiservice.post("Global/GetAll",t,!1).subscribe({next:m=>{if(m.IsSuccess==!0&&m.Obj!=null){let B=m.Obj.DataReturn[0];B!=null&&(this.TransferBanches.TransferBranchesDetails[e].ProductUnits=m.Obj.DataReturn,this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=B.Id,this.TransferBanches.TransferBranchesDetails[e].Quantity=1)}else this._AppModeService._Toastr.error(m.Message)}});this.SubscriptionArr.push(a)}}SelectUnit(n,e){if(n!=null&&n>0){let t=this.TransferBanches.TransferBranchesDetails[e].ProductUnits.find(a=>a.Id==n);if(t!=null)this.TransferBanches.TransferBranchesDetails[e].ProductUnitId=t.Id,this.TransferBanches.TransferBranchesDetails[e].ProductUnitName=t.Name,this.UnitWa(t.Id,e);else{this._Apiservice.DontPlay();return}}}UnitWa(n,e){}StartConnection(){this.Hub_Connection=new me().withUrl(`${q.signalrUrl}/TransferBranches`,{skipNegotiation:!0,transport:he.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(n=>{console.log("Error Hub Connection",n)})}GetDocNo(){let n=this.TransferBanches.FromBranchId==null?0:this.TransferBanches.FromBranchId,e=this.TransferBanches.ToBranchId==null?0:this.TransferBanches.ToBranchId,t=this._Apiservice.get(`TransferBranchesEP/GetPageInfo?FromBranchId=${n}&ToBranchId=${e}`).subscribe({next:a=>{a.IsSuccess==!0&&a.Obj!=null?(this.TransferBanches.DocNoFrom=a.Obj.FromDocNo,this.TransferBanches.DocNoTo=a.Obj.ToDocNo):this._AppModeService._Toastr.error(a.Message)}});this.SubscriptionArr.push(t)}AppendRow(n){let e={ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0};return this.TransferBanches.TransferBranchesDetails.push(e),!0}RemoveRow(n){return this.TransferBanches.TransferBranchesDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.TransferBanches.TransferBranchesDetails.splice(n,1),this.TotalTransfer(),!0)}GetItemBalance(n,e){let t=this.TransferBanches.TransferBranchesDetails[n];if(this.TransferBanches.ToStoreId==0||this.TransferBanches.ToStoreId==null||this.TransferBanches.FromStoreId==0||this.TransferBanches.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.EnterStore"));return}if(t.ProductId==0||t.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.SelectItem"));return}let a={ProductId:t.ProductId,FromStoreId:this.TransferBanches.FromStoreId,ToStoreId:this.TransferBanches.ToStoreId,BranchId:this.TransferBanches.FromBranchId,SecoundBranchId:this.TransferBanches.ToBranchId},m=this._Apiservice.post("ItemEP/ProductBalance",a,!0).subscribe({next:B=>{B.IsSuccess==!0&&B.Obj!=null?(this.ItemBalanceFrom=B.Obj.BalanceFrom,this.ItemBalanceTo=B.Obj.BalanceTo,this._AppModeService._NgbModal.open(e,{size:"xl",centered:!0})):this._AppModeService._Toastr.error(B.Message)}});this.SubscriptionArr.push(m)}TotalRow(n){let e=Number(this.TransferBanches.TransferBranchesDetails[n].Price),t=Number(this.TransferBanches.TransferBranchesDetails[n].Quantity);return this.TransferBanches.TransferBranchesDetails[n].TotalPrice=Number(e*t),this.TotalTransfer(),Number(e*t)}TotalTransfer(){let n=0;for(let e=0;e<this.TransferBanches.TransferBranchesDetails.length;e++)n+=Number(this.TransferBanches.TransferBranchesDetails[e].Price)*Number(this.TransferBanches.TransferBranchesDetails[e].Quantity);return this.TransferBanches.TotalPrice=Number(n),Number(n)}Save(){if(this.TransferBanches.DocDate==""||this.TransferBanches.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate"));return}if(this.TransferBanches.FromBranchId==0||this.TransferBanches.FromBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.EnterFromBranchId"));return}if(this.TransferBanches.FromStoreId==0||this.TransferBanches.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.FromStoreId"));return}if(this.TransferBanches.ToBranchId==0||this.TransferBanches.ToBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.EnterToBranchId"));return}if(this.TransferBanches.ToStoreId==0||this.TransferBanches.ToStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.ToStoreId"));return}if(this.TransferBanches.FromBranchId==0||this.TransferBanches.ToBranchId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.ToFrom"));return}if(this.TransferBanches.DocNoFrom<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.DocNoFrom"));return}if(this.TransferBanches.DocNoTo<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.DocNoTo"));return}if(this.TransferBanches.FromBranchId==this.TransferBanches.ToBranchId){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferBanches.Error.SameBranch"));return}for(let t=0;t<this.TransferBanches.TransferBranchesDetails.length;t++){let a=t,m=Number(this.TransferBanches.TransferBranchesDetails[t].ProductId),B=Number(this.TransferBanches.TransferBranchesDetails[t].Quantity);this.TransferBanches.TransferBranchesDetails[t].Price=0;let b=Number(this.TransferBanches.TransferBranchesDetails[t].ProductUnitId);if(m==null||m==null||m<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}if(b==null||b==null||b<=0||isNaN(b)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterUnit"));return}if(this.TransferBanches.TransferBranchesDetails.filter(U=>U.ProductId==m&&U.ProductUnitId==b).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(a+1));return}if(B==null||B==null||isNaN(B)||B<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterQuantity"));return}}let n={DocNo:this.TransferBanches.DocNo,DocDate:this._Apiservice.ConvertISODate(this.TransferBanches.DocDate),DocNoFrom:this.TransferBanches.DocNoFrom,DocNoTo:this.TransferBanches.DocNoTo,TransferBranchesDetails:this.TransferBanches.TransferBranchesDetails,FromStoreId:this.TransferBanches.FromStoreId,FromStoreName:this.TransferBanches.FromStoreName,FromBranchId:this.TransferBanches.FromBranchId,FromBranchName:this.TransferBanches.FromBranchName,ToBranchId:this.TransferBanches.ToBranchId,ToBranchName:this.TransferBanches.ToBranchName,ToStoreId:this.TransferBanches.ToStoreId,ToStoreName:this.TransferBanches.ToStoreName,TotalQty:this.TransferBanches.TotalQty,TotalPrice:this.TransferBanches.TotalPrice,Id:0,Name:"",Code:""},e=this._Apiservice.post("TransferBranchesEP/Add",n,!0).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this._SharedObjectModelService.Paging.DataReturn.push(t.Obj)):this._AppModeService._Toastr.error(t.Message)}});this.SubscriptionArr.push(e)}ResetPage(){this.TransferBanches={DocNo:0,DocDate:"",DocNoTo:0,DocNoFrom:0,TransferBranchesDetails:[{ProductType:0,Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:"",Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:"",Balance:0}],FromStoreId:null,FromStoreName:"",FromBranchId:null,FromBranchName:"",ToBranchId:null,ToBranchName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,TotalPrice:0,Id:0,Name:"",Code:""},this._DefaultSettingsService.ResetDate(this.TransferBanches)}ServerListener(){this.Hub_Connection?.on("AddTransferBranches",n=>{this.GetDocNo()})}ngOnDestroy(){for(let n=0;n<this.SubscriptionArr.length;n++)this.SubscriptionArr[n].unsubscribe()}};h.\u0275fac=function(e){return new(e||h)(M($),M(se),M(_e),M(ue),M(z))},h.\u0275cmp=j({type:h,selectors:[["app-transfer-banches"]],viewQuery:function(e,t){if(e&1&&(F(fe,5),F(Se,5)),e&2){let a;V(a=E())&&(t.ContentModel=a.first),V(a=E())&&(t.GLComponent=a.first)}},standalone:!0,features:[G],decls:7,vars:7,consts:[["content",""],["ItemBalance",""],["GLComponent",""],["SelectFromBranch",""],["SelectFromStore",""],["SelectToBranch",""],["SelectToStore",""],["ddddd",""],["SelectItem22",""],["SelectUnits",""],[3,"ShowToEditeEvent","OpenModalEvent","PageTitle","TablePaging","GlResponse","GetById","DeleteUrl","PrintUrl","OutModal"],[1,"col-8"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-end","col-12","pt-2"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","px-1"],["type","number","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"my-1"],["type","text","name","DocDate","id","DocDate",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block col-12 text-center",4,"ngIf"],["class","formdate",4,"ngIf"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["for","FromStoreId",1,"my-1"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","disabled","searchable","ngModel"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","disabled","ngModel"],[1,"table","table-hover","table-striped","table-light","mt-4","mb-0"],[1,"col-1"],[1,"col-2"],[4,"ngFor","ngForOf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],["class","btn btn-success py-3 px-5",3,"click",4,"ngIf"],["class","btn btn-primary py-3 px-5",3,"click",4,"ngIf"],["class","btn btn-info mx-3 py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-secondary","py-3","px-5",3,"click"],[1,"d-block","col-12","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","showClear","appendTo","showOtherMonths","ngModel","showTime"],[1,"form-text","text-muted"],[1,"Flex1"],[1,"d-flex","justify-content-center","align-items-center"],[1,"col-5","mx-auto","btn","btn-success",3,"click"],[1,"col-5","mx-auto","btn","btn-danger",3,"click","disabled"],[1,"ngSelect","d-flex"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-11",3,"focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["class","col-1 d-block text-center btn btn-info py-0 px-2 mx-2",3,"disabled","click",4,"ngIf"],[1,"ngSelect"],["bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","disabled","ngModel"],["name","Quantity","type","number",1,"form-control","text-center",3,"change","keyup","ngModelChange","disabled","ngModel"],[1,"col-1","d-block","text-center","btn","btn-info","py-0","px-2","mx-2",3,"click","disabled"],[1,"fa-solid","fa-eye","d-block","mx-auto"],[1,"btn","btn-success","py-3","px-5",3,"click"],[1,"btn","btn-primary","py-3","px-5",3,"click"],[1,"btn","btn-info","mx-3","py-3","px-5",3,"click"],[1,"modal-body"],[1,"my-2","text-center"],[1,"table","table-striped","table-hover"]],template:function(e,t){if(e&1){let a=D();l(0,"app-dynamic-component",10),g("ShowToEditeEvent",function(){return s(a),c(t.ShowToEdite())})("OpenModalEvent",function(){return s(a),c(t.OpenModal())}),p(),I(1,Oe,71,61,"ng-template",null,0,R)(3,Ge,29,20,"ng-template",11,1,R),P(5,"app-glsheard",null,2)}if(e&2){let a=u(2);T("PageTitle","TransferBanches.TransferBanches")("TablePaging",t.TablePaging)("GlResponse",!0)("GetById","TransferBranchesEP/GetById")("DeleteUrl","TransferBranchesEP/Delete")("PrintUrl","TransferBranches")("OutModal",a)}},dependencies:[le,ce,H,J,ie,re,te,ne,L,Q,ee,Y,Z,K,X,oe,ae,de,Te,pe]});let i=h;return i})();export{_t as TransferBanchesComponent};
