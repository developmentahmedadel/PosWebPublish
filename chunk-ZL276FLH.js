import{a as Se}from"./chunk-3UDBFBON.js";import{b as _e,j as ue}from"./chunk-A6MDEMU4.js";import"./chunk-3ZAIJ4IV.js";import"./chunk-Y5QDR55A.js";import{a as de}from"./chunk-VSYXDL23.js";import{g as oe,h as ae,o as ce,s as se,x as pe}from"./chunk-BHSN7HFD.js";import{b as le}from"./chunk-6BJKXUWP.js";import"./chunk-3Y7UQ2M3.js";import{a as me}from"./chunk-BHTRH7BV.js";import{g as re}from"./chunk-VUX2NRX2.js";import"./chunk-RXBBGPQB.js";import"./chunk-GEJP5WQO.js";import"./chunk-GNF256I6.js";import{a as Z,b as ee,c as te,d as ne}from"./chunk-MZIKAFPE.js";import"./chunk-EGE4BGUH.js";import{k as ie}from"./chunk-RVJIMCIT.js";import{c as Y}from"./chunk-ITQ57RKD.js";import{c as L,d as z}from"./chunk-KALZ37GW.js";import{c as U,f as H,h as K,k as J,m as Q,s as q,u as X}from"./chunk-N4FWSTCP.js";import{e as W,j as $}from"./chunk-VTADEU6K.js";import{$b as M,Cb as a,Db as o,Eb as b,Ib as C,Mb as I,Nb as c,Wb as f,X as T,Xb as s,Yb as v,Zb as x,_b as A,ac as N,bc as D,db as l,dc as k,eb as P,ec as G,na as R,nc as S,oc as g,pc as j,qc as F,vb as y,xa as p,xb as u,ya as m,z as O}from"./chunk-J5UB44FZ.js";import{a as V,b as B}from"./chunk-3EYC4JTX.js";var ve=()=>["Name","TotalQty","Wa","TotaPrice"];function Ie(r,_){if(r&1&&(a(0,"small",38),s(1),o()),r&2){let n=c(2);l(),A("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function he(r,_){if(r&1&&s(0),r&2){let n=_.item;x(" ",n.Name," ")}}function xe(r,_){if(r&1&&(a(0,"small",38),s(1),o()),r&2){let n=c(2);l(),A("Loaded ",n.Groups.length," of ",n._SharedObjectModelService.TotalItems,"")}}function ye(r,_){if(r&1&&s(0),r&2){let n=_.item;x(" ",n.Name," ")}}function fe(r,_){if(r&1&&(a(0,"small",38),s(1),o()),r&2){let n=c(2);l(),A("Loaded ",n.Items.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Ce(r,_){if(r&1&&s(0),r&2){let n=_.item;x(" ",n.NameAndCode," ")}}function Te(r,_){if(r&1){let n=C();a(0,"div",39)(1,"p-button",40),I("onClick",function(){p(n);let e=c(2);return m(e.ExpandAll())}),o(),a(2,"p-button",41),I("onClick",function(){p(n);let e=c(2);return m(e.CollapseAll())}),o()()}}function be(r,_){r&1&&(a(0,"tr")(1,"th"),s(2),S(3,"translate"),o(),a(4,"th"),s(5),S(6,"translate"),o(),a(7,"th"),s(8),S(9,"translate"),o(),a(10,"th"),s(11),S(12,"translate"),o(),a(13,"th"),s(14),S(15,"translate"),o(),a(16,"th"),s(17),S(18,"translate"),o(),a(19,"th"),s(20),S(21,"translate"),o(),a(22,"th"),s(23,"-"),o()()),r&2&&(l(2),v(g(3,7,"Table.Units")),l(3),v(g(6,9,"Table.Name")),l(3),v(g(9,11,"Table.BalanceDaftare")),l(3),v(g(12,13,"Table.BalanceNow")),l(3),v(g(15,15,"Table.WA")),l(3),v(g(18,17,"Table.Amount")),l(3),v(g(21,19,"Table.Status")))}function we(r,_){if(r&1&&b(0,"p-button",51),r&2){let n=c(),t=n.$implicit,e=n.expanded,i=c(2);u("pRowToggler",t)("text",!0)("rounded",!0)("plain",!0)("icon",e?"pi pi-chevron-down":i._Apiservice.Language=="ar"?"pi pi-chevron-left":"pi pi-chevron-right")}}function Me(r,_){r&1&&(a(0,"span",52),s(1," \u0645\u062A\u0633\u0627\u0648\u064A "),o())}function Ne(r,_){r&1&&(a(0,"span",53),s(1," \u0639\u062C\u0632 "),o())}function De(r,_){r&1&&(a(0,"span",54),s(1," \u0641\u0627\u0626\u0636 "),o())}function Pe(r,_){if(r&1){let n=C();a(0,"span",55)(1,"button",56),I("click",function(){p(n);let e=c().$implicit,i=c(2);return e.InventoryType=1,m(i.Calc())}),s(2," \u0637\u0628\u064A\u0639\u064A "),o(),a(3,"button",57),I("click",function(){p(n);let e=c().$implicit,i=c(2);return e.InventoryType=2,m(i.Calc())}),s(4," \u063A\u064A\u0631 \u0637\u0628\u064A\u0639\u064A "),o()()}if(r&2){let n=c().$implicit;l(),u("disabled",n.InventoryType==1),l(2),u("disabled",n.InventoryType==2)}}function Ae(r,_){if(r&1){let n=C();a(0,"button",58),I("click",function(){p(n);let e=c().$implicit,i=c(2);return m(i.RemoveProcut(e))}),b(1,"i",59),o()}}function Ee(r,_){if(r&1){let n=C();a(0,"tr")(1,"td"),y(2,we,1,5,"p-button",42),o(),a(3,"td")(4,"span",43),s(5),o()(),a(6,"td")(7,"span",43),s(8),o()(),a(9,"td")(10,"input",44),I("keyup",function(){p(n);let e=c(2);return m(e.Calc())})("change",function(){p(n);let e=c(2);return m(e.Calc())})("change",function(){let e=p(n).$implicit,i=c(2);return m(i.ConvertNumber(e.BalanceNow)==e.BalanceDocument?e.InventoryType=0:e.InventoryType=e.InventoryType)}),D("ngModelChange",function(e){let i=p(n).$implicit;return N(i.BalanceNow,e)||(i.BalanceNow=e),m(e)}),o()(),a(11,"td")(12,"span",43),s(13),o()(),a(14,"td")(15,"span",43),s(16),o()(),a(17,"td",45),y(18,Me,2,0,"span",46)(19,Ne,2,0,"span",47)(20,De,2,0,"span",48)(21,Pe,5,2,"span",49),o(),a(22,"td"),y(23,Ae,2,0,"button",50),o()()}if(r&2){let n=_.$implicit,t=c(2);l(2),u("ngIf",t.Inventory.Id==0),l(3),x(" ",n.ProductName,""),l(3),x(" ",n.BalanceDocument.toFixed(2)," "),l(2),u("disabled",t.Inventory.Id>0),M("ngModel",n.BalanceNow),l(3),x(" ",n.WADocument.toFixed(2)," "),l(3),x(" ",n.TotaPriceDocument.toFixed(2)," "),l(2),u("ngIf",t.ConvertNumber(n.BalanceNow)==n.BalanceDocument),l(),u("ngIf",t.ConvertNumber(n.BalanceNow)<n.BalanceDocument),l(),u("ngIf",t.ConvertNumber(n.BalanceNow)>n.BalanceDocument),l(),u("ngIf",t.ConvertNumber(n.BalanceNow)<n.BalanceDocument),l(2),u("ngIf",t.Inventory.Id==0)}}function Ve(r,_){r&1&&(a(0,"tr")(1,"th"),s(2),S(3,"translate"),o(),a(4,"th"),s(5),S(6,"translate"),o()()),r&2&&(l(2),x("",g(3,2,"Table.Name")," "),l(3),v(g(6,4,"Table.Quantity")))}function Be(r,_){if(r&1&&(a(0,"tr")(1,"td")(2,"span",43),s(3),o()(),a(4,"td")(5,"span",43),s(6),o()()()),r&2){let n=_.$implicit;l(3),x(" ",n.UnitName," "),l(3),x(" ",n.Qty," ")}}function Oe(r,_){if(r&1&&(a(0,"tr")(1,"td",60)(2,"p-table",61),y(3,Ve,7,6,"ng-template",30)(4,Be,7,2,"ng-template",31),o()()()),r&2){let n=_.$implicit;l(2),u("value",n.ItemUnits)}}function Re(r,_){if(r&1){let n=C();a(0,"p-paginator",62),I("onPageChange",function(e){p(n);let i=c(2);return m(i.onPageChange(e))}),o()}if(r&2){let n=c(2);u("first",n._SharedObjectModelService.Paging.CurrentPage)("rows",n._SharedObjectModelService.Paging.PageSize)("totalRecords",n._SharedObjectModelService.Paging.TotalItems)("rowsPerPageOptions",n._AppModeService.RowCount)}}function ke(r,_){if(r&1){let n=C();a(0,"p-paginator",63),I("onPageChange",function(e){p(n);let i=c(2);return m(i.onPageChange(e))}),o()}if(r&2){let n=c(2);u("first",n._SharedObjectModelService.Paging.CurrentPage)("rows",n._SharedObjectModelService.Paging.PageSize)("totalRecords",n._SharedObjectModelService.Paging.TotalItems)}}function Ge(r,_){if(r&1){let n=C();a(0,"button",23),I("click",function(){p(n);let e=c(2);return m(e.Save())}),a(1,"span"),s(2),S(3,"translate"),o(),b(4,"i",64),o()}r&2&&(l(2),x(" ",g(3,1,"Model.Save"),""))}function je(r,_){if(r&1){let n=C();b(0,"app-modal-header",6),a(1,"div",7)(2,"div",8)(3,"div",9)(4,"label",10),s(5),S(6,"translate"),o(),b(7,"input",11),o(),a(8,"div",12)(9,"label",13),s(10),S(11,"translate"),o(),a(12,"input",14),D("ngModelChange",function(e){p(n);let i=c();return N(i.Inventory.Notes,e)||(i.Inventory.Notes=e),m(e)}),o()(),a(13,"div",12)(14,"span",15),s(15),S(16,"date"),o()(),a(17,"div",12)(18,"p",16),s(19),S(20,"translate"),o(),a(21,"ng-select",17,1),I("clear",function(){p(n);let e=c();return m(e.Storages=[])})("focus",function(){p(n);let e=f(22),i=c();return i.ChangeSearchApi("Storages",e),m(i._AppModeService.ResetCurrentPage())})("keyup",function(){p(n);let e=f(22),i=c();return i.ChangeSearchApi("Storages",e),m(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(n);let e=f(22),i=c();return m(i.ChangeSearchApi("Storages",e))})("close",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(n);let e=c();return e.SelectValue(e.SearchModel.StoreId,"Store"),m(e.ResetPage())}),D("ngModelChange",function(e){p(n);let i=c();return N(i.SearchModel.StoreId,e)||(i.SearchModel.StoreId=e),m(e)}),y(23,Ie,2,2,"ng-template",18)(24,he,1,1,"ng-template",19),o()(),a(25,"div",12)(26,"p"),s(27),S(28,"translate"),o(),a(29,"ng-select",17,2),I("clear",function(){p(n);let e=c();return m(e.Groups=[])})("focus",function(){p(n);let e=f(30),i=c();return i.ChangeSearchApi("ItemGroups",e),m(i._AppModeService.ResetCurrentPage())})("keyup",function(){p(n);let e=f(30),i=c();return i.ChangeSearchApi("ItemGroups",e),m(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(n);let e=f(30),i=c();return m(i.ChangeSearchApi("ItemGroups",e))})("close",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(n);let e=c();return e.SelectValue(e.SearchModel.GroupId,"Group"),e.SearchModel.ProductId=null,m(e.ResetPage())}),D("ngModelChange",function(e){p(n);let i=c();return N(i.SearchModel.GroupId,e)||(i.SearchModel.GroupId=e),m(e)}),y(31,xe,2,2,"ng-template",18)(32,ye,1,1,"ng-template",19),o()(),a(33,"div",12)(34,"label",20),s(35),S(36,"translate"),o(),a(37,"ng-select",21,3),I("clear",function(){p(n);let e=c();return m(e.Items=[])})("focus",function(){p(n);let e=f(38),i=c();return i.ChangeSearchApi("Items",e),m(i._AppModeService.ResetCurrentPage())})("keyup",function(){p(n);let e=f(38),i=c();return i.ChangeSearchApi("Items",e),m(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(n);let e=f(38),i=c();return m(i.ChangeSearchApi("Items",e))})("close",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c();return m(e._AppModeService.ResetCurrentPage())})("change",function(){p(n);let e=c();return e.SelectValue(e.SearchModel.ProductId,"Product"),e.SearchModel.GroupId=null,m(e.ResetPage())}),D("ngModelChange",function(e){p(n);let i=c();return N(i.SearchModel.ProductId,e)||(i.SearchModel.ProductId=e),m(e)}),y(39,fe,2,2,"ng-template",18)(40,Ce,1,1,"ng-template",19),o()(),a(41,"div",22)(42,"button",23),I("click",function(){p(n);let e=c();return m(e.Search())}),s(43),S(44,"translate"),b(45,"i",24),o()()(),a(46,"div",25)(47,"table",26)(48,"thead")(49,"tr")(50,"th"),s(51),S(52,"translate"),o(),a(53,"th"),s(54),S(55,"translate"),o(),a(56,"th"),s(57),S(58,"translate"),o()()(),a(59,"tbody")(60,"tr")(61,"td"),s(62),o(),a(63,"td"),s(64),o(),a(65,"td"),s(66),o()()()()(),a(67,"div",27)(68,"p-table",28,4),y(70,Te,3,0,"ng-template",29)(71,be,24,21,"ng-template",30)(72,Ee,24,12,"ng-template",31)(73,Oe,5,1,"ng-template",32),o(),y(74,Re,1,4,"p-paginator",33)(75,ke,1,3,"p-paginator",34),o()(),a(76,"div",35),y(77,Ge,5,3,"button",36),a(78,"button",37),I("click",function(){let e=p(n).$implicit,i=c();return e.close("Close click"),m(i.ResetPage())}),s(79),S(80,"translate"),o()()}if(r&2){let n=c();u("PageTitle","InventorySettlement.InventorySettlement"),l(5),v(g(6,41,"Table.DocNo")),l(2),u("disabled",!0)("value",n.SearchModel.DocNo),l(3),v(g(11,43,"Table.Notes")),l(2),M("ngModel",n.Inventory.Notes),l(3),x(" ",j(16,45,n.Inventory.DocDate,"d-M-yyyy h:mm:ss a")," "),l(4),v(g(20,48,"SaleInvoice.Storage")),l(2),u("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),M("ngModel",n.SearchModel.StoreId),l(6),v(g(28,50,"Item.ItemGroup")),l(2),u("items",n.Groups)("autofocus",!1)("virtualScroll",!0)("searchable",!0),M("ngModel",n.SearchModel.GroupId),l(6),x(" ",g(36,52,"BalanceStorage.ItemId"),""),l(2),u("items",n.Items)("autofocus",!1)("virtualScroll",!0)("searchable",!0),M("ngModel",n.SearchModel.ProductId),l(6),x("",g(44,54,"Model.Search")," "),l(8),v(g(52,56,"InventorySettlement.TotalNormal")),l(3),v(g(55,58,"InventorySettlement.TotalUnNormal")),l(3),v(g(58,60,"InventorySettlement.TotalOver")),l(5),v(n.Inventory.TotalNormal.toFixed(2)),l(2),v(n.Inventory.TotalUnNormal.toFixed(2)),l(2),v(n.Inventory.TotalOver.toFixed(2)),l(2),u("expandedRowKeys",n.expandedRows)("value",n.Inventory.InventorySettlementDetails)("paginator",!1)("rows",10)("globalFilterFields",G(64,ve)),l(6),u("ngIf",n._SharedObjectModelService.Paging.TotalItems>=10),l(),u("ngIf",n._SharedObjectModelService.Paging.TotalItems<10),l(2),u("ngIf",n.Inventory.Id==0),l(2),v(g(80,62,"Model.Close"))}}var st=(()=>{let _=class _{constructor(t,e,i,d){this._SharedObjectModelService=t,this._AppModeService=e,this._DefaultSettingsService=i,this._Apiservice=d,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"InventorySettlement",Join:!0,JoinTables:["Storages SF"],JoinConditions:["T.StoreId = SF.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","SF.Name AS StoreName"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes",ExistSearchField:"T.Notes"},{SortName:"StoreName",CellName:"SaleInvoice.Storage",ExistSearchField:"SF.Name"}]},this.Inventory={InventorySettlementDetails:[],Id:0,Name:"",Code:"",DocDate:"",DocNo:0,StoreId:0,StoreName:"",TotalNormal:0,TotalUnNormal:0,TotalOver:0},this.Items=[],this.Groups=[],this.Storages=[],this.SearchModel={GroupId:null,StoreId:null,ProductId:null},this.expandedRows={}}ngOnInit(){}OpenModal(){this.GetPageInfo(),this.SearchModel={GroupId:null,StoreId:null,ProductId:null},this.ResetPage()}GetPageInfo(){this._Apiservice.get("StorageSettlementEP/GetPageInfo",!1).pipe(T(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?this.SearchModel.DocNo=t.Obj:this._AppModeService._Toastr.error(t.Message)}})}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){this.Inventory={InventorySettlementDetails:[],Id:t.Id,Name:"",Code:"",DocDate:new Date(`${t.DocDate}`),DocNo:t.DocNo,StoreId:t.StoreId,StoreName:t.StoreName,TotalNormal:t.TotalNormal,TotalUnNormal:t.TotalUnNormal,TotalOver:t.TotalOver},this.Storages=[{Id:t.StoreId,Name:t.StoreName}],this.SearchModel.StoreId=t.StoreId,this.SearchModel.DocNo=t.DocNo,this.Inventory.InventorySettlementDetails=[];for(let e=0;e<t.InventorySettlementDetails.length;e++){let i=t.InventorySettlementDetails[e];this.Inventory.InventorySettlementDetails.push(i)}}ChangeSearchApi(t,e){let i=`${e.searchTerm}`.trim();(i==""||i=="null")&&(e.searchTerm="",i=""),this._AppModeService.CurrentPage+=1;let d={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:i,SearchField:"Name"};t=="Storages"&&(d.BranchFilter=!0),t=="Items"&&(d.Columns=["Id","Name","Code"],d.Conditions="ProductType != 2"),this._Apiservice.post("Global/GetAll",d,!1).pipe(T(this._Apiservice.destroy$)).subscribe({next:h=>{h.IsSuccess==!0&&h.Obj!=null?this.HandleResponse(h.Obj,t):this._AppModeService._Toastr.error(h.Message)}})}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Storages"&&(this.Storages=this._SharedObjectModelService.RemoveDuplicates(this.Storages.concat(t.DataReturn),"Id")),e=="ItemGroups"&&(this.Groups=this._SharedObjectModelService.RemoveDuplicates(this.Groups.concat(t.DataReturn),"Id")),e=="Items"&&(this.Items=this._SharedObjectModelService.RemoveDuplicates(this.Items.concat(t.DataReturn),"Id"),this.Items=this.Items.map(i=>B(V({},i),{NameAndCode:`${i.Name} - ${i.Code}`})))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let i=[];e=="Store"&&(i=this.Storages),e=="Group"&&(i=this.Groups),e=="Product"&&(i=this.Items);let d=i.find(h=>h.Id==t);if(d==null){this._AppModeService.DontPlay();return}else this.SearchModel[`${e}Id`]=t,this.SearchModel[`${e}Name`]=d.Name}else this.SearchModel[`${e}Id`]=null,this.SearchModel[`${e}Name`]=""}Search(){if(this.SearchModel.StoreId==0||this.SearchModel.StoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyOffer.Error.EnterStore"));return}let t={ProductId:this.SearchModel.ProductId,StoreId:this.SearchModel.StoreId,GroupId:this.SearchModel.GroupId,CurrentPage:1,PageSize:this._SharedObjectModelService.Paging.PageSize};this._Apiservice.post("StorageSettlementEP/GetItems",t,!0).pipe(T(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.Inventory.InventorySettlementDetails=this._SharedObjectModelService.RemoveDuplicates(this.Inventory.InventorySettlementDetails.concat(e.Obj.List),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=e.Obj.TotalItems,this.Inventory.TotalNormal=0,this.Inventory.TotalUnNormal=0,this.Inventory.TotalOver=0):(this.Inventory.InventorySettlementDetails=[],this._AppModeService._Toastr.error(e.Message))}})}onPageChange(t){t.page++,t.first,t.rows,this._SharedObjectModelService.Paging.CurrentPage=t.first,this._SharedObjectModelService.Paging.PageSize=t.rows;let e={ProductId:this.SearchModel.ProductId,StoreId:this.SearchModel.StoreId,GroupId:this.SearchModel.GroupId,PageSize:this._SharedObjectModelService.Paging.PageSize,CurrentPage:t.page};this._Apiservice.post("StorageSettlementEP/GetItems",e,!0).pipe(T(this._Apiservice.destroy$)).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?(this.Inventory.InventorySettlementDetails=this._SharedObjectModelService.RemoveDuplicates(this.Inventory.InventorySettlementDetails.concat(i.Obj.List),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=i.Obj.TotalItems):this._AppModeService._Toastr.error(i.Message)}})}RemoveProcut(t){this.Inventory.InventorySettlementDetails=this.Inventory.InventorySettlementDetails.filter(e=>e.ProductId!=t.ProductId),this.Calc()}ExpandAll(){this.expandedRows=this.Inventory.InventorySettlementDetails.reduce((t,e)=>(t[e.Id]=!0)&&t,{})}CollapseAll(){this.expandedRows={}}ConvertNumber(t){return Number(t)}Calc(){this.Inventory.TotalNormal=0,this.Inventory.TotalUnNormal=0,this.Inventory.TotalOver=0;for(let t=0;t<this.Inventory.InventorySettlementDetails.length;t++){let e=Number(this.Inventory.InventorySettlementDetails[t].BalanceDocument),i=Number(this.Inventory.InventorySettlementDetails[t].BalanceNow),d=Number(this.Inventory.InventorySettlementDetails[t].WADocument);i>e&&(this.Inventory.InventorySettlementDetails[t].InventoryType=3);let h=Number(this.Inventory.InventorySettlementDetails[t].InventoryType);h==1&&(this.Inventory.TotalNormal+=(e-i)*d),h==2&&(this.Inventory.TotalUnNormal+=(e-i)*d),h==3&&i-e>0&&(this.Inventory.TotalOver+=(i-e)*d)}}Save(){if(this.Inventory.StoreId=this.SearchModel.StoreId,this.Inventory.DocNo=this.SearchModel.DocNo,this.Inventory.DocDate==""||this.Inventory.DocDate==null)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate")),!1;if(this.Inventory.StoreId==0||this.Inventory.StoreId==null)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyOffer.Error.EnterStore")),!1;for(let i=0;i<this.Inventory.InventorySettlementDetails.length;i++){let d=this.Inventory.InventorySettlementDetails[i].ProductName,h=this.Inventory.InventorySettlementDetails[i].BalanceDocument,w=Number(`${this.Inventory.InventorySettlementDetails[i].BalanceNow}`.trim()),ge=Number(this.Inventory.InventorySettlementDetails[i].InventoryType),E=this.Inventory.InventorySettlementDetails[i].WADocument;if(h>0&&w<0)return alert("BalanceDocument > 0 && (BalanceNow <= 0)"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+d),!1;if(Number(w)>0&&E<=0)return alert("Number(BalanceNow) > 0 && WADocument <= 0"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.WANow")+" "+d),!1;if((Number(w)<0||w<0)&&E>0)return alert("(Number(BalanceNow) < 0 || (BalanceNow <= 0))  && WADocument > 0"),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+d),!1;if(Number(w)<0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.BalanceNow")+" "+d),!1;if(ge==0&&Number(h)-Number(w)>0)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("InventorySettlement.Error.InventoryType")+" "+d),!1}let e={InventorySettlementDetails:this.Inventory.InventorySettlementDetails.filter(i=>i.BalanceDocument>0&&i.BalanceNow!="null"||Number(i.BalanceNow)>0),Id:0,Name:"",Code:"",DocDate:this._Apiservice.ConvertISODate(this.Inventory.DocDate),DocNo:this.Inventory.DocNo,StoreId:this.Inventory.StoreId,StoreName:this.Inventory.StoreName,TotalNormal:this.Inventory.TotalNormal,TotalUnNormal:this.Inventory.TotalUnNormal,TotalOver:this.Inventory.TotalOver};return e.Id==0&&this._Apiservice.post("StorageSettlementEP/Add",e,!0).pipe(T(this._Apiservice.destroy$)).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?(this._AppModeService._Toastr.success(i.Message),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(i.Obj)):this._AppModeService._Toastr.error(i.Message)}}),!0}ResetPage(){this.Inventory={InventorySettlementDetails:[],Id:0,Name:"",Code:"",DocDate:"",DocNo:0,StoreId:0,StoreName:"",TotalNormal:0,TotalUnNormal:0,TotalOver:0},O(0,1e3).pipe(T(this._Apiservice.destroy$)).subscribe(t=>{this.Inventory.DocDate=this._Apiservice.NowDate()})}trackByMethod(t,e){return e.Id}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};_.\u0275fac=function(e){return new(e||_)(P(me),P(Y),P(Se),P(U))},_.\u0275cmp=R({type:_,selectors:[["app-inventory-settlement"]],standalone:!0,features:[k],decls:3,vars:5,consts:[["content",""],["SelectStorages",""],["SelectItemGroup",""],["SelectFromStore",""],["dt1",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GetById","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-center"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","col-xl-1","p-2"],["for","DocNo"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","col-xl-2","p-2"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"d-block","text-center"],["for","Store"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["for","Item"],["placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","col-xl-1","p-2","align-self-end","text-center","mx-auto"],[1,"btn-Add","btn",3,"click"],[1,"mx-1","pi","pi-search"],[1,"DivPaging","col-12","table-responsive"],[1,"table","table-striped","table-hover","w-100","m-0"],[1,"DivPaging","col-12","p-0","table-responsive"],["dataKey","Id",3,"expandedRowKeys","value","paginator","rows","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["appendTo","table",3,"first","rows","totalRecords","rowsPerPageOptions","onPageChange",4,"ngIf"],["appendTo","table",3,"first","rows","totalRecords","onPageChange",4,"ngIf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],["class","btn-Add btn",3,"click",4,"ngIf"],["type","button",1,"btn","btn-light","btn-Close","border","border-1","border-dark",3,"click"],[1,"form-text","text-muted"],[1,"flex","flex-wrap","justify-content-end","gap-2","CollapseGroup"],["icon","pi pi-plus","text","",3,"onClick"],["icon","pi pi-minus","text","",3,"onClick"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon",4,"ngIf"],[1,"text-dark"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"keyup","change","ngModelChange","disabled","ngModel"],[1,"p-0","text-center"],["class","py-3 m-0 text-dark text-center",4,"ngIf"],["class"," py-3 m-0 text-danger text-center",4,"ngIf"],["class"," py-3 m-0 text-success text-center",4,"ngIf"],["class","mx-2",4,"ngIf"],["class","btn btn-Delete",3,"click",4,"ngIf"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon"],[1,"py-3","m-0","text-dark","text-center"],[1,"py-3","m-0","text-danger","text-center"],[1,"py-3","m-0","text-success","text-center"],[1,"mx-2"],[1,"btn","btn-Refresh","p-2",3,"click","disabled"],[1,"btn","btn-Delete","btn-Page","p-2",3,"click","disabled"],[1,"btn","btn-Delete",3,"click"],[1,"mx-1","pi","pi-trash","fw-bold"],["colspan","8",1,"p-0"],["dataKey","Id",3,"value"],["appendTo","table",3,"onPageChange","first","rows","totalRecords","rowsPerPageOptions"],["appendTo","table",3,"onPageChange","first","rows","totalRecords"],[1,"mx-1","pi","pi-save"]],template:function(e,i){if(e&1){let d=C();a(0,"app-dynamic-component",5),I("OpenModalEvent",function(){return p(d),m(i.OpenModal())})("ShowToEditeEvent",function(){return p(d),m(i.ShowToEdite())}),o(),y(1,je,81,65,"ng-template",null,0,F)}if(e&2){let d=f(2);u("PageTitle","InventorySettlement.InventorySettlement")("TablePaging",i.TablePaging)("FullScreen",!0)("GetById","StorageSettlementEP/GetById")("OutModal",d)}},dependencies:[le,re,ie,$,ae,oe,H,Q,K,q,J,W,pe,ce,se,X,z,L,ne,te,Z,ee,ue,_e,de]});let r=_;return r})();export{st as InventorySettlementComponent};
