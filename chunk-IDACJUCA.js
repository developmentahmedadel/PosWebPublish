import{a as xe,b as Te,c as De}from"./chunk-BZPR73YG.js";import{a as be}from"./chunk-D7RC4W4V.js";import{a as Ce}from"./chunk-R22ILC4E.js";import{a as he,b as ge,j as fe}from"./chunk-JSAFLJSP.js";import{a as Se}from"./chunk-VSYXDL23.js";import{a as ye}from"./chunk-6KCN6SOZ.js";import{a as de,b as Ie}from"./chunk-OFCF557E.js";import{a as _e,b as ue,c as me,d as ve}from"./chunk-ZWNSIIKM.js";import{c as Z,d as ee,g as pe}from"./chunk-JS2GAZTB.js";import{H as K,I as X,_ as te,aa as ie,c as q,d as z,da as ne,fa as oe,ha as re,i as Y,ia as ae,ja as ce,la as le,na as se,z as J}from"./chunk-WSHLQXZC.js";import{$b as b,Cb as a,Db as c,Eb as R,Fb as k,Gb as O,Ib as T,Mb as f,Nb as l,Qb as x,Rb as U,Tb as Q,Ub as F,Vb as W,Wb as D,X as N,Xb as s,Yb as I,Zb as y,_b as w,ac as C,bc as A,db as o,dc as G,eb as B,na as j,nc as p,oc as _,pc as H,qc as $,vb as g,wa as L,xa as u,xb as d,ya as m}from"./chunk-J5UB44FZ.js";var Re=["GLComponent"],we=["content"];function Ve(r,v){if(r&1){let i=T();a(0,"div",61)(1,"div",62)(2,"input",63),p(3,"translate"),f("keyup",function(){u(i);let e=l(2);return m(e.ResetPage())})("change",function(){u(i);let e=l(2);return m(e.ResetPage())}),A("ngModelChange",function(e){u(i);let n=l(2);return C(n.InvoiceDocNo,e)||(n.InvoiceDocNo=e),m(e)}),c()(),a(4,"button",64),f("click",function(){u(i);let e=l(2);return m(e.Search())}),s(5),p(6,"translate"),c()()}if(r&2){let i=l(2);o(2),x("placeholder",_(3,4,"ReturnBuyInvoice.InvoiceNo")),b("ngModel",i.InvoiceDocNo),o(2),d("disabled",i._AppModeService.DisabledButton),o(),y(" ",_(6,6,"Model.Search")," ")}}function Be(r,v){r&1&&(a(0,"span",65),s(1),p(2,"translate"),c()),r&2&&(o(),y("",_(2,1,"SaleInvoice.Cash")," "))}function Ee(r,v){r&1&&(a(0,"span",65),s(1),p(2,"translate"),c()),r&2&&(o(),y("",_(2,1,"SaleInvoice.Debt")," "))}function Me(r,v){if(r&1&&(a(0,"span",66),s(1),p(2,"translate"),c()),r&2){let i=l(2);o(),w("",_(2,2,"SaleInvoice.Cash")," : ",i.InvoiceCash,"")}}function Pe(r,v){if(r&1&&(a(0,"span",66),s(1),p(2,"translate"),c()),r&2){let i=l(2);o(),w("",_(2,2,"SaleInvoice.Visa")," : ",i.InvoiceVisa,"")}}function ke(r,v){if(r&1&&(a(0,"span",66),s(1),p(2,"translate"),c()),r&2){let i=l(2);o(),w("",_(2,2,"SaleInvoice.Debt")," : ",i.InvoiceDept,"")}}function Oe(r,v){if(r&1&&(a(0,"p",75),s(1),c()),r&2){let i=l(2).$implicit;o(),y(" ",i.ProductName," ")}}function Ue(r,v){if(r&1&&(k(0),g(1,Oe,2,1,"p",74),O()),r&2){let i=v.$implicit,t=l().$implicit;o(),d("ngIf",t.ProductId==i.Id)}}function Qe(r,v){if(r&1&&(a(0,"p",75),s(1),c()),r&2){let i=l(2).$implicit;o(),y(" ",i.ProductUnitName," ")}}function Fe(r,v){if(r&1&&(k(0),g(1,Qe,2,1,"p",74),O()),r&2){let i=v.$implicit,t=l().$implicit;o(),d("ngIf",t.ProductUnitId==i.Id)}}function We(r,v){if(r&1){let i=T();a(0,"tr"),R(1,"td",67),a(2,"td",68),p(3,"translate"),g(4,Ue,2,1,"ng-container",69),c(),a(5,"td",68),p(6,"translate"),g(7,Fe,2,1,"ng-container",69),c(),a(8,"td",70),p(9,"translate"),a(10,"span",71),s(11),c()(),a(12,"td",70),p(13,"translate"),a(14,"div",72)(15,"input",73),f("change",function(){let e=u(i).index,n=l(2);return m(n.LowQuantity(e))})("keyup",function(){let e=u(i).index,n=l(2);return m(n.LowQuantity(e))}),A("ngModelChange",function(e){let n=u(i).$implicit;return C(n.Quantity,e)||(n.Quantity=e),m(e)}),c()()(),a(16,"td",70),p(17,"translate"),a(18,"span",71),s(19),c()(),a(20,"td",70),p(21,"translate"),a(22,"span",71),s(23),c()(),a(24,"td",70),p(25,"translate"),a(26,"span",71),s(27),c()(),a(28,"td",70),p(29,"translate"),a(30,"span",71),s(31),c()(),a(32,"td",70),p(33,"translate"),a(34,"span"),s(35),c()()()}if(r&2){let i=v.$implicit,t=v.index,e=l(2);o(),x("title",t+1),o(),x("title",_(3,23,"SaleInvoice.Name")),o(2),d("ngForOf",i.Items),o(),x("title",_(6,25,"SaleInvoice.Unit")),o(2),d("ngForOf",i.ProductUnits),o(),x("title",_(9,27,"ReturnBuyInvoice.LastReturnQuantity")),o(3),y(" ",i.ReturnedQty,""),o(),x("title",_(13,29,"ReturnBuyInvoice.ReturnQuantity")),o(3),U("id","ReturnQuantity",t,""),U("name","ReturnQuantity",t,""),b("ngModel",i.Quantity),o(),x("title",_(17,31,"ReturnBuyInvoice.Quantity")),o(3),y(" ",i.SaveQuantity,""),o(),x("title",_(21,33,"SaleInvoice.Price")),o(3),y(" ",i.Price,""),o(),x("title",_(25,35,"SaleInvoice.DiscountRate")),o(3),y(" ",i.DiscountRate.toFixed(2),""),o(),x("title",_(29,37,"SaleInvoice.Discount")),o(3),y(" ",e.ConvertToNumer(i.Discount).toFixed(2),""),o(),x("title",_(33,39,"SaleInvoice.NetTotal")),o(3),I(i.TotalPriceAfterDiscount.toFixed(2))}}function je(r,v){r&1&&(a(0,"label",22),s(1),p(2,"translate"),c()),r&2&&(o(),I(_(2,1,"Table.DocDate")))}function Le(r,v){if(r&1&&(a(0,"span",76),s(1),p(2,"date"),c()),r&2){let i=l(2);o(),y(" ",H(2,1,i.Invoice.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Ge(r,v){if(r&1){let i=T();a(0,"p-calendar",77),A("ngModelChange",function(e){u(i);let n=l(2);return C(n.Invoice.DocDate,e)||(n.Invoice.DocDate=e),m(e)}),c()}if(r&2){let i=l(2);b("ngModel",i.Invoice.DocDate),d("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function He(r,v){if(r&1&&s(0),r&2){let i=v.item;y(" ",i.Name," ")}}function $e(r,v){if(r&1&&s(0),r&2){let i=v.item;y(" ",i.Name," ")}}function qe(r,v){if(r&1){let i=T();a(0,"div",25)(1,"p",32),s(2),p(3,"translate"),c(),a(4,"ng-select",33),A("ngModelChange",function(e){u(i);let n=l(2);return C(n.Invoice.ClientId,e)||(n.Invoice.ClientId=e),m(e)}),g(5,$e,1,1,"ng-template",34),c()()}if(r&2){let i=l(2);o(2),I(_(3,5,"SaleOffer.Client")),o(2),d("items",i.ClientArr)("disabled",!0)("virtualScroll",!0),b("ngModel",i.Invoice.ClientId)}}function ze(r,v){if(r&1&&s(0),r&2){let i=v.item;y(" ",i.Name," ")}}function Ye(r,v){if(r&1){let i=T();a(0,"div",25)(1,"p",32),s(2),p(3,"translate"),c(),a(4,"ng-select",33),A("ngModelChange",function(e){u(i);let n=l(2);return C(n.Invoice.SupplierId,e)||(n.Invoice.SupplierId=e),m(e)}),g(5,ze,1,1,"ng-template",34),c()()}if(r&2){let i=l(2);o(2),I(_(3,5,"BuyOffer.Supplier")),o(2),d("items",i.SupplierArr)("disabled",!0)("virtualScroll",!0),b("ngModel",i.Invoice.SupplierId)}}function Je(r,v){r&1&&(a(0,"option",40),s(1),p(2,"translate"),c()),r&2&&(d("value",3),o(),I(_(2,2,"SaleInvoice.Delivery")))}function Ke(r,v){if(r&1&&(a(0,"small",82),s(1),c()),r&2){let i=l(3);o(),w("Loaded ",i.TreasuryArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function Xe(r,v){if(r&1&&s(0),r&2){let i=v.item;y(" ",i.Name," ")}}function Ze(r,v){if(r&1){let i=T();a(0,"div",31)(1,"div",78)(2,"p",38),s(3),p(4,"translate"),c(),a(5,"input",79),p(6,"translate"),f("keyup",function(){u(i);let e=l(2);return m(e.ChangeCash())})("change",function(){u(i);let e=l(2);return m(e.ChangeCash())}),A("ngModelChange",function(e){u(i);let n=l(2);return C(n.Invoice.Cash,e)||(n.Invoice.Cash=e),m(e)}),c()(),a(7,"div",25)(8,"p",38),s(9),p(10,"translate"),c(),a(11,"ng-select",80,2),f("clear",function(){u(i);let e=l(2);return m(e.TreasuryArr=[])})("focus",function(){u(i);let e=D(12),n=l(2);return m(n.ChangeSearchApi("Treasury",e))})("keyup",function(){u(i);let e=D(12),n=l(2);return m(n.ChangeSearchApi("Treasury",e))})("change",function(){u(i);let e=D(12),n=l(2);return m(n.ChangeSearchApi("Treasury",e))})("scrollToEnd",function(){u(i);let e=D(12),n=l(2);return m(n.ChangeSearchApi("Treasury",e))})("close",function(){u(i);let e=l(2);return m(e._AppModeService.CurrentPage=0)})("open",function(){u(i);let e=l(2);return m(e._AppModeService.CurrentPage=0)})("change",function(){u(i);let e=l(2);return m(e.SelectValue(e.Invoice.TreasuryId,"Treasury"))}),A("ngModelChange",function(e){u(i);let n=l(2);return C(n.Invoice.TreasuryId,e)||(n.Invoice.TreasuryId=e),m(e)}),g(13,Ke,2,2,"ng-template",81)(14,Xe,1,1,"ng-template",34),c()()()}if(r&2){let i=l(2);o(3),I(_(4,11,"BuyInvoice.Cash")),o(2),x("placeholder",_(6,13,"SaleInvoice.Cash")),d("disabled",i.Invoice.PaymentType==3),b("ngModel",i.Invoice.Cash),o(4),I(_(10,15,"BuyInvoice.Treasury")),o(2),d("items",i.TreasuryArr)("autofocus",!1)("virtualScroll",!0)("searchable",!0)("disabled",i.Invoice.PaymentType==3||i.Invoice.Cash==""||i.Invoice.Cash==0),b("ngModel",i.Invoice.TreasuryId)}}function et(r,v){if(r&1&&(a(0,"small",82),s(1),c()),r&2){let i=l(3);o(),w("Loaded ",i.BankAccountArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function tt(r,v){if(r&1&&s(0),r&2){let i=v.item;y(" ",i.Name," ")}}function it(r,v){if(r&1){let i=T();a(0,"div",31)(1,"div",78)(2,"p",38),s(3),p(4,"translate"),c(),a(5,"input",83),p(6,"translate"),f("keyup",function(){u(i);let e=l(2);return m(e.ChangeCash())})("change",function(){u(i);let e=l(2);return m(e.ChangeCash())}),A("ngModelChange",function(e){u(i);let n=l(2);return C(n.Invoice.Visa,e)||(n.Invoice.Visa=e),m(e)}),c()(),a(7,"div",78)(8,"p",38),s(9),p(10,"translate"),c(),a(11,"ng-select",84,3),f("clear",function(){u(i);let e=l(2);return m(e.BankAccountArr=[])})("focus",function(){u(i);let e=D(12),n=l(2);return m(n.ChangeSearchApi("BankAccounts",e))})("keyup",function(){u(i);let e=D(12),n=l(2);return m(n.ChangeSearchApi("BankAccounts",e))})("change",function(){u(i);let e=D(12),n=l(2);return m(n.ChangeSearchApi("BankAccounts",e))})("scrollToEnd",function(){u(i);let e=D(12),n=l(2);return m(n.ChangeSearchApi("BankAccounts",e))})("close",function(){u(i);let e=l(2);return m(e._AppModeService.CurrentPage=0)})("open",function(){u(i);let e=l(2);return m(e._AppModeService.CurrentPage=0)})("change",function(){u(i);let e=l(2);return m(e.SelectValue(e.Invoice.BankAccountId,"BankAccount"))}),A("ngModelChange",function(e){u(i);let n=l(2);return C(n.Invoice.BankAccountId,e)||(n.Invoice.BankAccountId=e),m(e)}),g(13,et,2,2,"ng-template",81)(14,tt,1,1,"ng-template",34),c()()()}if(r&2){let i=l(2);o(3),I(_(4,10,"BuyInvoice.Visa")),o(2),x("placeholder",_(6,12,"SaleInvoice.Visa")),d("disabled",i.Invoice.PaymentType==3),b("ngModel",i.Invoice.Visa),o(4),I(_(10,14,"BuyInvoice.Bank")),o(2),d("items",i.BankAccountArr)("virtualScroll",!0)("searchable",!0)("disabled",i.Invoice.PaymentType==3||i.Invoice.Visa==""||i.Invoice.Visa==0),b("ngModel",i.Invoice.BankAccountId)}}function nt(r,v){if(r&1&&(a(0,"small",82),s(1),c()),r&2){let i=l(3);o(),w("Loaded ",i.EmployeeArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function ot(r,v){if(r&1&&s(0),r&2){let i=v.item;y(" ",i.Name," ")}}function rt(r,v){if(r&1){let i=T();a(0,"div",85)(1,"p",32),s(2),p(3,"translate"),c(),a(4,"ng-select",86,4),f("clear",function(){u(i);let e=l(2);return m(e.EmployeeArr=[])})("focus",function(){u(i);let e=D(5),n=l(2);return m(n.ChangeSearchApi("Employee",e))})("keyup",function(){u(i);let e=D(5),n=l(2);return m(n.ChangeSearchApi("Employee",e))})("change",function(){u(i);let e=D(5),n=l(2);return m(n.ChangeSearchApi("Employee",e))})("scrollToEnd",function(){u(i);let e=D(5),n=l(2);return m(n.ChangeSearchApi("Employee",e))})("close",function(){u(i);let e=l(2);return m(e._AppModeService.CurrentPage=0)})("open",function(){u(i);let e=l(2);return m(e._AppModeService.CurrentPage=0)})("change",function(){u(i);let e=l(2);return m(e.SelectValue(e.Invoice.EmployeeId,"Employee"))}),A("ngModelChange",function(e){u(i);let n=l(2);return C(n.Invoice.EmployeeId,e)||(n.Invoice.EmployeeId=e),m(e)}),g(6,nt,2,2,"ng-template",81)(7,ot,1,1,"ng-template",34),c()()}if(r&2){let i=l(2);o(2),I(_(3,6,"BuyReport.Employee")),o(2),d("items",i.EmployeeArr)("autofocus",!1)("virtualScroll",!0)("searchable",!0),b("ngModel",i.Invoice.EmployeeId)}}function at(r,v){r&1&&(a(0,"p",38),s(1),p(2,"translate"),c()),r&2&&(o(),y("",_(2,1,"BuyInvoice.Debt")," : "))}function ct(r,v){if(r&1&&R(0,"input",87),r&2){let i=l(2);x("value",i.Invoice.Debt),d("disabled",!0)}}function lt(r,v){if(r&1){let i=T();a(0,"button",88),f("click",function(){u(i);let e=l(2);return m(e.Save())}),s(1),p(2,"translate"),a(3,"span",89),s(4,"Ctrl + Space"),c(),R(5,"i",90),c()}if(r&2){let i=l(2);d("disabled",i._AppModeService.DisabledButton),o(),y(" ",_(2,2,"Model.Save")," ")}}function st(r,v){if(r&1){let i=T();a(0,"button",92),f("click",function(){u(i);let e=l(3);return m(e.Save())}),s(1),p(2,"translate"),c()}if(r&2){let i=l(3);d("disabled",i._AppModeService.DisabledButton),o(),y(" ",_(2,2,"Model.Update")," ")}}function pt(r,v){if(r&1&&(a(0,"span"),g(1,st,3,4,"button",91),c()),r&2){let i=l(2);o(),d("ngIf",i.Invoice.Id!=0)}}function _t(r,v){if(r&1){let i=T();a(0,"button",93),f("click",function(){u(i);let e=l(2);return m(e.OpenGl())}),s(1),p(2,"translate"),c()}r&2&&(o(),y(" ",_(2,1,"Model.Gl")," "))}function ut(r,v){if(r&1){let i=T();R(0,"app-modal-header",6),a(1,"div",7)(2,"div",8),g(3,Ve,7,8,"div",9),a(4,"div",10)(5,"p",11),s(6),p(7,"translate"),c(),g(8,Be,3,3,"span",12)(9,Ee,3,3,"span",12),c(),a(10,"div",13),g(11,Me,3,4,"span",14)(12,Pe,3,4,"span",14)(13,ke,3,4,"span",14),c()(),a(14,"div",15)(15,"table",16)(16,"thead")(17,"tr")(18,"th"),s(19,"#"),c(),a(20,"th",17),s(21),p(22,"translate"),c(),a(23,"th",18),s(24),p(25,"translate"),c(),a(26,"th",18),s(27),p(28,"translate"),c(),a(29,"th",18),s(30),p(31,"translate"),c(),a(32,"th",18),s(33),p(34,"translate"),c(),a(35,"th",18),s(36),p(37,"translate"),c(),a(38,"th",18),s(39),p(40,"translate"),c(),a(41,"th",18),s(42),p(43,"translate"),c(),a(44,"th",18),s(45),p(46,"translate"),c()()(),a(47,"tbody"),g(48,We,36,41,"tr",19),c()()()(),a(49,"div",20)(50,"div",21)(51,"label",22),s(52),p(53,"translate"),c(),R(54,"input",23),c(),a(55,"div",24)(56,"div",25)(57,"label",26),s(58),p(59,"translate"),c(),a(60,"input",27),A("ngModelChange",function(e){u(i);let n=l();return C(n.Invoice.Notes,e)||(n.Invoice.Notes=e),m(e)}),c()(),a(61,"div",25),g(62,je,3,3,"label",28)(63,Le,3,4,"span",29)(64,Ge,1,5,"p-calendar",30),c()(),a(65,"div",31)(66,"div",25)(67,"p",32),s(68),p(69,"translate"),c(),a(70,"ng-select",33),A("ngModelChange",function(e){u(i);let n=l();return C(n.Invoice.StoreId,e)||(n.Invoice.StoreId=e),m(e)}),g(71,He,1,1,"ng-template",34),c()(),g(72,qe,6,7,"div",35)(73,Ye,6,7,"div",35),c()(),a(74,"div",36)(75,"div",37)(76,"p",38),s(77),p(78,"translate"),c(),a(79,"select",39),f("change",function(){u(i);let e=l();return m(e.ChangePamentType(e.Invoice.PaymentType))}),A("ngModelChange",function(e){u(i);let n=l();return C(n.Invoice.PaymentType,e)||(n.Invoice.PaymentType=e),m(e)}),a(80,"option",40),s(81),p(82,"translate"),c(),a(83,"option",40),s(84),p(85,"translate"),c(),g(86,Je,3,4,"option",41),c()(),g(87,Ze,15,17,"div",42)(88,it,15,16,"div",42)(89,rt,8,8,"div",43),a(90,"div",44),g(91,at,3,3,"p",45)(92,ct,1,2,"input",46),c()(),a(93,"div",47)(94,"div",48)(95,"span",49),s(96),p(97,"translate"),c(),a(98,"span",50),s(99),c()(),a(100,"div",51)(101,"span",49),s(102),p(103,"translate"),c(),a(104,"span",50),s(105),c()(),a(106,"div",51)(107,"span",52),s(108),p(109,"translate"),c(),a(110,"span",50),s(111),c()(),a(112,"div",51)(113,"span",53),s(114),p(115,"translate"),c(),a(116,"span",50),s(117),c()(),a(118,"div",51)(119,"span",54)(120,"span"),s(121),p(122,"translate"),c(),a(123,"span"),s(124),c()(),a(125,"span",50),s(126),c()(),a(127,"div",51)(128,"span",55),s(129),p(130,"translate"),c(),a(131,"span",50),s(132),c()()(),a(133,"div",56),g(134,lt,6,4,"button",57)(135,pt,2,1,"span",58)(136,_t,3,3,"button",59),a(137,"button",60),f("click",function(){let e=u(i).$implicit,n=l();return e.close("Close click"),m(n.ResetPage())}),s(138),p(139,"translate"),c()()}if(r&2){let i=l();d("PageTitle",i.PageTitle),o(3),d("ngIf",i.Invoice.Id==0),o(3),y(" ",_(7,63,"ReturnSaleInvoice.Status")," : "),o(2),d("ngIf",i.InvoiceType==1),o(),d("ngIf",i.InvoiceType==2),o(2),d("ngIf",i.InvoiceCash>=0),o(),d("ngIf",i.InvoiceVisa>=0),o(),d("ngIf",i.InvoiceDept>=0),o(8),I(_(22,65,"SaleInvoice.Name")),o(3),I(_(25,67,"SaleInvoice.Unit")),o(3),I(_(28,69,"ReturnBuyInvoice.LastReturnQuantity")),o(3),I(_(31,71,"ReturnBuyInvoice.ReturnQuantity")),o(3),I(_(34,73,"ReturnBuyInvoice.Quantity")),o(3),I(_(37,75,"SaleInvoice.Price")),o(3),y("",_(40,77,"SaleInvoice.DiscountRate")," %"),o(3),I(_(43,79,"SaleInvoice.Discount")),o(3),I(_(46,81,"SaleInvoice.NetTotal")),o(3),d("ngForOf",i.Invoice.InvoiceDetails)("ngForTrackBy",i.trackByMethod),o(4),I(_(53,83,"Table.DocNo")),o(2),d("value",i.Invoice.DocNo)("disabled",!0),o(4),I(_(59,85,"Table.Notes")),o(2),b("ngModel",i.Invoice.Notes),o(2),d("ngIf",i._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!0),o(),d("ngIf",i._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!1),o(),d("ngIf",i._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!0),o(4),I(_(69,87,"BuyInvoice.Storage")),o(2),d("items",i.StoreArr)("disabled",!0)("virtualScroll",!0),b("ngModel",i.Invoice.StoreId),o(2),d("ngIf",i.ScreenName=="ReturnSaleInvoice"),o(),d("ngIf",i.ScreenName=="ReturnBuyInvoice"),o(4),I(_(78,89,"BuyInvoice.PamentType")),o(2),b("ngModel",i.Invoice.PaymentType),o(),d("value",1),o(),I(_(82,91,"SaleInvoice.Cash")),o(2),d("value",2),o(),I(_(85,93,"SaleInvoice.Debt")),o(2),d("ngIf",i.ScreenName=="ReturnSaleInvoice"),o(),d("ngIf",i.Invoice.PaymentType!=3),o(),d("ngIf",i.Invoice.PaymentType!=3),o(),d("ngIf",i.Invoice.PaymentType==3),o(2),d("ngIf",i.Invoice.PaymentType==2),o(),d("ngIf",i.Invoice.PaymentType==2),o(4),I(_(97,95,"ProductCount")),o(3),I(i.Invoice.InvoiceDetails.length),o(3),I(_(103,97,"SaleInvoice.TotalInvoice")),o(3),I(i.Invoice.TotalInvoice.toFixed(2)),o(3),I(_(109,99,"SaleInvoice.TotalDiscount")),o(3),I(i.Invoice.TotalDisc.toFixed(2)),o(3),y("",_(115,101,"SaleInvoice.DiscountRate"),"%"),o(3),I(i.Invoice.TotalDiscRate.toFixed(2)),o(4),y("",_(122,103,"SaleInvoice.TotalVat")," "),o(3),y(" ",i.Invoice.TotalVatRate.toFixed(2),"% "),o(2),I(i.Invoice.TotalInvoiceVatAmount.toFixed(2)),o(3),I(_(130,105,"SaleInvoice.TotalAfterVat")),o(3),I(i.Invoice.TotalInvoiceAfterVat.toFixed(2)),o(2),d("ngIf",i.Invoice.Id==0),o(),d("ngIf",i._Apiservice.environment.SystemUpdate),o(),d("ngIf",i.Invoice.Id>0&&(i.ScreenName=="SaleInvoice"||"BuyInvoice")),o(2),I(_(139,107,"Model.Close"))}}var kt=(()=>{let v=class v{constructor(t,e,n,h,S){this._ActivatedRoute=t,this._SharedObjectModelService=e,this._DefaultSettingsService=n,this._AppModeService=h,this._Apiservice=S,this.SignalR=!1,this.GlResponse=!1,this.TablePaging={},this.PageTitle="",this.ScreenName="",this.InvoiceName="",this.PrintUrl="",this.AddUrl="",this.UpdateUrl="",this.DeleteUrl="",this.GetById="",this.Invoice={InvoiceCollected:!1,ClientType:2,DocNo:0,DocDate:"",InvoiceDetails:[],TotalInvoice:0,TotalDiscRate:0,TotalDisc:0,TotalInvoiceAfterDisc:0,TotalInvoiceAfterVat:0,TotalInvoiceVatAmount:0,TotalVatRate:0,Cash:"",Visa:"",Debt:"",TreasuryId:null,TreasuryName:"",BankAccountId:null,BankAccountName:"",EmployeeId:null,EmployeeName:"",StoreId:null,StoreName:"",ClientId:null,ClientName:"",SupplierId:null,SupplierName:"",Id:0,PaymentType:1,Name:"",Notes:"",Code:""},this.SupplierArr=[],this.ClientArr=[],this.StoreArr=[],this.TreasuryArr=[],this.BankAccountArr=[],this.EmployeeArr=[],this.ItemBalanceList=[],this.InvoiceDocNo="",this.InvoiceType=0,this.InvoiceCash=0,this.InvoiceVisa=0,this.InvoiceDept=0}ngOnChanges(t){let e=Number(this._ActivatedRoute.snapshot.queryParams.Id);e>0&&this.GetByIdRoute(e)}ngOnInit(){this.SignalR&&(this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener())}GetByIdRoute(t){this._Apiservice.getById(this.GetById,t,!0).pipe(N(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._SharedObjectModelService.PageModel=e.Obj.model,this._SharedObjectModelService.Gl=e.Obj.Gl,this.Drow(this._SharedObjectModelService.PageModel),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(e.Message)}})}GetPageInfo(){this._AppModeService.DisabledButton=!0,this._Apiservice.get(`${this.ScreenName}EP/GetPageInfo`,!1).pipe(N(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this.Invoice.DocNo=t.Obj,this._AppModeService.DisabledButton=!1):this._AppModeService._Toastr.error(t.Message)},error:t=>{this._AppModeService.DisabledButton=!1}})}StartConnection(){this.Hub_Connection=new De().withUrl(`${K.signalrUrl}/${this.ScreenName}`,{skipNegotiation:!0,transport:Te.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(xe.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(t=>{console.log(t)})}ServerListener(){this.Hub_Connection?.on(`Update${this.ScreenName}`,t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Invoice.Id&&(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.UpdateModelAnother"),t.User),this._AppModeService._NgbModal.dismissAll())}),this.Hub_Connection?.on(`Delete${this.ScreenName}`,t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Invoice.Id&&(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.DeleteModelAnother"),t.User),this._SharedObjectModelService.Paging.DataReturn=this._SharedObjectModelService.Paging.DataReturn.filter(n=>n.Id!=t.Id),this._AppModeService._NgbModal.dismissAll())})}OpenModal(){this.InvoiceDocNo="",this.ResetPage()}OpenGl(){this.GLComponent.Open()}ChangeSearchApi(t,e){let n=`${e.searchTerm}`.trim();(n==""||n=="null")&&(e.searchTerm="",n=""),this._AppModeService.CurrentPage+=1;let h={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:n,SearchField:"Name"};t=="Storages"&&(h.BranchFilter=!0),t=="Treasury"&&(h.BranchFilter=!0),this._Apiservice.post("Global/GetAll",h,!1).pipe(N(this._Apiservice.destroy$)).subscribe({next:S=>{S.IsSuccess==!0&&S.Obj!=null?this.HandleResponse(S.Obj,t):this._AppModeService._Toastr.error(S.Message)}})}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Suppliers"&&(this.SupplierArr=this._SharedObjectModelService.RemoveDuplicates(this.SupplierArr.concat(t.DataReturn),"Id")),e=="Clients"&&(this.ClientArr=this._SharedObjectModelService.RemoveDuplicates(this.ClientArr.concat(t.DataReturn),"Id")),e=="Storages"&&(this.StoreArr=this._SharedObjectModelService.RemoveDuplicates(this.StoreArr.concat(t.DataReturn),"Id")),e=="Treasury"&&(this.TreasuryArr=this._SharedObjectModelService.RemoveDuplicates(this.TreasuryArr.concat(t.DataReturn),"Id")),e=="BankAccounts"&&(this.BankAccountArr=this._SharedObjectModelService.RemoveDuplicates(this.BankAccountArr.concat(t.DataReturn),"Id")),e=="Employee"&&(this.EmployeeArr=this._SharedObjectModelService.RemoveDuplicates(this.EmployeeArr.concat(t.DataReturn),"Id"))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let n=[];e=="Supplier"&&(n=this.SupplierArr),e=="Client"&&(n=this.ClientArr),e=="Store"&&(n=this.StoreArr),e=="Treasury"&&(n=this.TreasuryArr),e=="BankAccount"&&(n=this.BankAccountArr),e=="Employee"&&(n=this.EmployeeArr);let h=n.find(S=>S.Id==t);if(h==null){this._AppModeService.DontPlay();return}else this.Invoice[`${e}Id`]=t,this.Invoice[`${e}Name`]=h.Name}else this.Invoice[`${e}Id`]=null,this.Invoice[`${e}Name`]=""}ChangePamentType(t){this.Invoice.BankAccountId=null,this.Invoice.BankAccountName="",this.Invoice.TreasuryId=null,this.Invoice.TreasuryName="",this.Invoice.EmployeeId=null,this.Invoice.EmployeeName="",t==1&&(this.Invoice.PaymentType=1,this.Invoice.Visa="",this.Invoice.Debt="",this.Invoice.Cash=this.Invoice.TotalInvoiceAfterVat),t==2&&(this.Invoice.PaymentType=2,this.Invoice.Cash="",this.Invoice.Visa="",this.Invoice.Debt=this.Invoice.TotalInvoiceAfterVat),t==3&&(this.Invoice.Visa="",this.Invoice.Cash="",this.Invoice.Debt="",this.Invoice.TreasuryId=null,this.Invoice.TreasuryName="",this.Invoice.BankAccountId=null,this.Invoice.BankAccountName=""),this.ChangeCash()}ChangeCash(){this.Invoice.PaymentType==1&&(this.Invoice.Cash=Number(this.Invoice.TotalInvoiceAfterVat-Number(this.Invoice.Visa)),this.Invoice.Visa=Number(this.Invoice.TotalInvoiceAfterVat-Number(this.Invoice.Cash))),this.Invoice.PaymentType==2&&(this.Invoice.Debt=Number(this.Invoice.TotalInvoiceAfterVat-(Number(this.Invoice.Cash)+Number(this.Invoice.Visa)))),this.Invoice.TreasuryId=Number(this.Invoice.Cash)==0?null:this.Invoice.TreasuryId,this.Invoice.BankAccountId=Number(this.Invoice.Visa)==0?null:this.Invoice.BankAccountId,this.Invoice.TreasuryName=Number(this.Invoice.Cash)==0?"":this.Invoice.TreasuryName,this.Invoice.BankAccountName=Number(this.Invoice.Visa)==0?"":this.Invoice.BankAccountName,this.Invoice.Cash=Number(this.Invoice.Cash)==0?"":this.Invoice.Cash,this.Invoice.Visa=Number(this.Invoice.Visa)==0?"":this.Invoice.Visa,this.Invoice.Debt=Number(this.Invoice.Debt)==0?"":this.Invoice.Debt,this.DefaultBankTreasury()}HandleMyDefaultSettings(){let t=this._DefaultSettingsService.DefaultSettings;this.ScreenName=="ReturnSaleInvoice"&&(this.Invoice.PaymentType=t.SaleInvoicePaymentType>0?t.SaleInvoicePaymentType:1),this.ScreenName=="ReturnBuyInvoice"&&(this.Invoice.PaymentType=t.BuyInvoicePaymentType>0?t.BuyInvoicePaymentType:1)}DefaultBankTreasury(){let t=this._DefaultSettingsService.DefaultSettings;this.ScreenName=="ReturnSaleInvoice"&&(this.Invoice.Cash>0&&t.ReturnSaleInvoiceTreasuryId>0&&this.Invoice.Id==0&&(this.TreasuryArr=[],this.Invoice.TreasuryId=t.ReturnSaleInvoiceTreasuryId,this.TreasuryArr.push({Id:t.ReturnSaleInvoiceTreasuryId,Name:t.ReturnSaleInvoiceTreasuryName})),this.Invoice.Visa>0&&t.ReturnSaleInvoiceBankAccountId>0&&this.Invoice.Id==0&&(this.BankAccountArr=[],this.Invoice.BankAccountId=t.ReturnSaleInvoiceBankAccountId,this.BankAccountArr.push({Id:t.ReturnSaleInvoiceBankAccountId,Name:t.ReturnSaleInvoiceBankAccountName}))),this.ScreenName=="ReturnBuyInvoice"&&(this.Invoice.Cash>0&&t.ReturnBuyInvoiceTreasuryId>0&&this.Invoice.Id==0&&(this.TreasuryArr=[],this.Invoice.TreasuryId=t.ReturnBuyInvoiceTreasuryId,this.TreasuryArr.push({Id:t.ReturnBuyInvoiceTreasuryId,Name:t.ReturnBuyInvoiceTreasuryName})),this.Invoice.Visa>0&&t.ReturnBuyInvoiceBankAccountId>0&&this.Invoice.Id==0&&(this.BankAccountArr=[],this.Invoice.BankAccountId=t.ReturnBuyInvoiceBankAccountId,this.BankAccountArr.push({Id:t.ReturnBuyInvoiceBankAccountId,Name:t.ReturnBuyInvoiceBankAccountName})))}ConvertToNumer(t){return Number(t)}LowQuantity(t){let e=Number(this.Invoice.InvoiceDetails[t].Quantity),n=Number(this.Invoice.InvoiceDetails[t].Price),h=Number(this.Invoice.InvoiceDetails[t].Vat),S=Number(this.Invoice.InvoiceDetails[t].SaveQuantity),V=Number(this.Invoice.InvoiceDetails[t].SaveDiscount),Ae=Number(this.Invoice.InvoiceDetails[t].SaveTotalPrice),E=Number(this.Invoice.InvoiceDetails[t].SaveDiscountRate),Ne=Number(this.Invoice.InvoiceDetails[t].RealQuantity);if(e==0||e<0||e>S){this.Invoice.InvoiceDetails[t].SaveQuantity=S,this.Invoice.InvoiceDetails[t].Discount=this.Invoice.InvoiceDetails[t].SaveDiscount,this.Invoice.InvoiceDetails[t].DiscountRate=this.Invoice.InvoiceDetails[t].SaveDiscountRate,this.Invoice.InvoiceDetails[t].TotalPriceAfterDiscount=0,this.Invoice.InvoiceDetails[t].TotalPriceAfterVat=0,e<0&&(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorQuantity")),this.Invoice.InvoiceDetails[t].Quantity=""),e>S&&(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ReturnedQtyUpQuantity")),this.Invoice.InvoiceDetails[t].Quantity=""),this.Confirm();return}if(e>0){let M=Number(e)/Ne;if(V>0){let P=V*M;this.Invoice.InvoiceDetails[t].Discount=P,this.Invoice.InvoiceDetails[t].TotalPriceAfterDiscount=e*n-V*M}if(E>0){let P=Ae*E/100;this.Invoice.InvoiceDetails[t].DiscountRate=E*M,this.Invoice.InvoiceDetails[t].TotalPriceAfterDiscount=e*n-P*M}E==0&&V==0&&(this.Invoice.InvoiceDetails[t].TotalPriceAfterDiscount=e*n,this.Invoice.InvoiceDetails[t].TotalPriceAfterVat=e*n*h/100),this.Confirm()}}TotalInvoiceVatAmount(){let t=0;for(let e=0;e<this.Invoice.InvoiceDetails.length;e++){let n=Number(this.Invoice.InvoiceDetails[e].Quantity),h=Number(this.Invoice.InvoiceDetails[e].TotalPriceAfterDiscount);if(n>0){let S=Number(this.Invoice.InvoiceDetails[e].Vat);t+=h*(S/100)}}return Number(t)}Confirm(){this.Invoice.TotalDiscRate=0,this.Invoice.TotalInvoiceAfterDisc=0,this.Invoice.TotalInvoiceAfterVat=0,this.Invoice.TotalVatRate=0,this.Invoice.TotalDisc=0,this.Invoice.TotalInvoice=0,this.Invoice.TotalInvoiceVatAmount=0;let t=this.Invoice.InvoiceDetails.filter(e=>Number(e.Quantity)>0);for(let e=0;e<t.length;e++){let n=Number(t[e].SaveQuantity),h=Number(t[e].Quantity),S=Number(t[e].Price),V=Number(t[e].TotalPriceAfterDiscount);if(h>n)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ReturnedQtyUpQuantity")),!1;this.Invoice.TotalInvoice+=S*h,this.Invoice.TotalDisc+=S*h-V}return this.Invoice.TotalDiscRate=this.Invoice.TotalInvoice==0?0:Number(this.Invoice.TotalDisc/this.Invoice.TotalInvoice*100),this.Invoice.TotalInvoiceAfterDisc=Number(this.Invoice.TotalInvoice-this.Invoice.TotalDisc),this.Invoice.TotalInvoiceVatAmount=this.TotalInvoiceVatAmount(),this.Invoice.TotalInvoiceAfterVat=Number(this.Invoice.TotalInvoiceAfterDisc+this.Invoice.TotalInvoiceVatAmount),this.Invoice.TotalVatRate=this.Invoice.TotalInvoiceAfterDisc==0?0:Number(this.Invoice.TotalInvoiceVatAmount/this.Invoice.TotalInvoiceAfterDisc*100),this.ChangeCash(),!0}ShowToEdite(){this.InvoiceDocNo="",this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){this.Invoice={ClientType:t.ClientType,DocNo:t.DocNo,DocDate:new Date(t.DocDate),Id:t.Id,PaymentType:t.PaymentType,Name:t.Name,Notes:t.Notes,Code:t.Code,TotalInvoice:t.TotalInvoice,TotalDiscRate:t.TotalDiscRate,TotalDisc:t.TotalDisc,TotalInvoiceAfterDisc:t.TotalInvoiceAfterDisc,TotalInvoiceAfterVat:t.TotalInvoiceAfterVat,TotalInvoiceVatAmount:t.TotalInvoiceVatAmount,TotalVatRate:t.TotalVatRate,Cash:t.Cash,Visa:t.Visa,Debt:t.Debt,TreasuryId:t.TreasuryId,TreasuryName:t.TreasuryName,BankAccountId:t.BankAccountId,BankAccountName:t.BankAccountName,EmployeeId:t.EmployeeId,EmployeeName:t.EmployeeName,StoreId:t.StoreId,StoreName:t.StoreName,ClientId:t.ClientId,ClientName:t.ClientName,SupplierId:t.SupplierId,SupplierName:t.SupplierName,InvoiceDetails:t[`${this.ScreenName}Details`]},t.SupplierId>0&&(this.SupplierArr=[{Id:t.SupplierId,Name:t.SupplierName}]),t.ClientId>0&&(this.ClientArr=[{Id:t.ClientId,Name:t.ClientName}]),t.TreasuryId>0&&(this.TreasuryArr=[{Id:t.TreasuryId,Name:t.TreasuryName}]),t.BankAccountId>0&&(this.BankAccountArr=[{Id:t.BankAccountId,Name:t.BankAccountName}]),t.EmployeeId>0&&(this.EmployeeArr=[{Id:t.EmployeeId,Name:t.EmployeeName}]),t.StoreId>0&&(this.StoreArr=[{Id:t.StoreId,Name:t.StoreName}]);for(let e=0;e<this.Invoice.InvoiceDetails.length;e++){let n=this.Invoice.InvoiceDetails[e];this.Invoice.InvoiceDetails[e].Items=[{Id:n.ProductId,Name:n.ProductName,NameAndCode:n.ProductName}],this.Invoice.InvoiceDetails[e].ProductUnits=[{Id:n.ProductUnitId,Name:n.ProductUnitName,NameAndUnitFactor:n.ProductUnitName}]}this._AppModeService.DisabledButton=!1}Search(){if(Number(this.InvoiceDocNo)==0||this.InvoiceDocNo==null||isNaN(Number(this.InvoiceDocNo))){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.EnterInvoiceNumber"));return}this._AppModeService.DisabledButton=!0,this._Apiservice.getById(`${this.InvoiceName}EP/GetByDocNo`,Number(this.InvoiceDocNo),!0).pipe(N(this._Apiservice.destroy$)).subscribe({next:t=>{if(t.IsSuccess==!0&&t.Obj!=null){this._AppModeService.DisabledButton=!1;let e=t.Obj;this.ResetPage(),this.GetPageInfo(),this.InvoiceCash=e.Cash,this.InvoiceVisa=e.Visa,this.InvoiceDept=e.Debt,this.InvoiceType=e.PaymentType,this.Invoice[`${this.InvoiceName}DocNo`]=e.DocNo,this.Invoice[`${this.InvoiceName}Id`]=e.Id,this.InvoiceName=="BuyInvoice"&&(this.Invoice.SupplierId=e.SupplierId,this.Invoice.SupplierName=e.SupplierName,this.SupplierArr=[{Id:e.SupplierId,Name:e.SupplierName}]),this.InvoiceName=="SaleInvoice"&&(this.Invoice.ClientId=e.ClientId,this.Invoice.ClientName=e.ClientName,this.ClientArr=[{Id:e.ClientId,Name:e.ClientName}]),this.Invoice.StoreId=e.StoreId,this.Invoice.StoreName=e.StoreName,this.StoreArr=[{Id:e.StoreId,Name:e.StoreName}],this.Invoice.PaymentType=1,this.Invoice.InvoiceDetails=e[`${this.InvoiceName}Details`];for(let n=0;n<this.Invoice.InvoiceDetails.length;n++)this.Invoice.InvoiceDetails[n].Id=0,this.Invoice.InvoiceDetails[n].SaveDiscount=Number(this.Invoice.InvoiceDetails[n].Discount),this.Invoice.InvoiceDetails[n].SaveDiscountRate=Number(this.Invoice.InvoiceDetails[n].DiscountRate),this.Invoice.InvoiceDetails[n].SavePrice=Number(this.Invoice.InvoiceDetails[n].Price),this.Invoice.InvoiceDetails[n].SaveTotalPrice=Number(this.Invoice.InvoiceDetails[n].TotalPrice),this.Invoice.InvoiceDetails[n].SaveTotalPriceAfterDiscount=Number(this.Invoice.InvoiceDetails[n].TotalPriceAfterDiscount),this.Invoice.InvoiceDetails[n].RealQuantity=Number(this.Invoice.InvoiceDetails[n].Quantity),this.Invoice.InvoiceDetails[n].SaveQuantity=Number(this.Invoice.InvoiceDetails[n].Quantity)-Number(this.Invoice.InvoiceDetails[n].ReturnedQty),this.Invoice.InvoiceDetails[n].Quantity="",this.Invoice.InvoiceDetails[n].TotalPrice=this.Invoice.InvoiceDetails[n].SaveQuantity*Number(this.Invoice.InvoiceDetails[n].SavePrice),this.Invoice.InvoiceDetails[n].TotalPriceAfterDiscount=0,this.Invoice.InvoiceDetails[n].Items=[{Id:this.Invoice.InvoiceDetails[n].ProductId,Name:this.Invoice.InvoiceDetails[n].ProductName}],this.Invoice.InvoiceDetails[n].ProductUnits=[{Id:this.Invoice.InvoiceDetails[n].ProductUnitId,Name:this.Invoice.InvoiceDetails[n].ProductUnitName,NameAndUnitFactor:this.Invoice.InvoiceDetails[n].ProductUnitName}]}else this._AppModeService.DisabledButton=!1,this.ResetPage(),this._AppModeService._Toastr.error(t.Message)},error:t=>{this._AppModeService.DisabledButton=!1}})}Save(){if(this.Invoice.DocDate==""||this.Invoice.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}if(this.Confirm()==!1)return;if(this.Invoice.TotalInvoice<0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash"));return}if(this.Invoice.TotalInvoiceAfterVat<0||this.Invoice.TotalInvoiceAfterVat<0&&this.Invoice.TotalInvoiceAfterDisc<0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.ErrorTotal"));return}if(Number(this.Invoice.Visa)<0||isNaN(Number(this.Invoice.Visa))){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash"));return}if(Number(this.Invoice.Cash)<0||isNaN(Number(this.Invoice.Cash))){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash"));return}if(Number(this.Invoice.Debt)<0||isNaN(Number(this.Invoice.Debt))){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorDebt"));return}if(Number(this.Invoice.Visa)>0&&(this.Invoice.BankAccountId<=0||this.Invoice.BankAccountId==null)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.EnterBank"));return}if(Number(this.Invoice.Cash)>0&&(this.Invoice.TreasuryId<=0||this.Invoice.TreasuryId==null)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.EnterTreasury"));return}if(this.Invoice.PaymentType==1&&Number(this.Invoice.Cash)+Number(this.Invoice.Visa)!=this.Invoice.TotalInvoiceAfterVat){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash"));return}if(this.Invoice.PaymentType==2&&Number(this.Invoice.Cash)+Number(this.Invoice.Visa)+Number(this.Invoice.Debt)!=this.Invoice.TotalInvoiceAfterVat){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorDebt"));return}if(this.Invoice.PaymentType==2&&Number(this.Invoice.Debt)<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorDebt"));return}if(this.Invoice.PaymentType==3&&this.Invoice.EmployeeId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SalesReport.ChooseEmployee"));return}let t={InvoiceDetails:this.Invoice.InvoiceDetails.filter(e=>Number(e.Quantity)>0),Id:this.Invoice.Id,Name:this.Invoice.Name,Notes:this.Invoice.Notes,Code:this.Invoice.Code,TotalInvoice:this.Invoice.TotalInvoice,TotalDisc:this.Invoice.TotalDisc,TotalDiscRate:this.Invoice.TotalDiscRate,TotalInvoiceAfterDisc:this.Invoice.TotalInvoiceAfterDisc,TotalInvoiceAfterVat:this.Invoice.TotalInvoiceAfterVat,TotalInvoiceVatAmount:this.Invoice.TotalInvoiceVatAmount,TotalVatRate:this.Invoice.TotalVatRate,Cash:Number(this.Invoice.Cash),Visa:Number(this.Invoice.Visa),Debt:Number(this.Invoice.Debt),PaymentType:Number(this.Invoice.PaymentType),DocDate:this._Apiservice.ConvertISODate(this.Invoice.DocDate),DocNo:this.Invoice.DocNo,SupplierId:this.Invoice.SupplierId,SupplierName:this.Invoice.SupplierName,StoreId:this.Invoice.StoreId,StoreName:this.Invoice.StoreName,TreasuryId:this.Invoice.TreasuryId,TreasuryName:this.Invoice.TreasuryName,BankAccountId:this.Invoice.BankAccountId,BankAccountName:this.Invoice.BankAccountName,EmployeeId:this.Invoice.EmployeeId,EmployeeName:this.Invoice.EmployeeName,ClientId:this.Invoice.ClientId,ClientName:this.Invoice.ClientName};t[`Return${this.InvoiceName}Details`]=this.Invoice.InvoiceDetails.filter(e=>Number(e.Quantity)>0),t[`${this.InvoiceName}DocNo`]=this.Invoice[`${this.InvoiceName}DocNo`],t[`${this.InvoiceName}Id`]=this.Invoice[`${this.InvoiceName}Id`],t.Id==0&&this._Apiservice.post(`${this.AddUrl}`,t,!0).pipe(N(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.InvoiceDocNo="",this.ResetPage(),this._SharedObjectModelService.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}}),t.Id>0&&this._Apiservice.put(this.UpdateUrl,t,!0).pipe(N(this._Apiservice.destroy$)).subscribe({next:e=>{if(e.IsSuccess==!0&&e.Obj!=null){this._AppModeService._Toastr.success(e.Message);let n=e.Obj,h=this._SharedObjectModelService.Paging.DataReturn.find(S=>S.Id==n.Id);h!=null&&Object.assign(h,n),this.ResetPage(),this.GetPageInfo()}else this._AppModeService._Toastr.error(e.Message)}})}ConfirmDelete(t,e=void 0){e!=null&&e!=null&&(e.Id>0||e.Id!="")&&(this.Invoice.Id=e.Id),this._AppModeService._NgbModal.open(t,{size:"xxl",centered:!0})}ResetPage(){this._AppModeService.DisabledButton=!1,this.Invoice={InvoiceCollected:!1,ClientType:2,DocNo:0,DocDate:"",InvoiceDetails:[],TotalInvoice:0,TotalDiscRate:0,TotalDisc:0,TotalInvoiceAfterDisc:0,TotalInvoiceAfterVat:0,TotalInvoiceVatAmount:0,TotalVatRate:0,Cash:"",Visa:"",Debt:"",TreasuryId:null,TreasuryName:"",BankAccountId:null,BankAccountName:"",EmployeeId:null,EmployeeName:"",StoreId:null,StoreName:"",ClientId:null,ClientName:"",SupplierId:null,SupplierName:"",Id:0,PaymentType:1,Name:"",Notes:"",Code:"",InvoiceCollection:0},this.InvoiceCash=0,this.InvoiceVisa=0,this.InvoiceDept=0,this._DefaultSettingsService.ResetDate(this.Invoice),this.HandleMyDefaultSettings()}trackByMethod(t,e){return e.Id}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};v.\u0275fac=function(e){return new(e||v)(B(J),B(ye),B(Ce),B(pe),B(X))},v.\u0275cmp=j({type:v,selectors:[["app-dynamic-return-invoice"]],viewQuery:function(e,n){if(e&1&&(Q(Re,5),Q(we,5)),e&2){let h;F(h=W())&&(n.GLComponent=h.first),F(h=W())&&(n.ContentModel=h.first)}},inputs:{SignalR:"SignalR",GlResponse:"GlResponse",TablePaging:"TablePaging",PageTitle:"PageTitle",ScreenName:"ScreenName",InvoiceName:"InvoiceName",PrintUrl:"PrintUrl",AddUrl:"AddUrl",UpdateUrl:"UpdateUrl",DeleteUrl:"DeleteUrl",GetById:"GetById"},standalone:!0,features:[L,G],decls:5,vars:8,consts:[["content",""],["GLComponent",""],["SelectTreasury",""],["SelectBank",""],["SelectEmployee",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","PrintUrl","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0","Invoicemodalbody"],[1,"d-flex","flex-wrap","justify-content-between","align-items-end","col-12","py-2"],["class","col-12 col-sm-6 col-md-4 col-lg-2 p-1 d-flex flex-wrap ",4,"ngIf"],[1,"col-12","col-sm-3","col-md-2","text-center","p-1","d-flex","flex-wrap","border","border-1","border-info","py-3"],[1,"col-6","m-0"],["class","col-6",4,"ngIf"],[1,"col-12","col-sm-9","col-md-6","text-center","Info","d-flex","flex-wrap"],["class","d-block col-12 col-sm-4 border border-1 border-info text-center py-3",4,"ngIf"],["id","Table",1,"table-responsive-vertical","shadow-z-1","mt-2","mb-0","pb-0"],[1,"table","table-hover","table-striped","table-light","m-0","p-0"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"bg-white","d-flex","flex-wrap","align-items-end","col-12"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","col-xl-1","p-1"],["for","DocNo"],["type","number","appNumericInput","",1,"form-control","text-center",3,"value","disabled"],[1,"col-12","col-md-8","col-lg-4","col-xl-3","px-0","d-flex","flex-wrap","align-items-end"],[1,"col-12","col-md-6","px-md-1","my-1","my-lg-0"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],["for","DocNo",4,"ngIf"],["class","d-block text-center ",4,"ngIf"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12","class"," shadow-none text-center w-100",3,"ngModel","showTime","showIcon","showOnFocus","showOtherMonths","ngModelChange",4,"ngIf"],[1,"col-12","col-md-8","col-lg-4","col-xl-3","px-0","d-flex","flex-wrap","align-items-center"],[1,"m-0"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"ngModelChange","items","disabled","virtualScroll","ngModel"],["ng-option-tmp",""],["class","col-12 col-md-6 px-md-1 my-1 my-lg-0",4,"ngIf"],[1,"bg-white","col-12","py-2","p-2","d-flex","flex-wrap"],[1,"col-12","col-md-4","col-lg-2","col-xl-1","px-1","my-1","my-lg-0"],[1,"my-1"],["name","","id","",1,"form-select",3,"change","ngModelChange","ngModel"],[3,"value"],[3,"value",4,"ngIf"],["class","col-12 col-md-8 col-lg-4 col-xl-3 px-0 d-flex flex-wrap align-items-center",4,"ngIf"],["class","col-12 col-md-4 col-lg-2 my-1 px-2",4,"ngIf"],[1,"col-12","col-md-4","col-lg-2","px-3","my-1","my-lg-0"],["class","my-1",4,"ngIf"],["id","Debt","min","0","type","number","appNumericInput","","class","form-control shadow-none text-center",3,"disabled","value",4,"ngIf"],[1,"TotalContainer","d-flex","flex-wrap","justify-content-around"],[1,"mx-auto","px-0","text-center"],["for","TotalInvoice",1,"text-white","m-0","p-0","text-center"],[1,"d-block","m-0","p-0","text-center"],[1,"mx-auto","p-0","text-center"],["for","TotalDiscount",1,"text-white","m-0","p-0","text-center"],["for","TotalDiscRate",1,"text-white","m-0","p-0","text-center"],["for","TotalVat",1,"text-white","m-0","p-0","text-center"],["for","TotalAfterVat",1,"text-white","m-0","p-0","text-center"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],["class","btn btn-success py-3 px-5",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["class","btn btn-info mx-3 py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-light","border","border-1","border-dark","px-5","py-3",3,"click"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","p-1","d-flex","flex-wrap"],[1,"col-9","px-1"],["min","0","id","InvoiceNo","type","number","appNumericInput","","autofocus","",1,"form-control","shadow-none","text-center",3,"keyup","change","ngModelChange","ngModel","placeholder"],[1,"btn","btn-primary","text-center","d-block","col-3","px-3",3,"click","disabled"],[1,"col-6"],[1,"d-block","col-12","col-sm-4","border","border-1","border-info","text-center","py-3"],[1,"",3,"title"],[1,"text-center",3,"title"],[4,"ngFor","ngForOf"],[3,"title"],[1,"text-dark"],[1,"col-10","col-xl-12","mx-auto"],["min","0","type","number","appNumericInput","",1,"form-control","text-center","mx-auto",3,"change","keyup","ngModelChange","id","name","ngModel"],["class","text-dark text-center d-block",4,"ngIf"],[1,"text-dark","text-center","d-block"],[1,"d-block","text-center"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"col-12","col-md-6","p-md-1","my-1","my-lg-0"],["min","0","type","number","appNumericInput","","id","Cash",1,"form-control","py-2","shadow-none","text-center",3,"keyup","change","ngModelChange","placeholder","disabled","ngModel"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","change","scrollToEnd","close","open","ngModelChange","items","autofocus","virtualScroll","searchable","disabled","ngModel"],["ng-header-tmp",""],[1,"form-text","text-muted"],["min","0","type","number","appNumericInput","","id","Visa",1,"form-control","py-2","shadow-none","text-center",3,"keyup","change","ngModelChange","placeholder","disabled","ngModel"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","change","scrollToEnd","close","open","ngModelChange","items","virtualScroll","searchable","disabled","ngModel"],[1,"col-12","col-md-4","col-lg-2","my-1","px-2"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","change","scrollToEnd","close","open","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["id","Debt","min","0","type","number","appNumericInput","",1,"form-control","shadow-none","text-center",3,"disabled","value"],[1,"btn","btn-success","py-3","px-5",3,"click","disabled"],[1,"fs-5","mx-1"],[1,"mx-1","pi","pi-save"],["class","btn btn-primary py-3 px-5",3,"disabled","click",4,"ngIf"],[1,"btn","btn-primary","py-3","px-5",3,"click","disabled"],[1,"btn","btn-info","mx-3","py-3","px-5",3,"click"]],template:function(e,n){if(e&1){let h=T();a(0,"app-dynamic-component",5),f("OpenModalEvent",function(){return u(h),m(n.OpenModal())})("ShowToEditeEvent",function(){return u(h),m(n.ShowToEdite())}),c(),g(1,ut,140,109,"ng-template",null,0,$),R(3,"app-glsheard",null,1)}if(e&2){let h=D(2);d("PageTitle",n.PageTitle)("TablePaging",n.TablePaging)("FullScreen",!0)("GlResponse",!0)("GetById",n.GetById)("PrintUrl",n.PrintUrl)("DeleteUrl",n.DeleteUrl)("OutModal",h)}},dependencies:[Y,Ie,de,ve,me,_e,ue,se,ae,ce,te,oe,re,ie,le,ne,q,z,he,ee,Z,fe,be,ge,Se]});let r=v;return r})();export{kt as a};
