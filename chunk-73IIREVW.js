import{a as ue}from"./chunk-NNHHLG53.js";import{g as ce,h as le,o as de,s as pe,x as se}from"./chunk-RAAURFHQ.js";import"./chunk-UVSBIWKY.js";import"./chunk-5EQTOVFJ.js";import{a as me}from"./chunk-OZ63RRZR.js";import{g as oe,h as ae}from"./chunk-3T7HRBK4.js";import"./chunk-G323P4PR.js";import"./chunk-NZD6IPKE.js";import"./chunk-EKOK3I7J.js";import{a as ee,b as te,c as ie,d as re}from"./chunk-SU7IEUNK.js";import"./chunk-MYPGER6Q.js";import{k as ne}from"./chunk-CETGYK4I.js";import{c as Z}from"./chunk-F7IHWOEY.js";import{b as L,c as z,d as H}from"./chunk-GJAIQ3XH.js";import{c as k,d as $,g as K,i as q,l as J,n as Q,t as X,v as Y}from"./chunk-UA6GT64L.js";import{G as W,e as F}from"./chunk-GOUT62LL.js";import{$b as A,Cb as l,Db as a,Eb as y,Ib as I,Mb as f,Nb as g,Wb as v,X as M,Xb as _,Yb as C,Zb as x,_b as T,ac as E,bc as G,cc as U,db as c,dc as B,eb as w,ec as O,ia as j,na as D,nc as h,oc as S,vb as b,xa as p,xb as P,ya as s}from"./chunk-RH76WUG2.js";import{a as R,b as N}from"./chunk-3EYC4JTX.js";var _e=()=>({"min-width":"75rem"}),ge=()=>["Name"];function Pe(n,d){if(n&1&&(l(0,"small",26),_(1),a()),n&2){let i=g();c(),T("Loaded ",i.Groups.length," of ",i._SharedObjectModelService.TotalItems,"")}}function he(n,d){if(n&1&&_(0),n&2){let i=d.item;x(" ",i.Name," ")}}function Se(n,d){if(n&1&&(l(0,"small",26),_(1),a()),n&2){let i=g();c(),T("Loaded ",i.Items.length," of ",i._SharedObjectModelService.TotalItems,"")}}function fe(n,d){if(n&1&&_(0),n&2){let i=d.item;x(" ",i.NameAndCode," ")}}function Ce(n,d){if(n&1){let i=I();l(0,"button",27),f("click",function(){p(i);let r=g();return s(r.EmptyPage())}),_(1),h(2,"translate"),a()}n&2&&(c(),C(S(2,1,"Model.ResetPage")))}function Ie(n,d){if(n&1){let i=I();l(0,"button",28),f("click",function(){p(i);let r=g();return s(r.Send())}),_(1),h(2,"translate"),y(3,"i",29),a()}n&2&&(c(),x("",S(2,1,"Model.Send")," "))}function be(n,d){if(n&1){let i=I();l(0,"div",30)(1,"p-button",31),f("onClick",function(){p(i);let r=g();return s(r.ExpandAll())}),a(),l(2,"p-button",32),f("onClick",function(){p(i);let r=g();return s(r.CollapseAll())}),a()()}}function ve(n,d){n&1&&(l(0,"tr")(1,"th",33),_(2),h(3,"translate"),a(),l(4,"th",34),_(5),h(6,"translate"),a(),l(7,"th",34),_(8),h(9,"translate"),a(),l(10,"th"),_(11,"-"),a()()),n&2&&(c(2),C(S(3,3,"Table.Units")),c(3),C(S(6,5,"Table.Name")),c(3),C(S(9,7,"Table.WA")))}function xe(n,d){if(n&1){let i=I();l(0,"tr")(1,"td"),y(2,"p-button",35),a(),l(3,"td")(4,"span",36),_(5),a()(),l(6,"td")(7,"span",36),_(8),a()(),l(9,"td")(10,"button",37),f("click",function(){let r=p(i).$implicit,e=g();return s(e.RemoveProcut(r))}),y(11,"i",38),a()()()}if(n&2){let i=d.$implicit,t=d.expanded,r=g();c(2),P("pRowToggler",i)("text",!0)("rounded",!0)("plain",!0)("icon",t?"pi pi-chevron-down":r._Apiservice.Language=="ar"?"pi pi-chevron-left":"pi pi-chevron-right"),c(3),C(i.ProductName),c(3),C(i.WA)}}function Te(n,d){n&1&&(l(0,"tr")(1,"th"),_(2),h(3,"translate"),a(),l(4,"th"),_(5),h(6,"translate"),a()()),n&2&&(c(2),x("",S(3,2,"Table.Name")," "),c(3),C(S(6,4,"Table.Price")))}function Me(n,d){if(n&1&&(l(0,"span",46),_(1),h(2,"translate"),a()),n&2){let i=g().$implicit,t=g(2);c(),T(" ",S(2,2,"ProductPricing.Hamesh")," => ",(t.ConvertNumber(i.ProductUnitPrice)-t.ConvertNumber(i.ProductUnitWA)).toFixed(2),"")}}function we(n,d){if(n&1&&(l(0,"span",47),_(1),h(2,"translate"),a()),n&2){let i=g().$implicit,t=g(2);c(),T(" ",S(2,2,"ProductPricing.Hamesh")," => ",(t.ConvertNumber(i.ProductUnitPrice)-t.ConvertNumber(i.ProductUnitWA)).toFixed(2)," ")}}function ye(n,d){if(n&1){let i=I();l(0,"tr")(1,"td",41)(2,"span",42),_(3),a(),b(4,Me,3,4,"span",43)(5,we,3,4,"span",44),a(),l(6,"td")(7,"input",45),G("ngModelChange",function(r){let e=p(i).$implicit;return E(e.ProductUnitPrice,r)||(e.ProductUnitPrice=r),s(r)}),a()()()}if(n&2){let i=d.$implicit,t=g(2);c(3),T(" ",i.ProductUnitName," - ",i.ProductUnitWA,""),c(),P("ngIf",t.ConvertNumber(i.ProductUnitPrice)-t.ConvertNumber(i.ProductUnitWA)<0),c(),P("ngIf",t.ConvertNumber(i.ProductUnitPrice)-t.ConvertNumber(i.ProductUnitWA)>=0),c(2),A("ngModel",i.ProductUnitPrice)}}function Ve(n,d){if(n&1&&(l(0,"tr")(1,"td",39)(2,"p-table",40),b(3,Te,7,6,"ng-template",21)(4,ye,8,5,"ng-template",22),a()()()),n&2){let i=d.$implicit;c(2),P("value",i.ProductPricingDetails)}}function Ae(n,d){if(n&1){let i=I();l(0,"p-paginator",48),f("onPageChange",function(r){p(i);let e=g();return s(e.onPageChange(r))}),a()}if(n&2){let i=g();P("first",i._SharedObjectModelService.Paging.CurrentPage)("rows",i._SharedObjectModelService.Paging.PageSize)("totalRecords",i._SharedObjectModelService.Paging.TotalItems)("rowsPerPageOptions",i._AppModeService.RowCount)}}function Ee(n,d){if(n&1){let i=I();l(0,"p-paginator",49),f("onPageChange",function(r){p(i);let e=g();return s(e.onPageChange(r))}),a()}if(n&2){let i=g();P("first",i._SharedObjectModelService.Paging.CurrentPage)("rows",i._SharedObjectModelService.Paging.PageSize)("totalRecords",i._SharedObjectModelService.Paging.TotalItems)}}var it=(()=>{let d=class d{constructor(t,r,e,o){this._AppModeService=t,this._SharedObjectModelService=r,this.Translate=e,this._Apiservice=o,this._ServiceLifeTime=j(k),this.ProductPricing=[],this.Groups=[],this.Items=[],this.SearchModel={ProductId:null,ProductGroupId:null},this.expandedRows={}}ngOnInit(){this._SharedObjectModelService.Paging={PageSize:10,CurrentPage:1,TotalPages:0,TotalItems:0,DataReturn:[]}}ChangeSearchApi(t,r){let e=`${r.searchTerm}`.trim();(e==""||e=="null")&&(r.searchTerm="",e=""),this._AppModeService.CurrentPage+=1;let o={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:e,SearchField:"Name"};t=="Storages"&&(o.BranchFilter=!0),t=="Items"&&(o.Columns=["Id","Name","Code"],this.SearchModel.ProductGroupId>0&&(o.Conditions=` ItemGroupId = ${this.SearchModel.ProductGroupId}`)),t=="ItemsCode"&&(o.TableName="Items",o.Columns=["Id","Name","Code"],o.SearchText=r,this.SearchModel.ProductGroupId>0&&(o.Conditions=`ProductType != 2 And ItemGroupId = ${this.SearchModel.ProductGroupId}`)),this._Apiservice.post("Global/GetAll",o,!1).pipe(M(this._ServiceLifeTime.Destroyed$)).subscribe({next:u=>{this.HandleResponse(u.Obj,t)}})}HandleResponse(t,r){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,r=="ItemGroups"&&(this.Groups=this._SharedObjectModelService.RemoveDuplicates(this.Groups.concat(t.DataReturn),"Id")),r=="Items"&&(this.Items=this._SharedObjectModelService.RemoveDuplicates(this.Items.concat(t.DataReturn),"Id"),this.Items=this.Items.map(e=>N(R({},e),{NameAndCode:`${e.Name} - ${e.Code}`}))),r=="ItemsCode"&&(this.Items=t.DataReturn,this.Items=this.Items.map(e=>N(R({},e),{NameAndCode:`${e.Name} - ${e.Code}`})))}SelectValue(t,r){if(t!=null&&(t>0||t!="")){let e=[];r=="ProductGroup"&&(e=this.Groups),r=="Product"&&(e=this.Items);let o=e.find(u=>u.Id==t);if(o==null){this._AppModeService.DontPlay();return}else this.SearchModel[`${r}Id`]=t,this.SearchModel[`${r}Name`]=o.Name}else this.SearchModel[`${r}Id`]=null,this.SearchModel[`${r}Name`]=""}ConvertNumber(t){return Number(t)}Search(){if(this.SearchModel.ProductId==null&&this.SearchModel.ProductGroupId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductPricing.Error.GroupOrProduct"));return}let t={ProductId:this.SearchModel.ProductId==null?0:this.SearchModel.ProductId,ProductGroupId:this.SearchModel.ProductGroupId==null?0:this.SearchModel.ProductGroupId,CurrentPage:1,PageSize:this._SharedObjectModelService.Paging.PageSize};this._Apiservice.post("ProductPricingEP/GetPageInfo",t,!0).pipe(M(this._ServiceLifeTime.Destroyed$)).subscribe({next:r=>{this.ProductPricing=this._SharedObjectModelService.RemoveDuplicates(this.ProductPricing.concat(r.Obj.DataReturn),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=r.Obj.TotalItems,this.SearchModel.ProductId=null}})}onPageChange(t){t.page++,t.first,t.rows,this._SharedObjectModelService.Paging.CurrentPage=t.first,this._SharedObjectModelService.Paging.PageSize=t.rows;let r={ItemId:this.SearchModel.ItemId==null?0:this.SearchModel.ItemId,ItemGroupId:this.SearchModel.ItemGroupId==null?0:this.SearchModel.ItemGroupId,PageSize:this._SharedObjectModelService.Paging.PageSize,CurrentPage:t.page};this._Apiservice.post("ProductPricingEP/GetPageInfo",r,!0).pipe(M(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this.ProductPricing=this._SharedObjectModelService.RemoveDuplicates(this.ProductPricing.concat(e.Obj.DataReturn),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=e.Obj.TotalItems}})}RemoveProcut(t){this.ProductPricing=this.ProductPricing.filter(r=>r.ProductId!=t.ProductId)}ExpandAll(){this.expandedRows=this.ProductPricing.reduce((t,r)=>(t[r.ProductId]=!0)&&t,{})}CollapseAll(){this.expandedRows={}}Send(){for(let t=0;t<this.ProductPricing.length;t++){let r=this.ProductPricing[t].ProductPricingDetails;for(let e=0;e<r.length;e++){let o=r[e],u=t+1,m=Number(o.ProductUnitWA),V=Number(o.ProductUnitPrice);if(V<0||isNaN(V)){this._AppModeService._Toastr.error(this.Translate.instant("ProductPricing.Error.ErrorNumber")+" "+u);return}if(m>0&&V<m){this._AppModeService._Toastr.error(this.Translate.instant("ProductPricing.Error.SmallWA")+" "+u);return}o.ProductUnitPrice=V}}this._Apiservice.post("ProductPricingEP/Add",this.ProductPricing,!0).pipe(M(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{this._AppModeService._Toastr.success(this.Translate.instant("Success.AddSuccess")),this.EmptyPage()}})}EmptyPage(){this.SearchModel={ItemGroupId:null,ItemId:null},this.ProductPricing=[]}ngOnDestroy(){}};d.\u0275fac=function(r){return new(r||d)(w(Z),w(me),w(L),w($))},d.\u0275cmp=D({type:d,selectors:[["app-product-pricing"]],standalone:!0,features:[U([k]),B],decls:39,vars:35,consts:[["SelectGroup",""],["SelectFromStore",""],["dt1",""],["clas","bg-light"],[1,"title-box","font-weight-normal"],[1,"min","border"],[1,"d-flex","flex-wrap","align-items-end","py-2","col-12"],[1,"col-12","col-md-3","p-2"],["for","FromStoreId",1,"my-1"],["placeholder","Search","appendTo","div","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],[1,"col-12","col-md-6","p-2"],[1,"btn-Add","btn",3,"click"],[1,"mx-1","pi","pi-search"],["class","btn-Delete btn-Page  btn",3,"click",4,"ngIf"],["type","button","class","btn-Add btn",3,"click",4,"ngIf"],[1,"DivPaging","col-12","p-0","table-responsive"],["dataKey","ProductId","sortMode","multiple",3,"value","expandedRowKeys","lazy","scrollable","paginator","rows","tableStyle","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["appendTo","table",3,"first","rows","totalRecords","rowsPerPageOptions","onPageChange",4,"ngIf"],["appendTo","table",3,"first","rows","totalRecords","onPageChange",4,"ngIf"],[1,"form-text","text-muted"],[1,"btn-Delete","btn-Page","btn",3,"click"],["type","button",1,"btn-Add","btn",3,"click"],[1,"mx-1","pi","pi-save"],[1,"flex","flex-wrap","justify-content-end","gap-2","CollapseGroup"],["icon","pi pi-plus","text","",3,"onClick"],["icon","pi pi-minus","text","",3,"onClick"],[1,"col-2"],[1,"col-6"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon"],[1,"text-dark","d-block","text-center"],[1,"btn","btn-Delete",3,"click"],[1,"mx-1","pi","pi-trash","fw-bold"],["colspan","7",1,"p-0"],["dataKey","ProductId",3,"value"],[1,"p-1"],[1,"text-dark"],["class","d-block text-center my-1 text-danger",4,"ngIf"],["class","d-block text-center my-1 text-success",4,"ngIf"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"d-block","text-center","my-1","text-danger"],[1,"d-block","text-center","my-1","text-success"],["appendTo","table",3,"onPageChange","first","rows","totalRecords","rowsPerPageOptions"],["appendTo","table",3,"onPageChange","first","rows","totalRecords"]],template:function(r,e){if(r&1){let o=I();l(0,"section",3)(1,"div",4)(2,"h4"),_(3),h(4,"translate"),a()(),l(5,"div",5)(6,"div",6)(7,"div",7)(8,"p",8),_(9),h(10,"translate"),a(),l(11,"ng-select",9,0),f("clear",function(){return p(o),s(e.Groups=[])})("focus",function(){p(o);let m=v(12);return e.ChangeSearchApi("ItemGroups",m),s(e._AppModeService.ResetCurrentPage())})("keyup",function(){p(o);let m=v(12);return e.ChangeSearchApi("ItemGroups",m),s(e._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(o);let m=v(12);return s(e.ChangeSearchApi("ItemGroups",m))})("close",function(){return p(o),s(e._AppModeService.ResetCurrentPage())})("open",function(){return p(o),s(e._AppModeService.ResetCurrentPage())})("change",function(){return p(o),e.SelectValue(e.SearchModel.ProductGroupId,"ProductGroup"),e.SearchModel.ProductId=null,s(e.Items=[])}),G("ngModelChange",function(m){return p(o),E(e.SearchModel.ProductGroupId,m)||(e.SearchModel.ProductGroupId=m),s(m)}),b(13,Pe,2,2,"ng-template",10)(14,he,1,1,"ng-template",11),a()(),l(15,"div",7)(16,"p",8),_(17),h(18,"translate"),a(),l(19,"ng-select",12,1),f("clear",function(){return p(o),s(e.Items=[])})("focus",function(){p(o);let m=v(20);return e.ChangeSearchApi("Items",m),s(e._AppModeService.ResetCurrentPage())})("keyup",function(){p(o);let m=v(20);return e.ChangeSearchApi("Items",m),s(e._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(o);let m=v(20);return s(e.ChangeSearchApi("Items",m))})("close",function(){return p(o),s(e._AppModeService.ResetCurrentPage())})("open",function(){return p(o),s(e._AppModeService.ResetCurrentPage())})("change",function(){return p(o),s(e.SelectValue(e.SearchModel.ProductId,"Product"))}),G("ngModelChange",function(m){return p(o),E(e.SearchModel.ProductId,m)||(e.SearchModel.ProductId=m),s(m)}),b(21,Se,2,2,"ng-template",10)(22,fe,1,1,"ng-template",11),a()(),l(23,"div",13)(24,"button",14),f("click",function(){return p(o),s(e.Search())}),_(25),h(26,"translate"),y(27,"i",15),a(),b(28,Ce,3,3,"button",16)(29,Ie,4,3,"button",17),a()(),l(30,"div",18)(31,"p-table",19,2),b(33,be,3,0,"ng-template",20)(34,ve,12,9,"ng-template",21)(35,xe,12,7,"ng-template",22)(36,Ve,5,1,"ng-template",23),a(),b(37,Ae,1,4,"p-paginator",24)(38,Ee,1,3,"p-paginator",25),a()()()}r&2&&(c(3),C(S(4,25,"ProductPricing.ProductPricing")),c(6),C(S(10,27,"Item.ItemGroup")),c(2),P("items",e.Groups)("virtualScroll",!0)("searchable",!0),A("ngModel",e.SearchModel.ProductGroupId),c(6),C(S(18,29,"Table.Item")),c(2),P("items",e.Items)("autofocus",!1)("virtualScroll",!0)("searchable",!0),A("ngModel",e.SearchModel.ProductId),c(6),x("",S(26,31,"Model.Search")," "),c(3),P("ngIf",e.ProductPricing.length>0),c(),P("ngIf",e.ProductPricing.length>0),c(2),P("value",e.ProductPricing)("expandedRowKeys",e.expandedRows)("lazy",!0)("scrollable",!0)("paginator",!1)("rows",e._SharedObjectModelService.Paging.PageSize)("tableStyle",O(33,_e))("globalFilterFields",O(34,ge)),c(6),P("ngIf",e._SharedObjectModelService.Paging.TotalItems>=10),c(),P("ngIf",e._SharedObjectModelService.Paging.TotalItems<10))},dependencies:[W,F,Y,K,Q,q,X,J,H,z,re,ie,ee,te,le,ce,ne,se,de,pe,ae,oe,ue],styles:[".min[_ngcontent-%COMP%]{min-height:100vh}"]});let n=d;return n})();export{it as ProductPricingComponent};
