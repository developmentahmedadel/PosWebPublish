import{a as se}from"./chunk-VSYXDL23.js";import{g as ne,h as oe,j as ae,n as ce,s as le}from"./chunk-CCUNZCGD.js";import{a as pe}from"./chunk-6KCN6SOZ.js";import"./chunk-OFCF557E.js";import{h as ie,i as re}from"./chunk-PHRVA4P6.js";import"./chunk-5KZZH3PQ.js";import"./chunk-ENJ54XRO.js";import{a as X,b as Y,c as Z,d as ee}from"./chunk-ZWNSIIKM.js";import"./chunk-KZSRC3MR.js";import{k as te}from"./chunk-TQD4QWDO.js";import{b as W,c as F,d as $,g as Q}from"./chunk-JS2GAZTB.js";import{F as U,I as B,_ as z,aa as L,d as D,da as H,fa as K,la as q,na as J}from"./chunk-WSHLQXZC.js";import{$b as A,Cb as l,Db as a,Eb as N,Ib as C,Mb as I,Nb as g,Wb as b,X as M,Xb as _,Yb as f,Zb as y,_b as x,ac as V,bc as E,db as c,dc as k,eb as T,ec as O,na as j,nc as h,oc as S,vb as v,xa as d,xb as P,ya as u}from"./chunk-J5UB44FZ.js";import{a as G,b as R}from"./chunk-3EYC4JTX.js";var de=()=>({"min-width":"75rem"}),ue=()=>["Name"];function me(n,p){if(n&1&&(l(0,"small",29),_(1),a()),n&2){let r=g();c(),x("Loaded ",r.Groups.length," of ",r._SharedObjectModelService.TotalItems,"")}}function _e(n,p){if(n&1&&_(0),n&2){let r=p.item;y(" ",r.Name," ")}}function ge(n,p){if(n&1&&(l(0,"small",29),_(1),a()),n&2){let r=g();c(),x("Loaded ",r.Items.length," of ",r._SharedObjectModelService.TotalItems,"")}}function Pe(n,p){if(n&1&&_(0),n&2){let r=p.item;y(" ",r.NameAndCode," ")}}function he(n,p){if(n&1){let r=C();l(0,"button",30),I("click",function(){d(r);let i=g();return u(i.EmptyPage())}),_(1),h(2,"translate"),a()}n&2&&(c(),f(S(2,1,"Model.ResetPage")))}function Se(n,p){if(n&1){let r=C();l(0,"button",31),I("click",function(){d(r);let i=g();return u(i.Send())}),_(1),h(2,"translate"),a()}n&2&&(c(),f(S(2,1,"Model.Send")))}function fe(n,p){if(n&1){let r=C();l(0,"div",32)(1,"p-button",33),I("onClick",function(){d(r);let i=g();return u(i.ExpandAll())}),a(),l(2,"p-button",34),I("onClick",function(){d(r);let i=g();return u(i.CollapseAll())}),a()()}}function Ie(n,p){n&1&&(l(0,"tr")(1,"th",35),_(2),h(3,"translate"),a(),l(4,"th",36),_(5),h(6,"translate"),a(),l(7,"th",36),_(8),h(9,"translate"),a(),l(10,"th"),_(11,"-"),a()()),n&2&&(c(2),f(S(3,3,"Table.Units")),c(3),f(S(6,5,"Table.Name")),c(3),f(S(9,7,"Table.WA")))}function Ce(n,p){if(n&1){let r=C();l(0,"tr")(1,"td"),N(2,"p-button",37),a(),l(3,"td")(4,"span",38),_(5),a()(),l(6,"td")(7,"span",38),_(8),a()(),l(9,"td")(10,"p-button",39),I("click",function(){let i=d(r).$implicit,e=g();return u(e.RemoveProcut(i))}),a()()()}if(n&2){let r=p.$implicit,t=p.expanded,i=g();c(2),P("pRowToggler",r)("text",!0)("rounded",!0)("plain",!0)("icon",t?"pi pi-chevron-down":i._Apiservice.Language=="ar"?"pi pi-chevron-left":"pi pi-chevron-right"),c(3),f(r.ProductName),c(3),f(r.WA),c(2),P("icon","pi pi-trash")}}function ve(n,p){n&1&&(l(0,"tr")(1,"th"),_(2),h(3,"translate"),a(),l(4,"th"),_(5),h(6,"translate"),a()()),n&2&&(c(2),y("",S(3,2,"Table.Name")," "),c(3),f(S(6,4,"Table.Price")))}function be(n,p){if(n&1&&(l(0,"span",47),_(1),h(2,"translate"),a()),n&2){let r=g().$implicit,t=g(2);c(),x(" ",S(2,2,"ProductPricing.Hamesh")," => ",(t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)).toFixed(2),"")}}function xe(n,p){if(n&1&&(l(0,"span",48),_(1),h(2,"translate"),a()),n&2){let r=g().$implicit,t=g(2);c(),x(" ",S(2,2,"ProductPricing.Hamesh")," => ",(t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)).toFixed(2)," ")}}function Me(n,p){if(n&1){let r=C();l(0,"tr")(1,"td",42)(2,"span",43),_(3),a(),v(4,be,3,4,"span",44)(5,xe,3,4,"span",45),a(),l(6,"td")(7,"input",46),E("ngModelChange",function(i){let e=d(r).$implicit;return V(e.ProductUnitPrice,i)||(e.ProductUnitPrice=i),u(i)}),a()()()}if(n&2){let r=p.$implicit,t=g(2);c(3),x(" ",r.ProductUnitName," - ",r.ProductUnitWA,""),c(),P("ngIf",t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)<0),c(),P("ngIf",t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)>=0),c(2),A("ngModel",r.ProductUnitPrice)}}function Te(n,p){if(n&1&&(l(0,"tr")(1,"td",40)(2,"p-table",41),v(3,ve,7,6,"ng-template",24)(4,Me,8,5,"ng-template",25),a()()()),n&2){let r=p.$implicit;c(2),P("value",r.ProductPricingDetails)}}function we(n,p){if(n&1){let r=C();l(0,"p-paginator",49),I("onPageChange",function(i){d(r);let e=g();return u(e.onPageChange(i))}),a()}if(n&2){let r=g();P("first",r._SharedObjectModelService.Paging.CurrentPage)("rows",r._SharedObjectModelService.Paging.PageSize)("totalRecords",r._SharedObjectModelService.Paging.TotalItems)("rowsPerPageOptions",r._AppModeService.RowCount)}}function ye(n,p){if(n&1){let r=C();l(0,"p-paginator",50),I("onPageChange",function(i){d(r);let e=g();return u(e.onPageChange(i))}),a()}if(n&2){let r=g();P("first",r._SharedObjectModelService.Paging.CurrentPage)("rows",r._SharedObjectModelService.Paging.PageSize)("totalRecords",r._SharedObjectModelService.Paging.TotalItems)}}var Qe=(()=>{let p=class p{constructor(t,i,e,o){this._AppModeService=t,this._SharedObjectModelService=i,this.Translate=e,this._Apiservice=o,this.ProductPricing=[],this.Groups=[],this.Items=[],this.SearchModel={ProductId:null,ProductGroupId:null},this.expandedRows={}}ngOnInit(){this._SharedObjectModelService.Paging={PageSize:10,CurrentPage:1,TotalPages:0,TotalItems:0,DataReturn:[]}}ChangeSearchApi(t,i){let e=`${i.searchTerm}`.trim();(e==""||e=="null")&&(i.searchTerm="",e=""),this._AppModeService.CurrentPage+=1;let o={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:e,SearchField:"Name"};t=="Storages"&&(o.BranchFilter=!0),t=="Items"&&(o.Columns=["Id","Name","Code"],this.SearchModel.ProductGroupId>0&&(o.Conditions=` ItemGroupId = ${this.SearchModel.ProductGroupId}`)),t=="ItemsCode"&&(o.TableName="Items",o.Columns=["Id","Name","Code"],o.SearchText=i,this.SearchModel.ProductGroupId>0&&(o.Conditions=`ProductType != 2 And ItemGroupId = ${this.SearchModel.ProductGroupId}`)),this._Apiservice.post("Global/GetAll",o,!1).pipe(M(this._Apiservice.destroy$)).subscribe({next:s=>{s.IsSuccess==!0&&s.Obj!=null?this.HandleResponse(s.Obj,t):this._AppModeService._Toastr.error(s.Message)}})}HandleResponse(t,i){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,i=="ItemGroups"&&(this.Groups=this._SharedObjectModelService.RemoveDuplicates(this.Groups.concat(t.DataReturn),"Id")),i=="Items"&&(this.Items=this._SharedObjectModelService.RemoveDuplicates(this.Items.concat(t.DataReturn),"Id"),this.Items=this.Items.map(e=>R(G({},e),{NameAndCode:`${e.Name} - ${e.Code}`}))),i=="ItemsCode"&&(this.Items=t.DataReturn,this.Items=this.Items.map(e=>R(G({},e),{NameAndCode:`${e.Name} - ${e.Code}`})))}SelectValue(t,i){if(t!=null&&(t>0||t!="")){let e=[];i=="ProductGroup"&&(e=this.Groups),i=="Product"&&(e=this.Items);let o=e.find(s=>s.Id==t);if(o==null){this._AppModeService.DontPlay();return}else this.SearchModel[`${i}Id`]=t,this.SearchModel[`${i}Name`]=o.Name}else this.SearchModel[`${i}Id`]=null,this.SearchModel[`${i}Name`]=""}ConvertNumber(t){return Number(t)}Search(){if(this.SearchModel.ProductId==null&&this.SearchModel.ProductGroupId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductPricing.Error.GroupOrProduct"));return}let t={ProductId:this.SearchModel.ProductId==null?0:this.SearchModel.ProductId,ProductGroupId:this.SearchModel.ProductGroupId==null?0:this.SearchModel.ProductGroupId,CurrentPage:1,PageSize:this._SharedObjectModelService.Paging.PageSize};this._Apiservice.post("ProductPricingEP/GetPageInfo",t,!0).pipe(M(this._Apiservice.destroy$)).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?(this.ProductPricing=this._SharedObjectModelService.RemoveDuplicates(this.ProductPricing.concat(i.Obj.DataReturn),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=i.Obj.TotalItems,this.SearchModel.ProductId=null):this._AppModeService._Toastr.error(i.Message)}})}onPageChange(t){t.page++,t.first,t.rows,this._SharedObjectModelService.Paging.CurrentPage=t.first,this._SharedObjectModelService.Paging.PageSize=t.rows;let i={ItemId:this.SearchModel.ItemId==null?0:this.SearchModel.ItemId,ItemGroupId:this.SearchModel.ItemGroupId==null?0:this.SearchModel.ItemGroupId,PageSize:this._SharedObjectModelService.Paging.PageSize,CurrentPage:t.page};this._Apiservice.post("ProductPricingEP/GetPageInfo",i,!0).pipe(M(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.ProductPricing=this._SharedObjectModelService.RemoveDuplicates(this.ProductPricing.concat(e.Obj.DataReturn),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=e.Obj.TotalItems):this._AppModeService._Toastr.error(e.Message)}})}RemoveProcut(t){this.ProductPricing=this.ProductPricing.filter(i=>i.ProductId!=t.ProductId)}ExpandAll(){this.expandedRows=this.ProductPricing.reduce((t,i)=>(t[i.Id]=!0)&&t,{})}CollapseAll(){this.expandedRows={}}Send(){for(let t=0;t<this.ProductPricing.length;t++){let i=this.ProductPricing[t].ProductPricingDetails;for(let e=0;e<i.length;e++){let o=i[e],s=t+1,m=Number(o.ProductUnitWA),w=Number(o.ProductUnitPrice);if(w<0||isNaN(w)){this._AppModeService._Toastr.error(this.Translate.instant("ProductPricing.Error.ErrorNumber")+" "+s);return}if(m>0&&w<m){this._AppModeService._Toastr.error(this.Translate.instant("ProductPricing.Error.SmallWA")+" "+s);return}o.ProductUnitPrice=w}}this._Apiservice.post("ProductPricingEP/Add",this.ProductPricing,!0).pipe(M(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this._AppModeService._Toastr.success(this.Translate.instant("Success.AddSuccess")),this.EmptyPage()):this._AppModeService._Toastr.error(t.Message)}})}EmptyPage(){this.SearchModel={ItemGroupId:null,ItemId:null},this.ProductPricing=[]}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};p.\u0275fac=function(i){return new(i||p)(T(Q),T(pe),T(W),T(B))},p.\u0275cmp=j({type:p,selectors:[["app-product-pricing"]],standalone:!0,features:[k],decls:41,vars:35,consts:[["SelectGroup",""],["SelectFromStore",""],["dt1",""],["clas","bg-light"],["id","container-page",1,"container-page","p-0","m-0"],[1,"page-wrapper","p-0","m-0"],[1,"main-content","p-0","m-0"],[1,"inner-box","min-vh-100","px-2","m-0"],[1,"title-box","font-weight-normal"],[1,"PageTitle","fs-1","fw-bold","px-2"],[1,"d-flex","flex-wrap","align-items-end","py-2","col-12"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","col-xl-2","p-1"],["for","FromStoreId",1,"my-1"],["placeholder","Search","appendTo","div","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],[1,"col-12","col-sm-6","col-md-4","mx-sm-auto","col-xl-4","p-1","text-center"],[1,"btn","btn-primary","my-3","my-md-0","py-3","mx-3","px-5","shadow-none","Save",3,"click"],["class","btn btn-info my-3 my-md-0  mx-3 py-3 px-5 shadow-none Save  ",3,"click",4,"ngIf"],["type","button","class","btn btn-success mx-3 py-3 px-5",3,"click",4,"ngIf"],[1,"col-12","card","p-0","table-responsive"],["dataKey","ProductId","sortMode","multiple",3,"value","expandedRowKeys","lazy","scrollable","paginator","rows","tableStyle","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["appendTo","table",3,"first","rows","totalRecords","rowsPerPageOptions","onPageChange",4,"ngIf"],["appendTo","table",3,"first","rows","totalRecords","onPageChange",4,"ngIf"],[1,"form-text","text-muted"],[1,"btn","btn-info","my-3","my-md-0","mx-3","py-3","px-5","shadow-none","Save",3,"click"],["type","button",1,"btn","btn-success","mx-3","py-3","px-5",3,"click"],[1,"flex","flex-wrap","justify-content-end","gap-2"],["label","Expand All","icon","pi pi-plus","text","",3,"onClick"],["label","Collapse All","icon","pi pi-minus","text","",3,"onClick"],[1,"col-2"],[1,"col-6"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon"],[1,"text-dark","d-block","text-center"],["type","button","severity","danger",3,"click","icon"],["colspan","7",1,"p-0"],["dataKey","ProductId",3,"value"],[1,"p-1"],[1,"text-dark"],["class","d-block text-center my-1 text-danger",4,"ngIf"],["class","d-block text-center my-1 text-success",4,"ngIf"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"d-block","text-center","my-1","text-danger"],[1,"d-block","text-center","my-1","text-success"],["appendTo","table",3,"onPageChange","first","rows","totalRecords","rowsPerPageOptions"],["appendTo","table",3,"onPageChange","first","rows","totalRecords"]],template:function(i,e){if(i&1){let o=C();l(0,"section",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"div",8)(6,"i",9),_(7),h(8,"translate"),a()(),l(9,"div",10)(10,"div",11)(11,"p",12),_(12),h(13,"translate"),a(),l(14,"ng-select",13,0),I("clear",function(){return d(o),u(e.Groups=[])})("focus",function(){d(o);let m=b(15);return e.ChangeSearchApi("ItemGroups",m),u(e._AppModeService.ResetCurrentPage())})("keyup",function(){d(o);let m=b(15);return e.ChangeSearchApi("ItemGroups",m),u(e._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){d(o);let m=b(15);return u(e.ChangeSearchApi("ItemGroups",m))})("close",function(){return d(o),u(e._AppModeService.ResetCurrentPage())})("open",function(){return d(o),u(e._AppModeService.ResetCurrentPage())})("change",function(){return d(o),e.SelectValue(e.SearchModel.ProductGroupId,"ProductGroup"),e.SearchModel.ProductId=null,u(e.Items=[])}),E("ngModelChange",function(m){return d(o),V(e.SearchModel.ProductGroupId,m)||(e.SearchModel.ProductGroupId=m),u(m)}),v(16,me,2,2,"ng-template",14)(17,_e,1,1,"ng-template",15),a()(),l(18,"div",11)(19,"p",12),_(20),h(21,"translate"),a(),l(22,"ng-select",16,1),I("clear",function(){return d(o),u(e.Items=[])})("focus",function(){d(o);let m=b(23);return e.ChangeSearchApi("Items",m),u(e._AppModeService.ResetCurrentPage())})("keyup",function(){d(o);let m=b(23);return e.ChangeSearchApi("Items",m),u(e._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){d(o);let m=b(23);return u(e.ChangeSearchApi("Items",m))})("close",function(){return d(o),u(e._AppModeService.ResetCurrentPage())})("open",function(){return d(o),u(e._AppModeService.ResetCurrentPage())})("change",function(){return d(o),u(e.SelectValue(e.SearchModel.ProductId,"Product"))}),E("ngModelChange",function(m){return d(o),V(e.SearchModel.ProductId,m)||(e.SearchModel.ProductId=m),u(m)}),v(24,ge,2,2,"ng-template",14)(25,Pe,1,1,"ng-template",15),a()(),l(26,"div",17)(27,"button",18),I("click",function(){return d(o),u(e.Search())}),_(28),h(29,"translate"),a(),v(30,he,3,3,"button",19)(31,Se,3,3,"button",20),a()(),l(32,"div",21)(33,"p-table",22,2),v(35,fe,3,0,"ng-template",23)(36,Ie,12,9,"ng-template",24)(37,Ce,11,8,"ng-template",25)(38,Te,5,1,"ng-template",26),a(),v(39,we,1,4,"p-paginator",27)(40,ye,1,3,"p-paginator",28),a()()()()()()}i&2&&(c(7),f(S(8,25,"ProductPricing.ProductPricing")),c(5),f(S(13,27,"Item.ItemGroup")),c(2),P("items",e.Groups)("virtualScroll",!0)("searchable",!0),A("ngModel",e.SearchModel.ProductGroupId),c(6),f(S(21,29,"Table.Item")),c(2),P("items",e.Items)("autofocus",!1)("virtualScroll",!0)("searchable",!0),A("ngModel",e.SearchModel.ProductId),c(6),f(S(29,31,"Model.Search")),c(2),P("ngIf",e.ProductPricing.length>0),c(),P("ngIf",e.ProductPricing.length>0),c(2),P("value",e.ProductPricing)("expandedRowKeys",e.expandedRows)("lazy",!0)("scrollable",!0)("paginator",!1)("rows",e._SharedObjectModelService.Paging.PageSize)("tableStyle",O(33,de))("globalFilterFields",O(34,ue)),c(6),P("ngIf",e._SharedObjectModelService.Paging.TotalItems>=10),c(),P("ngIf",e._SharedObjectModelService.Paging.TotalItems<10))},dependencies:[U,D,J,z,K,L,q,H,$,F,ee,Z,X,Y,oe,ne,te,le,ae,ce,re,ie,se]});let n=p;return n})();export{Qe as ProductPricingComponent};
