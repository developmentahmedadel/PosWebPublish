import{a as Te,b as Se}from"./chunk-6T4APQIW.js";import{a as ge}from"./chunk-PLYKRIX3.js";import{a as he}from"./chunk-AK5AIK5K.js";import{c as me,j as ue}from"./chunk-ZLLO2CPJ.js";import"./chunk-C6Q6MUFU.js";import{a as fe}from"./chunk-VSYXDL23.js";import"./chunk-3ZAIJ4IV.js";import"./chunk-5VO5RH76.js";import{a as pe,b as _e}from"./chunk-2W5TGM3Y.js";import"./chunk-CIOY3TMC.js";import{a as de}from"./chunk-7XIF7JPY.js";import"./chunk-VB2SDBDM.js";import"./chunk-I6L65D3G.js";import"./chunk-KLFZIA63.js";import"./chunk-7FMAHILW.js";import{a as ne,b as ie,c as oe,d as ae}from"./chunk-IBMBVOFU.js";import{c as se,d as le,g as ce}from"./chunk-DLDN7W7Q.js";import{H as Y,I as K,L as X,N as Z,Q as ee,S as te,_ as re,b as L,c as H,d as J,i as z,z as q}from"./chunk-XINR554T.js";import{$b as M,Cb as l,Db as c,Eb as w,Ib as N,Mb as C,Nb as s,Qb as E,Rb as F,Tb as B,Ub as O,Vb as R,Wb as I,X as b,Xb as f,Yb as h,Zb as v,_b as A,ac as D,bc as y,db as a,dc as Q,eb as P,gc as $,na as G,nc as u,oc as T,pc as W,qc as k,vb as x,xa as p,xb as S,ya as _}from"./chunk-J5UB44FZ.js";import{a as V,b as U}from"./chunk-3EYC4JTX.js";var xe=["content"],Ce=["GLComponent"],ve=(o,m)=>({"btn-success":o,"btn-primary":m});function be(o,m){if(o&1&&(l(0,"span",32),f(1),u(2,"date"),c()),o&2){let n=s(2);a(),v(" ",W(2,1,n.Transfer.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function we(o,m){if(o&1){let n=N();l(0,"p-calendar",33),y("ngModelChange",function(e){p(n);let r=s(2);return D(r.Transfer.DocDate,e)||(r.Transfer.DocDate=e),_(e)}),c()}if(o&2){let n=s(2);M("ngModel",n.Transfer.DocDate),S("showOtherMonths",!0)("showTime",!0)("showIcon",!0)("showOnFocus",!0)}}function Me(o,m){if(o&1&&(l(0,"small",34),f(1),c()),o&2){let n=s(2);a(),A("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function De(o,m){if(o&1&&f(0),o&2){let n=m.item;v(" ",n.Name," ")}}function ye(o,m){if(o&1&&(l(0,"small",34),f(1),c()),o&2){let n=s(2);a(),A("Loaded ",n.Storages.length," of ",n._SharedObjectModelService.TotalItems,"")}}function Ne(o,m){if(o&1&&f(0),o&2){let n=m.item;v(" ",n.Name," ")}}function Pe(o,m){if(o&1&&(l(0,"small",34),f(1),c()),o&2){let n=s().$implicit,t=s(2);a(),A("Loaded ",n.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ae(o,m){if(o&1&&f(0),o&2){let n=m.item;A(" ",n.Name," - ",n.Code," ")}}function Ee(o,m){if(o&1){let n=N();l(0,"button",49),C("click",function(){p(n);let e=s().index,r=s(2),i=I(4);return _(r.GetItemBalance(e,i))}),w(1,"i",50),c()}if(o&2){let n=s(3);S("disabled",n._AppModeService.DisabledButton)}}function Ve(o,m){if(o&1&&(l(0,"small",34),f(1),c()),o&2){let n=s().$implicit,t=s(2);a(),A("Loaded ",n.ProductUnits.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ue(o,m){if(o&1&&f(0),o&2){let n=m.item;v(" ",n.Name," ")}}function Fe(o,m){if(o&1){let n=N();l(0,"tr")(1,"td",35)(2,"div",36)(3,"button",37),C("click",function(){p(n);let e=s(2);return _(e.AppendRow())}),w(4,"i",38),c(),l(5,"span",39),f(6),c(),l(7,"button",40),C("click",function(){let e=p(n).index,r=s(2);return _(r.RemoveRow(e))}),w(8,"i",41),c()()(),l(9,"td",42),u(10,"translate"),l(11,"ng-select",43,5),u(13,"translate"),C("clear",function(){let e=p(n).$implicit;return _(e.Items=[])})("focus",function(){let e=p(n).index,r=I(12),i=s(2);return i.ChangeSearchApiDetails("Items",r,e),_(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=p(n).index,r=I(12),i=s(2);return i.ChangeSearchApiDetails("Items",r,e),_(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=p(n).index,r=I(12),i=s(2);return _(i.ChangeSearchApiDetails("Items",r,e))})("close",function(){p(n);let e=s(2);return _(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=s(2);return _(e._AppModeService.ResetCurrentPage())})("change",function(){let e=p(n),r=e.$implicit,i=e.index,d=s(2);return _(d.SelectItem(r.ProductId,i))}),y("ngModelChange",function(e){let r=p(n).$implicit;return D(r.ProductId,e)||(r.ProductId=e),_(e)}),x(14,Pe,2,2,"ng-template",21)(15,Ae,1,2,"ng-template",22),c(),x(16,Ee,2,1,"button",44),c(),l(17,"td",45),u(18,"translate"),l(19,"ng-select",46,6),u(21,"translate"),C("clear",function(){let e=p(n).$implicit;return _(e.ProductUnits=[])})("focus",function(){let e=p(n).index,r=I(20),i=s(2);return i.ChangeSearchApiDetails("ItemUnits",r,e),_(i._AppModeService.ResetCurrentPage())})("keyup",function(){let e=p(n).index,r=I(20),i=s(2);return i.ChangeSearchApiDetails("ItemUnits",r,e),_(i._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=p(n).index,r=I(20),i=s(2);return _(i.ChangeSearchApiDetails("ItemUnits",r,e))})("close",function(){p(n);let e=s(2);return _(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=s(2);return _(e._AppModeService.ResetCurrentPage())})("change",function(){let e=p(n),r=e.$implicit,i=e.index,d=s(2);return _(d.SelectUnit(r.ProductUnitId,i))}),y("ngModelChange",function(e){let r=p(n).$implicit;return D(r.ProductUnitId,e)||(r.ProductUnitId=e),_(e)}),x(22,Ve,2,2,"ng-template",21)(23,Ue,1,1,"ng-template",22),c()(),l(24,"td",47),u(25,"translate"),l(26,"input",48),y("ngModelChange",function(e){let r=p(n).$implicit;return D(r.Quantity,e)||(r.Quantity=e),_(e)}),c()()()}if(o&2){let n=m.$implicit,t=m.index,e=s(2);a(),E("title",t+1),a(5),h(t+1),a(),S("disabled",e.Transfer.TransferDetails.length==1),a(2),E("title",T(10,21,"TransferStorage.Name")),a(2),F("placeholder","  ",T(13,23,"SaleInvoice.ChooseProduct"),""),S("items",n.Items)("dropdownPosition","top")("searchable",!0)("virtualScroll",!0),M("ngModel",n.ProductId),a(5),S("ngIf",n.ProductId>0&&e.Transfer.FromStoreId>0&&e.Transfer.ToStoreId>0),a(),E("title",T(18,25,"SaleInvoice.Units")),a(2),F("placeholder","  ",T(21,27,"Item.ItemUnit"),""),S("items",n.ProductUnits)("dropdownPosition","top")("disabled",n.ProductId==0||n.ProductId==null),M("ngModel",n.ProductUnitId),a(5),E("title",T(25,29,"SaleInvoice.Quantity")),a(2),M("ngModel",n.Quantity)}}function Be(o,m){o&1&&(l(0,"span"),f(1),u(2,"translate"),c()),o&2&&(a(),v(" ",T(2,1,"Model.Save"),""))}function Oe(o,m){o&1&&(l(0,"span"),f(1),u(2,"translate"),c()),o&2&&(a(),v(" ",T(2,1,"Model.Update"),""))}function Re(o,m){if(o&1){let n=N();l(0,"button",51),C("click",function(){p(n);let e=s(2);return _(e.OpenGl())}),f(1),u(2,"translate"),c()}o&2&&(a(),v(" ",T(2,1,"Model.Gl")," "))}function ke(o,m){if(o&1){let n=N();w(0,"app-modal-header",9),l(1,"div",10)(2,"div",11)(3,"div",12)(4,"label",13),f(5),u(6,"translate"),c(),w(7,"input",14),c(),l(8,"div",12)(9,"label",15),f(10),u(11,"translate"),c(),l(12,"input",16),y("ngModelChange",function(e){p(n);let r=s();return D(r.Transfer.Notes,e)||(r.Transfer.Notes=e),_(e)}),c()(),l(13,"div",12),x(14,be,3,4,"span",17)(15,we,1,5,"p-calendar",18),c(),l(16,"div",12)(17,"p",19),f(18),u(19,"translate"),c(),l(20,"ng-select",20,3),C("clear",function(){p(n);let e=s();return _(e.Storages=[])})("focus",function(){p(n);let e=I(21),r=s();return r.ChangeSearchApi("FromStore",e),_(r._AppModeService.ResetCurrentPage())})("keyup",function(){p(n);let e=I(21),r=s();return r.ChangeSearchApi("FromStore",e),_(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(n);let e=I(21),r=s();return _(r.ChangeSearchApi("FromStore",e))})("close",function(){p(n);let e=s();return _(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=s();return _(e._AppModeService.ResetCurrentPage())})("change",function(){p(n);let e=s();return _(e.SelectValue(e.Transfer.FromStoreId,"FromStore"))}),y("ngModelChange",function(e){p(n);let r=s();return D(r.Transfer.FromStoreId,e)||(r.Transfer.FromStoreId=e),_(e)}),x(22,Me,2,2,"ng-template",21)(23,De,1,1,"ng-template",22),c()(),l(24,"div",12)(25,"p",19),f(26),u(27,"translate"),c(),l(28,"ng-select",20,4),C("clear",function(){p(n);let e=s();return _(e.Storages=[])})("focus",function(){p(n);let e=I(29),r=s();return r.ChangeSearchApi("ToStore",e),_(r._AppModeService.ResetCurrentPage())})("keyup",function(){p(n);let e=I(29),r=s();return r.ChangeSearchApi("ToStore",e),_(r._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){p(n);let e=I(29),r=s();return _(r.ChangeSearchApi("ToStore",e))})("close",function(){p(n);let e=s();return _(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=s();return _(e._AppModeService.ResetCurrentPage())})("change",function(){p(n);let e=s();return _(e.SelectValue(e.Transfer.ToStoreId,"ToStore"))}),y("ngModelChange",function(e){p(n);let r=s();return D(r.Transfer.ToStoreId,e)||(r.Transfer.ToStoreId=e),_(e)}),x(30,ye,2,2,"ng-template",21)(31,Ne,1,1,"ng-template",22),c()()(),l(32,"div",23)(33,"table",24)(34,"thead")(35,"tr")(36,"th"),f(37,"#"),c(),l(38,"th"),f(39),u(40,"translate"),c(),l(41,"th"),f(42),u(43,"translate"),c(),l(44,"th"),f(45),u(46,"translate"),c()()(),l(47,"tbody"),x(48,Fe,27,31,"tr",25),c()()()(),l(49,"div",26)(50,"button",27),C("click",function(){p(n);let e=s();return _(e.Save())}),x(51,Be,3,3,"span",28)(52,Oe,3,3,"span",28),w(53,"i",29),c(),x(54,Re,3,3,"button",30),l(55,"button",31),C("click",function(){let e=p(n).$implicit,r=s();return e.close("Close click"),_(r.ResetPage())}),f(56),u(57,"translate"),c()()}if(o&2){let n=s();S("PageTitle","TransferStorage.TransferStorage"),a(5),h(T(6,29,"Table.DocNo")),a(2),S("value",n.Transfer.DocNo)("disabled",!0),a(3),h(T(11,31,"Table.Notes")),a(2),M("ngModel",n.Transfer.Notes),a(2),S("ngIf",n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!1),a(),S("ngIf",n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!0),a(3),h(T(19,33,"TransferStorage.FromStoreId")),a(2),S("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),M("ngModel",n.Transfer.FromStoreId),a(6),h(T(27,35,"TransferStorage.ToStoreId")),a(2),S("items",n.Storages)("autofocus",!1)("virtualScroll",!0)("searchable",!0),M("ngModel",n.Transfer.ToStoreId),a(11),h(T(40,37,"TransferStorage.Name")),a(3),h(T(43,39,"SaleInvoice.Units")),a(3),h(T(46,41,"TransferStorage.Quantity")),a(3),S("ngForOf",n.Transfer.TransferDetails),a(2),S("ngClass",$(45,ve,n.Transfer.Id==0,n.Transfer.Id!=0)),a(),S("ngIf",n.Transfer.Id==0),a(),S("ngIf",n.Transfer.Id!=0),a(2),S("ngIf",n.Transfer.Id>0),a(2),h(T(57,43,"Model.Close"))}}function je(o,m){if(o&1&&(l(0,"tr")(1,"td")(2,"span",55),f(3),c()(),l(4,"td")(5,"span",55),f(6),c()()()),o&2){let n=m.$implicit;a(3),h(n.Name),a(3),h(n.Qty)}}function Ge(o,m){if(o&1&&(l(0,"tr")(1,"td")(2,"span",55),f(3),c()(),l(4,"td")(5,"span",55),f(6),c()()()),o&2){let n=m.$implicit;a(3),h(n.Name),a(3),h(n.Qty)}}function Qe(o,m){if(o&1&&(l(0,"div",52)(1,"p",53),f(2),u(3,"translate"),c(),l(4,"table",54)(5,"thead")(6,"tr")(7,"th"),f(8),u(9,"translate"),c(),l(10,"th"),f(11),u(12,"translate"),c()()(),l(13,"tbody"),x(14,je,7,2,"tr",25),c()(),l(15,"p",53),f(16),u(17,"translate"),c(),l(18,"table",54)(19,"thead")(20,"tr")(21,"th"),f(22),u(23,"translate"),c(),l(24,"th"),f(25),u(26,"translate"),c()()(),l(27,"tbody"),x(28,Ge,7,2,"tr",25),c()()()),o&2){let n=s();a(2),v(" ",T(3,8,"TransferStorage.BalanceFrom")," "),a(6),h(T(9,10,"SaleInvoice.Name")),a(3),h(T(12,12,"Table.Balance")),a(3),S("ngForOf",n.ItemBalanceFrom),a(2),v(" ",T(17,14,"TransferStorage.BalanceTo")," "),a(6),h(T(23,16,"SaleInvoice.Name")),a(3),h(T(26,18,"Table.Balance")),a(3),S("ngForOf",n.ItemBalanceTo)}}var dt=(()=>{let m=class m{constructor(t,e,r,i,d){this._ActivatedRoute=t,this._AppModeService=e,this._SharedObjectModelService=r,this._DefaultSettingsService=i,this._Apiservice=d,this.TablePaging={InputType:"Table",Type:"TablePaging",ReportName:"Transfer",GlobalData:{BranchFilter:!0,Url:"Global/GetAll",TableName:"Transfer",Join:!0,JoinTables:["Storages SF","Storages ST"],JoinConditions:["T.FromStoreId = SF.Id","T.ToStoreId = ST.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.Notes","SF.Name AS FromStoreName","ST.Name AS ToStoreName"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"},{SortName:"FromStoreName",CellName:"TransferStorage.FromStoreId",ExistSearchField:"SF.Name"},{SortName:"ToStoreName",CellName:"TransferStorage.ToStoreId",ExistSearchField:"ST.Name"}]},this.Transfer={Id:0,Name:"",Notes:"",Code:"",FromStoreId:null,FromStoreName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,DocNo:0,DocDate:"",TransferDetails:[{Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""}]},this.Storages=[],this.ItemBalanceFrom=[],this.ItemBalanceTo=[]}ngOnInit(){let t=Number(this._ActivatedRoute.snapshot.queryParams.Id);t>0&&this.GetByIdRoute(t),this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}GetByIdRoute(t){this._Apiservice.getById("TransferStorageEP/GetById",t,!0).pipe(b(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._SharedObjectModelService.PageModel=e.Obj.model,this._SharedObjectModelService.Gl=e.Obj.Gl,this.Drow(this._SharedObjectModelService.PageModel),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(e.Message)}})}OpenModal(){this._AppModeService.DisabledButton=!0,this.ResetPage(),this.GetPageInfo()}GetPageInfo(){this._Apiservice.get("TransferStorageEP/GetPageInfo",!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:t=>{t.IsSuccess==!0&&t.Obj!=null?(this.Transfer.DocNo=t.Obj,this._AppModeService.DisabledButton=!1):this._AppModeService._Toastr.error(t.Message)},error:t=>{this._AppModeService.DisabledButton=!1}})}ShowToEdite(){this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){this.Transfer={Id:t.Id,Name:t.Name,Notes:t.Notes,Code:t.Code,FromStoreId:t.FromStoreId,FromStoreName:t.FromStoreName,ToStoreId:t.ToStoreId,ToStoreName:t.ToStoreName,TotalQty:t.TotalQty,DocNo:t.DocNo,DocDate:new Date(`${t.DocDate}`),TransferDetails:t.TransferDetails},this.Storages=[],this.Storages.push({Id:t.FromStoreId,Name:t.FromStoreName}),this.Storages.push({Id:t.ToStoreId,Name:t.ToStoreName});for(let e=0;e<this.Transfer.TransferDetails.length;e++){let r=this.Transfer.TransferDetails[e];r.Items=[{Id:r.ProductId,Name:r.ProductName,NameAndCode:r.ProductName}],r.ProductUnits=[{Id:r.ProductUnitId,Name:r.ProductUnitName,NameAndUnitFactor:r.ProductUnitName}]}}ChangeSearchApi(t,e){let r=`${e.searchTerm}`.trim();(r==""||r=="null")&&(e.searchTerm="",r=""),this._AppModeService.CurrentPage+=1;let i={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:r,SearchField:"Name"};(t=="FromStore"||t=="ToStore")&&(i.TableName="Storages",i.BranchFilter=!0),this._Apiservice.post("Global/GetAll",i,!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:d=>{d.IsSuccess==!0&&d.Obj!=null?this.HandleResponse(d.Obj,t):this._AppModeService._Toastr.error(d.Message)}})}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,(e=="FromStore"||e=="ToStore")&&(this.Storages=this._SharedObjectModelService.RemoveDuplicates(this.Storages.concat(t.DataReturn),"Id"))}ChangeSearchApiDetails(t,e,r){let i=`${e.searchTerm}`.trim();(i==""||i=="null")&&(e.searchTerm="",i=""),this._AppModeService.CurrentPage+=1;let d={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:i,SearchField:"Name"};if(t=="Items"&&(d.Columns=["Id","Name","Code"],d.Conditions="ProductType != 2"),t=="ItemUnits"){let g=this.Transfer.TransferDetails[r].ProductId==null?0:this.Transfer.TransferDetails[r].ProductId;d.Conditions=`ItemId = ${g}`,d.Join=!0,d.JoinTables=["Units U"],d.NoPaging=!0,d.JoinConditions=["T.UnitId = U.Id"],d.Columns=["T.Id","U.Name","T.UnitFactor"],d.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",d,!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:g=>{g.IsSuccess==!0&&g.Obj!=null?this.HandleResponseDetails(g.Obj,t,r):this._AppModeService._Toastr.error(g.Message)}})}HandleResponseDetails(t,e,r){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Items"&&(this.Transfer.TransferDetails[r].Items=this._SharedObjectModelService.RemoveDuplicates(this.Transfer.TransferDetails[r].Items.concat(t.DataReturn),"Id"),this.Transfer.TransferDetails[r].Items=this.Transfer.TransferDetails[r].Items.map(i=>U(V({},i),{NameAndCode:i.Code!=null?`${i.Name} - ${i.Code}`:`${i.Name}`}))),e=="ItemUnits"&&(this.Transfer.TransferDetails[r].ProductUnits=t.DataReturn.map(i=>U(V({},i),{NameAndUnitFactor:i.UnitFactor!=null?`${i.Name} - ${i.UnitFactor}`:`${i.Name}`})))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let r=[];(e=="FromStore"||e=="ToStore")&&(r=this.Storages);let i=r.find(d=>d.Id==t);if(i==null){this._AppModeService.DontPlay();return}else this.Transfer[`${e}Id`]=t,this.Transfer[`${e}Name`]=i.Name}else this.Transfer[`${e}Id`]=null,this.Transfer[`${e}Name`]=""}SelectItem(t,e){if(t!=null&&t>0){let r=this.Transfer.TransferDetails[e].Items.find(i=>i.Id==t);if(r!=null)this.Transfer.TransferDetails[e].ProductId=r.Id,this.Transfer.TransferDetails[e].ProductName=r.Name,this.Transfer.TransferDetails[e].ProductUnitId=null,this.Transfer.TransferDetails[e].ProductUnits=[],this.AfterSelectem(r.Id,e);else{this._Apiservice.DontPlay();return}}else this.Transfer.TransferDetails[e].ProductUnitId=null,this.Transfer.TransferDetails[e].ProductUnits=[]}AfterSelectem(t,e){if(t>0){let r={TableName:"ItemUnits",Columns:["Id","Name"],CurrentPage:1,PageSize:1,SearchText:"",SearchField:"Name"};r.Conditions=`ItemId = ${t}`,r.Join=!0,r.JoinTables=["Units U"],r.JoinConditions=["T.UnitId = U.Id"],r.Columns=["T.Id","U.Name","T.UnitFactor"],r.SearchField="U.Name",this._Apiservice.post("Global/GetAll",r,!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:i=>{if(i.IsSuccess==!0&&i.Obj!=null){i.Obj.DataReturn=i.Obj.DataReturn.map(g=>U(V({},g),{NameAndUnitFactor:g.UnitFactor!=null?`${g.Name} - ${g.UnitFactor}`:`${g.Name}`}));let d=i.Obj.DataReturn[0];d!=null&&(this.Transfer.TransferDetails[e].ProductUnits=i.Obj.DataReturn,this.Transfer.TransferDetails[e].ProductUnitId=d.Id,this.Transfer.TransferDetails[e].Quantity=1)}else this._AppModeService._Toastr.error(i.Message)}})}}SelectUnit(t,e){if(t!=null&&t>0){let r=this.Transfer.TransferDetails[e].ProductUnits.find(i=>i.Id==t);if(r!=null)this.Transfer.TransferDetails[e].ProductUnitId=r.Id,this.Transfer.TransferDetails[e].ProductUnitName=r.Name;else{this._Apiservice.DontPlay();return}}}TotalRow(t){let e=Number(this.Transfer.TransferDetails[t].Price),r=Number(this.Transfer.TransferDetails[t].Quantity);return Number(e*r)}TotalTransfer(){let t=0;for(let e=0;e<this.Transfer.TransferDetails.length;e++)this.Transfer.TransferDetails[e].ProductId>0&&this.Transfer.TransferDetails[e].ProductUnitId>0&&(t+=Number(this.Transfer.TransferDetails[e].Price)*Number(this.Transfer.TransferDetails[e].Quantity));return Number(t)}AppendRow(){let t={Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""};return this.Transfer.TransferDetails.push(t),this._AppModeService.AppendTd(),!0}RemoveRow(t){return this.Transfer.TransferDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Transfer.Error.ErrorFirstRow")),!1):(this.Transfer.TransferDetails.splice(t,1),this.TotalTransfer(),!0)}GetItemBalance(t,e){let r=this.Transfer.TransferDetails[t];if(this.Transfer.ToStoreId==0||this.Transfer.ToStoreId==null||this.Transfer.FromStoreId==0||this.Transfer.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Storage"));return}if(r.ProductId==0||r.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}let i={ProductId:r.ProductId,FromStoreId:this.Transfer.FromStoreId,ToStoreId:this.Transfer.ToStoreId};this._AppModeService.DisabledButton=!0,this._Apiservice.post("ItemEP/ProductBalance",i,!0).pipe(b(this._Apiservice.destroy$)).subscribe({next:d=>{d.IsSuccess==!0&&d.Obj!=null?(this._AppModeService.DisabledButton=!1,this._AppModeService._NgbModal.open(e,{size:"xl",centered:!0}),this.ItemBalanceFrom=d.Obj.FromStorageBalance,this.ItemBalanceTo=d.Obj.ToStorageBalance):(this._AppModeService.DisabledButton=!1,this._AppModeService._Toastr.error(d.Message))},error:d=>{this._AppModeService.DisabledButton=!1}})}Save(){if(this.Transfer.DocDate==""||this.Transfer.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleOffer.Error.EnterDate"));return}if(this.Transfer.FromStoreId==0||this.Transfer.FromStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterFromStore"));return}if(this.Transfer.ToStoreId==0||this.Transfer.ToStoreId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterToStore"));return}if(this.Transfer.ToStoreId==this.Transfer.FromStoreId){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.ErrorExistStore"));return}for(let e=0;e<this.Transfer.TransferDetails.length;e++){let r=e,i=Number(this.Transfer.TransferDetails[e].ProductId),d=Number(this.Transfer.TransferDetails[e].Quantity),g=Number(this.Transfer.TransferDetails[e].ProductUnitId),Ie=Number(this.Transfer.TransferDetails[e].Price);if(i==null||i==null||i<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterProduct"));return}if(g==null||g==null||g<=0||isNaN(g)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyTransfer.Error.EnterUnit"));return}if(this.Transfer.TransferDetails.filter(j=>j.ProductId==i&&j.ProductUnitId==g).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(r+1));return}if(d==null||d==null||isNaN(d)||d<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("TransferStorage.Error.EnterQuantity"));return}this.Transfer.TransferDetails[e].ProductUnitId=g,this.Transfer.TransferDetails[e].ProductId=i,this.Transfer.TransferDetails[e].Price=Ie}let t={DocDate:this._Apiservice.ConvertISODate(this.Transfer.DocDate),DocNo:this.Transfer.DocNo,TransferDetails:this.Transfer.TransferDetails,FromStoreId:this.Transfer.FromStoreId,FromStoreName:this.Transfer.FromStoreName,ToStoreId:this.Transfer.ToStoreId,ToStoreName:this.Transfer.ToStoreName,TotalQty:this.Transfer.TotalQty,Id:this.Transfer.Id,Name:this.Transfer.Name,Code:this.Transfer.Code,Notes:this.Transfer.Notes};t.Id==0&&this._Apiservice.post("TransferStorageEP/Add",t,!0).pipe(b(this._Apiservice.destroy$)).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this._SharedObjectModelService.Paging.DataReturn.push(e.Obj)):this._AppModeService._Toastr.error(e.Message)}}),t.Id>0&&this._Apiservice.put("TransferStorageEP/Update",t,!0).pipe(b(this._Apiservice.destroy$)).subscribe({next:e=>{if(e.IsSuccess==!0&&e.Obj!=null){this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.UpdateSuccess"));let r=e.Obj,i=this._SharedObjectModelService.Paging.DataReturn.find(d=>d.Id==r.Id);i!=null&&Object.assign(i,r),this.ResetPage(),this.GetPageInfo()}else this._AppModeService._Toastr.error(e.Message)}})}OpenGl(){this.GLComponent.Open()}StartConnection(){this.Hub_Connection=new Se().withUrl(`${Y.signalrUrl}/Transfer`,{skipNegotiation:!0,transport:Te.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(t=>{console.log("Error Hub Connection",t)})}ServerListener(){this.Hub_Connection?.on("AddTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&(this.Transfer.DocNo=t.DocNo)}),this.Hub_Connection?.on("UpdateTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Transfer.Id&&(alert(this._AppModeService._Translate.instant("Show.UpdateModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.UpdateModelAnother"),t.User),this._AppModeService._NgbModal.dismissAll())}),this.Hub_Connection?.on("DeleteTranfer",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Transfer.Id&&(alert(this._AppModeService._Translate.instant("Show.DeleteModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.DeleteModelAnother"),t.User),this._SharedObjectModelService.Paging.DataReturn=this._SharedObjectModelService.Paging.DataReturn.filter(r=>r.Id!=t.Id),this._AppModeService._NgbModal.dismissAll())})}ResetPage(){this.Transfer={Id:0,Name:"",Notes:"",Code:"",FromStoreId:null,FromStoreName:"",ToStoreId:null,ToStoreName:"",TotalQty:0,DocNo:0,DocDate:"",TransferDetails:[{Items:[],ProductUnits:[],ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",Price:0,Quantity:"",TotalPrice:0,Code:"",Name:"",Id:0,Notes:""}]},this._DefaultSettingsService.ResetDate(this.Transfer)}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};m.\u0275fac=function(e){return new(e||m)(P(q),P(ce),P(de),P(he),P(K))},m.\u0275cmp=G({type:m,selectors:[["app-transfer-storage"]],viewQuery:function(e,r){if(e&1&&(B(xe,5),B(Ce,5)),e&2){let i;O(i=R())&&(r.ContentModel=i.first),O(i=R())&&(r.GLComponent=i.first)}},standalone:!0,features:[Q],decls:7,vars:8,consts:[["content",""],["ItemBalance",""],["GLComponent",""],["SelectFromStore",""],["SelectToStore",""],["SelectItem22",""],["SelectUnits",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","PrintUrl","DeleteUrl","OutModal"],[1,"col-8"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-end","col-12"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","col-xl-2","p-1"],["for","DocNo"],["type","number","appNumericInput","",1,"form-control","text-center",3,"value","disabled"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],["class","d-block text-center ",4,"ngIf"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12","class"," shadow-none text-center w-100",3,"ngModel","showOtherMonths","showTime","showIcon","showOnFocus","ngModelChange",4,"ngIf"],[1,"m-0"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["id","ProductTable",1,"table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-4","mb-0"],[4,"ngFor","ngForOf"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn","py-3","px-5",3,"click","ngClass"],[4,"ngIf"],[1,"mx-1","pi","pi-save"],["class","btn btn-info mx-3 py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-light","border","border-1","border-dark","px-5","py-3",3,"click"],[1,"d-block","text-center"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showOtherMonths","showTime","showIcon","showOnFocus"],[1,"form-text","text-muted"],[1,"",3,"title"],[1,"d-flex","justify-content-center","align-items-center","col-11","col-md-12"],[1,"px-3","mx-1","text-center","mx-auto","btn","btn-success",3,"click"],[1,"mx-1","fs-5","fw-bold","pi","pi-plus"],[1,"d-none","d-lg-inline"],[1,"px-3","mx-1","text-center","mx-auto","btn","btn-danger",3,"click","disabled"],[1,"mx-1","pi","pi-trash","fw-bold","fs-5"],[1,"ngSelect","d-flex",3,"title"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-12","col-md-11",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["class","col-1 d-block text-center btn btn-info py-0 px-2 mx-2",3,"disabled","click",4,"ngIf"],[1,"ngSelect",3,"title"],["bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","disabled","ngModel"],[3,"title"],["name","Quantity","type","number","appNumericInput","",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-1","d-block","text-center","btn","btn-info","py-0","px-2","mx-2",3,"click","disabled"],[1,"pi","pi-eye","d-block","mx-auto"],[1,"btn","btn-info","mx-3","py-3","px-5",3,"click"],[1,"modal-body"],[1,"my-2","text-center"],[1,"table","table-striped","table-hover"],[1,"text-dark"]],template:function(e,r){if(e&1){let i=N();l(0,"app-dynamic-component",7),C("OpenModalEvent",function(){return p(i),_(r.OpenModal())})("ShowToEditeEvent",function(){return p(i),_(r.ShowToEdite())}),c(),x(1,ke,58,48,"ng-template",null,0,k)(3,Qe,29,20,"ng-template",8,1,k),w(5,"app-glsheard",null,2)}if(e&2){let i=I(2);S("PageTitle","TransferStorage.TransferStorage")("TablePaging",r.TablePaging)("FullScreen",!1)("GlResponse",!0)("GetById","TransferStorageEP/GetById")("PrintUrl","TransferStorage")("DeleteUrl","TransferStorageEP/Delete")("OutModal",i)}},dependencies:[_e,pe,z,re,X,te,Z,ee,H,J,L,le,se,ae,oe,ne,ie,ue,ge,me,fe],styles:["svg[_ngcontent-%COMP%]{cursor:pointer}"]});let o=m;return o})();export{dt as TransferStorageComponent};
