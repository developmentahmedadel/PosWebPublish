import{a as de}from"./chunk-PAI6ZM6M.js";import{b as _e,c as le,h as se}from"./chunk-ZV4STMPN.js";import"./chunk-3ZAIJ4IV.js";import"./chunk-W3OSOPGE.js";import"./chunk-VSYXDL23.js";import"./chunk-BHSN7HFD.js";import"./chunk-6BJKXUWP.js";import"./chunk-3Y7UQ2M3.js";import{a as pe}from"./chunk-LUZO7NCR.js";import"./chunk-VUX2NRX2.js";import"./chunk-RXBBGPQB.js";import"./chunk-GEJP5WQO.js";import"./chunk-GNF256I6.js";import{a as re,b as oe,c as ce,d as ae}from"./chunk-MZIKAFPE.js";import"./chunk-EGE4BGUH.js";import"./chunk-RVJIMCIT.js";import{c as ie}from"./chunk-NUFVOF6D.js";import{c as q,d as K}from"./chunk-KALZ37GW.js";import{c as z,f as X,h as Y,k as Z,m as ee,s as te,u as ne}from"./chunk-N4FWSTCP.js";import{d as J,e as H}from"./chunk-VTADEU6K.js";import{$b as A,Cb as l,Db as p,Eb as N,Fb as W,Gb as O,Ib as U,Mb as h,Nb as r,Rb as y,Tb as $,Ub as j,Vb as L,Wb as g,X as b,Xb as d,Yb as w,Zb as R,_b as v,ac as D,bc as V,db as s,dc as Q,eb as k,na as F,nc as C,oc as P,qc as G,vb as f,xa as c,xb as T,ya as a}from"./chunk-J5UB44FZ.js";import{a as M,b as E}from"./chunk-3EYC4JTX.js";var ue=["dynamiccomponent"];function me(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2);s(),v("Loaded ",i.Recipe.Items.length," of ",i._SharedObjectModelService.TotalItems,"")}}function ge(_,u){if(_&1&&d(0),_&2){let i=u.item;v(" ",i.Name," - ",i.Code," ")}}function xe(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2);s(),v("Loaded ",i.Recipe.ProductUnits.length," of ",i._SharedObjectModelService.TotalItems,"")}}function Ce(_,u){if(_&1&&d(0),_&2){let i=u.item;R(" ",i.NameAndUnitFactor," ")}}function Pe(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2);s(),v("Loaded ",i.Recipe.CostCenters.length," of ",i._SharedObjectModelService.TotalItems,"")}}function Se(_,u){if(_&1&&d(0),_&2){let i=u.item;R(" ",i.Name," ")}}function Te(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2).$implicit,t=r(2);s(),v("Loaded ",i.Storages.length," of ",t._SharedObjectModelService.TotalItems,"")}}function he(_,u){if(_&1&&d(0),_&2){let i=u.item;R(" ",i.Name," ")}}function Re(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2).$implicit,t=r(2);s(),v("Loaded ",i.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ie(_,u){if(_&1&&d(0),_&2){let i=u.item;v(" ",i.Name," - ",i.Code," ")}}function fe(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2).$implicit,t=r(2);s(),v("Loaded ",i.ProductUnits.length," of ",t._SharedObjectModelService.TotalItems,"")}}function ye(_,u){if(_&1&&d(0),_&2){let i=u.item;R(" ",i.NameAndUnitFactor," ")}}function we(_,u){if(_&1){let i=U();l(0,"tr")(1,"td",18)(2,"div",38)(3,"button",39),h("click",function(){c(i);let e=r(3);return a(e.AppendRow(e.RecipeType.DirectProduct))}),N(4,"i",40),p(),l(5,"button",41),h("click",function(){c(i);let e=r().index,n=r(2);return a(n.RemoveRow(n.RecipeType.DirectProduct,e))}),N(6,"i",42),p()()(),l(7,"td")(8,"ng-select",43,4),C(10,"translate"),h("clear",function(){c(i);let e=r().$implicit;return a(e.Storages=[])})("focus",function(){c(i);let e=g(9),n=r().index,o=r(2);return o.ChangeSearchApiDetails("Storages",e,n,o.RecipeType.DirectProduct),a(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(9),n=r().index,o=r(2);return o.ChangeSearchApiDetails("Storages",e,n,o.RecipeType.DirectProduct),a(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(9),n=r().index,o=r(2);return a(o.ChangeSearchApiDetails("Storages",e,n,o.RecipeType.DirectProduct))})("close",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=r(),n=e.$implicit,o=e.index,m=r(2);return a(m.SelectValueDetails(n.StorageId,"Storage",o))}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.StorageId,e)||(n.StorageId=e),a(e)}),f(11,Te,2,2,"ng-template",20)(12,he,1,1,"ng-template",21),p()(),l(13,"td")(14,"ng-select",44,5),C(16,"translate"),h("clear",function(){c(i);let e=r().$implicit;return a(e.Items=[])})("focus",function(){c(i);let e=g(15),n=r().index,o=r(2);return o.ChangeSearchApiDetails("DirectProduct",e,n,1),a(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(15),n=r().index,o=r(2);return o.ChangeSearchApiDetails("DirectProduct",e,n,1),a(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(15),n=r().index,o=r(2);return a(o.ChangeSearchApiDetails("DirectProduct",e,n,1))})("close",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r().$implicit;return r(2)._AppModeService.ResetCurrentPage(),a(e.Items=[])})("change",function(){c(i);let e=g(15),n=r(),o=n.$implicit,m=n.index;return r(2).SelectItem(o.ProductId,m),a(e.blur())}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.ProductId,e)||(n.ProductId=e),a(e)}),f(17,Re,2,2,"ng-template",20)(18,Ie,1,2,"ng-template",21),p()(),l(19,"td")(20,"ng-select",45,6),C(22,"translate"),h("clear",function(){c(i);let e=r().$implicit;return a(e.ProductUnits=[])})("focus",function(){c(i);let e=g(21),n=r().index,o=r(2);return o.ChangeSearchApiDetails("ItemUnits",e,n,1),a(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(21),n=r().index,o=r(2);return o.ChangeSearchApiDetails("ItemUnits",e,n,1),a(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(21),n=r().index,o=r(2);return a(o.ChangeSearchApiDetails("ItemUnits",e,n,1))})("close",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(21),n=r(),o=n.$implicit,m=n.index;return r(2).SelectUnit(o.ProductUnitId,m),a(e.blur())}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.ProductUnitId,e)||(n.ProductUnitId=e),a(e)}),f(23,fe,2,2,"ng-template",20)(24,ye,1,1,"ng-template",21),p()(),l(25,"td")(26,"input",46),h("change",function(){c(i);let e=r(3);return a(e.CalcRecipe())})("keyup",function(){c(i);let e=r(3);return a(e.CalcRecipe())}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.Quantity,e)||(n.Quantity=e),a(e)}),p()(),l(27,"td"),d(28),p(),l(29,"td"),d(30),p()()}if(_&2){let i=r(),t=i.$implicit,e=i.index;s(8),y("placeholder","  ",P(10,30,"SaleInvoice.ChooseStore"),""),T("items",t.Storages)("dropdownPosition","top")("searchable",!0)("virtualScroll",!0),A("ngModel",t.StorageId),s(6),y("placeholder","  ",P(16,32,"SaleInvoice.ChooseProduct"),""),T("dropdownPosition","top")("items",t.Items)("virtualScroll",!0)("searchable",!0),A("ngModel",t.ProductId),s(6),y("placeholder","  ",P(22,34,"Item.ItemUnit"),""),T("dropdownPosition","top")("items",t.ProductUnits)("disabled",t.ProductId==0||t.ProductId==null)("virtualScroll",!0)("searchable",!0),A("ngModel",t.ProductUnitId),s(6),y("id","Quantity",e,""),y("name","Quantity",e,""),T("disabled",t.ProductId==null||t.ProductUnitId==null),A("ngModel",t.Quantity),s(2),R(" ",t.WA," "),s(2),R(" ",t.TotalPrice," ")}}function Ae(_,u){if(_&1&&(W(0),f(1,we,31,36,"tr",37),O()),_&2){let i=u.$implicit,t=r(2);s(),T("ngIf",i.RecipeType==t.RecipeType.DirectProduct)}}function De(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2).$implicit,t=r(2);s(),v("Loaded ",i.AccTrees.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ve(_,u){if(_&1&&d(0),_&2){let i=u.item;R(" ",i.Name," ")}}function ve(_,u){if(_&1){let i=U();l(0,"tr")(1,"td",18)(2,"div",38)(3,"button",39),h("click",function(){c(i);let e=r(3);return a(e.AppendRow(e.RecipeType.DirectSalary))}),N(4,"i",40),p(),l(5,"button",41),h("click",function(){c(i);let e=r().index,n=r(2);return a(n.RemoveRow(n.RecipeType.DirectSalary,e))}),N(6,"i",42),p()()(),l(7,"td")(8,"ng-select",47,7),h("clear",function(){c(i);let e=r().$implicit;return a(e.AccTrees=[])})("focus",function(){c(i);let e=g(9),n=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,n,o.RecipeType.DirectSalary),a(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(9),n=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,n,o.RecipeType.DirectSalary),a(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(9),n=r().index,o=r(2);return a(o.ChangeSearchApiDetails("AccTreeExpenses",e,n,o.RecipeType.DirectSalary))})("close",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=r(),n=e.$implicit,o=e.index,m=r(2);return a(m.SelectValueDetails(n.AccTreeId,"AccTree",o))}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.AccTreeId,e)||(n.AccTreeId=e),a(e)}),f(10,De,2,2,"ng-template",20)(11,Ve,1,1,"ng-template",21),p()(),l(12,"td")(13,"input",48),h("change",function(){c(i);let e=r(3);return a(e.CalcRecipe())})("keyup",function(){c(i);let e=r(3);return a(e.CalcRecipe())}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.Amount,e)||(n.Amount=e),a(e)}),p()(),l(14,"td")(15,"input",49),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.Notes,e)||(n.Notes=e),a(e)}),p()()()}if(_&2){let i=r(),t=i.$implicit,e=i.index;s(8),T("items",t.AccTrees)("autofocus",!1)("dropdownPosition","top")("virtualScroll",!0)("searchable",!0),A("ngModel",t.AccTreeId),s(5),y("id","Amount",e,""),y("name","Amount",e,""),A("ngModel",t.Amount),s(2),y("id","Notes",e,""),y("name","Notes",e,""),A("ngModel",t.Notes)}}function Ne(_,u){if(_&1&&(W(0),f(1,ve,16,16,"tr",37),O()),_&2){let i=u.$implicit,t=r(2);s(),T("ngIf",i.RecipeType==t.RecipeType.DirectSalary)}}function be(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2).$implicit,t=r(2);s(),v("Loaded ",i.Storages.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ue(_,u){if(_&1&&d(0),_&2){let i=u.item;R(" ",i.Name," ")}}function Me(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2).$implicit,t=r(2);s(),v("Loaded ",i.Items.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ee(_,u){if(_&1&&d(0),_&2){let i=u.item;v(" ",i.Name," - ",i.Code," ")}}function We(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2).$implicit,t=r(2);s(),v("Loaded ",i.ProductUnits.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Oe(_,u){if(_&1&&d(0),_&2){let i=u.item;R(" ",i.NameAndUnitFactor," ")}}function ke(_,u){if(_&1){let i=U();l(0,"tr")(1,"td",18)(2,"div",38)(3,"button",39),h("click",function(){c(i);let e=r(3);return a(e.AppendRow(e.RecipeType.InDirectProduct))}),N(4,"i",40),p(),l(5,"button",41),h("click",function(){c(i);let e=r().index,n=r(2);return a(n.RemoveRow(n.RecipeType.InDirectProduct,e))}),N(6,"i",42),p()()(),l(7,"td")(8,"ng-select",43,4),C(10,"translate"),h("clear",function(){c(i);let e=r().$implicit;return a(e.Storages=[])})("focus",function(){c(i);let e=g(9),n=r().index,o=r(2);return o.ChangeSearchApiDetails("Storages",e,n,o.RecipeType.InDirectProduct),a(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(9),n=r().index,o=r(2);return o.ChangeSearchApiDetails("Storages",e,n,o.RecipeType.InDirectProduct),a(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(9),n=r().index,o=r(2);return a(o.ChangeSearchApiDetails("Storages",e,n,o.RecipeType.InDirectProduct))})("close",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=r(),n=e.$implicit,o=e.index,m=r(2);return a(m.SelectValueDetails(n.StorageId,"Storage",o))}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.StorageId,e)||(n.StorageId=e),a(e)}),f(11,be,2,2,"ng-template",20)(12,Ue,1,1,"ng-template",21),p()(),l(13,"td")(14,"ng-select",44,5),C(16,"translate"),h("clear",function(){c(i);let e=r().$implicit;return a(e.Items=[])})("focus",function(){c(i);let e=g(15),n=r().index,o=r(2);return o.ChangeSearchApiDetails("InDirectProduct",e,n,o.RecipeType.InDirectProduct),a(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(15),n=r().index,o=r(2);return o.ChangeSearchApiDetails("InDirectProduct",e,n,o.RecipeType.InDirectProduct),a(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(15),n=r().index,o=r(2);return a(o.ChangeSearchApiDetails("InDirectProduct",e,n,o.RecipeType.InDirectProduct))})("close",function(){c(i);let e=r().$implicit;return r(2)._AppModeService.ResetCurrentPage(),a(e.Items=[])})("open",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(15),n=r(),o=n.$implicit,m=n.index;return r(2).SelectItem(o.ProductId,m),a(e.blur())}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.ProductId,e)||(n.ProductId=e),a(e)}),f(17,Me,2,2,"ng-template",20)(18,Ee,1,2,"ng-template",21),p()(),l(19,"td")(20,"ng-select",45,6),C(22,"translate"),h("clear",function(){c(i);let e=r().$implicit;return a(e.ProductUnits=[])})("focus",function(){c(i);let e=g(21),n=r().index,o=r(2);return o.ChangeSearchApiDetails("ItemUnits",e,n,1),a(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(21),n=r().index,o=r(2);return o.ChangeSearchApiDetails("ItemUnits",e,n,1),a(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(21),n=r().index,o=r(2);return a(o.ChangeSearchApiDetails("ItemUnits",e,n,1))})("close",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(21),n=r(),o=n.$implicit,m=n.index;return r(2).SelectUnit(o.ProductUnitId,m),a(e.blur())}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.ProductUnitId,e)||(n.ProductUnitId=e),a(e)}),f(23,We,2,2,"ng-template",20)(24,Oe,1,1,"ng-template",21),p()(),l(25,"td")(26,"input",46),h("change",function(){c(i);let e=r(3);return a(e.CalcRecipe())})("keyup",function(){c(i);let e=r(3);return a(e.CalcRecipe())}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.Quantity,e)||(n.Quantity=e),a(e)}),p()(),l(27,"td"),d(28),p(),l(29,"td"),d(30),p()()}if(_&2){let i=r(),t=i.$implicit,e=i.index;s(8),y("placeholder","  ",P(10,30,"SaleInvoice.ChooseStore"),""),T("items",t.Storages)("dropdownPosition","top")("searchable",!0)("virtualScroll",!0),A("ngModel",t.StorageId),s(6),y("placeholder","  ",P(16,32,"SaleInvoice.ChooseProduct"),""),T("dropdownPosition","top")("items",t.Items)("virtualScroll",!0)("searchable",!0),A("ngModel",t.ProductId),s(6),y("placeholder","  ",P(22,34,"Item.ItemUnit"),""),T("dropdownPosition","top")("items",t.ProductUnits)("disabled",t.ProductId==0||t.ProductId==null)("virtualScroll",!0)("searchable",!0),A("ngModel",t.ProductUnitId),s(6),y("id","Quantity",e,""),y("name","Quantity",e,""),T("disabled",t.ProductId==null||t.ProductUnitId==null),A("ngModel",t.Quantity),s(2),R(" ",t.WA," "),s(2),R(" ",t.TotalPrice," ")}}function Be(_,u){if(_&1&&(W(0),f(1,ke,31,36,"tr",37),O()),_&2){let i=u.$implicit,t=r(2);s(),T("ngIf",i.RecipeType==t.RecipeType.InDirectProduct)}}function Fe(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2).$implicit,t=r(2);s(),v("Loaded ",i.AccTrees.length," of ",t._SharedObjectModelService.TotalItems,"")}}function $e(_,u){if(_&1&&d(0),_&2){let i=u.item;R(" ",i.Name," ")}}function je(_,u){if(_&1){let i=U();l(0,"tr")(1,"td",18)(2,"div",38)(3,"button",39),h("click",function(){c(i);let e=r(3);return a(e.AppendRow(e.RecipeType.InDirectSalary))}),N(4,"i",40),p(),l(5,"button",41),h("click",function(){c(i);let e=r().index,n=r(2);return a(n.RemoveRow(n.RecipeType.InDirectSalary,e))}),N(6,"i",42),p()()(),l(7,"td")(8,"ng-select",47,7),h("clear",function(){c(i);let e=r().$implicit;return a(e.AccTrees=[])})("focus",function(){c(i);let e=g(9),n=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,n,o.RecipeType.InDirectSalary),a(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(9),n=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,n,o.RecipeType.InDirectSalary),a(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(9),n=r().index,o=r(2);return a(o.ChangeSearchApiDetails("AccTreeExpenses",e,n,o.RecipeType.InDirectSalary))})("close",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=r(),n=e.$implicit,o=e.index,m=r(2);return a(m.SelectValueDetails(n.AccTreeId,"AccTree",o))}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.AccTreeId,e)||(n.AccTreeId=e),a(e)}),f(10,Fe,2,2,"ng-template",20)(11,$e,1,1,"ng-template",21),p()(),l(12,"td")(13,"input",48),h("change",function(){c(i);let e=r(3);return a(e.CalcRecipe())})("keyup",function(){c(i);let e=r(3);return a(e.CalcRecipe())}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.Amount,e)||(n.Amount=e),a(e)}),p()(),l(14,"td")(15,"input",49),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.Notes,e)||(n.Notes=e),a(e)}),p()()()}if(_&2){let i=r(),t=i.$implicit,e=i.index;s(8),T("items",t.AccTrees)("autofocus",!1)("dropdownPosition","top")("virtualScroll",!0)("searchable",!0),A("ngModel",t.AccTreeId),s(5),y("id","Amount",e,""),y("name","Amount",e,""),A("ngModel",t.Amount),s(2),y("id","Notes",e,""),y("name","Notes",e,""),A("ngModel",t.Notes)}}function Le(_,u){if(_&1&&(W(0),f(1,je,16,16,"tr",37),O()),_&2){let i=u.$implicit,t=r(2);s(),T("ngIf",i.RecipeType==t.RecipeType.InDirectSalary)}}function Qe(_,u){if(_&1&&(l(0,"small",36),d(1),p()),_&2){let i=r(2).$implicit,t=r(2);s(),v("Loaded ",i.AccTrees.length," of ",t._SharedObjectModelService.TotalItems,"")}}function Ge(_,u){if(_&1&&d(0),_&2){let i=u.item;R(" ",i.Name," ")}}function Je(_,u){if(_&1){let i=U();l(0,"tr")(1,"td",18)(2,"div",38)(3,"button",39),h("click",function(){c(i);let e=r(3);return a(e.AppendRow(e.RecipeType.InDirectOther))}),N(4,"i",40),p(),l(5,"button",41),h("click",function(){c(i);let e=r().index,n=r(2);return a(n.RemoveRow(n.RecipeType.InDirectOther,e))}),N(6,"i",42),p()()(),l(7,"td")(8,"ng-select",47,7),h("clear",function(){c(i);let e=r().$implicit;return a(e.AccTrees=[])})("focus",function(){c(i);let e=g(9),n=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,n,o.RecipeType.InDirectOther),a(o._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(9),n=r().index,o=r(2);return o.ChangeSearchApiDetails("AccTreeExpenses",e,n,o.RecipeType.InDirectOther),a(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(9),n=r().index,o=r(2);return a(o.ChangeSearchApiDetails("AccTreeExpenses",e,n,o.RecipeType.InDirectOther))})("close",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("open",function(){c(i);let e=r(3);return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=r(),n=e.$implicit,o=e.index,m=r(2);return a(m.SelectValueDetails(n.AccTreeId,"AccTree",o))}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.AccTreeId,e)||(n.AccTreeId=e),a(e)}),f(10,Qe,2,2,"ng-template",20)(11,Ge,1,1,"ng-template",21),p()(),l(12,"td")(13,"input",48),h("change",function(){c(i);let e=r(3);return a(e.CalcRecipe())})("keyup",function(){c(i);let e=r(3);return a(e.CalcRecipe())}),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.Amount,e)||(n.Amount=e),a(e)}),p()(),l(14,"td")(15,"input",49),V("ngModelChange",function(e){c(i);let n=r().$implicit;return D(n.Notes,e)||(n.Notes=e),a(e)}),p()()()}if(_&2){let i=r(),t=i.$implicit,e=i.index;s(8),T("items",t.AccTrees)("autofocus",!1)("dropdownPosition","top")("virtualScroll",!0)("searchable",!0),A("ngModel",t.AccTreeId),s(5),y("id","Amount",e,""),y("name","Amount",e,""),A("ngModel",t.Amount),s(2),y("id","Notes",e,""),y("name","Notes",e,""),A("ngModel",t.Notes)}}function He(_,u){if(_&1&&(W(0),f(1,Je,16,16,"tr",37),O()),_&2){let i=u.$implicit,t=r(2);s(),T("ngIf",i.RecipeType==t.RecipeType.InDirectOther)}}function ze(_,u){if(_&1){let i=U();N(0,"app-modal-header",10),l(1,"div",11)(2,"div",12)(3,"label",13),d(4),C(5,"translate"),p(),N(6,"input",14),p(),l(7,"div",15)(8,"label",16),d(9),C(10,"translate"),p(),l(11,"input",17),V("ngModelChange",function(e){c(i);let n=r();return D(n.Recipe.Notes,e)||(n.Recipe.Notes=e),a(e)}),p()(),l(12,"div",15)(13,"label",18),d(14),C(15,"translate"),p(),l(16,"ng-select",19,2),h("clear",function(){c(i);let e=r();return a(e.Recipe.Items=[])})("focus",function(){c(i);let e=g(17),n=r();return n.ChangeSearchApi("Product",e),a(n._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(17),n=r();return n.ChangeSearchApi("Product",e),a(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(17),n=r();return a(n.ChangeSearchApi("Product",e))})("close",function(){c(i);let e=r();return e._AppModeService.ResetCurrentPage(),a(e.Recipe.Items=[])})("open",function(){c(i);let e=r();return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(17),n=r();return n.SelectValue(n.Recipe.ProductId,"Product"),e.blur(),a(n.Recipe.Items=[])}),V("ngModelChange",function(e){c(i);let n=r();return D(n.Recipe.ProductId,e)||(n.Recipe.ProductId=e),a(e)}),f(18,me,2,2,"ng-template",20)(19,ge,1,2,"ng-template",21),p()(),l(20,"div",15)(21,"label",18),d(22),C(23,"translate"),p(),l(24,"ng-select",22,3),h("clear",function(){c(i);let e=r();return a(e.Recipe.ProductUnits=[])})("focus",function(){c(i);let e=g(25),n=r();return n.ChangeSearchApi("ItemUnits",e),a(n._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(25),n=r();return n.ChangeSearchApi("ItemUnits",e),a(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(25),n=r();return a(n.ChangeSearchApi("ItemUnits",e))})("close",function(){c(i);let e=r();return e._AppModeService.ResetCurrentPage(),a(e.Recipe.ProductUnits=[])})("open",function(){c(i);let e=r();return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(25),n=r();return n.SelectValue(n.Recipe.ProductUnitId,"ProductUnit"),e.blur(),a(n.Recipe.ProductUnits=[])}),V("ngModelChange",function(e){c(i);let n=r();return D(n.Recipe.ProductUnitId,e)||(n.Recipe.ProductUnitId=e),a(e)}),f(26,xe,2,2,"ng-template",20)(27,Ce,1,1,"ng-template",21),p()(),l(28,"div",15)(29,"label",18),d(30),C(31,"translate"),p(),l(32,"ng-select",23,2),h("clear",function(){c(i);let e=r();return a(e.Recipe.CostCenters=[])})("focus",function(){c(i);let e=g(17),n=r();return n.ChangeSearchApi("CostCenter",e),a(n._AppModeService.ResetCurrentPage())})("keyup",function(){c(i);let e=g(17),n=r();return n.ChangeSearchApi("CostCenter",e),a(n._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){c(i);let e=g(17),n=r();return a(n.ChangeSearchApi("CostCenter",e))})("close",function(){c(i);let e=r();return e._AppModeService.ResetCurrentPage(),a(e.Recipe.CostCenters=[])})("open",function(){c(i);let e=r();return a(e._AppModeService.ResetCurrentPage())})("change",function(){c(i);let e=g(17),n=r();return n.SelectValue(n.Recipe.CostCenterId,"CostCenter"),e.blur(),a(n.Recipe.CostCenters=[])}),V("ngModelChange",function(e){c(i);let n=r();return D(n.Recipe.CostCenterId,e)||(n.Recipe.CostCenterId=e),a(e)}),f(34,Pe,2,2,"ng-template",20)(35,Se,1,1,"ng-template",21),p()(),l(36,"div",15)(37,"label",24),d(38),C(39,"translate"),p(),N(40,"input",25),p()(),l(41,"div",26)(42,"div",27)(43,"h4",28),d(44," \u062A\u0643\u0627\u0644\u064A\u0641 \u0635\u0646\u0627\u0639\u064A\u0629 \u0645\u0628\u0627\u0634\u0631\u0629 "),p()(),l(45,"div",29)(46,"p",30),d(47),C(48,"translate"),l(49,"span"),d(50,"["),p(),d(51),l(52,"span"),d(53,"]"),p()(),l(54,"table",31)(55,"thead")(56,"tr")(57,"th",18),d(58,"#"),p(),l(59,"th",32),d(60),C(61,"translate"),p(),l(62,"th",32),d(63),C(64,"translate"),p(),l(65,"th",32),d(66),C(67,"translate"),p(),l(68,"th",32),d(69),C(70,"translate"),p(),l(71,"th",32),d(72),C(73,"translate"),p(),l(74,"th",32),d(75),C(76,"translate"),p()()(),l(77,"tbody"),f(78,Ae,2,1,"ng-container",33),p()()(),l(79,"div",29)(80,"p",30),d(81),C(82,"translate"),l(83,"span"),d(84,"["),p(),d(85),l(86,"span"),d(87,"]"),p()(),l(88,"table",31)(89,"thead")(90,"tr")(91,"th",18),d(92,"#"),p(),l(93,"th",34),d(94),C(95,"translate"),p(),l(96,"th",34),d(97),C(98,"translate"),p(),l(99,"th",34),d(100),C(101,"translate"),p()()(),l(102,"tbody"),f(103,Ne,2,1,"ng-container",33),p()()(),l(104,"div",27)(105,"h4",28),d(106," \u062A\u0643\u0627\u0644\u064A\u0641 \u0635\u0646\u0627\u0639\u064A\u0629 \u063A\u064A\u0631 \u0645\u0628\u0627\u0634\u0631\u0629 "),p()(),l(107,"div",29)(108,"p",30),d(109),C(110,"translate"),l(111,"span"),d(112,"["),p(),d(113),l(114,"span"),d(115,"]"),p()(),l(116,"table",31)(117,"thead")(118,"tr")(119,"th"),d(120,"#"),p(),l(121,"th",32),d(122),C(123,"translate"),p(),l(124,"th",32),d(125),C(126,"translate"),p(),l(127,"th",32),d(128),C(129,"translate"),p(),l(130,"th",32),d(131),C(132,"translate"),p(),l(133,"th",32),d(134),C(135,"translate"),p(),l(136,"th",32),d(137),C(138,"translate"),p()()(),l(139,"tbody"),f(140,Be,2,1,"ng-container",33),p()()(),l(141,"div",29)(142,"p",30),d(143),C(144,"translate"),l(145,"span"),d(146,"["),p(),d(147),l(148,"span"),d(149,"]"),p()(),l(150,"table",31)(151,"thead")(152,"tr")(153,"th"),d(154,"#"),p(),l(155,"th",34),d(156),C(157,"translate"),p(),l(158,"th",34),d(159),C(160,"translate"),p(),l(161,"th",34),d(162),C(163,"translate"),p()()(),l(164,"tbody"),f(165,Le,2,1,"ng-container",33),p()()(),l(166,"div",29)(167,"p",30),d(168),C(169,"translate"),l(170,"span"),d(171,"["),p(),d(172),l(173,"span"),d(174,"]"),p()(),l(175,"table",31)(176,"thead")(177,"tr")(178,"th"),d(179,"#"),p(),l(180,"th",34),d(181),C(182,"translate"),p(),l(183,"th",34),d(184),C(185,"translate"),p(),l(186,"th",34),d(187),C(188,"translate"),p()()(),l(189,"tbody"),f(190,He,2,1,"ng-container",33),p()()()(),l(191,"app-modal-footer",35),h("SaveEvent",function(){c(i);let e=r();return a(e.Save())})("UpdateEvent",function(){c(i);let e=r();return a(e.Save())})("CloseEvent",function(){let e=c(i).$implicit,n=r();return e.close("Close click"),a(n.ResetPage())}),p()}if(_&2){let i=r();T("PageTitle","ProductRecipe.ProductRecipe"),s(4),R(" ",P(5,65,"Table.DocNo")," "),s(2),T("disabled",!0)("value",i.Recipe.DocNo),s(3),R(" ",P(10,67,"Table.Notes")," "),s(2),A("ngModel",i.Recipe.Notes),s(3),R(" ",P(15,69,"TransferStorage.Name")," "),s(2),T("dropdownPosition","bottom")("items",i.Recipe.Items)("virtualScroll",!0)("searchable",!0),A("ngModel",i.Recipe.ProductId),s(6),R(" ",P(23,71,"Item.ItemUnit")," "),s(2),T("disabled",i.Recipe.ProductId==null)("dropdownPosition","bottom")("items",i.Recipe.ProductUnits)("virtualScroll",!0)("searchable",!0),A("ngModel",i.Recipe.ProductUnitId),s(6),R(" ",P(31,73,"MoneyIn.CostCenter")," "),s(2),T("dropdownPosition","bottom")("items",i.Recipe.CostCenters)("virtualScroll",!0)("searchable",!0),A("ngModel",i.Recipe.CostCenterId),s(6),R(" ",P(39,75,"ProductRecipe.TotalPrice")," "),s(2),T("value",i.Recipe.TotalPrice)("disabled",!0),s(7),R(" ",P(48,77,"ProductRecipe.TotalDirectProduct")," "),s(4),R(" ",i.Recipe.TotalDirectProduct," "),s(9),w(P(61,79,"SaleInvoice.Storage")),s(3),w(P(64,81,"SaleInvoice.Name")),s(3),w(P(67,83,"SaleInvoice.Unit")),s(3),w(P(70,85,"Table.Quantity")),s(3),w(P(73,87,"ProductRecipe.WA")),s(3),w(P(76,89,"Table.Total")),s(3),T("ngForOf",i.RecipeDetails),s(3),R(" ",P(82,91,"ProductRecipe.TotalDirectSalary")," "),s(4),R(" ",i.Recipe.TotalDirectSalary," "),s(9),w(P(95,93,"SaleInvoice.Name")),s(3),w(P(98,95,"MoneyIn.Price")),s(3),w(P(101,97,"MoneyIn.Notes")),s(3),T("ngForOf",i.RecipeDetails),s(6),R(" ",P(110,99,"ProductRecipe.TotalInDirectProduct")," "),s(4),R(" ",i.Recipe.TotalInDirectProduct," "),s(9),w(P(123,101,"SaleInvoice.Storage")),s(3),w(P(126,103,"SaleInvoice.Name")),s(3),w(P(129,105,"SaleInvoice.Unit")),s(3),w(P(132,107,"Table.Quantity")),s(3),w(P(135,109,"ProductRecipe.WA")),s(3),w(P(138,111,"Table.Total")),s(3),T("ngForOf",i.RecipeDetails),s(3),R(" ",P(144,113,"ProductRecipe.TotalInDirectSalary")," "),s(4),R(" ",i.Recipe.TotalInDirectSalary," "),s(9),w(P(157,115,"SaleInvoice.Name")),s(3),w(P(160,117,"MoneyIn.Price")),s(3),w(P(163,119,"MoneyIn.Notes")),s(3),T("ngForOf",i.RecipeDetails),s(3),R(" ",P(169,121,"ProductRecipe.TotalInDirectOther")," "),s(4),R(" ",i.Recipe.TotalInDirectOther," "),s(9),w(P(182,123,"SaleInvoice.Name")),s(3),w(P(185,125,"MoneyIn.Price")),s(3),w(P(188,127,"MoneyIn.Notes")),s(3),T("ngForOf",i.RecipeDetails),s(),T("Id",i.Recipe.Id)}}var dt=(()=>{let u=class u{constructor(t,e,n,o){this._SharedScreenService=t,this._SharedObjectModelService=e,this._AppModeService=n,this._Apiservice=o,this.TablePaging={InputType:"Table",Type:"TablePaging",GlobalData:{Url:"Global/GetAll",TableName:"ProductRecipe",JoinTables:["Items Product","ItemUnits ProductUnit"],JoinConditions:["T.ProductId = Product.Id","T.ProductUnitId = ProductUnit.Id"],Join:!0,Columns:["T.Id","T.DocNo","Product.Name AS ProductName","ProductUnit.Name AS ProductUnitName","T.TotalDirectProduct","T.TotalDirectSalary","T.TotalInDirectProduct","T.TotalInDirectSalary","T.TotalInDirectOther","T.TotalPrice"]},Required:!1,TableCell:[{SortName:"DocNo",CellName:"Table.DocNo",ExistSearchField:"T.DocNo"},{SortName:"ProductName",CellName:"Table.Name",ExistSearchField:"Product.Name"},{SortName:"ProductUnitName",CellName:"Item.ItemUnit",ExistSearchField:"ProductUnit.Name"},{SortName:"TotalDirectProduct",CellName:"ProductRecipe.TotalDirectProduct",ExistSearchField:"T.TotalDirectProduct"},{SortName:"TotalDirectSalary",CellName:"ProductRecipe.TotalDirectSalary",ExistSearchField:"T.TotalDirectSalary"},{SortName:"TotalInDirectProduct",CellName:"ProductRecipe.TotalInDirectProduct",ExistSearchField:"T.TotalInDirectProduct"},{SortName:"TotalInDirectSalary",CellName:"ProductRecipe.TotalInDirectSalary",ExistSearchField:"T.TotalInDirectSalary"},{SortName:"TotalInDirectOther",CellName:"ProductRecipe.TotalInDirectOther",ExistSearchField:"T.TotalInDirectOther"},{SortName:"TotalPrice",CellName:"ProductRecipe.TotalPrice",ExistSearchField:"T.TotalPrice"}]},this.Recipe={Id:0,DocNo:0,DocDate:null,ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",CostCenterId:null,CostCenterName:"",TotalPrice:0,Items:[],ProductUnits:[],CostCenters:[],RecipeDetails:[]},this.RecipeType={DirectProduct:1,DirectSalary:2,InDirectProduct:3,InDirectSalary:4,InDirectOther:5},this.RecipeDetails=[{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],RecipeType:this.RecipeType.DirectProduct,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""},{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],RecipeType:this.RecipeType.DirectSalary,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""},{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],RecipeType:this.RecipeType.InDirectProduct,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""},{Id:0,Name:"",ProductId:null,ProductName:"",Items:[],StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],RecipeType:this.RecipeType.InDirectSalary,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""},{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],RecipeType:this.RecipeType.InDirectOther,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""}]}ngOnInit(){}OpenModal(){this._AppModeService.DisabledButton=!0,this.ResetPage(),this.GetPageInfo()}ShowToEdite(t){this.ResetPage(),this.Drow(t.PageModel)}Drow(t){console.log(t),this.Recipe={Id:t.Id,Notes:t.Notes,DocNo:t.DocNo,ProductId:t.ProductId,ProductName:t.ProductName,ProductUnitId:t.ProductUnitId,ProductUnitName:t.ProductUnitName,CostCenterId:t.CostCenterId,CostCenterName:t.CostCenterName,TotalPrice:t.TotalPrice,TotalDirectProduct:t.TotalDirectProduct,TotalDirectSalary:t.TotalDirectSalary,TotalInDirectProduct:t.TotalInDirectProduct,TotalInDirectSalary:t.TotalInDirectSalary,TotalInDirectOther:t.TotalInDirectOther,ProductRecipeDetails:t.ProductRecipeDetails},this.Recipe.Items=[{Id:t.ProductId,Name:t.ProductName,NameAndCode:t.ProductName}],this.Recipe.ProductUnits=[{Id:t.ProductUnitId,Name:t.ProductUnitName,NameAndUnitFactor:t.ProductUnitName}],this.Recipe.CostCenters=[{Id:t.CostCenterId,Name:t.CostCenterName}],this.RecipeDetails=[];for(let x=0;x<this.Recipe.ProductRecipeDetails.length;x++){let I=this.Recipe.ProductRecipeDetails[x];I.StorageId>0&&(I.Storages=[{Id:I.StorageId,Name:I.StorageName}]),I.ProductId>0&&(I.Items=[{Id:I.ProductId,Name:I.ProductName,NameAndCode:I.ProductName}]),I.ProductUnitId>0&&(I.ProductUnits=[{Id:I.ProductUnitId,Name:I.ProductUnitName,NameAndUnitFactor:I.ProductUnitName}]),I.AccTreeId>0&&(I.AccTrees=[{Id:I.AccTreeId,Name:I.AccTreeName}]),this.RecipeDetails.push(I)}this.Recipe.ProductRecipeDetails.filter(x=>x.RecipeType==this.RecipeType.DirectProduct).length==0&&this.AppendRow(this.RecipeType.DirectProduct),this.Recipe.ProductRecipeDetails.filter(x=>x.RecipeType==this.RecipeType.DirectSalary).length==0&&this.AppendRow(this.RecipeType.DirectSalary),this.Recipe.ProductRecipeDetails.filter(x=>x.RecipeType==this.RecipeType.InDirectProduct).length==0&&this.AppendRow(this.RecipeType.InDirectProduct),this.Recipe.ProductRecipeDetails.filter(x=>x.RecipeType==this.RecipeType.InDirectSalary).length==0&&this.AppendRow(this.RecipeType.InDirectSalary),this.Recipe.ProductRecipeDetails.filter(x=>x.RecipeType==this.RecipeType.InDirectOther).length==0&&this.AppendRow(this.RecipeType.InDirectOther)}GetPageInfo(){this._Apiservice.get("ProductRecipeEP/GetPageInfo",!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:t=>{this._AppModeService.DisabledButton=!1,t.IsSuccess==!0&&t.Obj!=null?this.Recipe.DocNo=t.Obj:this._AppModeService._Toastr.error(t.Message)},error:t=>{this._AppModeService.DisabledButton=!1}})}AppendRow(t){let e={Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],RecipeType:t,Items:[],ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""};this.RecipeDetails.push(e)}RemoveRow(t,e){return this.RecipeDetails.filter(n=>n.RecipeType==t).length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.RecipeDetails.splice(e,1),this.CalcRecipe(),!0)}CalcRecipe(){this.Recipe.TotalPrice=0,this.Recipe.TotalDirectProduct=0,this.Recipe.TotalDirectSalary=0,this.Recipe.TotalInDirectProduct=0,this.Recipe.TotalInDirectSalary=0,this.Recipe.TotalInDirectOther=0;for(let t=0;t<this.RecipeDetails.length;t++){let e=this.RecipeDetails[t];e.TotalPrice=Number(e.WA)*Number(e.Quantity),this.Recipe.TotalPrice+=Number(e.TotalPrice),this.Recipe.TotalPrice+=Number(e.Amount),e.RecipeType==this.RecipeType.DirectProduct&&(this.Recipe.TotalDirectProduct+=Number(e.WA)*Number(e.Quantity)),e.RecipeType==this.RecipeType.DirectSalary&&(this.Recipe.TotalDirectSalary+=Number(e.Amount)),e.RecipeType==this.RecipeType.InDirectProduct&&(this.Recipe.TotalInDirectProduct+=Number(e.WA)*Number(e.Quantity)),e.RecipeType==this.RecipeType.InDirectSalary&&(this.Recipe.TotalInDirectSalary+=Number(e.Amount)),e.RecipeType==this.RecipeType.InDirectOther&&(this.Recipe.TotalInDirectOther+=Number(e.Amount))}}ChangeSearchApi(t,e){let n="";n=`${e.searchTerm}`.trim(),(n==""||n=="null")&&(e.searchTerm="",n=""),this._AppModeService.CurrentPage+=1;let o={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:n,SearchField:"Name"};if(t=="CostCenter"&&(o.BranchFilter=!0),t=="Product"&&(o.TableName="Items",o.Columns=["Id","Name","Code"],o.SearchField="Code",o.Conditions="ProductType = 1"),t=="ItemUnits"){let m=this.Recipe.ProductId==null?0:this.Recipe.ProductId;o.Conditions=`ItemId = ${m}`,o.Join=!0,o.JoinTables=["Units U"],o.NoPaging=!0,o.JoinConditions=["T.UnitId = U.Id"],o.Columns=["T.Id","U.Name","T.UnitFactor"],o.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",o,!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:m=>{m.IsSuccess==!0&&m.Obj!=null?this.HandleResponse(m.Obj,t):this._AppModeService._Toastr.error(m.Message)}})}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="CostCenter"&&(this.Recipe.CostCenters=this._SharedObjectModelService.RemoveDuplicates(this.Recipe.CostCenters.concat(t.DataReturn),"Id")),e=="Product"&&(this.Recipe.Items=this._SharedObjectModelService.RemoveDuplicates(this.Recipe.Items.concat(t.DataReturn),"Id").map(n=>E(M({},n),{NameAndCode:n.Code!=null?`${n.Name} - ${n.Code}`:`${n.Name}`}))),e=="ItemUnits"&&(this.Recipe.ProductUnits=t.DataReturn.map(n=>E(M({},n),{UnitFactor:n.UnitFactor,NameAndUnitFactor:`${n.Name} - ${n.UnitFactor}`})))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let n=[];e=="Product"&&(n=this.Recipe.Items),e=="CostCenter"&&(n=this.Recipe.CostCenters),e=="ProductUnit"&&(n=this.Recipe.ProductUnits);let o=n.find(m=>m.Id==t);if(o==null){this._AppModeService.DontPlay();return}else this.Recipe[`${e}Id`]=t,this.Recipe[`${e}Name`]=o.Name}else this.Recipe[`${e}Id`]=null,this.Recipe[`${e}Name`]="",(e=="Product"||e=="ProductUnit")&&(this.Recipe.ProductUnits=[],this.Recipe.ProductUnitId=null)}SelectItem(t,e){if(t!=null&&t>0){let n=this.RecipeDetails[e].Items.find(o=>o.Id==t);if(n!=null)this.RecipeDetails[e].ProductId=n.Id,this.RecipeDetails[e].ProductName=n.Name,this.RecipeDetails[e].ProductUnitId=null,this.RecipeDetails[e].ProductUnits=[],this.AfterSelectem(n.Id,e);else{this._Apiservice.DontPlay();return}}else this.RecipeDetails[e].ProductUnitId=null,this.RecipeDetails[e].ProductUnits=[]}AfterSelectem(t,e){if(t>0){let n={TableName:"ItemUnits",Columns:["Id","Name"],NoPaging:!0,SearchText:"",SearchField:"Name"};n.Conditions=`ItemId = ${t}`,n.Join=!0,n.JoinTables=["Units U"],n.JoinConditions=["T.UnitId = U.Id"],n.Columns=["T.Id","U.Name","T.UnitFactor","T.DefaultUnit"],n.SearchField="U.Name",this._Apiservice.post("Global/GetAll",n,!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:o=>{if(o.IsSuccess==!0&&o.Obj!=null){console.log(o.Obj.DataReturn),o.Obj.DataReturn=o.Obj.DataReturn.map(x=>E(M({},x),{NameAndUnitFactor:x.UnitFactor!=null?`${x.Name} - ${x.UnitFactor}`:`${x.Name}`}));let m=o.Obj.DataReturn,S=m.find(x=>x.DefaultUnit==!0);if(S&&this.RecipeDetails.find(I=>I.ProductId==t&&I.ProductUnitId==S.Id)==null){this.RecipeDetails[e].ProductUnits=[{Id:S.Id,NameAndUnitFactor:S.Name+" - "+S.UnitFactor}],this.RecipeDetails[e].ProductUnitId=S.Id,this.SelectUnit(S.Id,e);return}for(let x=0;x<m.length;x++){let I=this.RecipeDetails.find(B=>B.ProductId==t&&B.ProductUnitId==m[x].Id);if(I==null){this.RecipeDetails[e].ProductUnits=[{Id:m[x].Id,NameAndUnitFactor:m[x].Name+" - "+m[x].UnitFactor}],this.RecipeDetails[e].ProductUnitId=m[x].Id,this.SelectUnit(m[x].Id,e);break}I!=null&&x==m.length-1&&this.RecipeDetails.splice(e,1)}this.CalcRecipe()}else this._AppModeService._Toastr.error(o.Message)}})}}SelectUnit(t,e){if(t!=null&&t>0){let n=this.RecipeDetails[e].ProductUnits.find(o=>o.Id==t);if(n!=null)this.RecipeDetails[e].ProductUnitId=n.Id,this.RecipeDetails[e].ProductUnitName=n.Name,this.UnitWa(n.Id,e);else{this._Apiservice.DontPlay();return}}}UnitWa(t,e){let n=this.RecipeDetails[e].ProductId;t>0&&n>0&&this._Apiservice.get(`ItemEP/ItemWaUnit?ProductId=${n}&ProductUnitId=${t}`,!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:o=>{o.IsSuccess==!0&&o.Obj!=null?(this.RecipeDetails[e].WA=o.Obj,this.CalcRecipe()):this._AppModeService._Toastr.error(o.Message)}})}ChangeSearchApiDetails(t,e,n,o){let m=`${e.searchTerm}`.trim();(m==""||m=="null")&&(e.searchTerm="",m=""),this._AppModeService.CurrentPage+=1;let S={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:m,SearchField:"Name"};if(t=="AccTreeExpenses"&&(S.TableName="AccTree",S.BranchFilter=!0,S.Conditions="AccClass >= 3 And Level = 5"),(t=="DirectProduct"||t=="InDirectProduct")&&(S.TableName="Items",S.Columns=["Id","Name","Code"],t=="DirectProduct"&&(S.Conditions=this.Recipe.ProductId>0?`ProductType = 1 And Id != ${this.Recipe.ProductId}`:"ProductType = 1"),t=="InDirectProduct"&&(S.Conditions=this.Recipe.ProductId>0?`ProductType = 3 And Id != ${this.Recipe.ProductId}`:"ProductType = 3")),t=="ItemUnits"){let x=this.RecipeDetails[n].ProductId==null?0:this.RecipeDetails[n].ProductId;S.Conditions=`ItemId = ${x}`,S.Join=!0,S.JoinTables=["Units U"],S.NoPaging=!0,S.JoinConditions=["T.UnitId = U.Id"],S.Columns=["T.Id","U.Name","T.UnitFactor"],S.SearchField="U.Name"}this._Apiservice.post("Global/GetAll",S,!1).pipe(b(this._Apiservice.destroy$)).subscribe({next:x=>{x.IsSuccess==!0&&x.Obj!=null?this.HandleResponseDetails(x.Obj,t,n):this._AppModeService._Toastr.error(x.Message)}})}HandleResponseDetails(t,e,n){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Storages"&&(this.RecipeDetails[n].Storages=this._SharedObjectModelService.RemoveDuplicates(this.RecipeDetails[n].Storages.concat(t.DataReturn),"Id")),(e=="DirectProduct"||e=="InDirectProduct")&&(this.RecipeDetails[n].Items=this._SharedObjectModelService.RemoveDuplicates(this.RecipeDetails[n].Items.concat(t.DataReturn),"Id"),this.RecipeDetails[n].Items=this.RecipeDetails[n].Items.map(o=>E(M({},o),{NameAndCode:o.Code!=null?`${o.Name} - ${o.Code}`:`${o.Name}`}))),e=="ItemUnits"&&(this.RecipeDetails[n].ProductUnits=t.DataReturn.map(o=>E(M({},o),{NameAndUnitFactor:o.UnitFactor!=null?`${o.Name} - ${o.UnitFactor}`:`${o.Name}`}))),e=="AccTreeExpenses"&&(this.RecipeDetails[n].AccTrees=this._SharedObjectModelService.RemoveDuplicates(this.RecipeDetails[n].AccTrees.concat(t.DataReturn),"Id"))}SelectValueDetails(t,e,n){if(t!=null&&t>0){let o=[];e=="AccTree"&&(o=this.RecipeDetails[n].AccTrees),e=="Storage"&&(o=this.RecipeDetails[n].Storages);let m=o.find(S=>S.Id==t);if(m!=null)this.RecipeDetails[n][`${e}Id`]=m.Id,this.RecipeDetails[n][`${e}Name`]=m.Name;else{this._Apiservice.DontPlay();return}}else this.RecipeDetails[n][`${e}Id`]=null,this.RecipeDetails[n][`${e}Name`]=[]}Save(){if(this.Recipe.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.ChooseItem"));return}if(this.Recipe.ProductUnitId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.EnterProductUnit"));return}if(this.Recipe.CostCenterId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.EnterCostCenter"));return}if(this.Recipe.TotalPrice<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.TotalPrice"));return}let t=this.RecipeDetails.filter(n=>Number(n.WA)>0||Number(n.Amount)>0);if(t.length==0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.Empty"));return}for(let n=0;n<t.length;n++){let o=t[n];if(o.RecipeType=Number(o.RecipeType),Number(o.Amount)>0&&o.AccTreeId==null&&(o.RecipeType==this.RecipeType.DirectSalary||o.RecipeType==this.RecipeType.InDirectSalary||o.RecipeType==this.RecipeType.InDirectOther)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.ChooseAccount"));return}if(Number(o.WA)>0&&(o.RecipeType==this.RecipeType.DirectProduct||o.RecipeType==this.RecipeType.InDirectProduct)){if(o.ProductId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.ChooseItem"));return}if(o.StorageId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductRecipe.Error.StoreId"));return}}}let e={Id:this.Recipe.Id,DocNo:this.Recipe.DocNo,Notes:this.Recipe.Notes,ProductId:this.Recipe.ProductId,ProductName:this.Recipe.ProductName,ProductUnitId:this.Recipe.ProductUnitId,ProductUnitName:this.Recipe.ProductUnitName,CostCenterId:this.Recipe.CostCenterId,CostCenterName:this.Recipe.CostCenterName,TotalPrice:this.Recipe.TotalPrice,ProductRecipeDetails:t.map(n=>E(M({},n),{Quantity:Number(n.Quantity),WA:Number(n.WA),Amount:Number(n.Amount)}))};e.Id==0&&this._Apiservice.post("ProductRecipeEP/Add",e,!0).pipe(b(this._Apiservice.destroy$)).subscribe({next:n=>{n.IsSuccess==!0&&n.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.ResetPage(),this.GetPageInfo(),this.DynamicComponent.Paging.DataReturn.push(n.Obj)):this._AppModeService._Toastr.error(n.Message)}}),e.Id>0&&this._Apiservice.put("ProductRecipeEP/Update",e,!0).pipe(b(this._Apiservice.destroy$)).subscribe({next:n=>{if(n.IsSuccess==!0&&n.Obj!=null){this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.UpdateSuccess"));let o=n.Obj,m=this.DynamicComponent.Paging.DataReturn.find(S=>S.Id==o.Id);m!=null&&Object.assign(m,o),this.ResetPage(),this.GetPageInfo()}else this._AppModeService._Toastr.error(n.Message)}})}ResetPage(){this.Recipe={Id:0,DocNo:0,DocDate:null,ProductId:null,ProductName:"",ProductUnitId:null,ProductUnitName:"",CostCenterId:null,CostCenterName:"",TotalPrice:0,Amount:"",Items:[],ProductUnits:[],CostCenters:[],RecipeDetails:[]},this.RecipeDetails=[{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],RecipeType:this.RecipeType.DirectProduct,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""},{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],RecipeType:this.RecipeType.DirectSalary,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""},{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],RecipeType:this.RecipeType.InDirectProduct,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""},{Id:0,Name:"",ProductId:null,ProductName:"",Items:[],StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],RecipeType:this.RecipeType.InDirectSalary,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""},{Id:0,Name:"",ProductId:null,ProductName:"",StorageId:null,StorageName:"",Storages:[],AccTreeId:null,AccTreeName:"",AccTrees:[],Items:[],RecipeType:this.RecipeType.InDirectOther,ProductUnitId:null,ProductUnitName:"",ProductUnits:[],Quantity:"",Amount:"",WA:""}]}ngOnDestroy(){this._Apiservice.destroy$.next(),this._Apiservice.destroy$.complete()}};u.\u0275fac=function(e){return new(e||u)(k(de),k(pe),k(ie),k(z))},u.\u0275cmp=F({type:u,selectors:[["app-recipe-product"]],viewQuery:function(e,n){if(e&1&&$(ue,5),e&2){let o;j(o=L())&&(n.DynamicComponent=o.first)}},standalone:!0,features:[Q],decls:4,vars:6,consts:[["dynamiccomponent",""],["content",""],["Select",""],["SelectProductUnit",""],["SelectStorages",""],["SelectItem22",""],["SelectUnits",""],["SelectAccTreeDetails",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","OutModal","DeleteUrl","GetById"],[1,"modalConent"],[3,"PageTitle"],[1,"col-12","d-flex","flex-wrap","justify-content-","align-items-center","p-1","bg-white"],[1,"col-12","col-md-1","p-1"],["for","DocNo",1,""],["id","DocNo","name","DocNo","type","number",1,"form-control","text-center",3,"disabled","value"],[1,"col-12","col-md-2","p-1"],["for","Notes",1,""],["id","Notes","name","Notes","type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,""],["id","ngSelectComponent","placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["id","ngSelectComponent","placeholder","Search","bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","disabled","dropdownPosition","items","virtualScroll","searchable","ngModel"],["id","ngSelectComponent","placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","virtualScroll","searchable","ngModel"],["for","TotalPrice",1,""],["id","TotalPrice","name","TotalPrice","type","number","appNumericInput","",1,"form-control","text-center",3,"value","disabled"],[1,"modal-body","p-0","m-0","d-flex","flex-wrap","justify-content-center","align-items-start","Invoicemodalbody","bg-white","ProductTable"],[1,"col-12"],[1,"m-0","p-2","col-12"],["id","ProductTable",1,"DivPaging","col-12","table-responsive-vertical","shadow-z-1"],[1,"my-1","text-center"],[1,"table","table-hover","table-striped","table-light","mt-1","mb-0"],[1,"col-2"],[4,"ngFor","ngForOf"],[1,"col-4"],[3,"SaveEvent","UpdateEvent","CloseEvent","Id"],[1,"form-text","text-muted"],[4,"ngIf"],[1,"d-flex","justify-content-center","align-items-center","col-12"],[1,"btn-Add","btn",3,"click"],[1,"mx-1","fw-bold","pi","pi-plus"],[1,"btn-Delete","btn-Page","btn",3,"click"],[1,"mx-1","pi","pi-trash","fw-bold"],["bindLabel","Name","bindValue","Id",1,"p-0","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","dropdownPosition","placeholder","searchable","virtualScroll","ngModel"],["bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","placeholder","virtualScroll","searchable","ngModel"],["bindLabel","NameAndUnitFactor","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","dropdownPosition","items","placeholder","disabled","virtualScroll","searchable","ngModel"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"change","keyup","ngModelChange","id","name","disabled","ngModel"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","col-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["min","0","type","number","appNumericInput","",1,"form-control","text-center",3,"change","keyup","ngModelChange","id","name","ngModel"],["type","text",1,"form-control","text-center",3,"ngModelChange","id","name","ngModel"]],template:function(e,n){if(e&1){let o=U();l(0,"app-dynamic-component",8,0),h("OpenModalEvent",function(){return c(o),a(n.OpenModal())})("ShowToEditeEvent",function(S){return c(o),a(n.ShowToEdite(S))}),p(),f(2,ze,192,129,"ng-template",9,1,G)}if(e&2){let o=g(3);T("PageTitle","ProductRecipe.ProductRecipe")("TablePaging",n.TablePaging)("FullScreen",!0)("OutModal",o)("DeleteUrl","ProductRecipeEP/Delete")("GetById","ProductRecipeEP/GetById")}},dependencies:[le,ne,X,ee,Y,te,Z,H,ae,ce,re,oe,J,K,q,se,_e]});let _=u;return _})();export{dt as RecipeProductComponent};
