import{a as Ce,b as ge,c as Se}from"./chunk-BZPR73YG.js";import{a as he}from"./chunk-ABGH7SJD.js";import{a as De}from"./chunk-AFVHDR2Z.js";import{b as pe,c as de,h as _e}from"./chunk-RMPXGUPG.js";import"./chunk-6G7QKXJW.js";import"./chunk-PE2JD36L.js";import{a as me}from"./chunk-NNHHLG53.js";import"./chunk-RAAURFHQ.js";import{a as le,b as ce}from"./chunk-UVSBIWKY.js";import"./chunk-5EQTOVFJ.js";import{a as ue}from"./chunk-OZ63RRZR.js";import"./chunk-3T7HRBK4.js";import"./chunk-G323P4PR.js";import"./chunk-NZD6IPKE.js";import"./chunk-EKOK3I7J.js";import{a as oe,b as se,c as ae,d as re}from"./chunk-SU7IEUNK.js";import"./chunk-MYPGER6Q.js";import"./chunk-CETGYK4I.js";import{c as ne}from"./chunk-F7IHWOEY.js";import{c as Y,d as J}from"./chunk-GJAIQ3XH.js";import{b as q,c as R,d as z,g as K,i as X,l as Z,n as ee,t as te,v as ie}from"./chunk-UA6GT64L.js";import{d as $,e as H,j as Q}from"./chunk-GOUT62LL.js";import{$b as y,Cb as a,Db as l,Eb as E,Ib as M,Mb as f,Nb as c,Qb as I,Rb as N,Tb as P,Ub as V,Vb as O,Wb as A,X as S,Xb as h,Yb as G,Zb as g,_b as L,ac as T,bc as b,cc as F,db as s,dc as j,eb as w,ia as B,na as k,nc as D,oc as C,pc as W,qc as U,vb as x,xa as p,xb as _,ya as m}from"./chunk-RH76WUG2.js";import"./chunk-3EYC4JTX.js";var ve=["GLComponent"],xe=["dynamiccomponent"];function Ie(r,u){if(r&1&&(a(0,"span",24),h(1),D(2,"date"),l()),r&2){let n=c(2);s(),g(" ",W(2,1,n.CashDiscount.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function ye(r,u){if(r&1){let n=M();a(0,"div",25,3)(2,"p-calendar",26),b("ngModelChange",function(e){p(n);let i=c(2);return T(i.CashDiscount.DocDate,e)||(i.CashDiscount.DocDate=e),m(e)}),l()()}if(r&2){let n=c(2);s(2),y("ngModel",n.CashDiscount.DocDate),_("showTime",!0)("showIcon",!0)("showOnFocus",!0)("showOtherMonths",!0)}}function Te(r,u){if(r&1&&(a(0,"small",39),h(1),l()),r&2){let n=c().$implicit,t=c(2);s(),L("Loaded ",n.Clients.length," of ",t._SharedObjectModelService.TotalItems,"")}}function be(r,u){if(r&1&&h(0),r&2){let n=u.item;g(" ",n.Name," ")}}function we(r,u){if(r&1&&(a(0,"span",40),h(1),l()),r&2){let n=c().$implicit;s(),g(" ",n.AmountDebts," ")}}function Me(r,u){if(r&1){let n=M();a(0,"tr")(1,"td",27)(2,"div",28)(3,"button",29),f("click",function(){p(n);let e=c(2);return m(e.AppendRow())}),h(4,"+"),l(),a(5,"button",30),f("click",function(){let e=p(n).index,i=c(2);return m(i.RemoveRow(e))}),h(6,"-"),l()()(),a(7,"td",31),D(8,"translate"),a(9,"ng-select",32,4),f("clear",function(){let e=p(n).$implicit;return m(e.Clients=[])})("focus",function(){let e=p(n).index,i=A(10),o=c(2);return o.ChangeSearchApiDetails("Clients",i,e),m(o._AppModeService.ResetCurrentPage())})("keyup",function(){let e=p(n).index,i=A(10),o=c(2);return o.ChangeSearchApiDetails("Clients",i,e),m(o._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){let e=p(n).index,i=A(10),o=c(2);return m(o.ChangeSearchApiDetails("Clients",i,e))})("close",function(){p(n);let e=c(2);return m(e._AppModeService.ResetCurrentPage())})("open",function(){p(n);let e=c(2);return m(e._AppModeService.ResetCurrentPage())})("change",function(){let e=p(n),i=e.$implicit,o=e.index,d=c(2);return m(d.SelectValueDetails(i.ClientId,"Client",o))}),b("ngModelChange",function(e){let i=p(n).$implicit;return T(i.ClientId,e)||(i.ClientId=e),m(e)}),x(11,Te,2,2,"ng-template",33)(12,be,1,1,"ng-template",34),l()(),a(13,"td",35),D(14,"translate"),x(15,we,2,1,"span",36),l(),a(16,"td",35),D(17,"translate"),a(18,"input",37),f("keyup",function(){let e=p(n),i=e.$implicit,o=e.index,d=c(2);return d.TotalCashDiscount(),m(d.ChangeAmount(i.ClientId,o))}),b("ngModelChange",function(e){let i=p(n).$implicit;return T(i.Amount,e)||(i.Amount=e),m(e)}),l()(),a(19,"td",35),D(20,"translate"),a(21,"input",38),b("ngModelChange",function(e){let i=p(n).$implicit;return T(i.Notes,e)||(i.Notes=e),m(e)}),l()()()}if(r&2){let n=u.$implicit,t=u.index,e=c(2);s(),I("title",t+1),s(4),_("disabled",e.CashDiscount.SalesDisountDetails.length==1),s(2),I("title",C(8,25,"TransferStorage.Name")),s(2),_("items",n.Clients)("autofocus",!1)("dropdownPosition",e._AppModeService.DropdownPosition(t))("virtualScroll",!0)("searchable",!0),y("ngModel",n.ClientId),s(4),I("title",C(14,27,"MoneyIn.Debt")),s(2),_("ngIf",n.ClientId>0),s(),I("title",C(17,29,"MoneyIn.Price")),s(2),N("name","Amount",t,""),N("id","Amount",t,""),_("disabled",n.ClientId==0||n.ClientId==null),y("ngModel",n.Amount),s(),I("title",C(20,31,"MoneyIn.Notes")),s(2),N("name","Notes",t,""),N("id","Notes",t,""),_("disabled",n.ClientId==0||n.ClientId==null),y("ngModel",n.Notes)}}function Ne(r,u){if(r&1){let n=M();E(0,"app-modal-header",6),a(1,"div",7)(2,"div",8)(3,"div",9),E(4,"input",10),l(),a(5,"div",11)(6,"label",12),h(7),D(8,"translate"),l(),a(9,"input",13),b("ngModelChange",function(e){p(n);let i=c();return T(i.CashDiscount.Notes,e)||(i.CashDiscount.Notes=e),m(e)}),l()(),a(10,"div",14),x(11,Ie,3,4,"span",15)(12,ye,3,5,"div",16),l()(),a(13,"div",17)(14,"table",18)(15,"thead")(16,"th",19),h(17,"#"),l(),a(18,"th",20),h(19),D(20,"translate"),l(),a(21,"th",20),h(22),D(23,"translate"),l(),a(24,"th",20),h(25),D(26,"translate"),l(),a(27,"th",21),h(28),D(29,"translate"),l()(),a(30,"tbody"),x(31,Me,22,33,"tr",22),l()()()(),a(32,"app-modal-footer",23),f("SaveEvent",function(){p(n);let e=c();return m(e.Save())})("UpdateEvent",function(){p(n);let e=c();return m(e.Save())})("OpenGlEvent",function(){p(n);let e=c();return m(e.OpenGl())})("CloseEvent",function(){let e=p(n).$implicit,i=c();return e.close("Close click"),m(i.ResetPage())}),l()}if(r&2){let n=c();_("PageTitle",n.TablePaging.PageTitle),s(4),_("disabled",!0)("value",n.CashDiscount.DocNo),s(3),G(C(8,15,"Table.Notes")),s(2),y("ngModel",n.CashDiscount.Notes),s(2),_("ngIf",(n._DefaultSettingsService.DefaultSettings==null?null:n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!1),s(),_("ngIf",(n._DefaultSettingsService.DefaultSettings==null?null:n._DefaultSettingsService.DefaultSettings.DateTimeReadOnly)==!0),s(7),g(" ",C(20,17,"SaleInvoice.Client")," "),s(3),g(" ",C(23,19,"MoneyIn.Debt")," "),s(3),g(" ",C(26,21,"MoneyIn.Price")," "),s(3),g(" ",C(29,23,"MoneyIn.Notes")," "),s(3),_("ngForOf",n.CashDiscount.SalesDisountDetails)("ngForTrackBy",n.trackByMethod),s(),_("Id",n.CashDiscount.Id)("Gl",!0)}}var nt=(()=>{let u=class u{constructor(t,e,i,o){this._SharedObjectModelService=t,this._AppModeService=e,this._DefaultSettingsService=i,this._Apiservice=o,this._ServiceLifeTime=B(R),this.TablePaging={PageTitle:"CashDisount.CashDisount",BranchFilter:!0,Url:"Global/GetAll",TableName:"SalesDisount",GetById:"SalesDisountEP/GetById",DeleteUrl:"SalesDisountEP/Delete",Columns:["Id","DocNo","DocDate","Notes"],TableCell:[{SortName:"DocNo",CellName:"Table.DocNo"},{SortName:"DocDate",CellName:"Table.DocDate",CellDateTime:!0},{SortName:"Notes",CellName:"Table.Notes"}]},this.CashDiscount={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SalesDisountDetails:[{Amount:"",ClientId:null,ClientName:"",Id:0,Code:"",Name:"",Clients:[],AmountDebts:0}]}}ngOnInit(){this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener()}OpenModal(){this.ResetPage(),this.GetPageInfo()}OpenGl(){this.GLComponent.Open()}ShowToEdite(t){this.GLComponent.Gl=t.Gl,this.Drow(t.PageModel)}Drow(t){this.CashDiscount={DocDate:new Date(t.DocDate),DocNo:t.DocNo,Id:t.Id,Name:t.Name,Code:t.Code,SalesDisountDetails:t.SalesDisountDetails};for(let e=0;e<this.CashDiscount.SalesDisountDetails.length;e++){this.CashDiscount.SalesDisountDetails[e].Clients=[],this.CashDiscount.SalesDisountDetails[e].Clients=[{Id:this.CashDiscount.SalesDisountDetails[e].ClientId,Name:this.CashDiscount.SalesDisountDetails[e].ClientName}];let i=this.CashDiscount.SalesDisountDetails[e].ClientId;this._Apiservice.getById("ClientEP/TotalBadDepts",i,!1).pipe(S(this._ServiceLifeTime.Destroyed$)).subscribe({next:o=>{this.CashDiscount.SalesDisountDetails[e].AmountDebts=o.Obj}})}}StartConnection(){this.Hub_Connection=new Se().withUrl(`${q.signalrUrl}/SalesDisount`,{skipNegotiation:!0,transport:ge.WebSockets,accessTokenFactory:()=>this._Apiservice.getToken()}).configureLogging(Ce.Error).build(),this.Hub_Connection.start().then(()=>{console.log("Hub Connection Success")}).catch(t=>{console.log(t)})}GetPageInfo(){this._Apiservice.get("SalesDisountEP/GetPageInfo",!1).pipe(S(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{this.CashDiscount.DocNo=t.Obj}})}ChangeSearchApiDetails(t,e,i){let o=`${e.searchTerm}`.trim();(o==""||o=="null")&&(e.searchTerm="",o=""),this._AppModeService.CurrentPage+=1;let d={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:o,SearchField:"Name"};this._Apiservice.post("Global/GetAll",d,!1).pipe(S(this._ServiceLifeTime.Destroyed$)).subscribe({next:v=>{this.HandleResponseDetails(v.Obj,t,i)}})}HandleResponseDetails(t,e,i){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Clients"&&(this.CashDiscount.SalesDisountDetails[i].Clients=this._SharedObjectModelService.RemoveDuplicates(this.CashDiscount.SalesDisountDetails[i].Clients.concat(t.DataReturn),"Id"))}SelectValueDetails(t,e,i){if(t!=null&&t>0){let o=[];e=="Client"&&(o=this.CashDiscount.SalesDisountDetails[i].Clients);let d=o.find(v=>v.Id==t);if(d!=null)this.CashDiscount.SalesDisountDetails[i][`${e}Id`]=d.Id,this.CashDiscount.SalesDisountDetails[i][`${e}Name`]=d.Name,this.TotalDept(d.Id,i);else{this._Apiservice.DontPlay();return}}else this.CashDiscount.SalesDisountDetails[i][`${e}Id`]=null,this.CashDiscount.SalesDisountDetails[i][`${e}Name`]=[]}TotalDept(t,e){this._Apiservice.getById("ClientEP/TotalBadDepts",t,!1).pipe(S(this._ServiceLifeTime.Destroyed$)).subscribe({next:i=>{this.CashDiscount.SalesDisountDetails[e].AmountDebts=i.Obj}})}AppendRow(){return this.Row={ClientId:null,Amount:"",AmountDebts:0,ClientName:"",Clients:[],Code:"",Id:0,Name:""},this.CashDiscount.SalesDisountDetails.push(this.Row),this.TotalCashDiscount(),!0}RemoveRow(t){return this.CashDiscount.SalesDisountDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SaleInvoice.Error.ErrorFirstRow")),!1):(this.CashDiscount.SalesDisountDetails.splice(t,1),this.TotalCashDiscount(),!0)}TotalCashDiscount(){let t=0;for(let e=0;e<this.CashDiscount.SalesDisountDetails.length;e++)t+=Number(this.CashDiscount.SalesDisountDetails[e].Amount);return Number(t.toFixed(2))}ChangeAmount(t,e){}Save(){if(this.CashDiscount.DocDate==""||this.CashDiscount.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}for(let e=0;e<this.CashDiscount.SalesDisountDetails.length;e++){let i=e,o=Number(this.CashDiscount.SalesDisountDetails[e].ClientId),d=Number(this.CashDiscount.SalesDisountDetails[e].Amount),v=Number(this.CashDiscount.SalesDisountDetails[e].AmountDebts);if(o>0){if(d<=0||isNaN(d)||d==null||d==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("MoneyIn.Error.EnterAmount"));return}if(this.CashDiscount.SalesDisountDetails.filter(fe=>fe.ClientId==o).length>=2){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.ItemDuplicated")+" "+(i+1));return}}}let t={DocNo:this.CashDiscount.DocNo,DocDate:this._Apiservice.ConvertISODate(this.CashDiscount.DocDate),SalesDisountDetails:this.CashDiscount.SalesDisountDetails,Id:this.CashDiscount.Id,Name:"",Code:""};t.Id==0&&this._Apiservice.post("SalesDisountEP/Add",t,!0).pipe(S(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo(),this.DynamicComponent.Paging.DataReturn.push(e.Obj)}}),t.Id>0&&this._Apiservice.put("SalesDisountEP/Update",t,!0).pipe(S(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this._AppModeService._Toastr.success(e.Message),this.ResetPage(),this.GetPageInfo();let i=e.Obj,o=this.DynamicComponent.Paging.DataReturn.find(d=>d.Id==i.Id);o!=null&&Object.assign(o,i)}})}ResetPage(){this.CashDiscount={DocDate:"",DocNo:0,Id:0,Name:"",Code:"",SalesDisountDetails:[{Amount:"",ClientId:null,ClientName:"",Id:0,Code:"",Name:"",Clients:[],AmountDebts:0}]},this._DefaultSettingsService.ResetDate(this.CashDiscount)}ServerListener(){this.Hub_Connection?.on("AddSalesDisount",t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&(this.CashDiscount.DocNo=t.DocNo)})}trackByMethod(t,e){return e.Id}ngOnDestroy(){}};u.\u0275fac=function(e){return new(e||u)(w(ue),w(ne),w(De),w(z))},u.\u0275cmp=k({type:u,selectors:[["app-cash-discount"]],viewQuery:function(e,i){if(e&1&&(P(ve,5),P(xe,5)),e&2){let o;V(o=O())&&(i.GLComponent=o.first),V(o=O())&&(i.DynamicComponent=o.first)}},standalone:!0,features:[F([R]),j],decls:6,vars:6,consts:[["dynamiccomponent",""],["content",""],["GLComponent",""],["ddddd",""],["SelectClientssDetails",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","GlResponse","GetById","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"col-12","d-flex","flex","flex-wrap","align-items-end","px-2"],[1,"col-12","col-sm-6","col-lg-2","col-xl-1","p-1"],["type","number","appNumericInput","","name","DocNo","id","DocNo",1,"form-control","text-center",3,"disabled","value"],[1,"col-12","col-sm-6","col-lg-3","col-xl-2","p-1"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-12","col-sm-6","col-xl-3","p-1"],["class","d-block text-center",4,"ngIf"],["class","formdate",4,"ngIf"],[1,"DivPaging","table-responsive-vertical","shadow-z-1"],[1,"table","table-hover","table-striped","table-light","mt-3","mb-0"],[1,"col-1"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"SaveEvent","UpdateEvent","OpenGlEvent","CloseEvent","Id","Gl"],[1,"d-block","text-center"],[1,"formdate"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","ngModel","showTime","showIcon","showOnFocus","showOtherMonths"],[1,"Flex1",3,"title"],[1,"d-flex","justify-content-center","align-items-center","col-11","col-md-12"],[1,"col-2","col-md-5","py-3","py-md-1","text-center","mx-auto","btn","btn-success",3,"click"],[1,"col-2","col-md-5","py-3","py-md-1","text-center","mx-auto","btn","btn-danger",3,"click","disabled"],[1,"ngSelect",3,"title"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center","col-10","col-lg-12",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","dropdownPosition","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],[3,"title"],["class","text-dark d-block text-center col-11 col-md-12",4,"ngIf"],["min","0","step","1","type","number","appNumericInput","",1,"form-control","shadow-none","text-center",3,"keyup","ngModelChange","disabled","ngModel","name","id"],["type","text",1,"form-control","shadow-none","text-center",3,"ngModelChange","disabled","ngModel","name","id"],[1,"form-text","text-muted"],[1,"text-dark","d-block","text-center","col-11","col-md-12"]],template:function(e,i){if(e&1){let o=M();a(0,"app-dynamic-component",5,0),f("OpenModalEvent",function(){return p(o),m(i.OpenModal())})("ShowToEditeEvent",function(v){return p(o),m(i.ShowToEdite(v))}),l(),x(2,Ne,33,25,"ng-template",null,1,U),E(4,"app-glsheard",null,2)}if(e&2){let o=A(3);_("PageTitle",i.TablePaging.PageTitle)("TablePaging",i.TablePaging)("GlResponse",!0)("GetById",i.TablePaging.GetById)("DeleteUrl",i.TablePaging.DeleteUrl)("OutModal",o)}},dependencies:[ce,le,Q,H,$,ie,K,ee,X,te,Z,J,Y,re,ae,oe,se,_e,he,pe,me,de]});let r=u;return r})();export{nt as CashDiscountComponent};
