import{a as fe,b as Se}from"./chunk-6T4APQIW.js";import{a as xe}from"./chunk-L75Y42KL.js";import{a as Te}from"./chunk-EHX2YHES.js";import{a as ve,c as ye,j as ge}from"./chunk-HX5JBV6V.js";import{a as de,b as Ie}from"./chunk-KOJPIKRQ.js";import{a as he}from"./chunk-HOAF6CDP.js";import{a as ce,b as le,c as se,d as pe}from"./chunk-DVVEKPVL.js";import{b as me}from"./chunk-JCTIHYFX.js";import{b as J,c as K,f as X,h as Z,k as ee,m as te,o as ie,p as ne,q as oe,s as re,u as ae}from"./chunk-M24M3PNC.js";import{c as _e,d as ue}from"./chunk-4L6P5Z5M.js";import{A as Y,c as H,d as q,e as $,j as z}from"./chunk-JM67XKKX.js";import{$b as T,Bb as a,Cb as c,Db as w,Eb as B,Fb as E,Hb as A,Lb as C,Mb as l,Pb as M,Qb as P,Sb as k,Tb as O,Ub as Q,Vb as b,Wb as s,Xb as h,Yb as y,Zb as N,_b as x,ac as D,cb as r,cc as W,db as V,fc as j,mc as I,na as U,nc as v,oc as L,pc as G,ub as g,wa as F,wb as d,xa as p,ya as _}from"./chunk-VIO7ZK3G.js";var be=["GLComponent"],Ae=["content"],Ne=(o,u)=>({"btn-success":o,"btn-primary":u});function Ve(o,u){if(o&1){let i=A();a(0,"div",56)(1,"label",57),s(2),I(3,"translate"),c(),a(4,"div",58)(5,"input",59),C("keyup",function(){p(i);let e=l(2);return _(e.ResetPage())})("change",function(){p(i);let e=l(2);return _(e.ResetPage())}),D("ngModelChange",function(e){p(i);let n=l(2);return T(n.InvoiceDocNo,e)||(n.InvoiceDocNo=e),_(e)}),c()(),a(6,"button",60),C("click",function(){p(i);let e=l(2);return _(e.Search())}),s(7),I(8,"translate"),c()()}if(o&2){let i=l(2);r(2),y(" ",v(3,4,"ReturnBuyInvoice.InvoiceNo")," "),r(3),x("ngModel",i.InvoiceDocNo),r(),d("disabled",i._AppModeService.DisabledButton),r(),y(" ",v(8,6,"Model.Search")," ")}}function we(o,u){if(o&1&&(a(0,"span",61),s(1),I(2,"date"),c()),o&2){let i=l(2);r(),y(" ",L(2,1,i.Invoice.DocDate,"d-M-yyyy h:mm:ss a")," ")}}function Re(o,u){if(o&1){let i=A();a(0,"p-calendar",62),D("ngModelChange",function(e){p(i);let n=l(2);return T(n.Invoice.DocDate,e)||(n.Invoice.DocDate=e),_(e)}),c()}if(o&2){let i=l(2);d("showOtherMonths",!0)("showTime",!0)("showIcon",!0)("showOnFocus",!1),x("ngModel",i.Invoice.DocDate)}}function Be(o,u){if(o&1&&s(0),o&2){let i=u.item;y(" ",i.Name," ")}}function Ee(o,u){if(o&1){let i=A();a(0,"div",10)(1,"p",19),s(2),I(3,"translate"),c(),a(4,"ng-select",20),D("ngModelChange",function(e){p(i);let n=l(2);return T(n.Invoice.ClientId,e)||(n.Invoice.ClientId=e),_(e)}),g(5,Be,1,1,"ng-template",21),c()()}if(o&2){let i=l(2);r(2),h(v(3,5,"SaleOffer.Client")),r(2),d("items",i.ClientArr)("disabled",!0)("virtualScroll",!0),x("ngModel",i.Invoice.ClientId)}}function Me(o,u){if(o&1&&s(0),o&2){let i=u.item;y(" ",i.Name," ")}}function Pe(o,u){if(o&1){let i=A();a(0,"div",10)(1,"p",19),s(2),I(3,"translate"),c(),a(4,"ng-select",20),D("ngModelChange",function(e){p(i);let n=l(2);return T(n.Invoice.SupplierId,e)||(n.Invoice.SupplierId=e),_(e)}),g(5,Me,1,1,"ng-template",21),c()()}if(o&2){let i=l(2);r(2),h(v(3,5,"BuyOffer.Supplier")),r(2),d("items",i.SupplierArr)("disabled",!0)("virtualScroll",!0),x("ngModel",i.Invoice.SupplierId)}}function ke(o,u){if(o&1&&s(0),o&2){let i=u.item;y(" ",i.Name," ")}}function Oe(o,u){o&1&&(a(0,"option",26),s(1),I(2,"translate"),c()),o&2&&(d("value",3),r(),h(v(2,2,"SaleInvoice.Delivery")))}function Qe(o,u){if(o&1&&(a(0,"small",68),s(1),c()),o&2){let i=l(3);r(),N("Loaded ",i.TreasuryArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function Ue(o,u){if(o&1&&s(0),o&2){let i=u.item;y(" ",i.Name," ")}}function Fe(o,u){if(o&1){let i=A();a(0,"div",63)(1,"div",64)(2,"p",24),s(3),I(4,"translate"),c(),a(5,"input",65),I(6,"translate"),C("keyup",function(){p(i);let e=l(2);return _(e.ChangeCash())})("change",function(){p(i);let e=l(2);return _(e.ChangeCash())}),D("ngModelChange",function(e){p(i);let n=l(2);return T(n.Invoice.Cash,e)||(n.Invoice.Cash=e),_(e)}),c()(),a(7,"div",64)(8,"p",24),s(9),I(10,"translate"),c(),a(11,"ng-select",66,2),C("clear",function(){p(i);let e=l(2);return _(e.TreasuryArr=[])})("focus",function(){p(i);let e=b(12),n=l(2);return _(n.ChangeSearchApi("Treasury",e))})("keyup",function(){p(i);let e=b(12),n=l(2);return _(n.ChangeSearchApi("Treasury",e))})("change",function(){p(i);let e=b(12),n=l(2);return _(n.ChangeSearchApi("Treasury",e))})("scrollToEnd",function(){p(i);let e=b(12),n=l(2);return _(n.ChangeSearchApi("Treasury",e))})("close",function(){p(i);let e=l(2);return _(e._AppModeService.CurrentPage=0)})("open",function(){p(i);let e=l(2);return _(e._AppModeService.CurrentPage=0)})("change",function(){p(i);let e=l(2);return _(e.SelectValue(e.Invoice.TreasuryId,"Treasury"))}),D("ngModelChange",function(e){p(i);let n=l(2);return T(n.Invoice.TreasuryId,e)||(n.Invoice.TreasuryId=e),_(e)}),g(13,Qe,2,2,"ng-template",67)(14,Ue,1,1,"ng-template",21),c()()()}if(o&2){let i=l(2);r(3),h(v(4,11,"BuyInvoice.Cash")),r(2),M("placeholder",v(6,13,"SaleInvoice.Cash")),d("disabled",i.Invoice.PaymentType==3),x("ngModel",i.Invoice.Cash),r(4),h(v(10,15,"BuyInvoice.Treasury")),r(2),d("items",i.TreasuryArr)("autofocus",!1)("virtualScroll",!0)("searchable",!0)("disabled",i.Invoice.PaymentType==3||i.Invoice.Cash==""||i.Invoice.Cash==0),x("ngModel",i.Invoice.TreasuryId)}}function We(o,u){if(o&1&&(a(0,"small",68),s(1),c()),o&2){let i=l(3);r(),N("Loaded ",i.BankAccountArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function je(o,u){if(o&1&&s(0),o&2){let i=u.item;y(" ",i.Name," ")}}function Le(o,u){if(o&1){let i=A();a(0,"div",63)(1,"div",64)(2,"p",24),s(3),I(4,"translate"),c(),a(5,"input",69),I(6,"translate"),C("keyup",function(){p(i);let e=l(2);return _(e.ChangeCash())})("change",function(){p(i);let e=l(2);return _(e.ChangeCash())}),D("ngModelChange",function(e){p(i);let n=l(2);return T(n.Invoice.Visa,e)||(n.Invoice.Visa=e),_(e)}),c()(),a(7,"div",64)(8,"p",24),s(9),I(10,"translate"),c(),a(11,"ng-select",70,3),C("clear",function(){p(i);let e=l(2);return _(e.BankAccountArr=[])})("focus",function(){p(i);let e=b(12),n=l(2);return _(n.ChangeSearchApi("BankAccounts",e))})("keyup",function(){p(i);let e=b(12),n=l(2);return _(n.ChangeSearchApi("BankAccounts",e))})("change",function(){p(i);let e=b(12),n=l(2);return _(n.ChangeSearchApi("BankAccounts",e))})("scrollToEnd",function(){p(i);let e=b(12),n=l(2);return _(n.ChangeSearchApi("BankAccounts",e))})("close",function(){p(i);let e=l(2);return _(e._AppModeService.CurrentPage=0)})("open",function(){p(i);let e=l(2);return _(e._AppModeService.CurrentPage=0)})("change",function(){p(i);let e=l(2);return _(e.SelectValue(e.Invoice.BankAccountId,"BankAccount"))}),D("ngModelChange",function(e){p(i);let n=l(2);return T(n.Invoice.BankAccountId,e)||(n.Invoice.BankAccountId=e),_(e)}),g(13,We,2,2,"ng-template",67)(14,je,1,1,"ng-template",21),c()()()}if(o&2){let i=l(2);r(3),h(v(4,10,"BuyInvoice.Visa")),r(2),M("placeholder",v(6,12,"SaleInvoice.Visa")),d("disabled",i.Invoice.PaymentType==3),x("ngModel",i.Invoice.Visa),r(4),h(v(10,14,"BuyInvoice.Bank")),r(2),d("items",i.BankAccountArr)("virtualScroll",!0)("searchable",!0)("disabled",i.Invoice.PaymentType==3||i.Invoice.Visa==""||i.Invoice.Visa==0),x("ngModel",i.Invoice.BankAccountId)}}function Ge(o,u){if(o&1&&(a(0,"small",68),s(1),c()),o&2){let i=l(3);r(),N("Loaded ",i.EmployeeArr.length," of ",i._SharedObjectModelService.TotalItems,"")}}function He(o,u){if(o&1&&s(0),o&2){let i=u.item;y(" ",i.Name," ")}}function qe(o,u){if(o&1){let i=A();a(0,"div",71)(1,"p",19),s(2),I(3,"translate"),c(),a(4,"ng-select",72,4),C("clear",function(){p(i);let e=l(2);return _(e.EmployeeArr=[])})("focus",function(){p(i);let e=b(5),n=l(2);return _(n.ChangeSearchApi("Employee",e))})("keyup",function(){p(i);let e=b(5),n=l(2);return _(n.ChangeSearchApi("Employee",e))})("change",function(){p(i);let e=b(5),n=l(2);return _(n.ChangeSearchApi("Employee",e))})("scrollToEnd",function(){p(i);let e=b(5),n=l(2);return _(n.ChangeSearchApi("Employee",e))})("close",function(){p(i);let e=l(2);return _(e._AppModeService.CurrentPage=0)})("open",function(){p(i);let e=l(2);return _(e._AppModeService.CurrentPage=0)})("change",function(){p(i);let e=l(2);return _(e.SelectValue(e.Invoice.EmployeeId,"Employee"))}),D("ngModelChange",function(e){p(i);let n=l(2);return T(n.Invoice.EmployeeId,e)||(n.Invoice.EmployeeId=e),_(e)}),g(6,Ge,2,2,"ng-template",67)(7,He,1,1,"ng-template",21),c()()}if(o&2){let i=l(2);r(2),h(v(3,6,"BuyReport.Employee")),r(2),d("items",i.EmployeeArr)("autofocus",!1)("virtualScroll",!0)("searchable",!0),x("ngModel",i.Invoice.EmployeeId)}}function $e(o,u){o&1&&(a(0,"p",24),s(1),I(2,"translate"),c()),o&2&&(r(),y("",v(2,1,"BuyInvoice.Debt")," : "))}function ze(o,u){if(o&1){let i=A();a(0,"input",73),D("ngModelChange",function(e){p(i);let n=l(2);return T(n.Invoice.Debt,e)||(n.Invoice.Debt=e),_(e)}),c()}if(o&2){let i=l(2);d("disabled",!0),x("ngModel",i.Invoice.Debt)}}function Ye(o,u){o&1&&(a(0,"span",74),s(1),I(2,"translate"),c()),o&2&&(r(),y("",v(2,1,"SaleInvoice.Cash")," "))}function Je(o,u){o&1&&(a(0,"span",74),s(1),I(2,"translate"),c()),o&2&&(r(),y("",v(2,1,"SaleInvoice.Debt")," "))}function Ke(o,u){if(o&1&&(a(0,"span",75),s(1),I(2,"translate"),c()),o&2){let i=l(2);r(),N("",v(2,2,"SaleInvoice.Cash")," : ",i.InvoiceCash,"")}}function Xe(o,u){if(o&1&&(a(0,"span",75),s(1),I(2,"translate"),c()),o&2){let i=l(2);r(),N("",v(2,2,"SaleInvoice.Visa")," : ",i.InvoiceVisa,"")}}function Ze(o,u){if(o&1&&(a(0,"span",75),s(1),I(2,"translate"),c()),o&2){let i=l(2);r(),N("",v(2,2,"SaleInvoice.Debt")," : ",i.InvoiceDept,"")}}function et(o,u){if(o&1&&(a(0,"p",84),s(1),c()),o&2){let i=l(2).$implicit;r(),y(" ",i.ProductName," ")}}function tt(o,u){if(o&1&&(B(0),g(1,et,2,1,"p",83),E()),o&2){let i=u.$implicit,t=l().$implicit;r(),d("ngIf",t.ProductId==i.Id)}}function it(o,u){if(o&1&&(a(0,"p",84),s(1),c()),o&2){let i=l(2).$implicit;r(),y(" ",i.ProductUnitName," ")}}function nt(o,u){if(o&1&&(B(0),g(1,it,2,1,"p",83),E()),o&2){let i=u.$implicit,t=l().$implicit;r(),d("ngIf",t.ProductUnitId==i.Id)}}function ot(o,u){if(o&1){let i=A();a(0,"tr")(1,"td",76)(2,"div",77)(3,"span",78),s(4),c()()(),a(5,"td",79),g(6,tt,2,1,"ng-container",80),c(),a(7,"td",79),g(8,nt,2,1,"ng-container",80),c(),a(9,"td")(10,"span",81),s(11),c()(),a(12,"td")(13,"input",82),C("change",function(){let e=p(i).index,n=l(2);return _(n.LowQuantity(e))})("keyup",function(){let e=p(i).index,n=l(2);return _(n.LowQuantity(e))}),D("ngModelChange",function(e){let n=p(i).$implicit;return T(n.Quantity,e)||(n.Quantity=e),_(e)}),c()(),a(14,"td")(15,"span",81),s(16),c()(),a(17,"td")(18,"span",81),s(19),c()(),a(20,"td")(21,"span",81),s(22),c()(),a(23,"td")(24,"span",81),s(25),c()()()}if(o&2){let i=u.$implicit,t=u.index,e=l(2);r(4),h(t+1),r(2),d("ngForOf",i.Items),r(2),d("ngForOf",i.ProductUnits),r(3),y(" ",i.ReturnedQty,""),r(2),P("id","ReturnQuantity",t,""),P("name","ReturnQuantity",t,""),x("ngModel",i.Quantity),r(3),y(" ",i.SaveQuantity,""),r(3),y(" ",i.Price,""),r(3),y(" ",e.ConvertToNumer(i.Discount).toFixed(2),""),r(3),y(" ",(e.TotalRow(t)-e.ConvertToNumer(i.Discount)).toFixed(2),"")}}function rt(o,u){if(o&1&&(a(0,"div",45)(1,"span",85),s(2),I(3,"translate"),c(),a(4,"span",47),s(5),c()()),o&2){let i=l(2);r(2),h(v(3,2,"SaleInvoice.TotalDiscount")),r(3),h(i.Invoice.TotalDisc.toFixed(2))}}function at(o,u){o&1&&(a(0,"span"),s(1),I(2,"translate"),c()),o&2&&(r(),y(" ",v(2,1,"Model.Save"),""))}function ct(o,u){o&1&&(a(0,"span"),s(1),I(2,"translate"),c()),o&2&&(r(),y(" ",v(2,1,"Model.Update"),""))}function lt(o,u){if(o&1){let i=A();a(0,"button",86),C("click",function(){p(i);let e=l(2);return _(e.OpenGl())}),s(1),I(2,"translate"),c()}o&2&&(r(),y(" ",v(2,1,"Model.Gl")," "))}function st(o,u){if(o&1){let i=A();w(0,"app-modal-header",6),a(1,"div",7)(2,"div",8),g(3,Ve,9,8,"div",9),a(4,"div",10)(5,"label",11),s(6),I(7,"translate"),c(),w(8,"input",12),c(),a(9,"div",10)(10,"label",13),s(11),I(12,"translate"),c(),a(13,"input",14),D("ngModelChange",function(e){p(i);let n=l();return T(n.Invoice.Notes,e)||(n.Invoice.Notes=e),_(e)}),c()(),a(14,"div",15),g(15,we,3,4,"span",16)(16,Re,1,5,"p-calendar",17),c(),g(17,Ee,6,7,"div",18)(18,Pe,6,7,"div",18),a(19,"div",10)(20,"p",19),s(21),I(22,"translate"),c(),a(23,"ng-select",20),D("ngModelChange",function(e){p(i);let n=l();return T(n.Invoice.StoreId,e)||(n.Invoice.StoreId=e),_(e)}),g(24,ke,1,1,"ng-template",21),c()(),a(25,"div",22)(26,"div",23)(27,"p",24),s(28),I(29,"translate"),c(),a(30,"select",25),C("change",function(){p(i);let e=l();return _(e.ChangePamentType(e.Invoice.PaymentType))}),D("ngModelChange",function(e){p(i);let n=l();return T(n.Invoice.PaymentType,e)||(n.Invoice.PaymentType=e),_(e)}),a(31,"option",26),s(32),I(33,"translate"),c(),a(34,"option",26),s(35),I(36,"translate"),c(),g(37,Oe,3,4,"option",27),c()(),g(38,Fe,15,17,"div",28)(39,Le,15,16,"div",28)(40,qe,8,8,"div",29),a(41,"div",30),g(42,$e,3,3,"p",31)(43,ze,1,2,"input",32),c()(),a(44,"div",33)(45,"p",34),s(46),I(47,"translate"),c(),g(48,Ye,3,3,"span",35)(49,Je,3,3,"span",35),c(),a(50,"div",36),g(51,Ke,3,4,"span",37)(52,Xe,3,4,"span",37)(53,Ze,3,4,"span",37),c()(),a(54,"div",38)(55,"div",39)(56,"table",40)(57,"thead")(58,"tr")(59,"th"),s(60,"#"),c(),a(61,"th",41),s(62),I(63,"translate"),c(),a(64,"th",42),s(65),I(66,"translate"),c(),a(67,"th",42),s(68),I(69,"translate"),c(),a(70,"th",42),s(71),I(72,"translate"),c(),a(73,"th",42),s(74),I(75,"translate"),c(),a(76,"th",42),s(77),I(78,"translate"),c(),a(79,"th",42),s(80),I(81,"translate"),c(),a(82,"th",42),s(83),I(84,"translate"),c()()(),a(85,"tbody"),g(86,ot,26,13,"tr",43),c()()()()(),a(87,"div",44)(88,"div",45)(89,"span",46),s(90,"Product Count"),c(),a(91,"span",47),s(92),c()(),a(93,"div",45)(94,"span",46),s(95),I(96,"translate"),c(),a(97,"span",47),s(98),c()(),g(99,rt,6,4,"div",48),a(100,"div",45)(101,"span",49),s(102),I(103,"translate"),a(104,"span"),s(105),c()(),a(106,"span",47),s(107),c()(),a(108,"div",45)(109,"span",50),s(110),I(111,"translate"),c(),a(112,"span",47),s(113),c()()(),a(114,"div",51)(115,"button",52),C("click",function(){p(i);let e=l();return _(e.Save())}),g(116,at,3,3,"span",53)(117,ct,3,3,"span",53),c(),g(118,lt,3,3,"button",54),a(119,"button",55),C("click",function(){let e=p(i).$implicit,n=l();return e.close("Close click"),_(n.ResetPage())}),s(120),I(121,"translate"),c()()}if(o&2){let i=l();d("PageTitle",i.PageTitle),r(3),d("ngIf",i.Invoice.Id==0),r(3),h(v(7,58,"Table.DocNo")),r(2),d("value",i.Invoice.DocNo)("disabled",!0),r(3),h(v(12,60,"Table.Notes")),r(2),x("ngModel",i.Invoice.Notes),r(2),d("ngIf",i._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!1),r(),d("ngIf",i._DefaultSettingsService.DefaultSettings.DateTimeReadOnly==!0),r(),d("ngIf",i.ScreenName=="ReturnSaleInvoice"),r(),d("ngIf",i.ScreenName=="ReturnBuyInvoice"),r(3),h(v(22,62,"BuyInvoice.Storage")),r(2),d("items",i.StoreArr)("disabled",!0)("virtualScroll",!0),x("ngModel",i.Invoice.StoreId),r(5),h(v(29,64,"BuyInvoice.PamentType")),r(2),x("ngModel",i.Invoice.PaymentType),r(),d("value",1),r(),h(v(33,66,"SaleInvoice.Cash")),r(2),d("value",2),r(),h(v(36,68,"SaleInvoice.Debt")),r(2),d("ngIf",i.ScreenName=="ReturnSaleInvoice"),r(),d("ngIf",i.Invoice.PaymentType!=3),r(),d("ngIf",i.Invoice.PaymentType!=3),r(),d("ngIf",i.Invoice.PaymentType==3),r(2),d("ngIf",i.Invoice.PaymentType==2),r(),d("ngIf",i.Invoice.PaymentType==2),r(3),y(" ",v(47,70,"ReturnSaleInvoice.Status")," : "),r(2),d("ngIf",i.InvoiceType==1),r(),d("ngIf",i.InvoiceType==2),r(2),d("ngIf",i.InvoiceCash>=0),r(),d("ngIf",i.InvoiceVisa>=0),r(),d("ngIf",i.InvoiceDept>=0),r(9),h(v(63,72,"SaleInvoice.Name")),r(3),h(v(66,74,"SaleInvoice.Unit")),r(3),h(v(69,76,"ReturnBuyInvoice.LastReturnQuantity")),r(3),h(v(72,78,"ReturnBuyInvoice.ReturnQuantity")),r(3),h(v(75,80,"ReturnBuyInvoice.Quantity")),r(3),h(v(78,82,"SaleInvoice.Price")),r(3),h(v(81,84,"SaleInvoice.Discount")),r(3),h(v(84,86,"SaleInvoice.NetTotal")),r(3),d("ngForOf",i.Invoice.InvoiceDetails)("ngForTrackBy",i.trackByMethod),r(6),h(i.Invoice.InvoiceDetails.length),r(3),h(v(96,88,"SaleInvoice.TotalInvoice")),r(3),h(i.Invoice.TotalInvoice.toFixed(2)),r(),d("ngIf",(i._DefaultSettingsService.DefaultSettings==null?null:i._DefaultSettingsService.DefaultSettings.HideColumnDiscount)==!1),r(3),y("",v(103,90,"SaleInvoice.TotalVat")," "),r(3),y("",i._DefaultSettingsService.DefaultSettings.Vat,"%"),r(2),h(i.Invoice.TotalInvoiceVatAmount.toFixed(2)),r(3),h(v(111,92,"SaleInvoice.TotalAfterVat")),r(3),h(i.Invoice.TotalInvoiceAfterVat.toFixed(2)),r(2),d("ngClass",j(96,Ne,i.Invoice.Id==0,i.Invoice.Id!=0)),r(),d("ngIf",i.Invoice.Id==0),r(),d("ngIf",i.Invoice.Id!=0),r(),d("ngIf",i.Invoice.Id>0&&(i.ScreenName=="SaleInvoice"||"BuyInvoice")),r(2),h(v(121,94,"Model.Close"))}}var Rt=(()=>{let u=class u{constructor(t,e,n,m,f){this._ActivatedRoute=t,this._SharedObjectModelService=e,this._DefaultSettingsService=n,this._AppModeService=m,this._Apiservice=f,this.SubscriptionArr=[],this.SignalR=!1,this.TablePaging={},this.PageTitle="",this.ScreenName="",this.InvoiceName="",this.PrintUrl="",this.AddUrl="",this.UpdateUrl="",this.DeleteUrl="",this.GetById="",this.Invoice={InvoiceCollected:!1,ClientType:2,DocNo:0,DocDate:"",InvoiceDetails:[],TotalInvoice:0,TotalDiscRate:0,TotalDisc:0,TotalInvoiceAfterDisc:0,TotalInvoiceAfterVat:0,TotalInvoiceVatAmount:0,TotalVatRate:0,Cash:"",Visa:"",Debt:"",TreasuryId:null,TreasuryName:"",BankAccountId:null,BankAccountName:"",EmployeeId:null,EmployeeName:"",StoreId:null,StoreName:"",ClientId:null,ClientName:"",SupplierId:null,SupplierName:"",Id:0,PaymentType:1,Name:"",Notes:"",Code:""},this.SupplierArr=[],this.ClientArr=[],this.StoreArr=[],this.TreasuryArr=[],this.BankAccountArr=[],this.EmployeeArr=[],this.ItemBalanceList=[],this.InvoiceDocNo="",this.InvoiceType=0,this.InvoiceCash=0,this.InvoiceVisa=0,this.InvoiceDept=0}ngOnChanges(t){let e=Number(this._ActivatedRoute.snapshot.queryParams.Id);e>0&&this.GetByIdRoute(e)}ngOnInit(){this.SignalR&&(this.StartConnection(),this.Hub_Connection?.state=="Connecting"&&this.ServerListener())}GetByIdRoute(t){let e=this._Apiservice.getById(this.GetById,t,!0).subscribe({next:n=>{n.IsSuccess==!0&&n.Obj!=null?(this._SharedObjectModelService.PageModel=n.Obj.model,this._SharedObjectModelService.Gl=n.Obj.Gl,this.Drow(this._SharedObjectModelService.PageModel),this._AppModeService._NgbModal.open(this.ContentModel,{fullscreen:!0,backdrop:"static"})):this._AppModeService._Toastr.error(n.Message)}});this.SubscriptionArr.push(e)}GetPageInfo(){this._AppModeService.DisabledButton=!0;let t=this._Apiservice.get(`${this.ScreenName}EP/GetPageInfo`,!1).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.Invoice.DocNo=e.Obj,this._AppModeService.DisabledButton=!1):this._AppModeService._Toastr.error(e.Message)},error:e=>{this._AppModeService.DisabledButton=!1}});this.SubscriptionArr.push(t)}StartConnection(){this.Hub_Connection=new Se().withUrl(`${J.signalrUrl}/${this.ScreenName}`,{skipNegotiation:!0,transport:fe.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(t=>{console.log("Error Hub Connection",t)})}ServerListener(){this.Hub_Connection?.on(`Add${this.ScreenName}`,t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&e.Id!=t.UserId&&this.GetPageInfo()}),this.Hub_Connection?.on(`Update${this.ScreenName}`,t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Invoice.Id&&(alert(this._AppModeService._Translate.instant("Show.UpdateModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.UpdateModelAnother"),t.User),this._AppModeService._NgbModal.dismissAll())}),this.Hub_Connection?.on(`Delete${this.ScreenName}`,t=>{let e=this._Apiservice.UserIdFromCookies();Number(e.BranchId)==t.BranchId&&t.UserId!=e.Id&&t.Id==this.Invoice.Id&&(alert(this._AppModeService._Translate.instant("Show.DeleteModelAnother")),this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("Show.DeleteModelAnother"),t.User),this._SharedObjectModelService.Paging.DataReturn=this._SharedObjectModelService.Paging.DataReturn.filter(n=>n.Id!=t.Id),this._AppModeService._NgbModal.dismissAll())})}OpenModal(){this.InvoiceDocNo="",this.ResetPage()}OpenGl(){this.GLComponent.Open()}ChangeSearchApi(t,e){let n=`${e.searchTerm}`.trim();(n==""||n=="null")&&(e.searchTerm="",n=""),this._AppModeService.CurrentPage+=1;let m={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:n,SearchField:"Name"};t=="Storages"&&(m.BranchFilter=!0),t=="Treasury"&&(m.BranchFilter=!0);let f=this._Apiservice.post("Global/GetAll",m,!1).subscribe({next:S=>{S.IsSuccess==!0&&S.Obj!=null?this.HandleResponse(S.Obj,t):this._AppModeService._Toastr.error(S.Message)}});this.SubscriptionArr.push(f)}HandleResponse(t,e){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,e=="Suppliers"&&(this.SupplierArr=this._SharedObjectModelService.RemoveDuplicates(this.SupplierArr.concat(t.DataReturn),"Id")),e=="Clients"&&(this.ClientArr=this._SharedObjectModelService.RemoveDuplicates(this.ClientArr.concat(t.DataReturn),"Id")),e=="Storages"&&(this.StoreArr=this._SharedObjectModelService.RemoveDuplicates(this.StoreArr.concat(t.DataReturn),"Id")),e=="Treasury"&&(this.TreasuryArr=this._SharedObjectModelService.RemoveDuplicates(this.TreasuryArr.concat(t.DataReturn),"Id")),e=="BankAccounts"&&(this.BankAccountArr=this._SharedObjectModelService.RemoveDuplicates(this.BankAccountArr.concat(t.DataReturn),"Id")),e=="Employee"&&(this.EmployeeArr=this._SharedObjectModelService.RemoveDuplicates(this.EmployeeArr.concat(t.DataReturn),"Id"))}SelectValue(t,e){if(t!=null&&(t>0||t!="")){let n=[];e=="Supplier"&&(n=this.SupplierArr),e=="Client"&&(n=this.ClientArr),e=="Store"&&(n=this.StoreArr),e=="Treasury"&&(n=this.TreasuryArr),e=="BankAccount"&&(n=this.BankAccountArr),e=="Employee"&&(n=this.EmployeeArr);let m=n.find(f=>f.Id==t);if(m==null){this._AppModeService.DontPlay();return}else this.Invoice[`${e}Id`]=t,this.Invoice[`${e}Name`]=m.Name}else this.Invoice[`${e}Id`]=null,this.Invoice[`${e}Name`]=""}ChangePamentType(t){this.Invoice.BankAccountId=null,this.Invoice.BankAccountName="",this.Invoice.TreasuryId=null,this.Invoice.TreasuryName="",this.Invoice.EmployeeId=null,this.Invoice.EmployeeName="",t==1&&(this.Invoice.PaymentType=1,this.Invoice.Visa="",this.Invoice.Debt="",this.Invoice.Cash=this.Invoice.TotalInvoiceAfterVat),t==2&&(this.Invoice.PaymentType=2,this.Invoice.Cash="",this.Invoice.Visa="",this.Invoice.Debt=this.Invoice.TotalInvoiceAfterVat),t==3&&(this.Invoice.Visa="",this.Invoice.Cash="",this.Invoice.Debt="",this.Invoice.TreasuryId=null,this.Invoice.TreasuryName="",this.Invoice.BankAccountId=null,this.Invoice.BankAccountName=""),this.ChangeCash()}ChangeCash(){this.Invoice.PaymentType==1&&(this.Invoice.Cash=Number((this.Invoice.TotalInvoiceAfterVat-Number(this.Invoice.Visa)).toFixed(2)),this.Invoice.Visa=Number((this.Invoice.TotalInvoiceAfterVat-Number(this.Invoice.Cash)).toFixed(2))),this.Invoice.PaymentType==2&&(this.Invoice.Debt=Number((this.Invoice.TotalInvoiceAfterVat-(Number(this.Invoice.Cash)+Number(this.Invoice.Visa))).toFixed(2))),this.Invoice.TreasuryId=Number(this.Invoice.Cash)==0?null:this.Invoice.TreasuryId,this.Invoice.BankAccountId=Number(this.Invoice.Visa)==0?null:this.Invoice.BankAccountId,this.Invoice.TreasuryName=Number(this.Invoice.Cash)==0?"":this.Invoice.TreasuryName,this.Invoice.BankAccountName=Number(this.Invoice.Visa)==0?"":this.Invoice.BankAccountName,this.Invoice.Cash=Number(this.Invoice.Cash)==0?"":this.Invoice.Cash,this.Invoice.Visa=Number(this.Invoice.Visa)==0?"":this.Invoice.Visa,this.Invoice.Debt=Number(this.Invoice.Debt)==0?"":this.Invoice.Debt,this.DefaultBankTreasury()}HandleMyDefaultSettings(){let t=this._DefaultSettingsService.DefaultSettings;this.ScreenName=="ReturnSaleInvoice"&&(this.Invoice.PaymentType=t.SaleInvoicePaymentType>0?t.SaleInvoicePaymentType:1),this.ScreenName=="ReturnBuyInvoice"&&(this.Invoice.PaymentType=t.BuyInvoicePaymentType>0?t.BuyInvoicePaymentType:1)}DefaultBankTreasury(){let t=this._DefaultSettingsService.DefaultSettings;this.ScreenName=="ReturnSaleInvoice"&&(this.Invoice.Cash>0&&t.ReturnSaleInvoiceTreasuryId>0&&this.Invoice.Id==0&&(this.TreasuryArr=[],this.Invoice.TreasuryId=t.ReturnSaleInvoiceTreasuryId,this.TreasuryArr.push({Id:t.ReturnSaleInvoiceTreasuryId,Name:t.ReturnSaleInvoiceTreasuryName})),this.Invoice.Visa>0&&t.ReturnSaleInvoiceBankAccountId>0&&this.Invoice.Id==0&&(this.BankAccountArr=[],this.Invoice.BankAccountId=t.ReturnSaleInvoiceBankAccountId,this.BankAccountArr.push({Id:t.ReturnSaleInvoiceBankAccountId,Name:t.ReturnSaleInvoiceBankAccountName}))),this.ScreenName=="ReturnBuyInvoice"&&(this.Invoice.Cash>0&&t.ReturnBuyInvoiceTreasuryId>0&&this.Invoice.Id==0&&(this.TreasuryArr=[],this.Invoice.TreasuryId=t.ReturnBuyInvoiceTreasuryId,this.TreasuryArr.push({Id:t.ReturnBuyInvoiceTreasuryId,Name:t.ReturnBuyInvoiceTreasuryName})),this.Invoice.Visa>0&&t.ReturnBuyInvoiceBankAccountId>0&&this.Invoice.Id==0&&(this.BankAccountArr=[],this.Invoice.BankAccountId=t.ReturnBuyInvoiceBankAccountId,this.BankAccountArr.push({Id:t.ReturnBuyInvoiceBankAccountId,Name:t.ReturnBuyInvoiceBankAccountName})))}ConvertToNumer(t){return Number(t)}TotalRow(t){let e=Number(this.Invoice.InvoiceDetails[t].Price),n=Number(this.Invoice.InvoiceDetails[t].Quantity);return Number(e*n)}LowQuantity(t){this.TotalInvoiceDiscount();let e=Number(this.Invoice.InvoiceDetails[t].Quantity),n=this.Invoice.InvoiceDetails[t].ReturnedQty,m=Number(this.Invoice.InvoiceDetails[t].Price),f=Number(this.Invoice.InvoiceDetails[t].TotalPrice),S=Number(this.Invoice.InvoiceDetails[t].SaveDiscount);if(e<0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorQuantity")),this.Invoice.InvoiceDetails[t].Quantity="",this.Invoice.InvoiceDetails[t].Discount=this.Invoice.InvoiceDetails[t].SaveDiscount,this.Invoice.InvoiceDetails[t].TotalPriceAfterVat=0,this.Confirm();return}if(e==0){this.Invoice.InvoiceDetails[t].SaveQuantity=f/m-n,this.Invoice.InvoiceDetails[t].Discount=this.Invoice.InvoiceDetails[t].SaveDiscount,this.Invoice.InvoiceDetails[t].TotalPriceAfterVat=0,this.Confirm();return}if(this.Invoice.InvoiceDetails[t].SaveQuantity=f/m-n-e,e>0){let R=f/m,De=Number(e/R*100),Ce=S*De/100;this.Invoice.InvoiceDetails[t].Discount=Ce,this.Confirm()}if(e>f/m-n){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ReturnedQtyUpQuantity")),this.Invoice.InvoiceDetails[t].SaveQuantity=f/m-n,this.Invoice.InvoiceDetails[t].Discount=this.Invoice.InvoiceDetails[t].SaveDiscount,this.Invoice.InvoiceDetails[t].Quantity="",this.Invoice.InvoiceDetails[t].TotalPriceAfterVat=0,this.Confirm();return}}Confirm(){let t=this.Invoice.InvoiceDetails.filter(e=>Number(e.Quantity)>0);for(let e=0;e<t.length;e++){let n=Number(t[e].Quantity),m=t[e].ReturnedQty,f=Number(t[e].Price),S=Number(t[e].TotalPrice);if(n>S/f-m)return this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ReturnedQtyUpQuantity")),!1}return this.Invoice.TotalInvoice=this.TotalInvoice(),this.Invoice.TotalDisc=this.TotalInvoiceDiscount(),this.Invoice.TotalDiscRate=this.Invoice.TotalDisc/100*this.Invoice.TotalInvoice,this.Invoice.TotalInvoiceAfterDisc=this.Invoice.TotalInvoice-this.Invoice.TotalDisc,this.Invoice.TotalInvoiceVatAmount=this.TotalInvoiceVatAmount(),this.Invoice.TotalInvoiceAfterVat=this.TotalInvoiceAfterVat(),this.Invoice.TotalVatRate=this.Invoice.TotalInvoiceVatAmount/100*this.Invoice.TotalInvoiceAfterDisc,this.Invoice.TotalDiscRate=Number(this.Invoice.TotalDiscRate.toFixed(3)),this.Invoice.TotalInvoiceAfterDisc=Number(this.Invoice.TotalInvoiceAfterDisc.toFixed(3)),this.Invoice.TotalInvoiceVatAmount=Number(this.Invoice.TotalInvoiceVatAmount.toFixed(3)),this.Invoice.TotalVatRate=Number(this.Invoice.TotalVatRate.toFixed(3)),this.Invoice.TotalInvoice=Number(this.Invoice.TotalInvoice.toFixed(3)),this.Invoice.TotalDisc=Number(this.Invoice.TotalDisc.toFixed(3)),this.Invoice.TotalInvoiceAfterVat=Number(this.Invoice.TotalInvoiceAfterVat.toFixed(2)),this.ChangeCash(),!0}TotalInvoice(){let t=0;for(let e=0;e<this.Invoice.InvoiceDetails.length;e++)t+=Number(this.Invoice.InvoiceDetails[e].Price)*Number(this.Invoice.InvoiceDetails[e].Quantity);return Number(t)}TotalInvoiceDiscount(){let t=0;for(let e=0;e<this.Invoice.InvoiceDetails.length;e++)Number(this.Invoice.InvoiceDetails[e].Quantity)>0&&(t+=Number(this.Invoice.InvoiceDetails[e].Discount));return Number(t)}TotalInvoiceVatAmount(){let t=0;for(let e=0;e<this.Invoice.InvoiceDetails.length;e++){let n=Number(this.Invoice.InvoiceDetails[e].Price),m=Number(this.Invoice.InvoiceDetails[e].Quantity);if(m>0){let f=n*m,S=Number(this.Invoice.InvoiceDetails[e].Vat),R=Number(this.Invoice.InvoiceDetails[e].Discount);t+=(f-R)*S/100}}return Number(t)}TotalInvoiceAfterVat(){let t=0;for(let e=0;e<this.Invoice.InvoiceDetails.length;e++)Number(this.Invoice.InvoiceDetails[e].Quantity)>0&&(t+=this.Invoice.InvoiceDetails[e].TotalPriceAfterVat=this.TotalRowAfterVat(e));return Number(t)}TotalRowAfterVat(t){let e=Number(this.Invoice.InvoiceDetails[t].Quantity);if(e>0){let n=Number(this.Invoice.InvoiceDetails[t].Price),m=this.Invoice.InvoiceDetails[t].Vat,f=Number(this.Invoice.InvoiceDetails[t].Discount),S=(n*e-f)*(m/100)+n*e-f;return this.Invoice.InvoiceDetails[t].TotalPriceAfterVat=Number(S),Number(S)}else return 0}ShowToEdite(){this.InvoiceDocNo="",this.Drow(this._SharedObjectModelService.PageModel)}Drow(t){this.Invoice={ClientType:t.ClientType,DocNo:t.DocNo,DocDate:new Date(t.DocDate),Id:t.Id,PaymentType:t.PaymentType,Name:t.Name,Notes:t.Notes,Code:t.Code,TotalInvoice:t.TotalInvoice,TotalDiscRate:t.TotalDiscRate,TotalDisc:t.TotalDisc,TotalInvoiceAfterDisc:t.TotalInvoiceAfterDisc,TotalInvoiceAfterVat:t.TotalInvoiceAfterVat,TotalInvoiceVatAmount:t.TotalInvoiceVatAmount,TotalVatRate:t.TotalVatRate,Cash:t.Cash,Visa:t.Visa,Debt:t.Debt,TreasuryId:t.TreasuryId,TreasuryName:t.TreasuryName,BankAccountId:t.BankAccountId,BankAccountName:t.BankAccountName,EmployeeId:t.EmployeeId,EmployeeName:t.EmployeeName,StoreId:t.StoreId,StoreName:t.StoreName,ClientId:t.ClientId,ClientName:t.ClientName,SupplierId:t.SupplierId,SupplierName:t.SupplierName,InvoiceDetails:t[`${this.ScreenName}Details`]},t.SupplierId>0&&(this.SupplierArr=[{Id:t.SupplierId,Name:t.SupplierName}]),t.ClientId>0&&(this.ClientArr=[{Id:t.ClientId,Name:t.ClientName}]),t.TreasuryId>0&&(this.TreasuryArr=[{Id:t.TreasuryId,Name:t.TreasuryName}]),t.BankAccountId>0&&(this.BankAccountArr=[{Id:t.BankAccountId,Name:t.BankAccountName}]),t.EmployeeId>0&&(this.EmployeeArr=[{Id:t.EmployeeId,Name:t.EmployeeName}]),t.StoreId>0&&(this.StoreArr=[{Id:t.StoreId,Name:t.StoreName}]);for(let e=0;e<this.Invoice.InvoiceDetails.length;e++){let n=this.Invoice.InvoiceDetails[e];this.Invoice.InvoiceDetails[e].Items=[{Id:n.ProductId,Name:n.ProductName,NameAndCode:n.ProductName}],this.Invoice.InvoiceDetails[e].ProductUnits=[{Id:n.ProductUnitId,Name:n.ProductUnitName}]}this._AppModeService.DisabledButton=!1}Search(){if(Number(this.InvoiceDocNo)==0||this.InvoiceDocNo==null||isNaN(Number(this.InvoiceDocNo))){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.EnterInvoiceNumber"));return}this._AppModeService.DisabledButton=!0;let t=this._Apiservice.getById(`${this.InvoiceName}EP/GetByDocNo`,Number(this.InvoiceDocNo),!0).subscribe({next:e=>{if(e.IsSuccess==!0&&e.Obj!=null){this._AppModeService.DisabledButton=!1;let n=e.Obj;this.ResetPage(),this.GetPageInfo(),this.InvoiceCash=n.Cash,this.InvoiceVisa=n.Visa,this.InvoiceDept=n.Debt,this.InvoiceType=n.PaymentType,this.Invoice[`${this.InvoiceName}DocNo`]=n.DocNo,this.Invoice[`${this.InvoiceName}Id`]=n.Id,this.InvoiceName=="BuyInvoice"&&(this.Invoice.SupplierId=n.SupplierId,this.Invoice.SupplierName=n.SupplierName,this.SupplierArr=[{Id:n.SupplierId,Name:n.SupplierName}]),this.InvoiceName=="SaleInvoice"&&(this.Invoice.ClientId=n.ClientId,this.Invoice.ClientName=n.ClientName,this.ClientArr=[{Id:n.ClientId,Name:n.ClientName}]),this.Invoice.StoreId=n.StoreId,this.Invoice.StoreName=n.StoreName,this.StoreArr=[{Id:n.StoreId,Name:n.StoreName}],this.Invoice.PaymentType=1,this.Invoice.InvoiceDetails=n[`${this.InvoiceName}Details`];for(let m=0;m<this.Invoice.InvoiceDetails.length;m++)this.Invoice.InvoiceDetails[m].Id=0,this.Invoice.InvoiceDetails[m].SaveDiscount=Number(this.Invoice.InvoiceDetails[m].Discount),this.Invoice.InvoiceDetails[m].SaveQuantity=Number(this.Invoice.InvoiceDetails[m].Quantity)-Number(this.Invoice.InvoiceDetails[m].ReturnedQty),this.Invoice.InvoiceDetails[m].Quantity="",this.Invoice.InvoiceDetails[m].Items=[{Id:this.Invoice.InvoiceDetails[m].ProductId,Name:this.Invoice.InvoiceDetails[m].ProductName}],this.Invoice.InvoiceDetails[m].ProductUnits=[{Id:this.Invoice.InvoiceDetails[m].ProductUnitId,Name:this.Invoice.InvoiceDetails[m].ProductUnitName}];console.log(this.Invoice)}else this._AppModeService.DisabledButton=!1,this.ResetPage(),this._AppModeService._Toastr.error(e.Message)},error:e=>{this._AppModeService.DisabledButton=!1}});this.SubscriptionArr.push(t)}Save(){if(this.Invoice.DocDate==""||this.Invoice.DocDate==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.EnterDate"));return}if(this.Confirm()==!1)return;if(this.Invoice.TotalInvoice<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash"));return}if(this.Invoice.TotalInvoiceAfterVat<0||this.Invoice.TotalInvoiceAfterVat==0&&this.Invoice.TotalInvoiceAfterDisc==0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("BuyInvoice.Error.ErrorTotal"));return}if(Number(this.Invoice.Visa)<0||isNaN(Number(this.Invoice.Visa))){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash"));return}if(Number(this.Invoice.Cash)<0||isNaN(Number(this.Invoice.Cash))){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash"));return}if(Number(this.Invoice.Debt)<0||isNaN(Number(this.Invoice.Debt))){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorDebt"));return}if(Number(this.Invoice.Visa)>0&&(this.Invoice.BankAccountId<=0||this.Invoice.BankAccountId==null)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.EnterBank"));return}if(Number(this.Invoice.Cash)>0&&(this.Invoice.TreasuryId<=0||this.Invoice.TreasuryId==null)){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.EnterTreasury"));return}if(this.Invoice.PaymentType==1&&Number(this.Invoice.Cash)+Number(this.Invoice.Visa)!=this.Invoice.TotalInvoiceAfterVat){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorCash"));return}if(this.Invoice.PaymentType==2&&Number(this.Invoice.Cash)+Number(this.Invoice.Visa)+Number(this.Invoice.Debt)!=this.Invoice.TotalInvoiceAfterVat){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorDebt"));return}if(this.Invoice.PaymentType==2&&Number(this.Invoice.Debt)<=0){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ReturnBuyInvoice.Error.ErrorDebt"));return}if(this.Invoice.PaymentType==3&&this.Invoice.EmployeeId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("SalesReport.ChooseEmployee"));return}let t={InvoiceDetails:this.Invoice.InvoiceDetails.filter(e=>Number(e.Quantity)>0),Id:this.Invoice.Id,Name:this.Invoice.Name,Notes:this.Invoice.Notes,Code:this.Invoice.Code,TotalInvoice:this.Invoice.TotalInvoice,TotalDisc:this.Invoice.TotalDisc,TotalDiscRate:this.Invoice.TotalDiscRate,TotalInvoiceAfterDisc:this.Invoice.TotalInvoiceAfterDisc,TotalInvoiceAfterVat:this.Invoice.TotalInvoiceAfterVat,TotalInvoiceVatAmount:this.Invoice.TotalInvoiceVatAmount,TotalVatRate:this.Invoice.TotalVatRate,Cash:Number(this.Invoice.Cash),Visa:Number(this.Invoice.Visa),Debt:Number(this.Invoice.Debt),PaymentType:Number(this.Invoice.PaymentType),DocDate:this._Apiservice.ConvertISODate(this.Invoice.DocDate),DocNo:this.Invoice.DocNo,SupplierId:this.Invoice.SupplierId,SupplierName:this.Invoice.SupplierName,StoreId:this.Invoice.StoreId,StoreName:this.Invoice.StoreName,TreasuryId:this.Invoice.TreasuryId,TreasuryName:this.Invoice.TreasuryName,BankAccountId:this.Invoice.BankAccountId,BankAccountName:this.Invoice.BankAccountName,EmployeeId:this.Invoice.EmployeeId,EmployeeName:this.Invoice.EmployeeName,ClientId:this.Invoice.ClientId,ClientName:this.Invoice.ClientName};if(t[`Return${this.InvoiceName}Details`]=this.Invoice.InvoiceDetails.filter(e=>Number(e.Quantity)>0),t[`${this.InvoiceName}DocNo`]=this.Invoice[`${this.InvoiceName}DocNo`],t[`${this.InvoiceName}Id`]=this.Invoice[`${this.InvoiceName}Id`],t.Id==0){let e=this._Apiservice.post(`${this.AddUrl}`,t,!0).subscribe({next:n=>{n.IsSuccess==!0&&n.Obj!=null?(this._AppModeService._Toastr.success(this._AppModeService._Translate.instant("Success.AddSuccess")),this.InvoiceDocNo="",this.ResetPage(),this._SharedObjectModelService.Paging.DataReturn.push(n.Obj)):this._AppModeService._Toastr.error(n.Message)}});this.SubscriptionArr.push(e)}if(t.Id>0){let e=this._Apiservice.put(this.UpdateUrl,t,!0).subscribe({next:n=>{if(n.IsSuccess==!0&&n.Obj!=null){this._AppModeService._Toastr.success(n.Message);let m=n.Obj,f=this._SharedObjectModelService.Paging.DataReturn.find(S=>S.Id==m.Id);f!=null&&Object.assign(f,m),this.ResetPage(),this.GetPageInfo()}else this._AppModeService._Toastr.error(n.Message)}});this.SubscriptionArr.push(e)}}ConfirmDelete(t,e=void 0){e!=null&&e!=null&&(e.Id>0||e.Id!="")&&(this.Invoice.Id=e.Id),this._AppModeService._NgbModal.open(t,{size:"xxl",centered:!0})}ResetPage(){this._AppModeService.DisabledButton=!1,this.Invoice={InvoiceCollected:!1,ClientType:2,DocNo:0,DocDate:"",InvoiceDetails:[],TotalInvoice:0,TotalDiscRate:0,TotalDisc:0,TotalInvoiceAfterDisc:0,TotalInvoiceAfterVat:0,TotalInvoiceVatAmount:0,TotalVatRate:0,Cash:"",Visa:"",Debt:"",TreasuryId:null,TreasuryName:"",BankAccountId:null,BankAccountName:"",EmployeeId:null,EmployeeName:"",StoreId:null,StoreName:"",ClientId:null,ClientName:"",SupplierId:null,SupplierName:"",Id:0,PaymentType:1,Name:"",Notes:"",Code:"",InvoiceCollection:0},this.InvoiceCash=0,this.InvoiceVisa=0,this.InvoiceDept=0,this._DefaultSettingsService.ResetDate(this.Invoice),this.HandleMyDefaultSettings()}trackByMethod(t,e){return e.Id}ngOnDestroy(){for(let t=0;t<this.SubscriptionArr.length;t++)this.SubscriptionArr[t].unsubscribe()}};u.\u0275fac=function(e){return new(e||u)(V(Y),V(he),V(Te),V(me),V(K))},u.\u0275cmp=U({type:u,selectors:[["app-dynamic-return-invoice"]],viewQuery:function(e,n){if(e&1&&(k(be,5),k(Ae,5)),e&2){let m;O(m=Q())&&(n.GLComponent=m.first),O(m=Q())&&(n.ContentModel=m.first)}},inputs:{SignalR:"SignalR",TablePaging:"TablePaging",PageTitle:"PageTitle",ScreenName:"ScreenName",InvoiceName:"InvoiceName",PrintUrl:"PrintUrl",AddUrl:"AddUrl",UpdateUrl:"UpdateUrl",DeleteUrl:"DeleteUrl",GetById:"GetById"},standalone:!0,features:[F,W],decls:5,vars:8,consts:[["content",""],["GLComponent",""],["SelectTreasury",""],["SelectBank",""],["SelectEmployee",""],[3,"OpenModalEvent","ShowToEditeEvent","PageTitle","TablePaging","FullScreen","GlResponse","GetById","PrintUrl","DeleteUrl","OutModal"],[3,"PageTitle"],[1,"modal-body","bg-white","p-0","m-0"],[1,"d-flex","flex-wrap","align-items-center","col-12"],["class","col-12 col-sm-6 col-md-4 col-lg-2 px-1 d-flex flex-wrap ",4,"ngIf"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","px-1"],["for","DocNo"],["type","number",1,"form-control","text-center",3,"value","disabled"],["for","Notes"],["type","text",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","px-1","align-self-end"],["class","d-block text-center ",4,"ngIf"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12","class"," shadow-none text-center w-100",3,"showOtherMonths","showTime","showIcon","showOnFocus","ngModel","ngModelChange",4,"ngIf"],["class","col-12 col-sm-6 col-md-4 col-lg-2 px-1",4,"ngIf"],[1,"m-0"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"ngModelChange","items","disabled","virtualScroll","ngModel"],["ng-option-tmp",""],[1,"col-12","my-2","px-2","d-flex","flex-wrap"],[1,"col-12","col-md-4","col-lg-2","px-1","my-1","my-lg-0"],[1,"my-1"],["name","","id","",1,"form-select",3,"change","ngModelChange","ngModel"],[3,"value"],[3,"value",4,"ngIf"],["class","col-12 col-md-8 col-lg-4 px-0 d-flex flex-wrap align-items-center",4,"ngIf"],["class","col-12 col-md-6 my-2 px-2",4,"ngIf"],[1,"col-12","col-md-4","col-lg-2","px-3","my-1","my-lg-0"],["class","my-1",4,"ngIf"],["id","Debt","min","0","type","number","class","form-control shadow-none text-center",3,"disabled","ngModel","ngModelChange",4,"ngIf"],[1,"col-12","col-sm-3","col-md-2","text-center","px-1","d-flex","flex-wrap","border","border-1","border-info","py-2"],[1,"col-6","m-0"],["class","col-6",4,"ngIf"],[1,"col-12","col-sm-9","text-center","Info","d-flex","flex-wrap"],["class","d-block col-12 col-sm-4 border border-1 border-info text-center py-2",4,"ngIf"],["id","Table",1,"mt-2","mb-0","pb-0"],[1,"card","mb-0","table","p-0","border-top-right-radius-0","border-top-left-radius-0"],[1,"table","table-hover","table-striped","table-light","m-0","p-0"],[1,"col-3"],[1,"col-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"TotalContainer","position-relative"],[1,"col-6","col-md-3","col-lg-2","m-0","p-0","text-center"],["for","TotalInvoice",1,"text-white","m-0","p-0","text-center"],[1,"d-block","m-0","p-0","text-center"],["class","col-6 col-md-3 col-lg-2 m-0 p-0 text-center",4,"ngIf"],["for","TotalVat",1,"text-white","m-0","p-0","text-center"],["for","TotalAfterVat",1,"text-white","m-0","p-0","text-center"],[1,"modal-footer","bg-white","py-2","px-4","m-0"],[1,"btn","py-3","px-5",3,"click","ngClass"],[4,"ngIf"],["class","btn btn-info mx-3 py-3 px-5",3,"click",4,"ngIf"],["type","button",1,"btn","btn-secondary","py-3","px-5",3,"click"],[1,"col-12","col-sm-6","col-md-4","col-lg-2","px-1","d-flex","flex-wrap"],["for","InvoiceNo",1,"col-12"],[1,"col-9","px-1"],["min","0","id","InvoiceNo","type","number","autofocus","",1,"form-control","shadow-none","text-center",3,"keyup","change","ngModelChange","ngModel"],[1,"btn","btn-primary","d-block","col-3","px-3",3,"click","disabled"],[1,"d-block","text-center"],["placeholder","D-M-Y","dateFormat","dd-mm-yy","hourFormat","12",1,"shadow-none","text-center","w-100",3,"ngModelChange","showOtherMonths","showTime","showIcon","showOnFocus","ngModel"],[1,"col-12","col-md-8","col-lg-4","px-0","d-flex","flex-wrap","align-items-center"],[1,"col-12","col-md-6","px-md-1","my-1","my-lg-0"],["min","0","type","number","id","Cash",1,"form-control","py-2","shadow-none","text-center",3,"keyup","change","ngModelChange","placeholder","disabled","ngModel"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","change","scrollToEnd","close","open","ngModelChange","items","autofocus","virtualScroll","searchable","disabled","ngModel"],["ng-header-tmp",""],[1,"form-text","text-muted"],["min","0","type","number","id","Visa",1,"form-control","py-2","shadow-none","text-center",3,"keyup","change","ngModelChange","placeholder","disabled","ngModel"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","change","scrollToEnd","close","open","ngModelChange","items","virtualScroll","searchable","disabled","ngModel"],[1,"col-12","col-md-6","my-2","px-2"],["placeholder","Search","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","change","scrollToEnd","close","open","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],["id","Debt","min","0","type","number",1,"form-control","shadow-none","text-center",3,"ngModelChange","disabled","ngModel"],[1,"col-6"],[1,"d-block","col-12","col-sm-4","border","border-1","border-info","text-center","py-2"],[1,""],[1,"d-flex","justify-content-center","align-items-center"],[1,"mx-1","text-dark"],[1,"text-center"],[4,"ngFor","ngForOf"],[1,"text-dark"],["min","0","type","number",1,"form-control","text-center",3,"change","keyup","ngModelChange","id","name","ngModel"],["class","text-dark text-center d-block",4,"ngIf"],[1,"text-dark","text-center","d-block"],["for","TotalDiscount",1,"text-white","m-0","p-0","text-center"],[1,"btn","btn-info","mx-3","py-3","px-5",3,"click"]],template:function(e,n){if(e&1){let m=A();a(0,"app-dynamic-component",5),C("OpenModalEvent",function(){return p(m),_(n.OpenModal())})("ShowToEditeEvent",function(){return p(m),_(n.ShowToEdite())}),c(),g(1,st,122,99,"ng-template",null,0,G),w(3,"app-glsheard",null,1)}if(e&2){let m=b(2);d("PageTitle",n.PageTitle)("TablePaging",n.TablePaging)("FullScreen",!0)("GlResponse",!0)("GetById",n.GetById)("PrintUrl",n.PrintUrl)("DeleteUrl",n.DeleteUrl)("OutModal",m)}},dependencies:[z,Ie,de,pe,se,ce,le,ae,ne,oe,X,te,ie,Z,re,ee,q,$,H,ve,ue,_e,ge,xe,ye]});let o=u;return o})();export{Rt as a};
