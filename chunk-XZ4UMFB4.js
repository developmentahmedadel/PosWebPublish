import{g as ne,h as oe,j as ae,n as ce,s as le}from"./chunk-S52O5BXQ.js";import"./chunk-KOJPIKRQ.js";import{h as ie,i as re}from"./chunk-WL6N6SLT.js";import{a as se}from"./chunk-JZVD3M6G.js";import"./chunk-34JSETBR.js";import"./chunk-QFTVA365.js";import"./chunk-LNYZIAUP.js";import{k as te}from"./chunk-HYE6JRVA.js";import{a as K,b as q,c as J,d as Q}from"./chunk-DVVEKPVL.js";import{b as ee}from"./chunk-GTD5WNPP.js";import{c as B,f as W,h as F,k as $,m as z,s as L,u as H}from"./chunk-M24M3PNC.js";import{b as X,c as Y,d as Z}from"./chunk-4L6P5Z5M.js";import{G as U,e as D}from"./chunk-JM67XKKX.js";import{$b as y,Bb as l,Cb as a,Db as k,Hb as b,Lb as C,Mb as g,Vb as v,Wb as _,Xb as f,Yb as T,Zb as x,_b as A,ac as V,cb as c,cc as N,db as M,dc as R,mc as h,na as j,nc as S,ub as I,wb as P,xa as d,ya as u}from"./chunk-VIO7ZK3G.js";import{a as E,b as G}from"./chunk-3EYC4JTX.js";var pe=()=>({"min-width":"75rem"}),de=()=>["Name"];function ue(n,s){if(n&1&&(l(0,"small",29),_(1),a()),n&2){let r=g();c(),x("Loaded ",r.Groups.length," of ",r._SharedObjectModelService.TotalItems,"")}}function me(n,s){if(n&1&&_(0),n&2){let r=s.item;T(" ",r.Name," ")}}function _e(n,s){if(n&1&&(l(0,"small",29),_(1),a()),n&2){let r=g();c(),x("Loaded ",r.Items.length," of ",r._SharedObjectModelService.TotalItems,"")}}function ge(n,s){if(n&1&&_(0),n&2){let r=s.item;T(" ",r.NameAndCode," ")}}function Pe(n,s){if(n&1){let r=b();l(0,"button",30),C("click",function(){d(r);let i=g();return u(i.EmptyPage())}),_(1),h(2,"translate"),a()}n&2&&(c(),f(S(2,1,"Model.ResetPage")))}function he(n,s){if(n&1){let r=b();l(0,"div",31)(1,"p-button",32),C("onClick",function(){d(r);let i=g();return u(i.ExpandAll())}),a(),l(2,"p-button",33),C("onClick",function(){d(r);let i=g();return u(i.CollapseAll())}),a()()}}function Se(n,s){n&1&&(l(0,"tr")(1,"th",34),_(2),h(3,"translate"),a(),l(4,"th",35),_(5),h(6,"translate"),a(),l(7,"th",35),_(8),h(9,"translate"),a(),l(10,"th"),_(11,"-"),a()()),n&2&&(c(2),f(S(3,3,"Table.Units")),c(3),f(S(6,5,"Table.Name")),c(3),f(S(9,7,"Table.WA")))}function fe(n,s){if(n&1){let r=b();l(0,"tr")(1,"td"),k(2,"p-button",36),a(),l(3,"td")(4,"span",37),_(5),a()(),l(6,"td")(7,"span",37),_(8),a()(),l(9,"td")(10,"p-button",38),C("click",function(){let i=d(r).$implicit,e=g();return u(e.RemoveProcut(i))}),a()()()}if(n&2){let r=s.$implicit,t=s.expanded,i=g();c(2),P("pRowToggler",r)("text",!0)("rounded",!0)("plain",!0)("icon",t?"pi pi-chevron-down":i._Apiservice.Language=="ar"?"pi pi-chevron-left":"pi pi-chevron-right"),c(3),f(r.ProductName),c(3),f(r.WA),c(2),P("icon","pi pi-trash")}}function Ce(n,s){n&1&&(l(0,"tr")(1,"th"),_(2),h(3,"translate"),a(),l(4,"th"),_(5),h(6,"translate"),a()()),n&2&&(c(2),T("",S(3,2,"Table.Name")," "),c(3),f(S(6,4,"Table.Price")))}function Ie(n,s){if(n&1&&(l(0,"span",46),_(1),h(2,"translate"),a()),n&2){let r=g().$implicit,t=g(2);c(),x(" ",S(2,2,"ProductPricing.Hamesh")," => ",(t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)).toFixed(2),"")}}function be(n,s){if(n&1&&(l(0,"span",47),_(1),h(2,"translate"),a()),n&2){let r=g().$implicit,t=g(2);c(),x(" ",S(2,2,"ProductPricing.Hamesh")," => ",(t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)).toFixed(2)," ")}}function ve(n,s){if(n&1){let r=b();l(0,"tr")(1,"td",41)(2,"span",42),_(3),a(),I(4,Ie,3,4,"span",43)(5,be,3,4,"span",44),a(),l(6,"td")(7,"input",45),V("ngModelChange",function(i){let e=d(r).$implicit;return y(e.ProductUnitPrice,i)||(e.ProductUnitPrice=i),u(i)}),a()()()}if(n&2){let r=s.$implicit,t=g(2);c(3),x(" ",r.ProductUnitName," - ",r.ProductUnitWA,""),c(),P("ngIf",t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)<0),c(),P("ngIf",t.ConvertNumber(r.ProductUnitPrice)-t.ConvertNumber(r.ProductUnitWA)>=0),c(2),A("ngModel",r.ProductUnitPrice)}}function xe(n,s){if(n&1&&(l(0,"tr")(1,"td",39)(2,"p-table",40),I(3,Ce,7,6,"ng-template",22)(4,ve,8,5,"ng-template",23),a()()()),n&2){let r=s.$implicit;c(2),P("value",r.ProductPricingDetails)}}function Me(n,s){if(n&1){let r=b();l(0,"p-paginator",48),C("onPageChange",function(i){d(r);let e=g();return u(e.onPageChange(i))}),a()}if(n&2){let r=g();P("first",r._SharedObjectModelService.Paging.CurrentPage)("rows",r._SharedObjectModelService.Paging.PageSize)("totalRecords",r._SharedObjectModelService.Paging.TotalItems)("rowsPerPageOptions",r._AppModeService.RowCount)}}function Te(n,s){if(n&1){let r=b();l(0,"p-paginator",49),C("onPageChange",function(i){d(r);let e=g();return u(e.onPageChange(i))}),a()}if(n&2){let r=g();P("first",r._SharedObjectModelService.Paging.CurrentPage)("rows",r._SharedObjectModelService.Paging.PageSize)("totalRecords",r._SharedObjectModelService.Paging.TotalItems)}}function we(n,s){if(n&1){let r=b();l(0,"button",50),C("click",function(){d(r);let i=g();return u(i.Send())}),_(1),h(2,"translate"),a()}n&2&&(c(),f(S(2,1,"Model.Send")))}var Ke=(()=>{let s=class s{constructor(t,i,e,o){this._AppModeService=t,this._SharedObjectModelService=i,this.Translate=e,this._Apiservice=o,this.SubscriptionArr=[],this.ProductPricing=[],this.Groups=[],this.Items=[],this.SearchModel={ProductId:null,ProductGroupId:null},this.expandedRows={}}ngOnInit(){}ChangeSearchApi(t,i){let e=`${i.searchTerm}`.trim();(e==""||e=="null")&&(i.searchTerm="",e=""),this._AppModeService.CurrentPage+=1;let o={TableName:t,Columns:["Id","Name"],Conditions:"",PageSize:this._AppModeService.TabTake,CurrentPage:this._AppModeService.CurrentPage,SearchText:e,SearchField:"Name"};t=="Storages"&&(o.BranchFilter=!0),t=="Items"&&(o.Columns=["Id","Name","Code"],this.SearchModel.ProductGroupId>0&&(o.Conditions=` ItemGroupId = ${this.SearchModel.ProductGroupId}`)),t=="ItemsCode"&&(o.TableName="Items",o.Columns=["Id","Name","Code"],o.SearchText=i,this.SearchModel.ProductGroupId>0&&(o.Conditions=`ProductType != 2 And ItemGroupId = ${this.SearchModel.ProductGroupId}`));let m=this._Apiservice.post("Global/GetAll",o,!1).subscribe({next:p=>{p.IsSuccess==!0&&p.Obj!=null?this.HandleResponse(p.Obj,t):this._AppModeService._Toastr.error(p.Message)}});this.SubscriptionArr.push(m)}HandleResponse(t,i){this._SharedObjectModelService.TotalItems=0,this._SharedObjectModelService.TotalItems=t.TotalItems,i=="ItemGroups"&&(this.Groups=this._SharedObjectModelService.RemoveDuplicates(this.Groups.concat(t.DataReturn),"Id")),i=="Items"&&(this.Items=this._SharedObjectModelService.RemoveDuplicates(this.Items.concat(t.DataReturn),"Id"),this.Items=this.Items.map(e=>G(E({},e),{NameAndCode:`${e.Name} - ${e.Code}`}))),i=="ItemsCode"&&(this.Items=t.DataReturn,this.Items=this.Items.map(e=>G(E({},e),{NameAndCode:`${e.Name} - ${e.Code}`})))}SelectValue(t,i){if(t!=null&&(t>0||t!="")){let e=[];i=="ProductGroup"&&(e=this.Groups),i=="Product"&&(e=this.Items);let o=e.find(m=>m.Id==t);if(o==null){this._AppModeService.DontPlay();return}else this.SearchModel[`${i}Id`]=t,this.SearchModel[`${i}Name`]=o.Name}else this.SearchModel[`${i}Id`]=null,this.SearchModel[`${i}Name`]=""}ConvertNumber(t){return Number(t)}Search(){if(this.SearchModel.ProductId==null&&this.SearchModel.ProductGroupId==null){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("ProductPricing.Error.GroupOrProduct"));return}let t={ProductId:this.SearchModel.ProductId==null?0:this.SearchModel.ProductId,ProductGroupId:this.SearchModel.ProductGroupId==null?0:this.SearchModel.ProductGroupId,CurrentPage:1,PageSize:this._SharedObjectModelService.Paging.PageSize},i=this._Apiservice.post("ProductPricingEP/GetPageInfo",t,!0).subscribe({next:e=>{e.IsSuccess==!0&&e.Obj!=null?(this.ProductPricing=this._SharedObjectModelService.RemoveDuplicates(this.ProductPricing.concat(e.Obj.DataReturn),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=e.Obj.TotalItems):this._AppModeService._Toastr.error(e.Message)}});this.SubscriptionArr.push(i)}onPageChange(t){t.page++,t.first,t.rows,this._SharedObjectModelService.Paging.CurrentPage=t.first,this._SharedObjectModelService.Paging.PageSize=t.rows;let i={ItemId:this.SearchModel.ItemId==null?0:this.SearchModel.ItemId,ItemGroupId:this.SearchModel.ItemGroupId==null?0:this.SearchModel.ItemGroupId,PageSize:this._SharedObjectModelService.Paging.PageSize,CurrentPage:t.page},e=this._Apiservice.post("ProductPricingEP/GetPageInfo",i,!0).subscribe({next:o=>{o.IsSuccess==!0&&o.Obj!=null?(this.ProductPricing=this._SharedObjectModelService.RemoveDuplicates(this.ProductPricing.concat(o.Obj.DataReturn),"ProductId"),this._SharedObjectModelService.Paging.TotalItems=o.Obj.TotalItems):this._AppModeService._Toastr.error(o.Message)}});this.SubscriptionArr.push(e)}RemoveProcut(t){this.ProductPricing=this.ProductPricing.filter(i=>i.ProductId!=t.ProductId)}ExpandAll(){this.expandedRows=this.ProductPricing.reduce((t,i)=>(t[i.Id]=!0)&&t,{})}CollapseAll(){this.expandedRows={}}Send(){for(let i=0;i<this.ProductPricing.length;i++){let e=this.ProductPricing[i].ProductPricingDetails;for(let o=0;o<e.length;o++){let m=e[o],p=i+1,O=Number(m.ProductUnitWA),w=Number(m.ProductUnitPrice);if(w<0||isNaN(w)){this._AppModeService._Toastr.error(this.Translate.instant("ProductPricing.Error.ErrorNumber")+" "+p);return}if(O>0&&w<O){this._AppModeService._Toastr.error(this.Translate.instant("ProductPricing.Error.SmallWA")+" "+p);return}m.ProductUnitPrice=w}}let t=this._Apiservice.post("ProductPricingEP/Add",this.ProductPricing,!0).subscribe({next:i=>{i.IsSuccess==!0&&i.Obj!=null?(this._AppModeService._Toastr.success(this.Translate.instant("Success.AddSuccess")),this.EmptyPage()):this._AppModeService._Toastr.error(i.Message)}});this.SubscriptionArr.push(t)}EmptyPage(){this.SearchModel={ItemGroupId:null,ItemId:null},this.ProductPricing=[]}ngOnDestroy(){for(let t=0;t<this.SubscriptionArr.length;t++)this.SubscriptionArr[t].unsubscribe()}};s.\u0275fac=function(i){return new(i||s)(M(ee),M(se),M(X),M(B))},s.\u0275cmp=j({type:s,selectors:[["app-product-pricing"]],standalone:!0,features:[N],decls:41,vars:35,consts:[["SelectGroup",""],["SelectFromStore",""],["dt1",""],["clas","bg-light"],["id","container-page",1,"container-page","p-0","m-0"],[1,"page-wrapper","p-0","m-0"],[1,"main-content","p-0","m-0"],[1,"inner-box","min-vh-100","px-2","m-0"],[1,"title-box","font-weight-normal"],[1,"d-flex","flex-wrap","align-items-end","py-2","col-12"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","px-1"],["for","FromStoreId",1,"my-1"],["placeholder","Search","appendTo","div","bindLabel","Name","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","virtualScroll","searchable","ngModel"],["ng-header-tmp",""],["ng-option-tmp",""],["placeholder","Search","bindLabel","NameAndCode","bindValue","Id",1,"p-0","text-center",3,"clear","focus","keyup","scrollToEnd","close","open","change","ngModelChange","items","autofocus","virtualScroll","searchable","ngModel"],[1,"col-12","col-sm-6","col-md-6","px-1","text-center"],[1,"btn","btn-success","mx-2","px-5","py-3","shadow-none","Save",3,"click"],["class","btn btn-primary mx-2 px-5 py-3 shadow-none ",3,"click",4,"ngIf"],[1,"card","table","mb-0","p-0","border-top-right-radius-0","border-top-left-radius-0"],["dataKey","ProductId","scrollHeight","100vh","sortMode","multiple",3,"value","expandedRowKeys","lazy","scrollable","paginator","rows","tableStyle","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["appendTo","table",3,"first","rows","totalRecords","rowsPerPageOptions","onPageChange",4,"ngIf"],["appendTo","table",3,"first","rows","totalRecords","onPageChange",4,"ngIf"],[1,"text-center"],["type","button","class","btn btn-success m-3 py-2 px-5",3,"click",4,"ngIf"],[1,"form-text","text-muted"],[1,"btn","btn-primary","mx-2","px-5","py-3","shadow-none",3,"click"],[1,"flex","flex-wrap","justify-content-end","gap-2"],["label","Expand All","icon","pi pi-plus","text","",3,"onClick"],["label","Collapse All","icon","pi pi-minus","text","",3,"onClick"],[1,"col-2"],[1,"col-6"],["type","button","pRipple","",3,"pRowToggler","text","rounded","plain","icon"],[1,"text-dark","d-block","text-center"],["type","button","severity","danger",3,"click","icon"],["colspan","7",1,"p-0"],["dataKey","ProductId",3,"value"],[1,"p-1"],[1,"text-dark"],["class","d-block text-center my-1 text-danger",4,"ngIf"],["class","d-block text-center my-1 text-success",4,"ngIf"],["min","0","type","number",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"d-block","text-center","my-1","text-danger"],[1,"d-block","text-center","my-1","text-success"],["appendTo","table",3,"onPageChange","first","rows","totalRecords","rowsPerPageOptions"],["appendTo","table",3,"onPageChange","first","rows","totalRecords"],["type","button",1,"btn","btn-success","m-3","py-2","px-5",3,"click"]],template:function(i,e){if(i&1){let o=b();l(0,"section",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"div",8),_(6),h(7,"translate"),a(),l(8,"div",9)(9,"div",10)(10,"p",11),_(11),h(12,"translate"),a(),l(13,"ng-select",12,0),C("clear",function(){return d(o),u(e.Groups=[])})("focus",function(){d(o);let p=v(14);return e.ChangeSearchApi("ItemGroups",p),u(e._AppModeService.ResetCurrentPage())})("keyup",function(){d(o);let p=v(14);return e.ChangeSearchApi("ItemGroups",p),u(e._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){d(o);let p=v(14);return u(e.ChangeSearchApi("ItemGroups",p))})("close",function(){return d(o),u(e._AppModeService.ResetCurrentPage())})("open",function(){return d(o),u(e._AppModeService.ResetCurrentPage())})("change",function(){return d(o),e.SelectValue(e.SearchModel.ProductGroupId,"ProductGroup"),e.SearchModel.ProductId=null,u(e.Items=[])}),V("ngModelChange",function(p){return d(o),y(e.SearchModel.ProductGroupId,p)||(e.SearchModel.ProductGroupId=p),u(p)}),I(15,ue,2,2,"ng-template",13)(16,me,1,1,"ng-template",14),a()(),l(17,"div",10)(18,"p",11),_(19),h(20,"translate"),a(),l(21,"ng-select",15,1),C("clear",function(){return d(o),u(e.Items=[])})("focus",function(){d(o);let p=v(22);return e.ChangeSearchApi("Items",p),u(e._AppModeService.ResetCurrentPage())})("keyup",function(){d(o);let p=v(22);return e.ChangeSearchApi("Items",p),u(e._AppModeService.ResetCurrentPage())})("scrollToEnd",function(){d(o);let p=v(22);return u(e.ChangeSearchApi("Items",p))})("close",function(){return d(o),u(e._AppModeService.ResetCurrentPage())})("open",function(){return d(o),u(e._AppModeService.ResetCurrentPage())})("change",function(){return d(o),u(e.SelectValue(e.SearchModel.ProductId,"Product"))}),V("ngModelChange",function(p){return d(o),y(e.SearchModel.ProductId,p)||(e.SearchModel.ProductId=p),u(p)}),I(23,_e,2,2,"ng-template",13)(24,ge,1,1,"ng-template",14),a()(),l(25,"div",16)(26,"button",17),C("click",function(){return d(o),u(e.Search())}),_(27),h(28,"translate"),a(),I(29,Pe,3,3,"button",18),a()(),l(30,"div",19)(31,"p-table",20,2),I(33,he,3,0,"ng-template",21)(34,Se,12,9,"ng-template",22)(35,fe,11,8,"ng-template",23)(36,xe,5,1,"ng-template",24),a(),I(37,Me,1,4,"p-paginator",25)(38,Te,1,3,"p-paginator",26),a(),l(39,"div",27),I(40,we,3,3,"button",28),a()()()()()()}i&2&&(c(6),T(" ",S(7,25,"ProductPricing.ProductPricing")," "),c(5),f(S(12,27,"Item.ItemGroup")),c(2),P("items",e.Groups)("virtualScroll",!0)("searchable",!0),A("ngModel",e.SearchModel.ProductGroupId),c(6),f(S(20,29,"Table.Item")),c(2),P("items",e.Items)("autofocus",!1)("virtualScroll",!0)("searchable",!0),A("ngModel",e.SearchModel.ProductId),c(6),f(S(28,31,"Model.Search")),c(2),P("ngIf",e.ProductPricing.length>0),c(2),P("value",e.ProductPricing)("expandedRowKeys",e.expandedRows)("lazy",!0)("scrollable",!0)("paginator",!1)("rows",e._SharedObjectModelService.Paging.PageSize)("tableStyle",R(33,pe))("globalFilterFields",R(34,de)),c(6),P("ngIf",e._SharedObjectModelService.Paging.TotalItems>=10),c(),P("ngIf",e._SharedObjectModelService.Paging.TotalItems<10),c(2),P("ngIf",e.ProductPricing.length>0))},dependencies:[U,D,H,W,z,F,L,$,Z,Y,Q,J,K,q,oe,ne,te,le,ae,ce,re,ie]});let n=s;return n})();export{Ke as ProductPricingComponent};
